{"platform":{"name":"windows_11_enterprise","release":"10.0.22621","target_id":"b602ff65-60bf-59e9-aa86-c414b787823f"},"profiles":[{"name":"vmware-vsphere-8.0-stig-baseline","version":"1.0.1","sha256":"037df02b2bce1332a63d955e79ec40ce574f703eb75c99ba683cac85c3471612","title":"InSpec Wrapper Profile for VMware vSphere 8.0 STIG Readiness Guide Version 1 Release 1","maintainer":"VMware","summary":"An InSpec Compliance Profile that runs PowerCLI audit tests on ESXI, VMs, and vCenter","license":"Apache-2.0","copyright":"The Authors","copyright_email":"stigs@vmware.com","supports":[],"attributes":[{"name":"vmhostName","options":{"value":"10.186.25.26"}},{"name":"cluster","options":{"value":""}},{"name":"allesxi","options":{"value":false}},{"name":"adJoined","options":{"value":false}},{"name":"adAdminGroup","options":{"value":"MyAdAdminGroup"}},{"name":"syslogServer","options":{"value":"tcp://log.test.local:514"}},{"name":"esxiNtpServers","options":{"value":["time-a-g.nist.gov","time-b-g.nist.gov"]}},{"name":"vMotionVlanId","options":{"value":"100"}},{"name":"mgtVlanId","options":{"value":"101"}},{"name":"exceptionUsers","options":{"value":["root","dcui"]}},{"name":"snmpEnabled","options":{"value":"false"}},{"name":"esxiBuildNumber","options":{"value":"21813344"}},{"name":"syslogServers","options":{"value":["loginsight.vmware.com","syslog.server2.com"]}},{"name":"ntpServers","options":{"value":["time-a-g.nist.gov","time-b-g.nist.gov"]}},{"name":"ipfixCollectorAddress","options":{"value":""}},{"name":"vcCryptoAdmins","options":{"value":["VSPHERE.LOCAL\\Administrator","VSPHERE.LOCAL\\Administrators","VSPHERE.LOCAL\\vCLSAdmin"]}},{"name":"vcCryptoRoles","options":{"value":["Admin","NoTrustedAdmin","vCLSAdmin","vSphereKubernetesManager"]}},{"name":"bashShellAdminUsers","options":{"value":["Administrator"]}},{"name":"bashShellAdminGroups","options":{"value":[]}},{"name":"trustedAdminUsers","options":{"value":[]}},{"name":"trustedAdminGroups","options":{"value":[]}},{"name":"backup3rdParty","options":{"value":false}},{"name":"vmName","options":{"value":""}},{"name":"allvms","options":{"value":true}}],"depends":[{"name":"esxi","path":"esxi","status":"loaded"},{"name":"vcenter","path":"vcenter","status":"loaded"},{"name":"vm","path":"vm","status":"loaded"}],"groups":[{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000005.rb","controls":["ESXI-80-000005"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000006.rb","controls":["ESXI-80-000006"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000008.rb","controls":["ESXI-80-000008"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000010.rb","controls":["ESXI-80-000010"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000014.rb","controls":["ESXI-80-000014"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000015.rb","controls":["ESXI-80-000015"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000035.rb","controls":["ESXI-80-000035"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000043.rb","controls":["ESXI-80-000043"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000047.rb","controls":["ESXI-80-000047"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000049.rb","controls":["ESXI-80-000049"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000052.rb","controls":["ESXI-80-000052"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000068.rb","controls":["ESXI-80-000068"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000085.rb","controls":["ESXI-80-000085"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000094.rb","controls":["ESXI-80-000094"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000111.rb","controls":["ESXI-80-000111"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000113.rb","controls":["ESXI-80-000113"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000114.rb","controls":["ESXI-80-000114"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000124.rb","controls":["ESXI-80-000124"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000133.rb","controls":["ESXI-80-000133"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000145.rb","controls":["ESXI-80-000145"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000160.rb","controls":["ESXI-80-000160"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000161.rb","controls":["ESXI-80-000161"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000187.rb","controls":["ESXI-80-000187"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000189.rb","controls":["ESXI-80-000189"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000191.rb","controls":["ESXI-80-000191"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000192.rb","controls":["ESXI-80-000192"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000193.rb","controls":["ESXI-80-000193"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000194.rb","controls":["ESXI-80-000194"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000195.rb","controls":["ESXI-80-000195"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000196.rb","controls":["ESXI-80-000196"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000198.rb","controls":["ESXI-80-000198"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000199.rb","controls":["ESXI-80-000199"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000201.rb","controls":["ESXI-80-000201"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000202.rb","controls":["ESXI-80-000202"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000203.rb","controls":["ESXI-80-000203"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000204.rb","controls":["ESXI-80-000204"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000205.rb","controls":["ESXI-80-000205"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000206.rb","controls":["ESXI-80-000206"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000207.rb","controls":["ESXI-80-000207"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000208.rb","controls":["ESXI-80-000208"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000209.rb","controls":["ESXI-80-000209"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000210.rb","controls":["ESXI-80-000210"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000211.rb","controls":["ESXI-80-000211"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000212.rb","controls":["ESXI-80-000212"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000213.rb","controls":["ESXI-80-000213"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000214.rb","controls":["ESXI-80-000214"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000215.rb","controls":["ESXI-80-000215"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000216.rb","controls":["ESXI-80-000216"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000217.rb","controls":["ESXI-80-000217"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000218.rb","controls":["ESXI-80-000218"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000219.rb","controls":["ESXI-80-000219"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000220.rb","controls":["ESXI-80-000220"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000221.rb","controls":["ESXI-80-000221"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000222.rb","controls":["ESXI-80-000222"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000223.rb","controls":["ESXI-80-000223"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000224.rb","controls":["ESXI-80-000224"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000225.rb","controls":["ESXI-80-000225"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000226.rb","controls":["ESXI-80-000226"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000227.rb","controls":["ESXI-80-000227"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000228.rb","controls":["ESXI-80-000228"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000229.rb","controls":["ESXI-80-000229"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000230.rb","controls":["ESXI-80-000230"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000231.rb","controls":["ESXI-80-000231"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000232.rb","controls":["ESXI-80-000232"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000233.rb","controls":["ESXI-80-000233"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000234.rb","controls":["ESXI-80-000234"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000235.rb","controls":["ESXI-80-000235"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000236.rb","controls":["ESXI-80-000236"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000237.rb","controls":["ESXI-80-000237"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000238.rb","controls":["ESXI-80-000238"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000239.rb","controls":["ESXI-80-000239"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000240.rb","controls":["ESXI-80-000240"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000241.rb","controls":["ESXI-80-000241"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000243.rb","controls":["ESXI-80-000243"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000244.rb","controls":["ESXI-80-000244"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000245.rb","controls":["ESXI-80-000245"]},{"id":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000246.rb","controls":["ESXI-80-000246"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000009.rb","controls":["VCSA-80-000009"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000023.rb","controls":["VCSA-80-000023"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000024.rb","controls":["VCSA-80-000024"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000034.rb","controls":["VCSA-80-000034"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000057.rb","controls":["VCSA-80-000057"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000059.rb","controls":["VCSA-80-000059"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000060.rb","controls":["VCSA-80-000060"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000069.rb","controls":["VCSA-80-000069"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000070.rb","controls":["VCSA-80-000070"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000071.rb","controls":["VCSA-80-000071"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000072.rb","controls":["VCSA-80-000072"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000073.rb","controls":["VCSA-80-000073"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000074.rb","controls":["VCSA-80-000074"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000077.rb","controls":["VCSA-80-000077"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000079.rb","controls":["VCSA-80-000079"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000080.rb","controls":["VCSA-80-000080"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000089.rb","controls":["VCSA-80-000089"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000095.rb","controls":["VCSA-80-000095"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000110.rb","controls":["VCSA-80-000110"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000123.rb","controls":["VCSA-80-000123"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000145.rb","controls":["VCSA-80-000145"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000148.rb","controls":["VCSA-80-000148"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000150.rb","controls":["VCSA-80-000150"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000158.rb","controls":["VCSA-80-000158"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000195.rb","controls":["VCSA-80-000195"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000196.rb","controls":["VCSA-80-000196"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000248.rb","controls":["VCSA-80-000248"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000253.rb","controls":["VCSA-80-000253"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000265.rb","controls":["VCSA-80-000265"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000266.rb","controls":["VCSA-80-000266"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000267.rb","controls":["VCSA-80-000267"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000268.rb","controls":["VCSA-80-000268"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000269.rb","controls":["VCSA-80-000269"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000270.rb","controls":["VCSA-80-000270"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000271.rb","controls":["VCSA-80-000271"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000272.rb","controls":["VCSA-80-000272"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000273.rb","controls":["VCSA-80-000273"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000274.rb","controls":["VCSA-80-000274"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000275.rb","controls":["VCSA-80-000275"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000276.rb","controls":["VCSA-80-000276"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000277.rb","controls":["VCSA-80-000277"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000278.rb","controls":["VCSA-80-000278"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000279.rb","controls":["VCSA-80-000279"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000280.rb","controls":["VCSA-80-000280"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000281.rb","controls":["VCSA-80-000281"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000282.rb","controls":["VCSA-80-000282"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000283.rb","controls":["VCSA-80-000283"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000284.rb","controls":["VCSA-80-000284"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000285.rb","controls":["VCSA-80-000285"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000286.rb","controls":["VCSA-80-000286"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000287.rb","controls":["VCSA-80-000287"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000288.rb","controls":["VCSA-80-000288"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000290.rb","controls":["VCSA-80-000290"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000291.rb","controls":["VCSA-80-000291"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000292.rb","controls":["VCSA-80-000292"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000293.rb","controls":["VCSA-80-000293"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000294.rb","controls":["VCSA-80-000294"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000295.rb","controls":["VCSA-80-000295"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000296.rb","controls":["VCSA-80-000296"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000298.rb","controls":["VCSA-80-000298"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000299.rb","controls":["VCSA-80-000299"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000300.rb","controls":["VCSA-80-000300"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000301.rb","controls":["VCSA-80-000301"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000302.rb","controls":["VCSA-80-000302"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000303.rb","controls":["VCSA-80-000303"]},{"id":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000304.rb","controls":["VCSA-80-000304"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000189.rb","controls":["VMCH-80-000189"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000191.rb","controls":["VMCH-80-000191"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000192.rb","controls":["VMCH-80-000192"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000193.rb","controls":["VMCH-80-000193"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000194.rb","controls":["VMCH-80-000194"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000195.rb","controls":["VMCH-80-000195"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000196.rb","controls":["VMCH-80-000196"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000197.rb","controls":["VMCH-80-000197"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000198.rb","controls":["VMCH-80-000198"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000199.rb","controls":["VMCH-80-000199"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000200.rb","controls":["VMCH-80-000200"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000201.rb","controls":["VMCH-80-000201"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000202.rb","controls":["VMCH-80-000202"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000203.rb","controls":["VMCH-80-000203"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000204.rb","controls":["VMCH-80-000204"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000205.rb","controls":["VMCH-80-000205"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000206.rb","controls":["VMCH-80-000206"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000207.rb","controls":["VMCH-80-000207"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000208.rb","controls":["VMCH-80-000208"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000209.rb","controls":["VMCH-80-000209"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000210.rb","controls":["VMCH-80-000210"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000211.rb","controls":["VMCH-80-000211"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000212.rb","controls":["VMCH-80-000212"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000213.rb","controls":["VMCH-80-000213"]},{"id":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000214.rb","controls":["VMCH-80-000214"]}],"controls":[{"id":"ESXI-80-000005","title":"The ESXi host must enforce the limit of three consecutive invalid logon attempts by a user.","desc":"By limiting the number of failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Once the configured number of attempts is reached, the account is locked by the ESXi host.","descriptions":[{"label":"default","data":"By limiting the number of failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Once the configured number of attempts is reached, the account is locked by the ESXi host."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.AccountLockFailures\" value and verify it is set to \"3\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures\n\nIf the \"Security.AccountLockFailures\" setting is set to a value other than \"3\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.AccountLockFailures\" value and configure it to \"3\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures | Set-AdvancedSetting -Value 3"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000021-VMM-000050","gid":"V-ESXI-80-000005","rid":"SV-ESXI-80-000005","stig_id":"ESXI-80-000005","cci":["CCI-000044"],"nist":["AC-7 a"]},"code":"control 'ESXI-80-000005' do\n  title 'The ESXi host must enforce the limit of three consecutive invalid logon attempts by a user.'\n  desc  'By limiting the number of failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Once the configured number of attempts is reached, the account is locked by the ESXi host.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.AccountLockFailures\\\" value and verify it is set to \\\"3\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures\n\n    If the \\\"Security.AccountLockFailures\\\" setting is set to a value other than \\\"3\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.AccountLockFailures\\\" value and configure it to \\\"3\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures | Set-AdvancedSetting -Value 3\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000021-VMM-000050'\n  tag gid: 'V-ESXI-80-000005'\n  tag rid: 'SV-ESXI-80-000005'\n  tag stig_id: 'ESXI-80-000005'\n  tag cci: ['CCI-000044']\n  tag nist: ['AC-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.AccountLockFailures | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '3' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000005.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000006","title":"The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via the Direct Console User Interface (DCUI).","desc":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Annotations.WelcomeMessage\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage\n\nIf the \"Annotations.WelcomeMessage\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Annotations.WelcomeMessage\" value and set it to the following. Click \"OK\".\n\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{hostname} , {ip}{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{esxproduct} {esxversion}{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{memory} RAM{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:white}\t{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By      {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  using this IS (which includes any device attached to this IS), you consent to the following conditions:                 {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited     {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law      {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          enforcement (LE), and counterintelligence (CI) investigations.                                                  {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       At any time, the USG may inspect and seize data stored on this IS.                                              {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Communications using, or data stored on, this IS are not private, are subject to routine monitoring,            {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          interception, and search, and may be disclosed or used for any USG-authorized purpose.                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not     {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          for your personal benefit or privacy.                                                                           {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching    {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or monitoring of the content of privileged communications, or work product, related to personal representation  {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work       {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          product are private and confidential. See User Agreement for details.                                           {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{align:left}{bgcolor:dark-grey}{color:white}  <F2> Accept Conditions and Customize System / View Logs{/align}{align:right}<F12> Accept Conditions and Shut Down/Restart  {bgcolor:black} {/color}{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Set-AdvancedSetting -Value \"<Banner text above>\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000023-VMM-000060","satisfies":["SRG-OS-000024-VMM-000070"],"gid":"V-ESXI-80-000006","rid":"SV-ESXI-80-000006","stig_id":"ESXI-80-000006","cci":["CCI-000048","CCI-000050"],"nist":["AC-8 a","AC-8 b"]},"code":"control 'ESXI-80-000006' do\n  title 'The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via the Direct Console User Interface (DCUI).'\n  desc  \"\n    Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Annotations.WelcomeMessage\\\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage\n\n    If the \\\"Annotations.WelcomeMessage\\\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Annotations.WelcomeMessage\\\" value and set it to the following. Click \\\"OK\\\".\n\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{hostname} , {ip}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{esxproduct} {esxversion}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{memory} RAM{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:white}\\t{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  using this IS (which includes any device attached to this IS), you consent to the following conditions:                 {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          enforcement (LE), and counterintelligence (CI) investigations.                                                  {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       At any time, the USG may inspect and seize data stored on this IS.                                              {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Communications using, or data stored on, this IS are not private, are subject to routine monitoring,            {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          interception, and search, and may be disclosed or used for any USG-authorized purpose.                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          for your personal benefit or privacy.                                                                           {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching    {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or monitoring of the content of privileged communications, or work product, related to personal representation  {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work       {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          product are private and confidential. See User Agreement for details.                                           {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{align:left}{bgcolor:dark-grey}{color:white}  <F2> Accept Conditions and Customize System / View Logs{/align}{align:right}<F12> Accept Conditions and Shut Down/Restart  {bgcolor:black} {/color}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Set-AdvancedSetting -Value \\\"<Banner text above>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag satisfies: ['SRG-OS-000024-VMM-000070']\n  tag gid: 'V-ESXI-80-000006'\n  tag rid: 'SV-ESXI-80-000006'\n  tag stig_id: 'ESXI-80-000006'\n  tag cci: ['CCI-000048', 'CCI-000050']\n  tag nist: ['AC-8 a', 'AC-8 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      result = powercli_command(\"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Select-Object -ExpandProperty Value\")\n      describe.one do\n        describe result do\n          its('stdout.strip') { should match 'You are accessing a U.S. Government' }\n        end\n        describe result do\n          its('stdout.strip') { should match \"I've read & consent to terms in IS user agreem't\" }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000006.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000008","title":"The ESXi host must enable lockdown mode.","desc":"Enabling Lockdown Mode disables direct access to an ESXi host, requiring the host to be managed remotely from vCenter Server. This is done to ensure the roles and access controls implemented in vCenter are always enforced and users cannot bypass them by logging on to a host directly.\n\nBy forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced.","descriptions":[{"label":"default","data":"Enabling Lockdown Mode disables direct access to an ESXi host, requiring the host to be managed remotely from vCenter Server. This is done to ensure the roles and access controls implemented in vCenter are always enforced and users cannot bypass them by logging on to a host directly.\n\nBy forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nScroll down to \"Lockdown Mode\" and verify it is set to \"Enabled\" (Normal or Strict).\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Select Name,@{N=\"Lockdown\";E={$_.Extensiondata.Config.LockdownMode}}\n\nIf \"Lockdown Mode\" is disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile >> Lockdown Mode.\n\nClick edit and select either the \"Normal\" or \"Strict\" radio buttons.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$level = \"lockdownNormal\" OR \"lockdownStrict\"\n$vmhost = Get-VMHost -Name <hostname> | Get-View\n$lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n$lockdown.ChangeLockdownMode($level)\n\nNote: In strict lockdown mode, the Direct Console User Interface (DCUI) service is stopped. If the connection to vCenter Server is lost and the vSphere Client is no longer available, the ESXi host becomes inaccessible."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000027-VMM-000080","gid":"V-ESXI-80-000008","rid":"SV-ESXI-80-000008","stig_id":"ESXI-80-000008","cci":["CCI-000054"],"nist":["AC-10"]},"code":"control 'ESXI-80-000008' do\n  title 'The ESXi host must enable lockdown mode.'\n  desc  \"\n    Enabling Lockdown Mode disables direct access to an ESXi host, requiring the host to be managed remotely from vCenter Server. This is done to ensure the roles and access controls implemented in vCenter are always enforced and users cannot bypass them by logging on to a host directly.\n\n    By forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Scroll down to \\\"Lockdown Mode\\\" and verify it is set to \\\"Enabled\\\" (Normal or Strict).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Select Name,@{N=\\\"Lockdown\\\";E={$_.Extensiondata.Config.LockdownMode}}\n\n    If \\\"Lockdown Mode\\\" is disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile >> Lockdown Mode.\n\n    Click edit and select either the \\\"Normal\\\" or \\\"Strict\\\" radio buttons.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $level = \\\"lockdownNormal\\\" OR \\\"lockdownStrict\\\"\n    $vmhost = Get-VMHost -Name <hostname> | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.ChangeLockdownMode($level)\n\n    Note: In strict lockdown mode, the Direct Console User Interface (DCUI) service is stopped. If the connection to vCenter Server is lost and the vSphere Client is no longer available, the ESXi host becomes inaccessible.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000027-VMM-000080'\n  tag gid: 'V-ESXI-80-000008'\n  tag rid: 'SV-ESXI-80-000008'\n  tag stig_id: 'ESXI-80-000008'\n  tag cci: ['CCI-000054']\n  tag nist: ['AC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    list = ['lockdownNormal', 'lockdownStrict']\n    vmhosts.each do |vmhost|\n      command = \"(Get-VMHost -Name #{vmhost}).Extensiondata.Config.LockdownMode\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should be_in list }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000008.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000010","title":"The ESXi host client must be configured with an idle session timeout.","desc":"The ESXi host client is the UI served up by the host itself, outside of vCenter. It is accessed by browsing to \"https://<ESX FQDN>/ui\". ESXi is not usually administered via this interface for long periods and all users will be highly privileged. Implementing a mandatory session idle limit will ensure that orphaned, forgotten or ignored sessions will be closed promptly.","descriptions":[{"label":"default","data":"The ESXi host client is the UI served up by the host itself, outside of vCenter. It is accessed by browsing to \"https://<ESX FQDN>/ui\". ESXi is not usually administered via this interface for long periods and all users will be highly privileged. Implementing a mandatory session idle limit will ensure that orphaned, forgotten or ignored sessions will be closed promptly."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.HostClientSessionTimeout\" value and verify it is set to \"900\" or less.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout\n\nIf the \"UserVars.HostClientSessionTimeout\" setting is not set to \"900\" or less, this is a finding."},{"label":"fix","data":"Fom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.HostClientSessionTimeout\" value and configure it to \"900\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Set-AdvancedSetting -Value \"900\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000029-VMM-000100","gid":"V-ESXI-80-000010","rid":"SV-ESXI-80-000010","stig_id":"ESXI-80-000010","cci":["CCI-000057"],"nist":["AC-11 a"]},"code":"control 'ESXI-80-000010' do\n  title 'The ESXi host client must be configured with an idle session timeout.'\n  desc  'The ESXi host client is the UI served up by the host itself, outside of vCenter. It is accessed by browsing to \"https://<ESX FQDN>/ui\". ESXi is not usually administered via this interface for long periods and all users will be highly privileged. Implementing a mandatory session idle limit will ensure that orphaned, forgotten or ignored sessions will be closed promptly.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.HostClientSessionTimeout\\\" value and verify it is set to \\\"900\\\" or less.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout\n\n    If the \\\"UserVars.HostClientSessionTimeout\\\" setting is not set to \\\"900\\\" or less, this is a finding.\n  \"\n  desc  'fix', \"\n    Fom the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.HostClientSessionTimeout\\\" value and configure it to \\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Set-AdvancedSetting -Value \\\"900\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000029-VMM-000100'\n  tag gid: 'V-ESXI-80-000010'\n  tag rid: 'SV-ESXI-80-000010'\n  tag stig_id: 'ESXI-80-000010'\n  tag cci: ['CCI-000057']\n  tag nist: ['AC-11 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 900 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000010.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000014","title":"The ESXi host Secure Shell (SSH) daemon must use FIPS 140-2 validated cryptographic modules to protect the confidentiality of remote access sessions.","desc":"Without confidentiality protection mechanisms, unauthorized individuals may gain access to sensitive information via a remote access session.\n\nOpenSSH on the ESXi host ships with a FIPS 140-2 validated cryptographic module and it is enabled by default. For backward compatibility reasons, this can be disabled so this setting must be audited and corrected if necessary.","descriptions":[{"label":"default","data":"Without confidentiality protection mechanisms, unauthorized individuals may gain access to sensitive information via a remote access session.\n\nOpenSSH on the ESXi host ships with a FIPS 140-2 validated cryptographic module and it is enabled by default. For backward compatibility reasons, this can be disabled so this setting must be audited and corrected if necessary."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli system security fips140 ssh get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.security.fips140.ssh.get.invoke()\n\nExpected result:\n\nEnabled: true\n\nIf the FIPS mode is not enabled for SSH, this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# esxcli system security fips140 ssh set -e true\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.security.fips140.ssh.set.CreateArgs()\n$arguments.enable = $true\n$esxcli.system.security.fips140.ssh.set.Invoke($arguments)"}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000033-VMM-000140","gid":"V-ESXI-80-000014","rid":"SV-ESXI-80-000014","stig_id":"ESXI-80-000014","cci":["CCI-000068"],"nist":["AC-17 (2)"]},"code":"control 'ESXI-80-000014' do\n  title 'The ESXi host Secure Shell (SSH) daemon must use FIPS 140-2 validated cryptographic modules to protect the confidentiality of remote access sessions.'\n  desc  \"\n    Without confidentiality protection mechanisms, unauthorized individuals may gain access to sensitive information via a remote access session.\n\n    OpenSSH on the ESXi host ships with a FIPS 140-2 validated cryptographic module and it is enabled by default. For backward compatibility reasons, this can be disabled so this setting must be audited and corrected if necessary.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system security fips140 ssh get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.security.fips140.ssh.get.invoke()\n\n    Expected result:\n\n    Enabled: true\n\n    If the FIPS mode is not enabled for SSH, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system security fips140 ssh set -e true\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.security.fips140.ssh.set.CreateArgs()\n    $arguments.enable = $true\n    $esxcli.system.security.fips140.ssh.set.Invoke($arguments)\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000033-VMM-000140'\n  tag gid: 'V-ESXI-80-000014'\n  tag rid: 'SV-ESXI-80-000014'\n  tag stig_id: 'ESXI-80-000014'\n  tag cci: ['CCI-000068']\n  tag nist: ['AC-17 (2)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.security.fips140.ssh.get.invoke() | Select-Object -ExpandProperty Enabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000014.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000015","title":"The ESXi must produce audit records containing information to establish what type of events occurred.","desc":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.","descriptions":[{"label":"default","data":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.log.level\" value and verify it is set to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level\n\nIf the \"Config.HostAgent.log.level\" setting is not set to \"info\", this is a finding.\n\nNote: Verbose logging level is acceptable for troubleshooting purposes."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.log.level\" value and configure it to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level | Set-AdvancedSetting -Value \"info\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000037-VMM-000150","satisfies":["SRG-OS-000063-VMM-000310"],"gid":"V-ESXI-80-000015","rid":"SV-ESXI-80-000015","stig_id":"ESXI-80-000015","cci":["CCI-000130","CCI-000171"],"nist":["AU-12 b","AU-3"]},"code":"control 'ESXI-80-000015' do\n  title 'The ESXi must produce audit records containing information to establish what type of events occurred.'\n  desc  'Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack. '\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.log.level\\\" value and verify it is set to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level\n\n    If the \\\"Config.HostAgent.log.level\\\" setting is not set to \\\"info\\\", this is a finding.\n\n    Note: Verbose logging level is acceptable for troubleshooting purposes.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.log.level\\\" value and configure it to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level | Set-AdvancedSetting -Value \\\"info\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000037-VMM-000150'\n  tag satisfies: ['SRG-OS-000063-VMM-000310']\n  tag gid: 'V-ESXI-80-000015'\n  tag rid: 'SV-ESXI-80-000015'\n  tag stig_id: 'ESXI-80-000015'\n  tag cci: ['CCI-000130', 'CCI-000171']\n  tag nist: ['AU-12 b', 'AU-3']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.log.level | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'info' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000015.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000035","title":"The ESXi host must enforce password complexity by configuring a password quality policy.","desc":"To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated.\n\nThe use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.","descriptions":[{"label":"default","data":"To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated.\n\nThe use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.PasswordQualityControl\" value and verify it is set to \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl\n\nIf the \"Security.PasswordQualityControl\" setting is set to a value other than \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.PasswordQualityControl\" value and configure it to \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl | Set-AdvancedSetting -Value \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000069-VMM-000360","satisfies":["SRG-OS-000070-VMM-000370","SRG-OS-000071-VMM-000380","SRG-OS-000072-VMM-000390","SRG-OS-000078-VMM-000450","SRG-OS-000266-VMM-000940"],"gid":"V-ESXI-80-000035","rid":"SV-ESXI-80-000035","stig_id":"ESXI-80-000035","cci":["CCI-000192","CCI-000193","CCI-000194","CCI-000195","CCI-000205","CCI-001619"],"nist":["IA-5 (1) (a)","IA-5 (1) (b)"]},"code":"control 'ESXI-80-000035' do\n  title 'The ESXi host must enforce password complexity by configuring a password quality policy.'\n  desc  \"\n    To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated.\n\n    The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.PasswordQualityControl\\\" value and verify it is set to \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl\n\n    If the \\\"Security.PasswordQualityControl\\\" setting is set to a value other than \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.PasswordQualityControl\\\" value and configure it to \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl | Set-AdvancedSetting -Value \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000069-VMM-000360'\n  tag satisfies: ['SRG-OS-000070-VMM-000370', 'SRG-OS-000071-VMM-000380', 'SRG-OS-000072-VMM-000390', 'SRG-OS-000078-VMM-000450', 'SRG-OS-000266-VMM-000940']\n  tag gid: 'V-ESXI-80-000035'\n  tag rid: 'SV-ESXI-80-000035'\n  tag stig_id: 'ESXI-80-000035'\n  tag cci: ['CCI-000192', 'CCI-000193', 'CCI-000194', 'CCI-000195', 'CCI-000205', 'CCI-001619']\n  tag nist: ['IA-5 (1) (a)', 'IA-5 (1) (b)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.PasswordQualityControl | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'similar=deny retry=3 min=disabled,disabled,disabled,disabled,15' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000035.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000043","title":"The ESXi host must prohibit password reuse for a minimum of five generations.","desc":"If a user or root used the same password continuously or was allowed to change it back shortly after being forced to change it to something else, it would provide a potential intruder with the opportunity to keep guessing at one user's password until it was guessed correctly.","descriptions":[{"label":"default","data":"If a user or root used the same password continuously or was allowed to change it back shortly after being forced to change it to something else, it would provide a potential intruder with the opportunity to keep guessing at one user's password until it was guessed correctly."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.PasswordHistory\" value and verify it is set to \"5\" or greater.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory\n\nIf the \"Security.PasswordHistory\" setting is set to a value other than 5 or greater, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.PasswordHistory\" value and configure it to \"5\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory | Set-AdvancedSetting -Value 5"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000077-VMM-000440","gid":"V-ESXI-80-000043","rid":"SV-ESXI-80-000043","stig_id":"ESXI-80-000043","cci":["CCI-000200"],"nist":["IA-5 (1) (e)"]},"code":"control 'ESXI-80-000043' do\n  title 'The ESXi host must prohibit password reuse for a minimum of five generations.'\n  desc  \"If a user or root used the same password continuously or was allowed to change it back shortly after being forced to change it to something else, it would provide a potential intruder with the opportunity to keep guessing at one user's password until it was guessed correctly.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.PasswordHistory\\\" value and verify it is set to \\\"5\\\" or greater.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory\n\n    If the \\\"Security.PasswordHistory\\\" setting is set to a value other than 5 or greater, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.PasswordHistory\\\" value and configure it to \\\"5\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory | Set-AdvancedSetting -Value 5\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000077-VMM-000440'\n  tag gid: 'V-ESXI-80-000043'\n  tag rid: 'SV-ESXI-80-000043'\n  tag stig_id: 'ESXI-80-000043'\n  tag cci: ['CCI-000200']\n  tag nist: ['IA-5 (1) (e)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.PasswordHistory | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '5' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000043.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000047","title":"The ESXi host must be configured to disable nonessential capabilities by disabling the Managed Object Browser (MOB).","desc":"The MOB provides a way to explore the object model used by the VMkernel to manage the host and enables configurations to be changed. This interface is meant to be used primarily for debugging the vSphere Software Development Kit (SDK), but because there are no access controls it could also be used as a method to obtain information about a host being targeted for unauthorized access.","descriptions":[{"label":"default","data":"The MOB provides a way to explore the object model used by the VMkernel to manage the host and enables configurations to be changed. This interface is meant to be used primarily for debugging the vSphere Software Development Kit (SDK), but because there are no access controls it could also be used as a method to obtain information about a host being targeted for unauthorized access."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.plugins.solo.enableMob\" value and verify it is set to \"false\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob\n\nIf the \"Config.HostAgent.plugins.solo.enableMob\" setting is not set to \"false\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.plugins.solo.enableMob\" value and configure it to \"false\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Set-AdvancedSetting -Value false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000095-VMM-000480","gid":"V-ESXI-80-000047","rid":"SV-ESXI-80-000047","stig_id":"ESXI-80-000047","cci":["CCI-000381"],"nist":["CM-7 a"]},"code":"control 'ESXI-80-000047' do\n  title 'The ESXi host must be configured to disable nonessential capabilities by disabling the Managed Object Browser (MOB).'\n  desc  'The MOB provides a way to explore the object model used by the VMkernel to manage the host and enables configurations to be changed. This interface is meant to be used primarily for debugging the vSphere Software Development Kit (SDK), but because there are no access controls it could also be used as a method to obtain information about a host being targeted for unauthorized access.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.plugins.solo.enableMob\\\" value and verify it is set to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob\n\n    If the \\\"Config.HostAgent.plugins.solo.enableMob\\\" setting is not set to \\\"false\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.plugins.solo.enableMob\\\" value and configure it to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Set-AdvancedSetting -Value false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag gid: 'V-ESXI-80-000047'\n  tag rid: 'SV-ESXI-80-000047'\n  tag stig_id: 'ESXI-80-000047'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000047.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000049","title":"The ESXi host must uniquely identify and must authenticate organizational users by using Active Directory.","desc":"Join ESXi hosts to an Active Directory domain to eliminate the need to create and maintain multiple local user accounts. Using Active Directory for user authentication simplifies the ESXi host configuration, ensures password complexity and reuse policies are enforced, and reduces the risk of security breaches and unauthorized access.\n\nNote: If the Active Directory group \"ESX Admins\" (default) exists, all users and groups assigned as members to this group will have full administrative access to all ESXi hosts in the domain.","descriptions":[{"label":"default","data":"Join ESXi hosts to an Active Directory domain to eliminate the need to create and maintain multiple local user accounts. Using Active Directory for user authentication simplifies the ESXi host configuration, ensures password complexity and reuse policies are enforced, and reduces the risk of security breaches and unauthorized access.\n\nNote: If the Active Directory group \"ESX Admins\" (default) exists, all users and groups assigned as members to this group will have full administrative access to all ESXi hosts in the domain."},{"label":"rationale","data":""},{"label":"check","data":"For systems that do not use Active Directory and have no local user accounts other than root and/or service accounts, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Authentication Services.\n\nVerify the \"Directory Services Type\" is set to \"Active Directory\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostAuthentication\n\nFor systems that do not use Active Directory and do have local user accounts, other than root and/or service accounts, this is a finding.\n\nIf the \"Directory Services Type\" is not set to \"Active Directory\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Authentication Services.\n\nClick \"Join Domain...\" and enter the AD domain to join.\n\nSelect the \"Using credentials\" radio button and enter the credentials of an account with permissions to join machines to AD (use UPN naming \"user@domain\"). Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostAuthentication | Set-VMHostAuthentication -JoinDomain -Domain \"domain name\" -User \"username\" -Password \"password\"\n\nIf any local user accounts are present besides root and service accounts, delete them by going to Host UI >> Manage >> Security & Users >> Users."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000104-VMM-000500","satisfies":["SRG-OS-000109-VMM-000550","SRG-OS-000112-VMM-000560","SRG-OS-000113-VMM-000570","SRG-OS-000123-VMM-000620"],"gid":"V-ESXI-80-000049","rid":"SV-ESXI-80-000049","stig_id":"ESXI-80-000049","cci":["CCI-000764","CCI-000770","CCI-001682","CCI-001941","CCI-001942"],"nist":["AC-2 (2)","IA-2","IA-2 (5)","IA-2 (8)","IA-2 (9)"]},"code":"control 'ESXI-80-000049' do\n  title 'The ESXi host must uniquely identify and must authenticate organizational users by using Active Directory.'\n  desc  \"\n    Join ESXi hosts to an Active Directory domain to eliminate the need to create and maintain multiple local user accounts. Using Active Directory for user authentication simplifies the ESXi host configuration, ensures password complexity and reuse policies are enforced, and reduces the risk of security breaches and unauthorized access.\n\n    Note: If the Active Directory group \\\"ESX Admins\\\" (default) exists, all users and groups assigned as members to this group will have full administrative access to all ESXi hosts in the domain.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For systems that do not use Active Directory and have no local user accounts other than root and/or service accounts, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Authentication Services.\n\n    Verify the \\\"Directory Services Type\\\" is set to \\\"Active Directory\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostAuthentication\n\n    For systems that do not use Active Directory and do have local user accounts, other than root and/or service accounts, this is a finding.\n\n    If the \\\"Directory Services Type\\\" is not set to \\\"Active Directory\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Authentication Services.\n\n    Click \\\"Join Domain...\\\" and enter the AD domain to join.\n\n    Select the \\\"Using credentials\\\" radio button and enter the credentials of an account with permissions to join machines to AD (use UPN naming \\\"user@domain\\\"). Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostAuthentication | Set-VMHostAuthentication -JoinDomain -Domain \\\"domain name\\\" -User \\\"username\\\" -Password \\\"password\\\"\n\n    If any local user accounts are present besides root and service accounts, delete them by going to Host UI >> Manage >> Security & Users >> Users.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000104-VMM-000500'\n  tag satisfies: ['SRG-OS-000109-VMM-000550', 'SRG-OS-000112-VMM-000560', 'SRG-OS-000113-VMM-000570', 'SRG-OS-000123-VMM-000620']\n  tag gid: 'V-ESXI-80-000049'\n  tag rid: 'SV-ESXI-80-000049'\n  tag stig_id: 'ESXI-80-000049'\n  tag cci: ['CCI-000764', 'CCI-000770', 'CCI-001682', 'CCI-001941', 'CCI-001942']\n  tag nist: ['AC-2 (2)', 'IA-2', 'IA-2 (5)', 'IA-2 (8)', 'IA-2 (9)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    if input('adJoined')\n      list = ['Joined', 'Ok']\n      vmhosts.each do |vmhost|\n        command = \"Get-VMHost -Name #{vmhost} | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should be_in list }\n        end\n      end\n    else\n      vmhosts.each do |vmhost|\n        command = \"Get-VMHost -Name #{vmhost} | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp '' }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000049.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000052","title":"The ESXi host Secure Shell (SSH) daemon must ignore .rhosts files.","desc":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH can emulate the behavior of the obsolete \"rsh\" command in allowing users to enable insecure access to their accounts via \".rhosts\" files.","descriptions":[{"label":"default","data":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH can emulate the behavior of the obsolete \"rsh\" command in allowing users to enable insecure access to their accounts via \".rhosts\" files."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep ignorerhosts\n\nExpected result:\n\nignorerhosts yes\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nIgnoreRhosts yes"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000107-VMM-000530","gid":"V-ESXI-80-000052","rid":"SV-ESXI-80-000052","stig_id":"ESXI-80-000052","cci":["CCI-000767"],"nist":["IA-2 (3)"]},"code":"control 'ESXI-80-000052' do\n  title 'The ESXi host Secure Shell (SSH) daemon must ignore .rhosts files.'\n  desc  'SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH can emulate the behavior of the obsolete \"rsh\" command in allowing users to enable insecure access to their accounts via \".rhosts\" files.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep ignorerhosts\n\n    Expected result:\n\n    ignorerhosts yes\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    IgnoreRhosts yes\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000107-VMM-000530'\n  tag gid: 'V-ESXI-80-000052'\n  tag rid: 'SV-ESXI-80-000052'\n  tag stig_id: 'ESXI-80-000052'\n  tag cci: ['CCI-000767']\n  tag nist: ['IA-2 (3)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000052.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000068","title":"The ESXi host must set a timeout to automatically end idle shell sessions after fifteen minutes.","desc":"If a user forgets to log out of their local or remote ESXi Shell session, the idle connection will remain open indefinitely and increase the likelihood of inappropriate host access via session hijacking. The \"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell sessions.","descriptions":[{"label":"default","data":"If a user forgets to log out of their local or remote ESXi Shell session, the idle connection will remain open indefinitely and increase the likelihood of inappropriate host access via session hijacking. The \"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell sessions."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.ESXiShellInteractiveTimeOut\" value and verify it is set to less than \"900\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n\nIf the \"UserVars.ESXiShellInteractiveTimeOut\" setting is set to a value greater than \"900\" or \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.ESXiShellInteractiveTimeOut\" value and configure it to \"900\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Set-AdvancedSetting -Value 900"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000163-VMM-000700","satisfies":["SRG-OS-000279-VMM-001010"],"gid":"V-ESXI-80-000068","rid":"SV-ESXI-80-000068","stig_id":"ESXI-80-000068","cci":["CCI-001133","CCI-002361"],"nist":["AC-12","SC-10"]},"code":"control 'ESXI-80-000068' do\n  title 'The ESXi host must set a timeout to automatically end idle shell sessions after fifteen minutes.'\n  desc  'If a user forgets to log out of their local or remote ESXi Shell session, the idle connection will remain open indefinitely and increase the likelihood of inappropriate host access via session hijacking. The \"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell sessions.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" value and verify it is set to less than \\\"900\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n\n    If the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" setting is set to a value greater than \\\"900\\\" or \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" value and configure it to \\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Set-AdvancedSetting -Value 900\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag satisfies: ['SRG-OS-000279-VMM-001010']\n  tag gid: 'V-ESXI-80-000068'\n  tag rid: 'SV-ESXI-80-000068'\n  tag stig_id: 'ESXI-80-000068'\n  tag cci: ['CCI-001133', 'CCI-002361']\n  tag nist: ['AC-12', 'SC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 900 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000068.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000085","title":"The ESXi host must implement Secure Boot enforcement.","desc":"Secure Boot is part of the UEFI firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and it requires that all ESXi kernel modules, drivers and VIBs be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. This control flips ESXi from merely supporting Secure Boot to requiring it. Without this setting enabled, and configuration encryption, an ESXi host could be subject to offline attacks. An attacker could simply transfer the ESXi install drive to a non-Secure Boot host and boot it up without ESXi complaining.","descriptions":[{"label":"default","data":"Secure Boot is part of the UEFI firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and it requires that all ESXi kernel modules, drivers and VIBs be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. This control flips ESXi from merely supporting Secure Boot to requiring it. Without this setting enabled, and configuration encryption, an ESXi host could be subject to offline attacks. An attacker could simply transfer the ESXi install drive to a non-Secure Boot host and boot it up without ESXi complaining."},{"label":"rationale","data":""},{"label":"check","data":"If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\nFrom an ESXi shell, run the following command:\n\n# esxcli system settings encryption get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.settings.encryption.get.invoke() | Select RequireSecureBoot\n\nExpected result:\n\nRequire Secure Boot: true\n\nIf \"Require Secure Boot\" is not enable, this is a finding."},{"label":"fix","data":"This setting cannot be configured until Secure Boot is properly enabled in the servers firmware.\n\nFrom an ESXi shell, run the following commands:\n\n# esxcli system settings encryption set --require-secure-boot=true\n# /sbin/auto-backup.sh\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n$arguments.requiresecureboot = $true\n$esxcli.system.settings.encryption.set.Invoke($arguments)\n\nEvacuate the host and gracefully reboot for changes to take effect."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000257-VMM-000910","satisfies":["SRG-OS-000258-VMM-000920","SRG-OS-000445-VMM-001780","SRG-OS-000446-VMM-001790"],"gid":"V-ESXI-80-000085","rid":"SV-ESXI-80-000085","stig_id":"ESXI-80-000085","cci":["CCI-001494","CCI-001495","CCI-002696","CCI-002699"],"nist":["AU-9","SI-6 a","SI-6 b"]},"code":"control 'ESXI-80-000085' do\n  title 'The ESXi host must implement Secure Boot enforcement.'\n  desc  \"\n    Secure Boot is part of the UEFI firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and it requires that all ESXi kernel modules, drivers and VIBs be signed by VMware or a partner subordinate.\n\n    Secure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. This control flips ESXi from merely supporting Secure Boot to requiring it. Without this setting enabled, and configuration encryption, an ESXi host could be subject to offline attacks. An attacker could simply transfer the ESXi install drive to a non-Secure Boot host and boot it up without ESXi complaining.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\n    From an ESXi shell, run the following command:\n\n    # esxcli system settings encryption get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.settings.encryption.get.invoke() | Select RequireSecureBoot\n\n    Expected result:\n\n    Require Secure Boot: true\n\n    If \\\"Require Secure Boot\\\" is not enable, this is a finding.\n  \"\n  desc 'fix', \"\n    This setting cannot be configured until Secure Boot is properly enabled in the servers firmware.\n\n    From an ESXi shell, run the following commands:\n\n    # esxcli system settings encryption set --require-secure-boot=true\n    # /sbin/auto-backup.sh\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n    $arguments.requiresecureboot = $true\n    $esxcli.system.settings.encryption.set.Invoke($arguments)\n\n    Evacuate the host and gracefully reboot for changes to take effect.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000257-VMM-000910'\n  tag satisfies: ['SRG-OS-000258-VMM-000920', 'SRG-OS-000445-VMM-001780', 'SRG-OS-000446-VMM-001790']\n  tag gid: 'V-ESXI-80-000085'\n  tag rid: 'SV-ESXI-80-000085'\n  tag stig_id: 'ESXI-80-000085'\n  tag cci: ['CCI-001494', 'CCI-001495', 'CCI-002696', 'CCI-002699']\n  tag nist: ['AU-9', 'SI-6 a', 'SI-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty RequireSecureBoot\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000085.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000094","title":"The ESXi host must enable Secure Boot.","desc":"Secure Boot is part of the Unified Extensible Firmware Interface (UEFI) firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and requires that all ESXi kernel modules, drivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. There is no ESXi control to \"turn on\" Secure Boot. Requiring Secure Boot (failing to boot without it present) is accomplished in another control.","descriptions":[{"label":"default","data":"Secure Boot is part of the Unified Extensible Firmware Interface (UEFI) firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and requires that all ESXi kernel modules, drivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. There is no ESXi control to \"turn on\" Secure Boot. Requiring Secure Boot (failing to boot without it present) is accomplished in another control."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/secureboot/bin/secureBoot.py -s\n\nIf Secure Boot is not \"Enabled\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/secureboot/bin/secureBoot.py -c\n\nIf the output indicates that Secure Boot cannot be enabled, correct the discrepancies and try again.\n\nOnce all discrepancies are resolved then the server ESXi is installed on can be updated to enable Secure Boot in the firmware.\n\nTo enable Secure Boot in the servers firmware follow the instructions for the specific manufacturer."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000278-VMM-001000","gid":"V-ESXI-80-000094","rid":"SV-ESXI-80-000094","stig_id":"ESXI-80-000094","cci":["CCI-001496"],"nist":["AU-9 (3)"]},"code":"control 'ESXI-80-000094' do\n  title 'The ESXi host must enable Secure Boot.'\n  desc  \"\n    Secure Boot is part of the Unified Extensible Firmware Interface (UEFI) firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and requires that all ESXi kernel modules, drivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a partner subordinate.\n\n    Secure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. There is no ESXi control to \\\"turn on\\\" Secure Boot. Requiring Secure Boot (failing to boot without it present) is accomplished in another control.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/secureboot/bin/secureBoot.py -s\n\n    If Secure Boot is not \\\"Enabled\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/secureboot/bin/secureBoot.py -c\n\n    If the output indicates that Secure Boot cannot be enabled, correct the discrepancies and try again.\n\n    Once all discrepancies are resolved then the server ESXi is installed on can be updated to enable Secure Boot in the firmware.\n\n    To enable Secure Boot in the servers firmware follow the instructions for the specific manufacturer.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000278-VMM-001000'\n  tag gid: 'V-ESXI-80-000094'\n  tag rid: 'SV-ESXI-80-000094'\n  tag stig_id: 'ESXI-80-000094'\n  tag cci: ['CCI-001496']\n  tag nist: ['AU-9 (3)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000094.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000111","title":"The ESXi host must enforce an unlock timeout of 15 minutes after a user account is locked out.","desc":"By enforcing a reasonable unlock timeout after multiple failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Users must wait for the timeout period to elapse before subsequent logon attempts are allowed.","descriptions":[{"label":"default","data":"By enforcing a reasonable unlock timeout after multiple failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Users must wait for the timeout period to elapse before subsequent logon attempts are allowed."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.AccountUnlockTime\" value and verify it is set to less than \"900\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime\n\nIf the \"Security.AccountUnlockTime\" setting is less than 900 or 0, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.AccountUnlockTime\" value and configure it to \"900\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime | Set-AdvancedSetting -Value 900"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000329-VMM-001180","gid":"V-ESXI-80-000111","rid":"SV-ESXI-80-000111","stig_id":"ESXI-80-000111","cci":["CCI-002238"],"nist":["AC-7 b"]},"code":"control 'ESXI-80-000111' do\n  title 'The ESXi host must enforce an unlock timeout of 15 minutes after a user account is locked out.'\n  desc  'By enforcing a reasonable unlock timeout after multiple failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Users must wait for the timeout period to elapse before subsequent logon attempts are allowed.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.AccountUnlockTime\\\" value and verify it is set to less than \\\"900\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime\n\n    If the \\\"Security.AccountUnlockTime\\\" setting is less than 900 or 0, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.AccountUnlockTime\\\" value and configure it to \\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime | Set-AdvancedSetting -Value 900\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000329-VMM-001180'\n  tag gid: 'V-ESXI-80-000111'\n  tag rid: 'SV-ESXI-80-000111'\n  tag stig_id: 'ESXI-80-000111'\n  tag cci: ['CCI-002238']\n  tag nist: ['AC-7 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.AccountUnlockTime | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 900 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000111.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000113","title":"The ESXi host must allocate audit record storage capacity to store at least one weeks worth of audit records.","desc":"In order to ensure ESXi has sufficient storage capacity in which to write the audit logs, audit record storage capacity should be configured.\n\nIf a central audit record storage facility is available, the local storage capacity should be sufficient to hold audit records that would accumulate during anticipated interruptions in delivery of records to the facility.","descriptions":[{"label":"default","data":"In order to ensure ESXi has sufficient storage capacity in which to write the audit logs, audit record storage capacity should be configured.\n\nIf a central audit record storage facility is available, the local storage capacity should be sufficient to hold audit records that would accumulate during anticipated interruptions in delivery of records to the facility."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.auditRecord.storageCapacity\" value and verify it is set to \"100\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity\n\nIf the \"Syslog.global.auditRecord.storageCapacity\" setting is not set to 100, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.auditRecord.storageCapacity\" value and configure it to \"100\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Set-AdvancedSetting -Value 100"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000341-VMM-001220","gid":"V-ESXI-80-000113","rid":"SV-ESXI-80-000113","stig_id":"ESXI-80-000113","cci":["CCI-001849"],"nist":["AU-4"]},"code":"control 'ESXI-80-000113' do\n  title 'The ESXi host must allocate audit record storage capacity to store at least one weeks worth of audit records.'\n  desc  \"\n    In order to ensure ESXi has sufficient storage capacity in which to write the audit logs, audit record storage capacity should be configured.\n\n    If a central audit record storage facility is available, the local storage capacity should be sufficient to hold audit records that would accumulate during anticipated interruptions in delivery of records to the facility.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.auditRecord.storageCapacity\\\" value and verify it is set to \\\"100\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity\n\n    If the \\\"Syslog.global.auditRecord.storageCapacity\\\" setting is not set to 100, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.auditRecord.storageCapacity\\\" value and configure it to \\\"100\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Set-AdvancedSetting -Value 100\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000341-VMM-001220'\n  tag gid: 'V-ESXI-80-000113'\n  tag rid: 'SV-ESXI-80-000113'\n  tag stig_id: 'ESXI-80-000113'\n  tag cci: ['CCI-001849']\n  tag nist: ['AU-4']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '100' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000113.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000114","title":"The ESXi host must off-load logs via syslog.","desc":"Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host, it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts.\n\nLogging to a secure, centralized log server also helps prevent log tampering and provides a long-term audit record.","descriptions":[{"label":"default","data":"Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host, it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts.\n\nLogging to a secure, centralized log server also helps prevent log tampering and provides a long-term audit record."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logHost\" value and verify it is set to a site-specific syslog server.\n\nSyslog servers are specified in the following formats:\n\nudp://<IP or FQDN>:514\ntcp://<IP or FQDN>:514\nssl://<IP or FQDN>:1514\n\nMultiple servers can also be specified when separated by commas.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost\n\nIf the \"Syslog.global.logHost\" setting is not set to a valid, site-specific syslog server, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logHost\" value and configure it to a site-specific syslog server.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost | Set-AdvancedSetting -Value \"enter site specific servers\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000342-VMM-001230","satisfies":["SRG-OS-000274-VMM-000960","SRG-OS-000275-VMM-000970","SRG-OS-000277-VMM-000990","SRG-OS-000479-VMM-001990"],"gid":"V-ESXI-80-000114","rid":"SV-ESXI-80-000114","stig_id":"ESXI-80-000114","cci":["CCI-001683","CCI-001684","CCI-001686","CCI-001851"],"nist":["AC-2 (4)","AU-4 (1)"]},"code":"control 'ESXI-80-000114' do\n  title 'The ESXi host must off-load logs via syslog.'\n  desc  \"\n    Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host, it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts.\n\n    Logging to a secure, centralized log server also helps prevent log tampering and provides a long-term audit record.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logHost\\\" value and verify it is set to a site-specific syslog server.\n\n    Syslog servers are specified in the following formats:\n\n    udp://<IP or FQDN>:514\n    tcp://<IP or FQDN>:514\n    ssl://<IP or FQDN>:1514\n\n    Multiple servers can also be specified when separated by commas.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost\n\n    If the \\\"Syslog.global.logHost\\\" setting is not set to a valid, site-specific syslog server, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logHost\\\" value and configure it to a site-specific syslog server.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost | Set-AdvancedSetting -Value \\\"enter site specific servers\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000342-VMM-001230'\n  tag satisfies: ['SRG-OS-000274-VMM-000960', 'SRG-OS-000275-VMM-000970', 'SRG-OS-000277-VMM-000990', 'SRG-OS-000479-VMM-001990']\n  tag gid: 'V-ESXI-80-000114'\n  tag rid: 'SV-ESXI-80-000114'\n  tag stig_id: 'ESXI-80-000114'\n  tag cci: ['CCI-001683', 'CCI-001684', 'CCI-001686', 'CCI-001851']\n  tag nist: ['AC-2 (4)', 'AU-4 (1)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logHost | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp \"#{input('syslogServer')}\" }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000114.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000124","title":"The ESXi host must synchronize internal information system clocks to an authoritative time source.","desc":"To ensure the accuracy of the system clock, it must be synchronized with an authoritative time source within DOD. Many system functions, including time-based logon and activity restrictions, automated reports, system logs, and audit records, depend on an accurate system clock. If there is no confidence in the correctness of the system clock, time-based functions may not operate as intended and records may be of diminished value.","descriptions":[{"label":"default","data":"To ensure the accuracy of the system clock, it must be synchronized with an authoritative time source within DOD. Many system functions, including time-based logon and activity restrictions, automated reports, system logs, and audit records, depend on an accurate system clock. If there is no confidence in the correctness of the system clock, time-based functions may not operate as intended and records may be of diminished value."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Time Configuration.\n\nVerify NTP or PTP are configured, and one or more authoritative time sources are listed.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nVerify the NTP or PTP service is running and configured to start and stop with the host.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostNTPServer\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\" -or $_.Label -eq \"PTP Daemon\"}\n\nIf the NTP service is not configured with authoritative DOD time sources or the service is not configured to start and stop with the host (\"Policy\" of \"on\" in PowerCLI) or is stopped, this is a finding.\nIf PTP is used instead of NTP, this is NOT a finding."},{"label":"fix","data":"To configure NTP, perform the following:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Time Configuration.\n\nClick \"Add Service\" and select \"Network Time Protocol\".\n\nEnter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \"OK\".\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nSelect the \"NTP Daemon\" service and click \"Edit Startup Policy\".\n\nSelect \"Start and stop with host\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$NTPServers = \"ntpserver1\",\"ntpserver2\"\nGet-VMHost | Add-VMHostNTPServer $NTPServers\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\"} | Set-VMHostService -Policy On\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\"} | Start-VMHostService\n\nTo configure PTP, perform the following:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Time Configuration.\n\nClick \"Add Service\" and select \"Precision Time Protocol\".\n\nSelect the network adapter that can receive the PTP traffic.\n\nIf NTP servers are available, select \"Enable fallback\" and enter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \"OK\".\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nSelect the \"PTP Daemon\" service and click \"Edit Startup Policy\".\n\nSelect \"Start and stop with host\". Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000355-VMM-001330","satisfies":["SRG-OS-000356-VMM-001340"],"gid":"V-ESXI-80-000124","rid":"SV-ESXI-80-000124","stig_id":"ESXI-80-000124","cci":["CCI-001891","CCI-002046"],"nist":["AU-8 (1) (a)","AU-8 (1) (b)"]},"code":"control 'ESXI-80-000124' do\n  title 'The ESXi host must synchronize internal information system clocks to an authoritative time source.'\n  desc  'To ensure the accuracy of the system clock, it must be synchronized with an authoritative time source within DOD. Many system functions, including time-based logon and activity restrictions, automated reports, system logs, and audit records, depend on an accurate system clock. If there is no confidence in the correctness of the system clock, time-based functions may not operate as intended and records may be of diminished value.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Time Configuration.\n\n    Verify NTP or PTP are configured, and one or more authoritative time sources are listed.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Verify the NTP or PTP service is running and configured to start and stop with the host.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostNTPServer\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\" -or $_.Label -eq \\\"PTP Daemon\\\"}\n\n    If the NTP service is not configured with authoritative DOD time sources or the service is not configured to start and stop with the host (\\\"Policy\\\" of \\\"on\\\" in PowerCLI) or is stopped, this is a finding.\n    If PTP is used instead of NTP, this is NOT a finding.\n  \"\n  desc 'fix', \"\n    To configure NTP, perform the following:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Time Configuration.\n\n    Click \\\"Add Service\\\" and select \\\"Network Time Protocol\\\".\n\n    Enter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \\\"OK\\\".\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Select the \\\"NTP Daemon\\\" service and click \\\"Edit Startup Policy\\\".\n\n    Select \\\"Start and stop with host\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $NTPServers = \\\"ntpserver1\\\",\\\"ntpserver2\\\"\n    Get-VMHost | Add-VMHostNTPServer $NTPServers\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\"} | Set-VMHostService -Policy On\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\"} | Start-VMHostService\n\n    To configure PTP, perform the following:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Time Configuration.\n\n    Click \\\"Add Service\\\" and select \\\"Precision Time Protocol\\\".\n\n    Select the network adapter that can receive the PTP traffic.\n\n    If NTP servers are available, select \\\"Enable fallback\\\" and enter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \\\"OK\\\".\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Select the \\\"PTP Daemon\\\" service and click \\\"Edit Startup Policy\\\".\n\n    Select \\\"Start and stop with host\\\". Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000355-VMM-001330'\n  tag satisfies: ['SRG-OS-000356-VMM-001340']\n  tag gid: 'V-ESXI-80-000124'\n  tag rid: 'SV-ESXI-80-000124'\n  tag stig_id: 'ESXI-80-000124'\n  tag cci: ['CCI-001891', 'CCI-002046']\n  tag nist: ['AU-8 (1) (a)', 'AU-8 (1) (b)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'on' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n      results = powercli_command(\"Get-VMHost -Name #{vmhost} | Get-VMHostNTPServer\").stdout\n      if !results.empty?\n        results.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |result|\n          describe \"NTP Server: #{result} for VMHost: #{vmhost}\" do\n            subject { result }\n            it { should be_in \"#{input('esxiNtpServers')}\" }\n          end\n        end\n      else\n        describe \"No NTP servers found on VMhost: #{vmhost}\" do\n          subject { results }\n          it { should_not be_empty }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000124.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000133","title":"The ESXi Image Profile and vSphere Installation Bundle (VIB) acceptance level must be verified.","desc":"Verify the ESXi Image Profile to only allow signed VIBs. An unsigned VIB represents untested code installed on an ESXi host. The ESXi Image profile supports four acceptance levels:\n\n1. VMwareCertified - VIBs created, tested, and signed by VMware.\n2. VMwareAccepted - VIBs created by a VMware partner but tested and signed by VMware.\n3. PartnerSupported - VIBs created, tested, and signed by a certified VMware partner.\n4. CommunitySupported - VIBs that have not been tested by VMware or a VMware partner.\n\nCommunity Supported VIBs are not supported and do not have a digital signature. To protect the security and integrity of ESXi hosts, do not allow unsigned (CommunitySupported) VIBs to be installed on hosts.","descriptions":[{"label":"default","data":"Verify the ESXi Image Profile to only allow signed VIBs. An unsigned VIB represents untested code installed on an ESXi host. The ESXi Image profile supports four acceptance levels:\n\n1. VMwareCertified - VIBs created, tested, and signed by VMware.\n2. VMwareAccepted - VIBs created by a VMware partner but tested and signed by VMware.\n3. PartnerSupported - VIBs created, tested, and signed by a certified VMware partner.\n4. CommunitySupported - VIBs that have not been tested by VMware or a VMware partner.\n\nCommunity Supported VIBs are not supported and do not have a digital signature. To protect the security and integrity of ESXi hosts, do not allow unsigned (CommunitySupported) VIBs to be installed on hosts."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Host Image Profile Acceptance Level\" view the acceptance level.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.software.acceptance.get.Invoke()\n\nIf the acceptance level is \"CommunitySupported\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Host Image Profile Acceptance Level\", click \"Edit\".\n\nUsing the drop-down selection, set the acceptance level as \"VMwareCertified\", \"VMwareAccepted\", or \"PartnerSupported\". The default is \"PartnerSupported\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.software.acceptance.set.CreateArgs()\n$arguments.level = \"PartnerSupported\"\n$esxcli.software.acceptance.set.Invoke($arguments)\n\nNote: \"VMwareCertified\" or \"VMwareAccepted\" may be substituted for \"PartnerSupported\", depending on local requirements. These are case sensitive."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000366-VMM-001430","satisfies":["SRG-OS-000370-VMM-001460"],"gid":"V-ESXI-80-000133","rid":"SV-ESXI-80-000133","stig_id":"ESXI-80-000133","cci":["CCI-001749","CCI-001774"],"nist":["CM-5 (3)","CM-7 (5) (b)"]},"code":"control 'ESXI-80-000133' do\n  title 'The ESXi Image Profile and vSphere Installation Bundle (VIB) acceptance level must be verified.'\n  desc  \"\n    Verify the ESXi Image Profile to only allow signed VIBs. An unsigned VIB represents untested code installed on an ESXi host. The ESXi Image profile supports four acceptance levels:\n\n    1. VMwareCertified - VIBs created, tested, and signed by VMware.\n    2. VMwareAccepted - VIBs created by a VMware partner but tested and signed by VMware.\n    3. PartnerSupported - VIBs created, tested, and signed by a certified VMware partner.\n    4. CommunitySupported - VIBs that have not been tested by VMware or a VMware partner.\n\n    Community Supported VIBs are not supported and do not have a digital signature. To protect the security and integrity of ESXi hosts, do not allow unsigned (CommunitySupported) VIBs to be installed on hosts.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Host Image Profile Acceptance Level\\\" view the acceptance level.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.software.acceptance.get.Invoke()\n\n    If the acceptance level is \\\"CommunitySupported\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Host Image Profile Acceptance Level\\\", click \\\"Edit\\\".\n\n    Using the drop-down selection, set the acceptance level as \\\"VMwareCertified\\\", \\\"VMwareAccepted\\\", or \\\"PartnerSupported\\\". The default is \\\"PartnerSupported\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.software.acceptance.set.CreateArgs()\n    $arguments.level = \\\"PartnerSupported\\\"\n    $esxcli.software.acceptance.set.Invoke($arguments)\n\n    Note: \\\"VMwareCertified\\\" or \\\"VMwareAccepted\\\" may be substituted for \\\"PartnerSupported\\\", depending on local requirements. These are case sensitive.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000366-VMM-001430'\n  tag satisfies: ['SRG-OS-000370-VMM-001460']\n  tag gid: 'V-ESXI-80-000133'\n  tag rid: 'SV-ESXI-80-000133'\n  tag stig_id: 'ESXI-80-000133'\n  tag cci: ['CCI-001749', 'CCI-001774']\n  tag nist: ['CM-5 (3)', 'CM-7 (5) (b)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    list = ['PartnerSupported', 'VMwareCertified', 'VMwareAccepted']\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.acceptance.get.Invoke()\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should be_in list }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000133.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000145","title":"The ESXi host must enable bidirectional Challenge-Handshake Authentication Protocol (CHAP) authentication for Internet Small Computer Systems Interface (iSCSI) traffic.","desc":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, there is potential for a man-in-the-middle attack, in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.","descriptions":[{"label":"default","data":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, there is potential for a man-in-the-middle attack, in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk."},{"label":"rationale","data":""},{"label":"check","data":"If iSCSI is not used, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\nSelect the iSCSI adapter >> Properties >> Authentication >> Method.\n\nView the CHAP configuration and verify CHAP is required for target and host authentication.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostHba | Where {$_.Type -eq \"iscsi\"} | Select AuthenticationProperties -ExpandProperty AuthenticationProperties\n\nIf iSCSI is used and CHAP is not set to \"required\" for both the target and host, this is a finding.\n\nIf iSCSI is used and unique CHAP secrets are not used for each host, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\nSelect the iSCSI adapter >> Properties >> Authentication.\n\nClick \"Edit...\". Set \"Authentication Method\" to \"Use bidirectional CHAP\" and enter a unique secret for each traffic flow direction.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostHba | Where {$_.Type -eq \"iscsi\"} | Set-VMHostHba -ChapType Required -ChapName \"chapname\" -ChapPassword \"password\" -MutualChapEnabled $true -MutualChapName \"mutualchapname\" -MutualChapPassword \"mutualpassword\""}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000379-VMM-001550","gid":"V-ESXI-80-000145","rid":"SV-ESXI-80-000145","stig_id":"ESXI-80-000145","cci":["CCI-001967"],"nist":["IA-3 (1)"]},"code":"control 'ESXI-80-000145' do\n  title 'The ESXi host must enable bidirectional Challenge-Handshake Authentication Protocol (CHAP) authentication for Internet Small Computer Systems Interface (iSCSI) traffic.'\n  desc  'When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, there is potential for a man-in-the-middle attack, in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If iSCSI is not used, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication >> Method.\n\n    View the CHAP configuration and verify CHAP is required for target and host authentication.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \\\"iscsi\\\"} | Select AuthenticationProperties -ExpandProperty AuthenticationProperties\n\n    If iSCSI is used and CHAP is not set to \\\"required\\\" for both the target and host, this is a finding.\n\n    If iSCSI is used and unique CHAP secrets are not used for each host, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication.\n\n    Click \\\"Edit...\\\". Set \\\"Authentication Method\\\" to \\\"Use bidirectional CHAP\\\" and enter a unique secret for each traffic flow direction.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \\\"iscsi\\\"} | Set-VMHostHba -ChapType Required -ChapName \\\"chapname\\\" -ChapPassword \\\"password\\\" -MutualChapEnabled $true -MutualChapName \\\"mutualchapname\\\" -MutualChapPassword \\\"mutualpassword\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000379-VMM-001550'\n  tag gid: 'V-ESXI-80-000145'\n  tag rid: 'SV-ESXI-80-000145'\n  tag stig_id: 'ESXI-80-000145'\n  tag cci: ['CCI-001967']\n  tag nist: ['IA-3 (1)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'}\"\n      iscsi_hbas = powercli_command(command).stdout\n\n      if iscsi_hbas.empty?\n        impact 0.0\n        describe '' do\n          skip 'There are no iSCSI HBAs present so this control is Not Applicable'\n        end\n      else\n        command1 = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'} | Select-Object -ExpandProperty AuthenticationProperties | Select-Object -ExpandProperty MutualChapEnabled\"\n        command2 = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'} | Select-Object -ExpandProperty AuthenticationProperties | Select-Object -ExpandProperty ChapType\"\n        describe powercli_command(command1) do\n          its('stdout.strip') { should cmp 'True' }\n        end\n        describe powercli_command(command2) do\n          its('stdout.strip') { should cmp 'Required' }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000145.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000160","title":"The ESXi host must protect the confidentiality and integrity of transmitted information by isolating vMotion traffic.","desc":"While encrypted vMotion is available, vMotion traffic should still be sequestered from other traffic to further protect it from attack. This network must only be accessible to other ESXi hosts, preventing outside access to the network.\n\nThe vMotion VMkernel port group must be in a dedicated VLAN that can be on a standard or distributed virtual switch as long as the vMotion VLAN is not shared by any other function and is not routed to anything but ESXi hosts.","descriptions":[{"label":"default","data":"While encrypted vMotion is available, vMotion traffic should still be sequestered from other traffic to further protect it from attack. This network must only be accessible to other ESXi hosts, preventing outside access to the network.\n\nThe vMotion VMkernel port group must be in a dedicated VLAN that can be on a standard or distributed virtual switch as long as the vMotion VLAN is not shared by any other function and is not routed to anything but ESXi hosts."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nReview the VLAN associated with any vMotion VMkernel(s) and verify they are dedicated for that purpose and are logically separated from other functions.\n\nIf long distance or cross vCenter vMotion is used the vMotion network can be routable but must be accessible to only the intended ESXi hosts.\n\nIf the vMotion port group is not on an isolated VLAN and/or is routable to systems other than ESXi hosts, this is a finding."},{"label":"fix","data":"Configuration of the vMotion VMkernel will be unique to each environment.\n\nAs an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\nFrom the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\" and select VLAN.\n\nChange the \"VLAN Type\" to \"VLAN\" and change the \"VLAN ID\" to a network allocated and dedicated to vMotion traffic exclusively. Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000423-VMM-001700","gid":"V-ESXI-80-000160","rid":"SV-ESXI-80-000160","stig_id":"ESXI-80-000160","cci":["CCI-002418"],"nist":["SC-8"]},"code":"control 'ESXI-80-000160' do\n  title 'The ESXi host must protect the confidentiality and integrity of transmitted information by isolating vMotion traffic.'\n  desc  \"\n    While encrypted vMotion is available, vMotion traffic should still be sequestered from other traffic to further protect it from attack. This network must only be accessible to other ESXi hosts, preventing outside access to the network.\n\n    The vMotion VMkernel port group must be in a dedicated VLAN that can be on a standard or distributed virtual switch as long as the vMotion VLAN is not shared by any other function and is not routed to anything but ESXi hosts.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Review the VLAN associated with any vMotion VMkernel(s) and verify they are dedicated for that purpose and are logically separated from other functions.\n\n    If long distance or cross vCenter vMotion is used the vMotion network can be routable but must be accessible to only the intended ESXi hosts.\n\n    If the vMotion port group is not on an isolated VLAN and/or is routable to systems other than ESXi hosts, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of the vMotion VMkernel will be unique to each environment.\n\n    As an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\" and select VLAN.\n\n    Change the \\\"VLAN Type\\\" to \\\"VLAN\\\" and change the \\\"VLAN ID\\\" to a network allocated and dedicated to vMotion traffic exclusively. Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-ESXI-80-000160'\n  tag rid: 'SV-ESXI-80-000160'\n  tag stig_id: 'ESXI-80-000160'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -VMKernel | Where-Object {$_.VMotionEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n      vmks = powercli_command(command).stdout\n\n      if vmks.empty?\n        describe '' do\n          skip 'There are no VMKernel adapters with vMotion enabled so this control is N/A.'\n        end\n      else\n        vmks.split.each do |vmk|\n          # Check to see if vMotion and any other services are enabled on the same VMkernel adapter\n          command2 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VsanTrafficEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n          describe powercli_command(command2) do\n            its('stdout.strip') { should be_empty }\n          end\n          # Get vMotion Port Group Name\n          command3 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Select-Object -ExpandProperty PortGroupName\"\n          pgname = powercli_command(command3).stdout.strip\n          # Test standard port groups\n          command4 = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup -Name \\\"#{pgname}\\\" -Standard | Select-Object -ExpandProperty VlanId\"\n          stdpgs = powercli_command(command4).stdout.strip\n          unless stdpgs.empty?\n            describe 'Checking standand port group VLAN ID' do\n              subject { stdpgs }\n              it { should cmp \"#{input('vMotionVlanId')}\" }\n            end\n          end\n          describe 'SA Interview' do\n            skip 'SA also needs to confirm this VLAN is dedicated to vMotion and not routable except to other ESXi hosts.'\n          end\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000160.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000161","title":"The ESXi host must maintain the confidentiality and integrity of information during transmission by exclusively enabling Transport Layer Security (TLS) 1.2.","desc":"TLS 1.0 and 1.1 are deprecated protocols with well-published shortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces and SSLv3, TL 1.1, and 1.0 disabled, where supported.\n\nMandating TLS 1.2 may break third-party integrations and add-ons to vSphere. Test these integrations carefully after implementing TLS 1.2 and roll back where appropriate.\n\nOn interfaces where required functionality is broken with TLS 1.2, this finding is not applicable until such time as the third-party software supports TLS 1.2.\n\nModify TLS settings in the following order:\n1. vCenter.\n2. ESXi.","descriptions":[{"label":"default","data":"TLS 1.0 and 1.1 are deprecated protocols with well-published shortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces and SSLv3, TL 1.1, and 1.0 disabled, where supported.\n\nMandating TLS 1.2 may break third-party integrations and add-ons to vSphere. Test these integrations carefully after implementing TLS 1.2 and roll back where appropriate.\n\nOn interfaces where required functionality is broken with TLS 1.2, this finding is not applicable until such time as the third-party software supports TLS 1.2.\n\nModify TLS settings in the following order:\n1. vCenter.\n2. ESXi."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.ESXiVPsDisabledProtocols\" value and verify it is set to \"sslv3,tlsv1,tlsv1.1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols\n\nIf the \"UserVars.ESXiVPsDisabledProtocols\" setting is set to a value other than \"sslv3,tlsv1,tlsv1.1\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.ESXiVPsDisabledProtocols\" value and configure it to \"sslv3,tlsv1,tlsv1.1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Set-AdvancedSetting -Value \"sslv3,tlsv1,tlsv1.1\""}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000425-VMM-001710","satisfies":["SRG-OS-000426-VMM-001720"],"gid":"V-ESXI-80-000161","rid":"SV-ESXI-80-000161","stig_id":"ESXI-80-000161","cci":["CCI-002420","CCI-002422"],"nist":["SC-8 (2)"]},"code":"control 'ESXI-80-000161' do\n  title 'The ESXi host must maintain the confidentiality and integrity of information during transmission by exclusively enabling Transport Layer Security (TLS) 1.2.'\n  desc  \"\n    TLS 1.0 and 1.1 are deprecated protocols with well-published shortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces and SSLv3, TL 1.1, and 1.0 disabled, where supported.\n\n    Mandating TLS 1.2 may break third-party integrations and add-ons to vSphere. Test these integrations carefully after implementing TLS 1.2 and roll back where appropriate.\n\n    On interfaces where required functionality is broken with TLS 1.2, this finding is not applicable until such time as the third-party software supports TLS 1.2.\n\n    Modify TLS settings in the following order:\n    1. vCenter.\n    2. ESXi.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiVPsDisabledProtocols\\\" value and verify it is set to \\\"sslv3,tlsv1,tlsv1.1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols\n\n    If the \\\"UserVars.ESXiVPsDisabledProtocols\\\" setting is set to a value other than \\\"sslv3,tlsv1,tlsv1.1\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.ESXiVPsDisabledProtocols\\\" value and configure it to \\\"sslv3,tlsv1,tlsv1.1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Set-AdvancedSetting -Value \\\"sslv3,tlsv1,tlsv1.1\\\"\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000425-VMM-001710'\n  tag satisfies: ['SRG-OS-000426-VMM-001720']\n  tag gid: 'V-ESXI-80-000161'\n  tag rid: 'SV-ESXI-80-000161'\n  tag stig_id: 'ESXI-80-000161'\n  tag cci: ['CCI-002420', 'CCI-002422']\n  tag nist: ['SC-8 (2)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'sslv3,tlsv1,tlsv1.1' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000161.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000187","title":"The ESXi host Secure Shell (SSH) daemon must be configured to only use FIPS 140-2 validated ciphers.","desc":"Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. ESXi must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated.","descriptions":[{"label":"default","data":"Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. ESXi must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep ciphers\n\nExpected result:\n\nciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nCiphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\nNote: The ciphers line must be after the FipsMode setting."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000478-VMM-001980","gid":"V-ESXI-80-000187","rid":"SV-ESXI-80-000187","stig_id":"ESXI-80-000187","cci":["CCI-002450"],"nist":["SC-13"]},"code":"control 'ESXI-80-000187' do\n  title 'The ESXi host Secure Shell (SSH) daemon must be configured to only use FIPS 140-2 validated ciphers.'\n  desc  'Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. ESXi must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep ciphers\n\n    Expected result:\n\n    ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\n    Note: The ciphers line must be after the FipsMode setting.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000478-VMM-001980'\n  tag gid: 'V-ESXI-80-000187'\n  tag rid: 'SV-ESXI-80-000187'\n  tag stig_id: 'ESXI-80-000187'\n  tag cci: ['CCI-002450']\n  tag nist: ['SC-13']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000187.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000189","title":"The ESXi host DCUI.Access list must be verified.","desc":"Lockdown mode disables direct host access, requiring that administrators manage hosts from vCenter Server. However, if a host becomes isolated from vCenter, the administrator is locked out and can no longer manage the host.\n\nThe \"DCUI.Access\" advanced setting allows specified users to exit lockdown mode in such a scenario. If the Direct Console User Interface (DCUI) is running in strict lockdown mode, this setting is ineffective.","descriptions":[{"label":"default","data":"Lockdown mode disables direct host access, requiring that administrators manage hosts from vCenter Server. However, if a host becomes isolated from vCenter, the administrator is locked out and can no longer manage the host.\n\nThe \"DCUI.Access\" advanced setting allows specified users to exit lockdown mode in such a scenario. If the Direct Console User Interface (DCUI) is running in strict lockdown mode, this setting is ineffective."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"DCUI.Access\" value and verify only the root user is listed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name DCUI.Access and verify it is set to root.\n\nIf the \"DCUI.Access\" is not restricted to \"root\", this is a finding.\n\nNote: This list is only for local user accounts and should only contain the root user."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"DCUI.Access\" value and configure it to \"root\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name DCUI.Access | Set-AdvancedSetting -Value \"root\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000189","rid":"SV-ESXI-80-000189","stig_id":"ESXI-80-000189","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000189' do\n  title 'The ESXi host DCUI.Access list must be verified.'\n  desc  \"\n    Lockdown mode disables direct host access, requiring that administrators manage hosts from vCenter Server. However, if a host becomes isolated from vCenter, the administrator is locked out and can no longer manage the host.\n\n    The \\\"DCUI.Access\\\" advanced setting allows specified users to exit lockdown mode in such a scenario. If the Direct Console User Interface (DCUI) is running in strict lockdown mode, this setting is ineffective.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"DCUI.Access\\\" value and verify only the root user is listed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access and verify it is set to root.\n\n    If the \\\"DCUI.Access\\\" is not restricted to \\\"root\\\", this is a finding.\n\n    Note: This list is only for local user accounts and should only contain the root user.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"DCUI.Access\\\" value and configure it to \\\"root\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access | Set-AdvancedSetting -Value \\\"root\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000189'\n  tag rid: 'SV-ESXI-80-000189'\n  tag stig_id: 'ESXI-80-000189'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name DCUI.Access | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'root' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000189.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000191","title":"The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via Secure Shell (SSH).","desc":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.Etc.issue\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.Etc.issue\n\nIf the \"Config.Etc.issue\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.Etc.issue\" value and set it to the following:\n\n\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions: -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations. -At any time, the USG may inspect and seize data stored on this IS. -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose. -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy. -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.Etc.issue | Set-AdvancedSetting -Value \"<Banner text above>\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000023-VMM-000060","gid":"V-ESXI-80-000191","rid":"SV-ESXI-80-000191","stig_id":"ESXI-80-000191","cci":["CCI-000048"],"nist":["AC-8 a"]},"code":"control 'ESXI-80-000191' do\n  title 'The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via Secure Shell (SSH).'\n  desc  \"\n    Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.Etc.issue\\\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue\n\n    If the \\\"Config.Etc.issue\\\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.Etc.issue\\\" value and set it to the following:\n\n    \\\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions: -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations. -At any time, the USG may inspect and seize data stored on this IS. -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose. -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy. -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue | Set-AdvancedSetting -Value \\\"<Banner text above>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag gid: 'V-ESXI-80-000191'\n  tag rid: 'SV-ESXI-80-000191'\n  tag stig_id: 'ESXI-80-000191'\n  tag cci: ['CCI-000048']\n  tag nist: ['AC-8 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      result = powercli_command(\"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.Etc.issue | Select-Object -ExpandProperty Value\")\n      describe.one do\n        describe result do\n          its('stdout.strip') { should match 'You are accessing a U.S. Government' }\n        end\n        describe result do\n          its('stdout.strip') { should match \"I've read & consent to terms in IS user agreem't\" }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000191.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000192","title":"The ESXi host Secure Shell (SSH) daemon must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system.","desc":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep banner\n\nExpected result:\n\nbanner /etc/issue\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, navigate to and open:\n\n/etc/ssh/sshd_config\n\nEnsure that the \"Banner\" line is uncommented and set to the following:\n\nBanner /etc/issue\n\nRestart SSH from the UI or run the following command:\n\n# /etc/init.d/SSH restart"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000023-VMM-000060","gid":"V-ESXI-80-000192","rid":"SV-ESXI-80-000192","stig_id":"ESXI-80-000192","cci":["CCI-000048"],"nist":["AC-8 a"]},"code":"control 'ESXI-80-000192' do\n  title 'The ESXi host Secure Shell (SSH) daemon must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system.'\n  desc  \"\n    Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep banner\n\n    Expected result:\n\n    banner /etc/issue\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, navigate to and open:\n\n    /etc/ssh/sshd_config\n\n    Ensure that the \\\"Banner\\\" line is uncommented and set to the following:\n\n    Banner /etc/issue\n\n    Restart SSH from the UI or run the following command:\n\n    # /etc/init.d/SSH restart\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag gid: 'V-ESXI-80-000192'\n  tag rid: 'SV-ESXI-80-000192'\n  tag stig_id: 'ESXI-80-000192'\n  tag cci: ['CCI-000048']\n  tag nist: ['AC-8 a']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000192.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000193","title":"The ESXi host must be configured to disable nonessential capabilities by disabling Secure Shell (SSH).","desc":"The ESXi Shell is an interactive command line interface (CLI) available at the ESXi server console. The ESXi shell provides temporary access to commands essential for server maintenance. Intended primarily for use in break-fix scenarios, the ESXi shell is well suited for checking and modifying configuration details, which are not always generally accessible, using the vSphere Client.\n\nThe ESXi shell is accessible remotely using SSH by users with the Administrator role. Under normal operating conditions, SSH access to the host must be disabled as is the default. As with the ESXi shell, SSH is also intended only for temporary use during break-fix scenarios. SSH must therefore be disabled under normal operating conditions and must only be enabled for diagnostics or troubleshooting. Remote access to the host must therefore be limited to the vSphere Client or Host Client at all other times.","descriptions":[{"label":"default","data":"The ESXi Shell is an interactive command line interface (CLI) available at the ESXi server console. The ESXi shell provides temporary access to commands essential for server maintenance. Intended primarily for use in break-fix scenarios, the ESXi shell is well suited for checking and modifying configuration details, which are not always generally accessible, using the vSphere Client.\n\nThe ESXi shell is accessible remotely using SSH by users with the Administrator role. Under normal operating conditions, SSH access to the host must be disabled as is the default. As with the ESXi shell, SSH is also intended only for temporary use during break-fix scenarios. SSH must therefore be disabled under normal operating conditions and must only be enabled for diagnostics or troubleshooting. Remote access to the host must therefore be limited to the vSphere Client or Host Client at all other times."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder Services, locate the \"SSH\" service and verify it is \"Stopped\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"}\n\nIf the SSH service is \"Running\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", select the \"SSH\" service and click the \"Stop\" button.\n\nClick the \"Edit Startup policy...\" button.\n\nSelect the \"Start and stop manually\" radio button.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000095-VMM-000480","satisfies":["SRG-OS-000297-VMM-001040","SRG-OS-000298-VMM-001050"],"gid":"V-ESXI-80-000193","rid":"SV-ESXI-80-000193","stig_id":"ESXI-80-000193","cci":["CCI-000381","CCI-002314","CCI-002322"],"nist":["AC-17 (1)","AC-17 (9)","CM-7 a"]},"code":"control 'ESXI-80-000193' do\n  title 'The ESXi host must be configured to disable nonessential capabilities by disabling Secure Shell (SSH).'\n  desc  \"\n    The ESXi Shell is an interactive command line interface (CLI) available at the ESXi server console. The ESXi shell provides temporary access to commands essential for server maintenance. Intended primarily for use in break-fix scenarios, the ESXi shell is well suited for checking and modifying configuration details, which are not always generally accessible, using the vSphere Client.\n\n    The ESXi shell is accessible remotely using SSH by users with the Administrator role. Under normal operating conditions, SSH access to the host must be disabled as is the default. As with the ESXi shell, SSH is also intended only for temporary use during break-fix scenarios. SSH must therefore be disabled under normal operating conditions and must only be enabled for diagnostics or troubleshooting. Remote access to the host must therefore be limited to the vSphere Client or Host Client at all other times.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under Services, locate the \\\"SSH\\\" service and verify it is \\\"Stopped\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"}\n\n    If the SSH service is \\\"Running\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", select the \\\"SSH\\\" service and click the \\\"Stop\\\" button.\n\n    Click the \\\"Edit Startup policy...\\\" button.\n\n    Select the \\\"Start and stop manually\\\" radio button.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag satisfies: ['SRG-OS-000297-VMM-001040', 'SRG-OS-000298-VMM-001050']\n  tag gid: 'V-ESXI-80-000193'\n  tag rid: 'SV-ESXI-80-000193'\n  tag stig_id: 'ESXI-80-000193'\n  tag cci: ['CCI-000381', 'CCI-002314', 'CCI-002322']\n  tag nist: ['AC-17 (1)', 'AC-17 (9)', 'CM-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000193.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000194","title":"The ESXi host must be configured to disable nonessential capabilities by disabling the ESXi shell.","desc":"The ESXi Shell is an interactive command line environment available locally from the Direct Console User Interface (DCUI) or remotely via SSH. Activities performed from the ESXi Shell bypass vCenter role-based access control (RBAC) and audit controls.\n\nThe ESXi shell must only be turned on when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere client.","descriptions":[{"label":"default","data":"The ESXi Shell is an interactive command line environment available locally from the Direct Console User Interface (DCUI) or remotely via SSH. Activities performed from the ESXi Shell bypass vCenter role-based access control (RBAC) and audit controls.\n\nThe ESXi shell must only be turned on when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere client."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder Services, locate the \"ESXi Shell\" service and verify it is \"Stopped\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"}\n\nIf the ESXi Shell service is \"Running\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", select the \"ESXi Shell\" service and click the \"Stop\" button.\n\nClick the \"Edit Startup policy...\" button.\n\nSelect the \"Start and stop manually\" radio button.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000095-VMM-000480","gid":"V-ESXI-80-000194","rid":"SV-ESXI-80-000194","stig_id":"ESXI-80-000194","cci":["CCI-000381"],"nist":["CM-7 a"]},"code":"control 'ESXI-80-000194' do\n  title 'The ESXi host must be configured to disable nonessential capabilities by disabling the ESXi shell.'\n  desc  \"\n    The ESXi Shell is an interactive command line environment available locally from the Direct Console User Interface (DCUI) or remotely via SSH. Activities performed from the ESXi Shell bypass vCenter role-based access control (RBAC) and audit controls.\n\n    The ESXi shell must only be turned on when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere client.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under Services, locate the \\\"ESXi Shell\\\" service and verify it is \\\"Stopped\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"}\n\n    If the ESXi Shell service is \\\"Running\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", select the \\\"ESXi Shell\\\" service and click the \\\"Stop\\\" button.\n\n    Click the \\\"Edit Startup policy...\\\" button.\n\n    Select the \\\"Start and stop manually\\\" radio button.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag gid: 'V-ESXI-80-000194'\n  tag rid: 'SV-ESXI-80-000194'\n  tag stig_id: 'ESXI-80-000194'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000194.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000195","title":"The ESXi host must automatically stop shell services after ten minutes.","desc":"When the ESXi Shell or Secure Shell (SSH) services are enabled on a host, they will run indefinitely. To avoid having these services left running, set the \"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after which the ESXi Shell and SSH services will be stopped automatically.","descriptions":[{"label":"default","data":"When the ESXi Shell or Secure Shell (SSH) services are enabled on a host, they will run indefinitely. To avoid having these services left running, set the \"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after which the ESXi Shell and SSH services will be stopped automatically."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.ESXiShellTimeOut\" value and verify it is set to less than \"600\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut\n\nIf the \"UserVars.ESXiShellTimeOut\" setting is set to a value greater than \"600\" or \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.ESXiShellTimeOut\" value and configure it to \"600\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Set-AdvancedSetting -Value 600"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000163-VMM-000700","gid":"V-ESXI-80-000195","rid":"SV-ESXI-80-000195","stig_id":"ESXI-80-000195","cci":["CCI-001133"],"nist":["SC-10"]},"code":"control 'ESXI-80-000195' do\n  title 'The ESXi host must automatically stop shell services after ten minutes.'\n  desc  'When the ESXi Shell or Secure Shell (SSH) services are enabled on a host, they will run indefinitely. To avoid having these services left running, set the \"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after which the ESXi Shell and SSH services will be stopped automatically.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiShellTimeOut\\\" value and verify it is set to less than \\\"600\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut\n\n    If the \\\"UserVars.ESXiShellTimeOut\\\" setting is set to a value greater than \\\"600\\\" or \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.ESXiShellTimeOut\\\" value and configure it to \\\"600\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Set-AdvancedSetting -Value 600\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag gid: 'V-ESXI-80-000195'\n  tag rid: 'SV-ESXI-80-000195'\n  tag stig_id: 'ESXI-80-000195'\n  tag cci: ['CCI-001133']\n  tag nist: ['SC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 600 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000195.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000196","title":"The ESXi host must set a timeout to automatically end idle DCUI sessions after ten minutes.","desc":"When the Direct Console User Interface (DCUI) is enabled and logged in, it should be automatically logged out if left logged on to avoid access by unauthorized persons. The \"DcuiTimeOut\" setting defines a window of time after which the DCUI will be logged out.","descriptions":[{"label":"default","data":"When the Direct Console User Interface (DCUI) is enabled and logged in, it should be automatically logged out if left logged on to avoid access by unauthorized persons. The \"DcuiTimeOut\" setting defines a window of time after which the DCUI will be logged out."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.DcuiTimeOut\" value and verify it is set to less than \"600\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut\n\nIf the \"UserVars.DcuiTimeOut\" setting is set to a value greater than \"600\" or \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.DcuiTimeOut\" value and configure it to \"600\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Set-AdvancedSetting -Value 600"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000163-VMM-000700","gid":"V-ESXI-80-000196","rid":"SV-ESXI-80-000196","stig_id":"ESXI-80-000196","cci":["CCI-001133"],"nist":["SC-10"]},"code":"control 'ESXI-80-000196' do\n  title 'The ESXi host must set a timeout to automatically end idle DCUI sessions after ten minutes.'\n  desc  'When the Direct Console User Interface (DCUI) is enabled and logged in, it should be automatically logged out if left logged on to avoid access by unauthorized persons. The \"DcuiTimeOut\" setting defines a window of time after which the DCUI will be logged out.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.DcuiTimeOut\\\" value and verify it is set to less than \\\"600\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut\n\n    If the \\\"UserVars.DcuiTimeOut\\\" setting is set to a value greater than \\\"600\\\" or \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.DcuiTimeOut\\\" value and configure it to \\\"600\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Set-AdvancedSetting -Value 600\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag gid: 'V-ESXI-80-000196'\n  tag rid: 'SV-ESXI-80-000196'\n  tag stig_id: 'ESXI-80-000196'\n  tag cci: ['CCI-001133']\n  tag nist: ['SC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 600 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000196.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000198","title":"The ESXi host must protect the confidentiality and integrity of transmitted information by isolating ESXi management traffic.","desc":"The vSphere management network provides access to the vSphere management interface on each component. Services running on the management interface provide an opportunity for an attacker to gain privileged access to the systems. Any remote attack most likely would begin with gaining entry to this network.\n\nThe Management VMkernel port group can be on a standard or distributed virtual switch but must be on a dedicated VLAN. The Management VLAN must not be shared by any other function and must not be accessible to anything other than management-related functions such as vCenter.","descriptions":[{"label":"default","data":"The vSphere management network provides access to the vSphere management interface on each component. Services running on the management interface provide an opportunity for an attacker to gain privileged access to the systems. Any remote attack most likely would begin with gaining entry to this network.\n\nThe Management VMkernel port group can be on a standard or distributed virtual switch but must be on a dedicated VLAN. The Management VLAN must not be shared by any other function and must not be accessible to anything other than management-related functions such as vCenter."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nReview each VMkernel adapter that is used for management traffic and view the \"Enabled services\".\n\nReview the VLAN associated with each VMkernel that is used for management traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\nIf any services are enabled on any Management VMkernel adapter, this is a finding.\n\nIf the network segment is accessible, except to networks where other management-related entities are located such as vCenter, this is a finding.\n\nIf there are any other systems or devices such as VMs on the ESXi management segment, this is a finding."},{"label":"fix","data":"Configuration of the management VMkernel will be unique to each environment.\n\nAs an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nSelect the Management VMkernel and click \"Edit\". On the Port properties tab, uncheck all services except for \"Management\". Click \"OK\".\n\nFrom the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\" and select VLAN.\n\nChange the \"VLAN Type\" to \"VLAN\" and change the \"VLAN ID\" to a network allocated and dedicated to management traffic exclusively. Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000423-VMM-001700","gid":"V-ESXI-80-000198","rid":"SV-ESXI-80-000198","stig_id":"ESXI-80-000198","cci":["CCI-002418"],"nist":["SC-8"]},"code":"control 'ESXI-80-000198' do\n  title 'The ESXi host must protect the confidentiality and integrity of transmitted information by isolating ESXi management traffic.'\n  desc  \"\n    The vSphere management network provides access to the vSphere management interface on each component. Services running on the management interface provide an opportunity for an attacker to gain privileged access to the systems. Any remote attack most likely would begin with gaining entry to this network.\n\n    The Management VMkernel port group can be on a standard or distributed virtual switch but must be on a dedicated VLAN. The Management VLAN must not be shared by any other function and must not be accessible to anything other than management-related functions such as vCenter.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Review each VMkernel adapter that is used for management traffic and view the \\\"Enabled services\\\".\n\n    Review the VLAN associated with each VMkernel that is used for management traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\n    If any services are enabled on any Management VMkernel adapter, this is a finding.\n\n    If the network segment is accessible, except to networks where other management-related entities are located such as vCenter, this is a finding.\n\n    If there are any other systems or devices such as VMs on the ESXi management segment, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of the management VMkernel will be unique to each environment.\n\n    As an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Select the Management VMkernel and click \\\"Edit\\\". On the Port properties tab, uncheck all services except for \\\"Management\\\". Click \\\"OK\\\".\n\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\" and select VLAN.\n\n    Change the \\\"VLAN Type\\\" to \\\"VLAN\\\" and change the \\\"VLAN ID\\\" to a network allocated and dedicated to management traffic exclusively. Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-ESXI-80-000198'\n  tag rid: 'SV-ESXI-80-000198'\n  tag stig_id: 'ESXI-80-000198'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -VMKernel | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n      vmks = powercli_command(command).stdout\n\n      vmks.split.each do |vmk|\n        # Check to see if Management and any other services are enabled on the same VMkernel adapter\n        command2 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Where-Object {$_.VMotionEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VsanTrafficEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n        describe powercli_command(command2) do\n          its('stdout.strip') { should be_empty }\n        end\n        # Get Management Port Group Name\n        command3 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Select-Object -ExpandProperty PortGroupName\"\n        pgname = powercli_command(command3).stdout.strip\n        # Test standard port groups\n        command4 = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup -Name \\\"#{pgname}\\\" | Select-Object -ExpandProperty VlanId\"\n        stdpgs = powercli_command(command4).stdout.strip\n        unless stdpgs.empty?\n          describe 'Checking standand port group VLAN ID' do\n            subject { stdpgs }\n            it { should cmp \"#{input('mgtVlanId')}\" }\n          end\n        end\n        describe 'SA Interview' do\n          skip 'SA also needs to confirm this VLAN is dedicated to Management and not shared with VMs or other services.'\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000198.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000199","title":"The ESXi host must protect the confidentiality and integrity of transmitted information by isolating IP-based storage traffic.","desc":"Virtual machines (VMs) might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes vSAN, iSCSI, and NFS. This configuration might expose IP-based storage traffic to unauthorized VM users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from any other traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and VMs will limit unauthorized users from viewing the traffic.","descriptions":[{"label":"default","data":"Virtual machines (VMs) might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes vSAN, iSCSI, and NFS. This configuration might expose IP-based storage traffic to unauthorized VM users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from any other traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and VMs will limit unauthorized users from viewing the traffic."},{"label":"rationale","data":""},{"label":"check","data":"If IP-based storage is not used, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nReview each VMkernel adapter that is used for IP-based storage traffic and view the \"Enabled services\".\n\nReview the VLAN associated with each VMkernel that is used for IP-based storage traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\nIf any services are enabled on an NFS or iSCSI IP-based storage VMkernel adapter, this is a finding.\n\nIf any services are enabled on a vSAN VMkernel adapter other than vSAN, this is a finding.\n\nIf any IP-based storage networks are not isolated from other traffic types, this is a finding."},{"label":"fix","data":"Configuration of an IP-Based VMkernel will be unique to each environment.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nSelect the VMkernel used for IP-based storage and click \"Edit\". On the \"Port\" properties tab, uncheck all services. Click \"OK\".\n\nNote: For VMkernels used for vSAN leave the vSAN service enabled and uncheck all others.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual switches.\n\nFind the port group that is dedicated to IP-based storage and click the '...' button next to the name. Click \"Edit Settings\".\n\nOn the \"Properties\" tab, change the \"VLAN ID\" to one dedicated for IP-based storage traffic. Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000423-VMM-001700","gid":"V-ESXI-80-000199","rid":"SV-ESXI-80-000199","stig_id":"ESXI-80-000199","cci":["CCI-002418"],"nist":["SC-8"]},"code":"control 'ESXI-80-000199' do\n  title 'The ESXi host must protect the confidentiality and integrity of transmitted information by isolating IP-based storage traffic.'\n  desc  \"\n    Virtual machines (VMs) might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes vSAN, iSCSI, and NFS. This configuration might expose IP-based storage traffic to unauthorized VM users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\n    To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from any other traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and VMs will limit unauthorized users from viewing the traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If IP-based storage is not used, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Review each VMkernel adapter that is used for IP-based storage traffic and view the \\\"Enabled services\\\".\n\n    Review the VLAN associated with each VMkernel that is used for IP-based storage traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\n    If any services are enabled on an NFS or iSCSI IP-based storage VMkernel adapter, this is a finding.\n\n    If any services are enabled on a vSAN VMkernel adapter other than vSAN, this is a finding.\n\n    If any IP-based storage networks are not isolated from other traffic types, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of an IP-Based VMkernel will be unique to each environment.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Select the VMkernel used for IP-based storage and click \\\"Edit\\\". On the \\\"Port\\\" properties tab, uncheck all services. Click \\\"OK\\\".\n\n    Note: For VMkernels used for vSAN leave the vSAN service enabled and uncheck all others.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual switches.\n\n    Find the port group that is dedicated to IP-based storage and click the '...' button next to the name. Click \\\"Edit Settings\\\".\n\n    On the \\\"Properties\\\" tab, change the \\\"VLAN ID\\\" to one dedicated for IP-based storage traffic. Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-ESXI-80-000199'\n  tag rid: 'SV-ESXI-80-000199'\n  tag stig_id: 'ESXI-80-000199'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      # Check for iSCSI HBAs\n      commandiscsihbas = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'}\"\n      iscsi_hbas = powercli_command(commandiscsihbas).stdout\n\n      # Check for vSAN VMkernels\n      commandvsanvmks = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -VMKernel | Where-Object {$_.VsanTrafficEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n      vsanvmks = powercli_command(commandvsanvmks).stdout\n\n      # Check for NFS Datastores\n      commandnfs = \"Get-VMHost -Name #{vmhost} | Get-Datastore | Where {$_.Type -eq 'NFS'} | Select-Object -ExpandProperty Name\"\n      nfsds = powercli_command(commandnfs).stdout\n\n      if iscsi_hbas.empty? && vsanvmks.empty? && nfsds.empty?\n        describe '' do\n          skip \"The ESXi host #{vmhost} is not using IP-based storage, so this control is N/A.\"\n        end\n      else\n        # Do any iSCSI VMKs have any services enabled?\n        commandivmks = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.iscsi.networkportal.list.Invoke() | Select-Object -ExpandProperty Vmknic\"\n        ivmks = powercli_command(commandivmks).stdout\n        ivmks.split.each do |ivmk|\n          commandvsck = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{ivmk} | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\" -or $_.VsanTrafficEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VMotionEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n          describe powercli_command(commandvsck) do\n            its('stdout.strip') { should be_empty }\n          end\n        end\n        # Does the vSAN VMK have any other services enabled?\n        vsanvmks.split.each do |vmk|\n          commandvsck = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VMotionEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n          describe powercli_command(commandvsck) do\n            its('stdout.strip') { should be_empty }\n          end\n        end\n        # Do any VMKs used for NFS storage have any services enabled?\n        unless nfsds.empty?\n          describe '' do\n            skip \"The ESXi host #{vmhost} has NFS datastores and requires manual validation.\"\n          end\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000199.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000201","title":"The ESXi host lockdown mode exception users list must be verified.","desc":"While a host is in lockdown mode (strict or normal), only users on the \"Exception Users\" list are allowed access. These users do not lose their permissions when the host enters lockdown mode.\n\nThe organization may want to add service accounts such as a backup agent to the Exception Users list. Verify the list of users exempted from losing permissions is legitimate and as needed per the environment. Adding unnecessary users to the exception list defeats the purpose of lockdown mode.","descriptions":[{"label":"default","data":"While a host is in lockdown mode (strict or normal), only users on the \"Exception Users\" list are allowed access. These users do not lose their permissions when the host enters lockdown mode.\n\nThe organization may want to add service accounts such as a backup agent to the Exception Users list. Verify the list of users exempted from losing permissions is legitimate and as needed per the environment. Adding unnecessary users to the exception list defeats the purpose of lockdown mode."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Lockdown Mode\", review the Exception Users list.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following script:\n\n$vmhost = Get-VMHost | Get-View\n$lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n$lockdown.QueryLockdownExceptions()\n\nIf the Exception Users list contains accounts that do not require special permissions, this is a finding.\n\nNote: The Exception Users list is empty by default and should remain that way except under site-specific circumstances."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Lockdown Mode\", click \"Edit\" and remove unnecessary users from the Exception Users list."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000201","rid":"SV-ESXI-80-000201","stig_id":"ESXI-80-000201","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000201' do\n  title 'The ESXi host lockdown mode exception users list must be verified.'\n  desc  \"\n    While a host is in lockdown mode (strict or normal), only users on the \\\"Exception Users\\\" list are allowed access. These users do not lose their permissions when the host enters lockdown mode.\n\n    The organization may want to add service accounts such as a backup agent to the Exception Users list. Verify the list of users exempted from losing permissions is legitimate and as needed per the environment. Adding unnecessary users to the exception list defeats the purpose of lockdown mode.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Lockdown Mode\\\", review the Exception Users list.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following script:\n\n    $vmhost = Get-VMHost | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.QueryLockdownExceptions()\n\n    If the Exception Users list contains accounts that do not require special permissions, this is a finding.\n\n    Note: The Exception Users list is empty by default and should remain that way except under site-specific circumstances.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Lockdown Mode\\\", click \\\"Edit\\\" and remove unnecessary users from the Exception Users list.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000201'\n  tag rid: 'SV-ESXI-80-000201'\n  tag stig_id: 'ESXI-80-000201'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost} | Get-View; (Get-View $vmhost.ConfigManager.HostAccessManager).QueryLockdownExceptions()\"\n      results = powercli_command(command).stdout\n      if !results.empty?\n        results.split.each do |exceptionUser|\n          describe \"Exception user: #{exceptionUser} on host: #{vmhost}\" do\n            subject { exceptionUser }\n            it { should be_in \"#{input('exceptionUsers')}\" }\n          end\n        end\n      else\n        describe \"Exception users for host: #{vmhost}\" do\n          subject { results }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000201.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000202","title":"The ESXi host Secure Shell (SSH) daemon must not allow host-based authentication.","desc":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH's cryptographic host-based authentication is more secure than \".rhosts\" authentication, since hosts are cryptographically authenticated. However, it is not recommended that hosts unilaterally trust one another, even within an organization.","descriptions":[{"label":"default","data":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH's cryptographic host-based authentication is more secure than \".rhosts\" authentication, since hosts are cryptographically authenticated. However, it is not recommended that hosts unilaterally trust one another, even within an organization."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep hostbasedauthentication\n\nExpected result:\n\nhostbasedauthentication no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nHostbasedAuthentication no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000202","rid":"SV-ESXI-80-000202","stig_id":"ESXI-80-000202","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000202' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not allow host-based authentication.'\n  desc  \"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH's cryptographic host-based authentication is more secure than \\\".rhosts\\\" authentication, since hosts are cryptographically authenticated. However, it is not recommended that hosts unilaterally trust one another, even within an organization.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep hostbasedauthentication\n\n    Expected result:\n\n    hostbasedauthentication no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    HostbasedAuthentication no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000202'\n  tag rid: 'SV-ESXI-80-000202'\n  tag stig_id: 'ESXI-80-000202'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000202.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000203","title":"The ESXi host Secure Shell (SSH) daemon must not allow authentication using an empty password.","desc":"Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.","descriptions":[{"label":"default","data":"Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep permitemptypasswords\n\nExpected result:\n\npermitemptypasswords no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nPermitEmptyPasswords no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000203","rid":"SV-ESXI-80-000203","stig_id":"ESXI-80-000203","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000203' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not allow authentication using an empty password.'\n  desc  'Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep permitemptypasswords\n\n    Expected result:\n\n    permitemptypasswords no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitEmptyPasswords no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000203'\n  tag rid: 'SV-ESXI-80-000203'\n  tag stig_id: 'ESXI-80-000203'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000203.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000204","title":"The ESXi host Secure Shell (SSH) daemon must not permit user environment settings.","desc":"SSH environment options potentially allow users to bypass access restriction in some configurations. Users must not be able to present environment options to the SSH daemon.","descriptions":[{"label":"default","data":"SSH environment options potentially allow users to bypass access restriction in some configurations. Users must not be able to present environment options to the SSH daemon."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep permituserenvironment\n\nExpected result:\n\npermituserenvironment no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nPermitUserEnvironment no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000204","rid":"SV-ESXI-80-000204","stig_id":"ESXI-80-000204","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000204' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not permit user environment settings.'\n  desc  'SSH environment options potentially allow users to bypass access restriction in some configurations. Users must not be able to present environment options to the SSH daemon.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep permituserenvironment\n\n    Expected result:\n\n    permituserenvironment no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitUserEnvironment no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000204'\n  tag rid: 'SV-ESXI-80-000204'\n  tag stig_id: 'ESXI-80-000204'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000204.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000205","title":"The ESXi host Secure Shell (SSH) daemon must perform strict mode checking of home directory configuration files.","desc":"If other users have access to modify user-specific SSH configuration files, they may be able to log on the system as another user.","descriptions":[{"label":"default","data":"If other users have access to modify user-specific SSH configuration files, they may be able to log on the system as another user."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep strictmodes\n\nExpected result:\n\nstrictmodes yes\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nStrictModes yes"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000205","rid":"SV-ESXI-80-000205","stig_id":"ESXI-80-000205","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000205' do\n  title 'The ESXi host Secure Shell (SSH) daemon must perform strict mode checking of home directory configuration files.'\n  desc  'If other users have access to modify user-specific SSH configuration files, they may be able to log on the system as another user.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep strictmodes\n\n    Expected result:\n\n    strictmodes yes\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    StrictModes yes\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000205'\n  tag rid: 'SV-ESXI-80-000205'\n  tag stig_id: 'ESXI-80-000205'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000205.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000206","title":"The ESXi host Secure Shell (SSH) daemon must not allow compression.","desc":"If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges.","descriptions":[{"label":"default","data":"If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep compression\n\nExpected result:\n\ncompression no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nCompression no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000206","rid":"SV-ESXI-80-000206","stig_id":"ESXI-80-000206","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000206' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not allow compression.'\n  desc  'If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep compression\n\n    Expected result:\n\n    compression no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Compression no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000206'\n  tag rid: 'SV-ESXI-80-000206'\n  tag stig_id: 'ESXI-80-000206'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000206.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000207","title":"The ESXi host Secure Shell (SSH) daemon must be configured to not allow gateway ports.","desc":"SSH Transmission Control Protocol (TCP) connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide convenience similar to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs). Gateway ports allow remote forwarded ports to bind to nonloopback addresses on the server.","descriptions":[{"label":"default","data":"SSH Transmission Control Protocol (TCP) connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide convenience similar to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs). Gateway ports allow remote forwarded ports to bind to nonloopback addresses on the server."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep gatewayports\n\nExpected result:\n\ngatewayports no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nGatewayPorts no"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000207","rid":"SV-ESXI-80-000207","stig_id":"ESXI-80-000207","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000207' do\n  title 'The ESXi host Secure Shell (SSH) daemon must be configured to not allow gateway ports.'\n  desc  'SSH Transmission Control Protocol (TCP) connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide convenience similar to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs). Gateway ports allow remote forwarded ports to bind to nonloopback addresses on the server.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep gatewayports\n\n    Expected result:\n\n    gatewayports no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    GatewayPorts no\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000207'\n  tag rid: 'SV-ESXI-80-000207'\n  tag stig_id: 'ESXI-80-000207'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000207.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000208","title":"The ESXi host Secure Shell (SSH) daemon must be configured to not allow X11 forwarding.","desc":"X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection.","descriptions":[{"label":"default","data":"X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep x11forwarding\n\nExpected result:\n\nx11forwarding no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nX11Forwarding no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000208","rid":"SV-ESXI-80-000208","stig_id":"ESXI-80-000208","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000208' do\n  title 'The ESXi host Secure Shell (SSH) daemon must be configured to not allow X11 forwarding.'\n  desc  'X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep x11forwarding\n\n    Expected result:\n\n    x11forwarding no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    X11Forwarding no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000208'\n  tag rid: 'SV-ESXI-80-000208'\n  tag stig_id: 'ESXI-80-000208'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000208.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000209","title":"The ESXi host Secure Shell (SSH) daemon must not permit tunnels.","desc":"OpenSSH has the ability to create network tunnels (layer 2 and layer 3) over an SSH connection. This function can provide similar convenience to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs).","descriptions":[{"label":"default","data":"OpenSSH has the ability to create network tunnels (layer 2 and layer 3) over an SSH connection. This function can provide similar convenience to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs)."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep permittunnel\n\nExpected result:\n\npermittunnel no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nPermitTunnel no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000209","rid":"SV-ESXI-80-000209","stig_id":"ESXI-80-000209","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000209' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not permit tunnels.'\n  desc  'OpenSSH has the ability to create network tunnels (layer 2 and layer 3) over an SSH connection. This function can provide similar convenience to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs).'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep permittunnel\n\n    Expected result:\n\n    permittunnel no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitTunnel no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000209'\n  tag rid: 'SV-ESXI-80-000209'\n  tag stig_id: 'ESXI-80-000209'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000209.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000210","title":"The ESXi host Secure Shell (SSH) daemon must set a timeout count on idle sessions.","desc":"Setting a timeout ensures that a user login will be terminated as soon as the \"ClientAliveCountMax\" is reached.","descriptions":[{"label":"default","data":"Setting a timeout ensures that a user login will be terminated as soon as the \"ClientAliveCountMax\" is reached."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep clientalivecountmax\n\nExpected result:\n\nclientalivecountmax 3\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nClientAliveCountMax 3"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000210","rid":"SV-ESXI-80-000210","stig_id":"ESXI-80-000210","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000210' do\n  title 'The ESXi host Secure Shell (SSH) daemon must set a timeout count on idle sessions.'\n  desc  'Setting a timeout ensures that a user login will be terminated as soon as the \"ClientAliveCountMax\" is reached.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep clientalivecountmax\n\n    Expected result:\n\n    clientalivecountmax 3\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    ClientAliveCountMax 3\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000210'\n  tag rid: 'SV-ESXI-80-000210'\n  tag stig_id: 'ESXI-80-000210'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000210.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000211","title":"The ESXi host Secure Shell (SSH) daemon must set a timeout interval on idle sessions.","desc":"Automatically logging out idle users guards against compromises via hijacked administrative sessions.","descriptions":[{"label":"default","data":"Automatically logging out idle users guards against compromises via hijacked administrative sessions."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep clientaliveinterval\n\nExpected result:\n\nclientaliveinterval 200\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nClientAliveInterval 200"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000211","rid":"SV-ESXI-80-000211","stig_id":"ESXI-80-000211","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000211' do\n  title 'The ESXi host Secure Shell (SSH) daemon must set a timeout interval on idle sessions.'\n  desc  'Automatically logging out idle users guards against compromises via hijacked administrative sessions.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep clientaliveinterval\n\n    Expected result:\n\n    clientaliveinterval 200\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    ClientAliveInterval 200\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000211'\n  tag rid: 'SV-ESXI-80-000211'\n  tag stig_id: 'ESXI-80-000211'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000211.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000212","title":"The ESXi host must disable Simple Network Management Protocol (SNMP) v1 and v2c.","desc":"If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can use this information to plan an attack.","descriptions":[{"label":"default","data":"If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can use this information to plan an attack."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli system snmp get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHostSnmp | Select *\n\nIf SNMP is not in use and is enabled, this is a finding.\n\nIf SNMP is enabled and is not using v3 targets with authentication, this is a finding.\n\nNote: SNMP v3 targets can only be viewed and configured via the \"esxcli\" command."},{"label":"fix","data":"To disable SNMP from an ESXi shell, run the following command:\n\n# esxcli system snmp set -e no\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi Host:\n\nGet-VMHostSnmp | Set-VMHostSnmp -Enabled $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000212","rid":"SV-ESXI-80-000212","stig_id":"ESXI-80-000212","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000212' do\n  title 'The ESXi host must disable Simple Network Management Protocol (SNMP) v1 and v2c.'\n  desc  'If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can use this information to plan an attack.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system snmp get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHostSnmp | Select *\n\n    If SNMP is not in use and is enabled, this is a finding.\n\n    If SNMP is enabled and is not using v3 targets with authentication, this is a finding.\n\n    Note: SNMP v3 targets can only be viewed and configured via the \\\"esxcli\\\" command.\n  \"\n  desc 'fix', \"\n    To disable SNMP from an ESXi shell, run the following command:\n\n    # esxcli system snmp set -e no\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi Host:\n\n    Get-VMHostSnmp | Set-VMHostSnmp -Enabled $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000212'\n  tag rid: 'SV-ESXI-80-000212'\n  tag stig_id: 'ESXI-80-000212'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    if \"#{input('snmpEnabled')}\" == 'false'\n      vmhosts.each do |vmhost|\n        command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.snmp.get.Invoke() | Select-Object -ExpandProperty enable\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp 'false' }\n        end\n      end\n    else\n      describe 'SNMP Enabled' do\n        skip 'Manually verify SNMP v3 is configured correctly and v2 is not used.'\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000212.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000213","title":"The ESXi host must disable Inter-Virtual Machine (VM) Transparent Page Sharing.","desc":"Published academic papers have demonstrated that by forcing a flush and reload of cache memory, it is possible to measure memory timings to try to determine an Advanced Encryption Standard (AES) encryption key in use on another virtual machine running on the same physical processor of the host server if Transparent Page Sharing (TPS) is enabled between the two VMs. This technique works only in a highly controlled system configured in a nonstandard way that VMware believes would not be recreated in a production environment.\n\nAlthough VMware believes information being disclosed in real-world conditions is unrealistic, out of an abundance of caution, upcoming ESXi Update releases will no longer enable TPS between VMs by default (TPS will still be used within individual VMs).","descriptions":[{"label":"default","data":"Published academic papers have demonstrated that by forcing a flush and reload of cache memory, it is possible to measure memory timings to try to determine an Advanced Encryption Standard (AES) encryption key in use on another virtual machine running on the same physical processor of the host server if Transparent Page Sharing (TPS) is enabled between the two VMs. This technique works only in a highly controlled system configured in a nonstandard way that VMware believes would not be recreated in a production environment.\n\nAlthough VMware believes information being disclosed in real-world conditions is unrealistic, out of an abundance of caution, upcoming ESXi Update releases will no longer enable TPS between VMs by default (TPS will still be used within individual VMs)."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Mem.ShareForceSalting\" value and verify it is set to \"2\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting\n\nIf the \"Mem.ShareForceSalting\" setting is not set to 2, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Mem.ShareForceSalting\" value and set it to \"2\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting | Set-AdvancedSetting -Value 2"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000213","rid":"SV-ESXI-80-000213","stig_id":"ESXI-80-000213","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000213' do\n  title 'The ESXi host must disable Inter-Virtual Machine (VM) Transparent Page Sharing.'\n  desc  \"\n    Published academic papers have demonstrated that by forcing a flush and reload of cache memory, it is possible to measure memory timings to try to determine an Advanced Encryption Standard (AES) encryption key in use on another virtual machine running on the same physical processor of the host server if Transparent Page Sharing (TPS) is enabled between the two VMs. This technique works only in a highly controlled system configured in a nonstandard way that VMware believes would not be recreated in a production environment.\n\n    Although VMware believes information being disclosed in real-world conditions is unrealistic, out of an abundance of caution, upcoming ESXi Update releases will no longer enable TPS between VMs by default (TPS will still be used within individual VMs).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Mem.ShareForceSalting\\\" value and verify it is set to \\\"2\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting\n\n    If the \\\"Mem.ShareForceSalting\\\" setting is not set to 2, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Mem.ShareForceSalting\\\" value and set it to \\\"2\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting | Set-AdvancedSetting -Value 2\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000213'\n  tag rid: 'SV-ESXI-80-000213'\n  tag stig_id: 'ESXI-80-000213'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Mem.ShareForceSalting | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '2' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000213.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000214","title":"The ESXi host must configure the firewall to block network traffic by default.","desc":"In addition to service-specific firewall rules, ESXi has a default firewall rule policy to allow or deny incoming and outgoing traffic. Reduce the risk of attack by ensuring this is set to deny incoming and outgoing traffic.","descriptions":[{"label":"default","data":"In addition to service-specific firewall rules, ESXi has a default firewall rule policy to allow or deny incoming and outgoing traffic. Reduce the risk of attack by ensuring this is set to deny incoming and outgoing traffic."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli network firewall get\n\nIf the \"Default Action\" does not equal \"DROP\", this is a finding.\nIf \"Enabled\" does not equal \"true\", this is a finding.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHostFirewallDefaultPolicy\n\nIf the Incoming or Outgoing policies are \"True\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# esxcli network firewall set --default-action=false\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHostFirewallDefaultPolicy | Set-VMHostFirewallDefaultPolicy -AllowIncoming $false -AllowOutgoing $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000214","rid":"SV-ESXI-80-000214","stig_id":"ESXI-80-000214","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000214' do\n  title 'The ESXi host must configure the firewall to block network traffic by default.'\n  desc  'In addition to service-specific firewall rules, ESXi has a default firewall rule policy to allow or deny incoming and outgoing traffic. Reduce the risk of attack by ensuring this is set to deny incoming and outgoing traffic.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli network firewall get\n\n    If the \\\"Default Action\\\" does not equal \\\"DROP\\\", this is a finding.\n    If \\\"Enabled\\\" does not equal \\\"true\\\", this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHostFirewallDefaultPolicy\n\n    If the Incoming or Outgoing policies are \\\"True\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli network firewall set --default-action=false\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHostFirewallDefaultPolicy | Set-VMHostFirewallDefaultPolicy -AllowIncoming $false -AllowOutgoing $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000214'\n  tag rid: 'SV-ESXI-80-000214'\n  tag stig_id: 'ESXI-80-000214'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostFirewallDefaultPolicy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000214.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000215","title":"The ESXi host must enable Bridge Protocol Data Units (BPDU) filter on the host to prevent being locked out of physical switch ports with Portfast and BPDU Guard enabled.","desc":"BPDU Guard and Portfast are commonly enabled on the physical switch to which the ESXi host is directly connected to reduce the Spanning Tree Protocol (STP) convergence delay.\n\nIf a BPDU packet is sent from a virtual machine (VM) on the ESXi host to the physical switch configured as stated above, a cascading lockout of all the uplink interfaces from the ESXi host can occur. To prevent this type of lockout, BPDU Filter can be enabled on the ESXi host to drop any BPDU packets being sent to the physical switch.\n\nThe caveat is that certain Secure Socket Layer (SSL) virtual private networks that use Windows bridging capability can legitimately generate BPDU packets. The administrator should verify no legitimate BPDU packets are generated by VMs on the ESXi host prior to enabling BPDU Filter. If BPDU Filter is enabled in this situation, enabling Reject Forged Transmits on the virtual switch port group adds protection against Spanning Tree loops.","descriptions":[{"label":"default","data":"BPDU Guard and Portfast are commonly enabled on the physical switch to which the ESXi host is directly connected to reduce the Spanning Tree Protocol (STP) convergence delay.\n\nIf a BPDU packet is sent from a virtual machine (VM) on the ESXi host to the physical switch configured as stated above, a cascading lockout of all the uplink interfaces from the ESXi host can occur. To prevent this type of lockout, BPDU Filter can be enabled on the ESXi host to drop any BPDU packets being sent to the physical switch.\n\nThe caveat is that certain Secure Socket Layer (SSL) virtual private networks that use Windows bridging capability can legitimately generate BPDU packets. The administrator should verify no legitimate BPDU packets are generated by VMs on the ESXi host prior to enabling BPDU Filter. If BPDU Filter is enabled in this situation, enabling Reject Forged Transmits on the virtual switch port group adds protection against Spanning Tree loops."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Net.BlockGuestBPDU\" value and verify it is set to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU\n\nIf the \"Net.BlockGuestBPDU\" setting is not set to \"1\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Net.BlockGuestBPDU\" value and configure it to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Set-AdvancedSetting -Value 1"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000215","rid":"SV-ESXI-80-000215","stig_id":"ESXI-80-000215","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000215' do\n  title 'The ESXi host must enable Bridge Protocol Data Units (BPDU) filter on the host to prevent being locked out of physical switch ports with Portfast and BPDU Guard enabled.'\n  desc  \"\n    BPDU Guard and Portfast are commonly enabled on the physical switch to which the ESXi host is directly connected to reduce the Spanning Tree Protocol (STP) convergence delay.\n\n    If a BPDU packet is sent from a virtual machine (VM) on the ESXi host to the physical switch configured as stated above, a cascading lockout of all the uplink interfaces from the ESXi host can occur. To prevent this type of lockout, BPDU Filter can be enabled on the ESXi host to drop any BPDU packets being sent to the physical switch.\n\n    The caveat is that certain Secure Socket Layer (SSL) virtual private networks that use Windows bridging capability can legitimately generate BPDU packets. The administrator should verify no legitimate BPDU packets are generated by VMs on the ESXi host prior to enabling BPDU Filter. If BPDU Filter is enabled in this situation, enabling Reject Forged Transmits on the virtual switch port group adds protection against Spanning Tree loops.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Net.BlockGuestBPDU\\\" value and verify it is set to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU\n\n    If the \\\"Net.BlockGuestBPDU\\\" setting is not set to \\\"1\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Net.BlockGuestBPDU\\\" value and configure it to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Set-AdvancedSetting -Value 1\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000215'\n  tag rid: 'SV-ESXI-80-000215'\n  tag stig_id: 'ESXI-80-000215'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '1' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000215.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000216","title":"The ESXi host must configure virtual switch security policies to reject forged transmits.","desc":"If the virtual machine (VM) operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis means the virtual switch does not compare the source and effective MAC addresses.\n\nTo protect against MAC address impersonation, all virtual switches must have forged transmissions set to reject. Reject Forged Transmit can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.","descriptions":[{"label":"default","data":"If the virtual machine (VM) operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis means the virtual switch does not compare the source and effective MAC addresses.\n\nTo protect against MAC address impersonation, all virtual switches must have forged transmissions set to reject. Reject Forged Transmit can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level."},{"label":"rationale","data":""},{"label":"check","data":"Note: This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click the '...' button next to each port group and select \"Edit Settings\".\n\nClick the \"Security\" tab. Verify that \"Forged transmits\" is set to \"Reject\" and that \"Override\" is not checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy\nGet-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\nIf the \"Forged Transmits\" policy is set to \"Accept\" (or \"true\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click \"Edit\" and select Security.\n\nSet \"Forged transmits\" to \"Reject\". Click \"OK\".\n\nFor each port group, click the '...' button and select \"Edit Settings\" then Security.\n\nSet \"Forged transmits\" to \"Reject\" and uncheck the \"Override\" box. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmits $false\nGet-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmitsInherited $true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000216","rid":"SV-ESXI-80-000216","stig_id":"ESXI-80-000216","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000216' do\n  title 'The ESXi host must configure virtual switch security policies to reject forged transmits.'\n  desc  \"\n    If the virtual machine (VM) operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    This means the virtual switch does not compare the source and effective MAC addresses.\n\n    To protect against MAC address impersonation, all virtual switches must have forged transmissions set to reject. Reject Forged Transmit can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Note: This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click the '...' button next to each port group and select \\\"Edit Settings\\\".\n\n    Click the \\\"Security\\\" tab. Verify that \\\"Forged transmits\\\" is set to \\\"Reject\\\" and that \\\"Override\\\" is not checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\n    If the \\\"Forged Transmits\\\" policy is set to \\\"Accept\\\" (or \\\"true\\\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click \\\"Edit\\\" and select Security.\n\n    Set \\\"Forged transmits\\\" to \\\"Reject\\\". Click \\\"OK\\\".\n\n    For each port group, click the '...' button and select \\\"Edit Settings\\\" then Security.\n\n    Set \\\"Forged transmits\\\" to \\\"Reject\\\" and uncheck the \\\"Override\\\" box. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmits $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmitsInherited $true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000216'\n  tag rid: 'SV-ESXI-80-000216'\n  tag stig_id: 'ESXI-80-000216'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000216.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000217","title":"The ESXi host must configure virtual switch security policies to reject Media Access Control (MAC) address changes.","desc":"If the virtual machine (VM) operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent VMs from changing their effective MAC address, which will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing. \"Reject MAC Changes\" can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.","descriptions":[{"label":"default","data":"If the virtual machine (VM) operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent VMs from changing their effective MAC address, which will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing. \"Reject MAC Changes\" can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level."},{"label":"rationale","data":""},{"label":"check","data":"This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click the '...' button next to each port group and select \"Edit Settings\".\n\nClick the \"Security\" tab. Verify that \"MAC Address Changes\" is set to \"Reject\" and that \"Override\" is not checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy\nGet-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\nIf the \"MAC Address Changes\" policy is set to \"Accept\" (or \"true\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click \"Edit\" and select Security.\n\nSet \"MAC Address Changes\" to \"Reject\". Click \"OK\".\n\nFor each port group, click the '...' button and select \"Edit Settings\" then Security.\n\nSet \"MAC Address Changes\" to \"Reject\" and uncheck the \"Override\" box. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -MacChanges $false\nGet-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -MacChangesInherited $true"}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000217","rid":"SV-ESXI-80-000217","stig_id":"ESXI-80-000217","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000217' do\n  title 'The ESXi host must configure virtual switch security policies to reject Media Access Control (MAC) address changes.'\n  desc  \"\n    If the virtual machine (VM) operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    This will prevent VMs from changing their effective MAC address, which will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing. \\\"Reject MAC Changes\\\" can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click the '...' button next to each port group and select \\\"Edit Settings\\\".\n\n    Click the \\\"Security\\\" tab. Verify that \\\"MAC Address Changes\\\" is set to \\\"Reject\\\" and that \\\"Override\\\" is not checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\n    If the \\\"MAC Address Changes\\\" policy is set to \\\"Accept\\\" (or \\\"true\\\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click \\\"Edit\\\" and select Security.\n\n    Set \\\"MAC Address Changes\\\" to \\\"Reject\\\". Click \\\"OK\\\".\n\n    For each port group, click the '...' button and select \\\"Edit Settings\\\" then Security.\n\n    Set \\\"MAC Address Changes\\\" to \\\"Reject\\\" and uncheck the \\\"Override\\\" box. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -MacChanges $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -MacChangesInherited $true\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000217'\n  tag rid: 'SV-ESXI-80-000217'\n  tag stig_id: 'ESXI-80-000217'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000217.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000218","title":"The ESXi host must configure virtual switch security policies to reject promiscuous mode requests.","desc":"When promiscuous mode is enabled for a virtual switch, all virtual machines (VMs) connected to the Portgroup have the potential to read all packets across that network (only the virtual machines connected to that Portgroup).\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting. Promiscuous mode can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.","descriptions":[{"label":"default","data":"When promiscuous mode is enabled for a virtual switch, all virtual machines (VMs) connected to the Portgroup have the potential to read all packets across that network (only the virtual machines connected to that Portgroup).\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting. Promiscuous mode can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level."},{"label":"rationale","data":""},{"label":"check","data":"This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click the '...' button next to each port group and select \"Edit Settings\".\n\nClick the \"Security\" tab. Verify that \"Promiscuous Mode\" is set to \"Reject\" and that \"Override\" is not checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy\nGet-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\nIf the \"Promiscuous Mode\" policy is set to \"Accept\" (or \"true\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click \"Edit\" and select Security.\n\nSet \"Promiscuous Mode\" to \"Reject\". Click \"OK\".\n\nFor each port group, click the '...' button and select \"Edit Settings\" then Security.\n\nSet \"Promiscuous Mode\" to \"Reject\" and uncheck the \"Override\" box. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuous $false\nGet-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuousInherited $true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000218","rid":"SV-ESXI-80-000218","stig_id":"ESXI-80-000218","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000218' do\n  title 'The ESXi host must configure virtual switch security policies to reject promiscuous mode requests.'\n  desc  \"\n    When promiscuous mode is enabled for a virtual switch, all virtual machines (VMs) connected to the Portgroup have the potential to read all packets across that network (only the virtual machines connected to that Portgroup).\n\n    Promiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting. Promiscuous mode can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click the '...' button next to each port group and select \\\"Edit Settings\\\".\n\n    Click the \\\"Security\\\" tab. Verify that \\\"Promiscuous Mode\\\" is set to \\\"Reject\\\" and that \\\"Override\\\" is not checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\n    If the \\\"Promiscuous Mode\\\" policy is set to \\\"Accept\\\" (or \\\"true\\\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click \\\"Edit\\\" and select Security.\n\n    Set \\\"Promiscuous Mode\\\" to \\\"Reject\\\". Click \\\"OK\\\".\n\n    For each port group, click the '...' button and select \\\"Edit Settings\\\" then Security.\n\n    Set \\\"Promiscuous Mode\\\" to \\\"Reject\\\" and uncheck the \\\"Override\\\" box. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuous $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuousInherited $true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000218'\n  tag rid: 'SV-ESXI-80-000218'\n  tag stig_id: 'ESXI-80-000218'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000218.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000219","title":"The ESXi host must restrict use of the dvFilter network application programming interface (API).","desc":"If the organization is not using products that use the dvfilter network API, the host should not be configured to send network information to a virtual machine (VM).\n\nIf the API is enabled, an attacker might attempt to connect a virtual machine to it, potentially providing access to the network of other VMs on the host.\n\nIf using a product that makes use of this API, verify the host has been configured correctly. If not using such a product, ensure the setting is blank.","descriptions":[{"label":"default","data":"If the organization is not using products that use the dvfilter network API, the host should not be configured to send network information to a virtual machine (VM).\n\nIf the API is enabled, an attacker might attempt to connect a virtual machine to it, potentially providing access to the network of other VMs on the host.\n\nIf using a product that makes use of this API, verify the host has been configured correctly. If not using such a product, ensure the setting is blank."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Net.DVFilterBindIpAddress\" value and verify the value is blank or the correct IP address of a security appliance if in use.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress\n\nIf the \"Net.DVFilterBindIpAddress\" setting is not blank and security appliances are not in use on the host, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Net.DVFilterBindIpAddress\" value and remove any incorrect addresses.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Set-AdvancedSetting -Value \"\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000219","rid":"SV-ESXI-80-000219","stig_id":"ESXI-80-000219","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000219' do\n  title 'The ESXi host must restrict use of the dvFilter network application programming interface (API).'\n  desc  \"\n    If the organization is not using products that use the dvfilter network API, the host should not be configured to send network information to a virtual machine (VM).\n\n    If the API is enabled, an attacker might attempt to connect a virtual machine to it, potentially providing access to the network of other VMs on the host.\n\n    If using a product that makes use of this API, verify the host has been configured correctly. If not using such a product, ensure the setting is blank.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Net.DVFilterBindIpAddress\\\" value and verify the value is blank or the correct IP address of a security appliance if in use.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress\n\n    If the \\\"Net.DVFilterBindIpAddress\\\" setting is not blank and security appliances are not in use on the host, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Net.DVFilterBindIpAddress\\\" value and remove any incorrect addresses.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Set-AdvancedSetting -Value \\\"\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000219'\n  tag rid: 'SV-ESXI-80-000219'\n  tag stig_id: 'ESXI-80-000219'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000219.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000220","title":"The ESXi host must restrict the use of Virtual Guest Tagging (VGT) on standard switches.","desc":"When a port group is set to VLAN 4095, the vSwitch passes all network frames to the attached virtual machines (VMs) without modifying the VLAN tags. In vSphere, this is referred to as VGT. The VM must process the VLAN information itself via an 802.1Q driver in the operating system.\n\nVLAN 4095 must only be implemented if the attached VMs have been specifically authorized and are capable of managing VLAN tags themselves. If VLAN 4095 is enabled inappropriately, it may cause denial of service or allow a VM to interact with traffic on an unauthorized VLAN.","descriptions":[{"label":"default","data":"When a port group is set to VLAN 4095, the vSwitch passes all network frames to the attached virtual machines (VMs) without modifying the VLAN tags. In vSphere, this is referred to as VGT. The VM must process the VLAN information itself via an 802.1Q driver in the operating system.\n\nVLAN 4095 must only be implemented if the attached VMs have been specifically authorized and are capable of managing VLAN tags themselves. If VLAN 4095 is enabled inappropriately, it may cause denial of service or allow a VM to interact with traffic on an unauthorized VLAN."},{"label":"rationale","data":""},{"label":"check","data":"This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nFor each standard switch, review the \"VLAN ID\" on each port group and verify it is not set to \"4095\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VirtualPortGroup | Select Name, VLanID\n\nIf any port group is configured with VLAN 4095 and is not documented as a needed exception, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nFor each port group on a standard switch that is configured to a native VLAN, click the '...' button next to the port group.\n\nClick \"Edit Settings\". On the \"Properties\" tab, change the \"VLAN ID\" to an appropriate VLAN ID. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VirtualPortGroup -Name \"portgroup name\" | Set-VirtualPortGroup -VLanId \"New VLAN#\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000220","rid":"SV-ESXI-80-000220","stig_id":"ESXI-80-000220","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000220' do\n  title 'The ESXi host must restrict the use of Virtual Guest Tagging (VGT) on standard switches.'\n  desc  \"\n    When a port group is set to VLAN 4095, the vSwitch passes all network frames to the attached virtual machines (VMs) without modifying the VLAN tags. In vSphere, this is referred to as VGT. The VM must process the VLAN information itself via an 802.1Q driver in the operating system.\n\n    VLAN 4095 must only be implemented if the attached VMs have been specifically authorized and are capable of managing VLAN tags themselves. If VLAN 4095 is enabled inappropriately, it may cause denial of service or allow a VM to interact with traffic on an unauthorized VLAN.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    For each standard switch, review the \\\"VLAN ID\\\" on each port group and verify it is not set to \\\"4095\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VirtualPortGroup | Select Name, VLanID\n\n    If any port group is configured with VLAN 4095 and is not documented as a needed exception, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    For each port group on a standard switch that is configured to a native VLAN, click the '...' button next to the port group.\n\n    Click \\\"Edit Settings\\\". On the \\\"Properties\\\" tab, change the \\\"VLAN ID\\\" to an appropriate VLAN ID. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VirtualPortGroup -Name \\\"portgroup name\\\" | Set-VirtualPortGroup -VLanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000220'\n  tag rid: 'SV-ESXI-80-000220'\n  tag stig_id: 'ESXI-80-000220'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Select-Object -ExpandProperty VlanId\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match '4095' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000220.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000221","title":"The ESXi host must have all security patches and updates installed.","desc":"Installing software updates is a fundamental mitigation against the exploitation of publicly known vulnerabilities.","descriptions":[{"label":"default","data":"Installing software updates is a fundamental mitigation against the exploitation of publicly known vulnerabilities."},{"label":"rationale","data":""},{"label":"check","data":"Determine the current version and build:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Summary. Note the version string next to \"Hypervisor:\".\n\nor\n\nFrom a Secure Shell (SSH) session connected to the ESXi host, or from the ESXi shell, run the following command:\n\n# vmware -v\n\nIf the ESXi host does not have the latest patches, this is a finding.\n\nIf the ESXi host is not on a supported release, this is a finding.\n\nThe latest ESXi versions and their build numbers can be found here: https://kb.vmware.com/s/article/2143832\n\nVMware also publishes Advisories on security patches and offers a way to subscribe to email alerts for them.\n\nGo to: https://www.vmware.com/support/policies/security_response"},{"label":"fix","data":"ESXi can be patched in multiple ways, and this fix text does not cover all methods.\n\nManual patching when image profiles are not used:\n\n- Download the latest \"offline bundle\" .zip update from vmware.com. Verify the hash.\n\n- Transfer the file to a datastore accessible by the ESXi host, local or remote.\n\n- Put the ESXi host into maintenance mode.\n\n- From an ESXi shell, run the following command:\n\nesxcli software vib update -d <path to offline patch bundle.zip>\n\nManual patching when image profiles are used:\n\nFrom an ESXi shell, run the following command:\n\n# esxcli software sources profile list -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\nNote the available profiles. The organization will usually want the one ending in \"-standard\".\n\n# esxcli software profile update -p <selected profile> -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\nThere will be little output during the update. Once complete, reboot the host for changes to take effect."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000221","rid":"SV-ESXI-80-000221","stig_id":"ESXI-80-000221","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000221' do\n  title 'The ESXi host must have all security patches and updates installed.'\n  desc  'Installing software updates is a fundamental mitigation against the exploitation of publicly known vulnerabilities.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Determine the current version and build:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Summary. Note the version string next to \\\"Hypervisor:\\\".\n\n    or\n\n    From a Secure Shell (SSH) session connected to the ESXi host, or from the ESXi shell, run the following command:\n\n    # vmware -v\n\n    If the ESXi host does not have the latest patches, this is a finding.\n\n    If the ESXi host is not on a supported release, this is a finding.\n\n    The latest ESXi versions and their build numbers can be found here: https://kb.vmware.com/s/article/2143832\n\n    VMware also publishes Advisories on security patches and offers a way to subscribe to email alerts for them.\n\n    Go to: https://www.vmware.com/support/policies/security_response\n  \"\n  desc 'fix', \"\n    ESXi can be patched in multiple ways, and this fix text does not cover all methods.\n\n    Manual patching when image profiles are not used:\n\n    - Download the latest \\\"offline bundle\\\" .zip update from vmware.com. Verify the hash.\n\n    - Transfer the file to a datastore accessible by the ESXi host, local or remote.\n\n    - Put the ESXi host into maintenance mode.\n\n    - From an ESXi shell, run the following command:\n\n    esxcli software vib update -d <path to offline patch bundle.zip>\n\n    Manual patching when image profiles are used:\n\n    From an ESXi shell, run the following command:\n\n    # esxcli software sources profile list -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\n    Note the available profiles. The organization will usually want the one ending in \\\"-standard\\\".\n\n    # esxcli software profile update -p <selected profile> -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\n    There will be little output during the update. Once complete, reboot the host for changes to take effect.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000221'\n  tag rid: 'SV-ESXI-80-000221'\n  tag stig_id: 'ESXI-80-000221'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"(Get-VMHost -Name #{vmhost}).ExtensionData.Config.Product.build\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp \"#{input('esxiBuildNumber')}\" }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000221.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000222","title":"The ESXi host must not suppress warnings that the local or remote shell sessions are enabled.","desc":"Warnings that local or remote shell sessions are enabled alert administrators to activity they may not be aware of and need to investigate.","descriptions":[{"label":"default","data":"Warnings that local or remote shell sessions are enabled alert administrators to activity they may not be aware of and need to investigate."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.SuppressShellWarning\" value and verify it is set to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning\n\nIf the \"UserVars.SuppressShellWarning\" setting is not set to \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.SuppressShellWarning\" value and configure it to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Set-AdvancedSetting -Value 0"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000222","rid":"SV-ESXI-80-000222","stig_id":"ESXI-80-000222","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000222' do\n  title 'The ESXi host must not suppress warnings that the local or remote shell sessions are enabled.'\n  desc  'Warnings that local or remote shell sessions are enabled alert administrators to activity they may not be aware of and need to investigate.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.SuppressShellWarning\\\" value and verify it is set to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning\n\n    If the \\\"UserVars.SuppressShellWarning\\\" setting is not set to \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.SuppressShellWarning\\\" value and configure it to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Set-AdvancedSetting -Value 0\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000222'\n  tag rid: 'SV-ESXI-80-000222'\n  tag stig_id: 'ESXI-80-000222'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '0' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000222.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000223","title":"The ESXi host must not suppress warnings about unmitigated hyperthreading vulnerabilities.","desc":"The L1 Terminal Fault (L1TF) CPU vulnerabilities published in 2018 have patches and mitigations available in vSphere. However, there are performance impacts to these mitigations that require careful thought and planning from the system administrator before implementation. Until a mitigation is implemented, the UI warning about the lack of a mitigation must not be dismissed so the system administrator does not assume the vulnerability has been addressed.","descriptions":[{"label":"default","data":"The L1 Terminal Fault (L1TF) CPU vulnerabilities published in 2018 have patches and mitigations available in vSphere. However, there are performance impacts to these mitigations that require careful thought and planning from the system administrator before implementation. Until a mitigation is implemented, the UI warning about the lack of a mitigation must not be dismissed so the system administrator does not assume the vulnerability has been addressed."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.SuppressHyperthreadWarning\" value and verify it is set to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning\n\nIf the \"UserVars.SuppressHyperthreadWarning\" setting is not set to \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.SuppressHyperthreadWarning\" value and configure it to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Set-AdvancedSetting -Value 0"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000223","rid":"SV-ESXI-80-000223","stig_id":"ESXI-80-000223","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000223' do\n  title 'The ESXi host must not suppress warnings about unmitigated hyperthreading vulnerabilities.'\n  desc  'The L1 Terminal Fault (L1TF) CPU vulnerabilities published in 2018 have patches and mitigations available in vSphere. However, there are performance impacts to these mitigations that require careful thought and planning from the system administrator before implementation. Until a mitigation is implemented, the UI warning about the lack of a mitigation must not be dismissed so the system administrator does not assume the vulnerability has been addressed.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.SuppressHyperthreadWarning\\\" value and verify it is set to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning\n\n    If the \\\"UserVars.SuppressHyperthreadWarning\\\" setting is not set to \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.SuppressHyperthreadWarning\\\" value and configure it to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Set-AdvancedSetting -Value 0\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000223'\n  tag rid: 'SV-ESXI-80-000223'\n  tag stig_id: 'ESXI-80-000223'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '0' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000223.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000224","title":"The ESXi host must verify certificates for SSL syslog endpoints.","desc":"When sending syslog data to a remote host, ESXi can be configured to use any combination of TCP, UDP and SSL transports. When using SSL, the server certificate must be validated to ensure that the host is connecting to a valid syslog server.","descriptions":[{"label":"default","data":"When sending syslog data to a remote host, ESXi can be configured to use any combination of TCP, UDP and SSL transports. When using SSL, the server certificate must be validated to ensure that the host is connecting to a valid syslog server."},{"label":"rationale","data":""},{"label":"check","data":"If SSL is not used for a syslog target, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logCheckSSLCerts\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts\n\nIf the \"Syslog.global.logCheckSSLCerts\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"To configure SSL syslog endpoint certificate checking it must be turned on and also the trusted certificate chain must be added to ESXi's trusted store.\n\nFrom the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logCheckSSLCerts\" value and configure it to \"true\".\n\nCopy the PEM formatted trusted CA certificate so that is accessible to the host and append the contents to /etc/vmware/ssl/castore.pem by running the follow command:\n\n# <path/to/cacert> >> /etc/vmware/ssl/castore.pem\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts | Set-AdvancedSetting -Value \"true\"\n\nCopy the PEM formatted trusted CA certificate so that is accessible to the host.\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.security.certificatestore.add.CreateArgs()\n$arguments.filename = <path/to/cacert>\n$esxcli.system.security.certificatestore.add.Invoke($arguments)"}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000224","rid":"SV-ESXI-80-000224","stig_id":"ESXI-80-000224","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000224' do\n  title 'The ESXi host must verify certificates for SSL syslog endpoints.'\n  desc  'When sending syslog data to a remote host, ESXi can be configured to use any combination of TCP, UDP and SSL transports. When using SSL, the server certificate must be validated to ensure that the host is connecting to a valid syslog server.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If SSL is not used for a syslog target, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logCheckSSLCerts\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts\n\n    If the \\\"Syslog.global.logCheckSSLCerts\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    To configure SSL syslog endpoint certificate checking it must be turned on and also the trusted certificate chain must be added to ESXi's trusted store.\n\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logCheckSSLCerts\\\" value and configure it to \\\"true\\\".\n\n    Copy the PEM formatted trusted CA certificate so that is accessible to the host and append the contents to /etc/vmware/ssl/castore.pem by running the follow command:\n\n    # <path/to/cacert> >> /etc/vmware/ssl/castore.pem\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts | Set-AdvancedSetting -Value \\\"true\\\"\n\n    Copy the PEM formatted trusted CA certificate so that is accessible to the host.\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.security.certificatestore.add.CreateArgs()\n    $arguments.filename = <path/to/cacert>\n    $esxcli.system.security.certificatestore.add.Invoke($arguments)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000224'\n  tag rid: 'SV-ESXI-80-000224'\n  tag stig_id: 'ESXI-80-000224'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logHost | Where {$_.Value -match \\\"ssl\\\"} | Select-Object -ExpandProperty Value\"\n      syslogservers = powercli_command(command).stdout\n\n      if !syslogservers.empty?\n        command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts | Select-Object -ExpandProperty Value\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp 'true' }\n        end\n      else\n        impact 0.0\n        describe '' do\n          skip 'No SSL syslog targets found, this check is not applicable.'\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000224.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000225","title":"The ESXi host must enable volatile key destruction.","desc":"By default, pages allocated for virtual machines (VMs), userspace applications, and kernel threads are zeroed out at allocation time. ESXi will always ensure that no nonzero pages are exposed to VMs or userspace applications. While this prevents exposing cryptographic keys from VMs or userworlds to other clients, these keys can stay present in host memory for a long time if the memory is not reused.\n\nThe NIAP Virtualization Protection Profile and Server Virtualization Extended Package require that memory that may contain cryptographic keys be zeroed upon process exit.\n\nTo this end, a new configuration option, MemEagerZero, can be configured to enforce zeroing out userworld and guest memory pages when a userworld process or guest exits. For kernel threads, memory spaces holding keys are zeroed out as soon as the secret is no longer needed.","descriptions":[{"label":"default","data":"By default, pages allocated for virtual machines (VMs), userspace applications, and kernel threads are zeroed out at allocation time. ESXi will always ensure that no nonzero pages are exposed to VMs or userspace applications. While this prevents exposing cryptographic keys from VMs or userworlds to other clients, these keys can stay present in host memory for a long time if the memory is not reused.\n\nThe NIAP Virtualization Protection Profile and Server Virtualization Extended Package require that memory that may contain cryptographic keys be zeroed upon process exit.\n\nTo this end, a new configuration option, MemEagerZero, can be configured to enforce zeroing out userworld and guest memory pages when a userworld process or guest exits. For kernel threads, memory spaces holding keys are zeroed out as soon as the secret is no longer needed."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Mem.MemEagerZero\" value and verify it is set to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero\n\nIf the \"Mem.MemEagerZero\" setting is not set to \"1\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Mem.MemEagerZero\" value and configure it to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero | Set-AdvancedSetting -Value 1"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000225","rid":"SV-ESXI-80-000225","stig_id":"ESXI-80-000225","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000225' do\n  title 'The ESXi host must enable volatile key destruction.'\n  desc  \"\n    By default, pages allocated for virtual machines (VMs), userspace applications, and kernel threads are zeroed out at allocation time. ESXi will always ensure that no nonzero pages are exposed to VMs or userspace applications. While this prevents exposing cryptographic keys from VMs or userworlds to other clients, these keys can stay present in host memory for a long time if the memory is not reused.\n\n    The NIAP Virtualization Protection Profile and Server Virtualization Extended Package require that memory that may contain cryptographic keys be zeroed upon process exit.\n\n    To this end, a new configuration option, MemEagerZero, can be configured to enforce zeroing out userworld and guest memory pages when a userworld process or guest exits. For kernel threads, memory spaces holding keys are zeroed out as soon as the secret is no longer needed.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Mem.MemEagerZero\\\" value and verify it is set to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero\n\n    If the \\\"Mem.MemEagerZero\\\" setting is not set to \\\"1\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Mem.MemEagerZero\\\" value and configure it to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero | Set-AdvancedSetting -Value 1\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000225'\n  tag rid: 'SV-ESXI-80-000225'\n  tag stig_id: 'ESXI-80-000225'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Mem.MemEagerZero | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '1' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000225.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000226","title":"The ESXi host must configure a session timeout for the vSphere API.","desc":"The vSphere API (VIM) allows for remote, programmatic administration of the ESXi host. Authenticated API sessions are no different from a risk perspective than authenticated UI sessions and they need similar protections.\n\nOne of these protections is a basic inactivity timeout, after which the session will be invalidated and reauthentication will be required by the application accessing the API. This is set to 30 seconds by default but can be disabled, thus leaving API sessions open indefinitely. The 30 second default must be verified and maintained.","descriptions":[{"label":"default","data":"The vSphere API (VIM) allows for remote, programmatic administration of the ESXi host. Authenticated API sessions are no different from a risk perspective than authenticated UI sessions and they need similar protections.\n\nOne of these protections is a basic inactivity timeout, after which the session will be invalidated and reauthentication will be required by the application accessing the API. This is set to 30 seconds by default but can be disabled, thus leaving API sessions open indefinitely. The 30 second default must be verified and maintained."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.vmacore.soap.sessionTimeout\" value and verify it is set to \"30\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout\n\nIf the \"Config.HostAgent.vmacore.soap.sessionTimeout\" setting is not set to \"30\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.vmacore.soap.sessionTimeout\" value and configure it to \"30\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Set-AdvancedSetting -Value 30"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000226","rid":"SV-ESXI-80-000226","stig_id":"ESXI-80-000226","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000226' do\n  title 'The ESXi host must configure a session timeout for the vSphere API.'\n  desc  \"\n    The vSphere API (VIM) allows for remote, programmatic administration of the ESXi host. Authenticated API sessions are no different from a risk perspective than authenticated UI sessions and they need similar protections.\n\n    One of these protections is a basic inactivity timeout, after which the session will be invalidated and reauthentication will be required by the application accessing the API. This is set to 30 seconds by default but can be disabled, thus leaving API sessions open indefinitely. The 30 second default must be verified and maintained.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.vmacore.soap.sessionTimeout\\\" value and verify it is set to \\\"30\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout\n\n    If the \\\"Config.HostAgent.vmacore.soap.sessionTimeout\\\" setting is not set to \\\"30\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.vmacore.soap.sessionTimeout\\\" value and configure it to \\\"30\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Set-AdvancedSetting -Value 30\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000226'\n  tag rid: 'SV-ESXI-80-000226'\n  tag stig_id: 'ESXI-80-000226'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '30' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000226.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000227","title":"The ESXi host must be configured with an appropriate maximum password age.","desc":"The older an ESXi local account password is, the larger the opportunity window is for attackers to guess, crack or re-use a previously cracked password. Rotating passwords on a regular basis is a fundamental security practice and one that ESXi supports.","descriptions":[{"label":"default","data":"The older an ESXi local account password is, the larger the opportunity window is for attackers to guess, crack or re-use a previously cracked password. Rotating passwords on a regular basis is a fundamental security practice and one that ESXi supports."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.PasswordMaxDays\" value and verify it is set to \"90\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays\n\nIf the \"Security.PasswordMaxDays\" setting is not set to \"90\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.PasswordMaxDays\" value and configure it to \"90\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays | Set-AdvancedSetting -Value 90"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000227","rid":"SV-ESXI-80-000227","stig_id":"ESXI-80-000227","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000227' do\n  title 'The ESXi host must be configured with an appropriate maximum password age.'\n  desc  'The older an ESXi local account password is, the larger the opportunity window is for attackers to guess, crack or re-use a previously cracked password. Rotating passwords on a regular basis is a fundamental security practice and one that ESXi supports.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.PasswordMaxDays\\\" value and verify it is set to \\\"90\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays\n\n    If the \\\"Security.PasswordMaxDays\\\" setting is not set to \\\"90\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.PasswordMaxDays\\\" value and configure it to \\\"90\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays | Set-AdvancedSetting -Value 90\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000227'\n  tag rid: 'SV-ESXI-80-000227'\n  tag stig_id: 'ESXI-80-000227'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.PasswordMaxDays | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '90' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000227.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000228","title":"The ESXi Common Information Model (CIM) service must be disabled.","desc":"The CIM system provides an interface that enables hardware-level management from remote applications via a set of standard application programming interfaces (APIs). These APIs are consumed by external applications such as HP SIM or Dell OpenManage for agentless, remote hardware monitoring of the ESXi host.\n\nTo reduce attack surface area and following the minimum functionality principal, the CIM service must be disabled unless explicitly needed and approved.","descriptions":[{"label":"default","data":"The CIM system provides an interface that enables hardware-level management from remote applications via a set of standard application programming interfaces (APIs). These APIs are consumed by external applications such as HP SIM or Dell OpenManage for agentless, remote hardware monitoring of the ESXi host.\n\nTo reduce attack surface area and following the minimum functionality principal, the CIM service must be disabled unless explicitly needed and approved."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", locate the \"CIM Server\" service and verify it is \"Stopped\" and the \"Startup Policy\" is set to \"Start and stop manually\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"CIM Server\"}\n\nIf the \"CIM Server\" service does not have a \"Policy\" of \"off\" or is running, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\" select the \"CIM Server\" service and click the \"Stop\" button.\n\nClick \"Edit Startup policy...\" and select the \"Start and stop manually\" radio button. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"CIM Server\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"CIM Server\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000228","rid":"SV-ESXI-80-000228","stig_id":"ESXI-80-000228","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000228' do\n  title 'The ESXi Common Information Model (CIM) service must be disabled.'\n  desc  \"\n    The CIM system provides an interface that enables hardware-level management from remote applications via a set of standard application programming interfaces (APIs). These APIs are consumed by external applications such as HP SIM or Dell OpenManage for agentless, remote hardware monitoring of the ESXi host.\n\n    To reduce attack surface area and following the minimum functionality principal, the CIM service must be disabled unless explicitly needed and approved.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", locate the \\\"CIM Server\\\" service and verify it is \\\"Stopped\\\" and the \\\"Startup Policy\\\" is set to \\\"Start and stop manually\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"CIM Server\\\"}\n\n    If the \\\"CIM Server\\\" service does not have a \\\"Policy\\\" of \\\"off\\\" or is running, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\" select the \\\"CIM Server\\\" service and click the \\\"Stop\\\" button.\n\n    Click \\\"Edit Startup policy...\\\" and select the \\\"Start and stop manually\\\" radio button. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"CIM Server\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"CIM Server\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000228'\n  tag rid: 'SV-ESXI-80-000228'\n  tag stig_id: 'ESXI-80-000228'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000228.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000229","title":"The ESXi host must use DOD-approved certificates.","desc":"The default self-signed host certificate issued by the VMware Certificate Authority (VMCA) must be replaced with a DOD-approved certificate when the host will be accessed directly, such as during a virtual machine (VM) console connection.\n\nThe use of a DOD certificate on the host assures clients the service they are connecting to is legitimate and properly secured.","descriptions":[{"label":"default","data":"The default self-signed host certificate issued by the VMware Certificate Authority (VMCA) must be replaced with a DOD-approved certificate when the host will be accessed directly, such as during a virtual machine (VM) console connection.\n\nThe use of a DOD certificate on the host assures clients the service they are connecting to is legitimate and properly secured."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Certificate.\n\nIf the issuer is not a DOD-approved certificate authority, this is a finding.\n\nIf the host will never be accessed directly (virtual machine console connections bypass vCenter), this is not a finding."},{"label":"fix","data":"Join the ESXi host to vCenter before replacing the certificate.\n\nObtain a DOD-issued certificate and private key for the host following the requirements below:\n\nKey size: 2048 bits or more (PEM encoded)\n\nKey format: PEM\nVMware supports PKCS8 and PKCS1 (RSA keys)\nx509 version 3\n\nSubjectAltName must contain DNS Name=<machine_FQDN>\n\nCRT (Base-64) format\n\nContains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\nStart time of one day before the current time\n\nCN (and SubjectAltName) set to the host name (or IP address) that the ESXi host has in the vCenter Server inventory\n\nFrom the vSphere Web Client, select the ESXi host's vCenter Server >> Configure >> System >> Advanced Settings.\n\nSelect the \"vpxd.certmgmt.mode\" value and ensure it is set to \"custom\".\n\nPut the host into maintenance mode.\n\nTemporarily enable Secure Shell (SSH) on the host. Use Secure Copy Protocol (SCP) to transfer the new certificate and key to /tmp. SSH to the host. Back up the existing certificate and key:\n\n# mv /etc/vmware/ssl/rui.crt /etc/vmware/ssl/rui.crt.bak\n# mv /etc/vmware/ssl/rui.key /etc/vmware/ssl/rui.key.bak\n\nCopy the new certificate and key to \"/etc/vmware/ssl/\" and rename them to \"rui.crt\" and \"rui.key\" respectively.\n\nRestart management agents to implement the new certificate:\n\n# services.sh restart"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000229","rid":"SV-ESXI-80-000229","stig_id":"ESXI-80-000229","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000229' do\n  title 'The ESXi host must use DOD-approved certificates.'\n  desc  \"\n    The default self-signed host certificate issued by the VMware Certificate Authority (VMCA) must be replaced with a DOD-approved certificate when the host will be accessed directly, such as during a virtual machine (VM) console connection.\n\n    The use of a DOD certificate on the host assures clients the service they are connecting to is legitimate and properly secured.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Certificate.\n\n    If the issuer is not a DOD-approved certificate authority, this is a finding.\n\n    If the host will never be accessed directly (virtual machine console connections bypass vCenter), this is not a finding.\n  \"\n  desc 'fix', \"\n    Join the ESXi host to vCenter before replacing the certificate.\n\n    Obtain a DOD-issued certificate and private key for the host following the requirements below:\n\n    Key size: 2048 bits or more (PEM encoded)\n\n    Key format: PEM\n    VMware supports PKCS8 and PKCS1 (RSA keys)\n    x509 version 3\n\n    SubjectAltName must contain DNS Name=<machine_FQDN>\n\n    CRT (Base-64) format\n\n    Contains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\n    Start time of one day before the current time\n\n    CN (and SubjectAltName) set to the host name (or IP address) that the ESXi host has in the vCenter Server inventory\n\n    From the vSphere Web Client, select the ESXi host's vCenter Server >> Configure >> System >> Advanced Settings.\n\n    Select the \\\"vpxd.certmgmt.mode\\\" value and ensure it is set to \\\"custom\\\".\n\n    Put the host into maintenance mode.\n\n    Temporarily enable Secure Shell (SSH) on the host. Use Secure Copy Protocol (SCP) to transfer the new certificate and key to /tmp. SSH to the host. Back up the existing certificate and key:\n\n    # mv /etc/vmware/ssl/rui.crt /etc/vmware/ssl/rui.crt.bak\n    # mv /etc/vmware/ssl/rui.key /etc/vmware/ssl/rui.key.bak\n\n    Copy the new certificate and key to \\\"/etc/vmware/ssl/\\\" and rename them to \\\"rui.crt\\\" and \\\"rui.key\\\" respectively.\n\n    Restart management agents to implement the new certificate:\n\n    # services.sh restart\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000229'\n  tag rid: 'SV-ESXI-80-000229'\n  tag stig_id: 'ESXI-80-000229'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      describe ssl_certificate(host: \"#{vmhost}\", port: 443) do\n        its('issuer_organization') { should cmp 'U.S. Government' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000229.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000230","title":"The ESXi host Secure Shell (SSH) daemon must disable port forwarding.","desc":"While enabling Transmission Control Protocol (TCP) tunnels is a valuable function of sshd, this feature is not appropriate for use on the ESXi hypervisor.","descriptions":[{"label":"default","data":"While enabling Transmission Control Protocol (TCP) tunnels is a valuable function of sshd, this feature is not appropriate for use on the ESXi hypervisor."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep allowtcpforwarding\n\nExpected result:\n\nallowtcpforwarding no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nAllowTcpForwarding no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000230","rid":"SV-ESXI-80-000230","stig_id":"ESXI-80-000230","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000230' do\n  title 'The ESXi host Secure Shell (SSH) daemon must disable port forwarding.'\n  desc  'While enabling Transmission Control Protocol (TCP) tunnels is a valuable function of sshd, this feature is not appropriate for use on the ESXi hypervisor.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep allowtcpforwarding\n\n    Expected result:\n\n    allowtcpforwarding no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    AllowTcpForwarding no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000230'\n  tag rid: 'SV-ESXI-80-000230'\n  tag stig_id: 'ESXI-80-000230'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000230.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000231","title":"The ESXi host OpenSLP service must be disabled.","desc":"OpenSLP implements the Service Location Protocol to help CIM clients discover CIM servers over TCP 427. This service is not widely needed and has had vulnerabilities exposed in the past. To reduce attack surface area and following the minimum functionality principal, the OpenSLP service must be disabled unless explicitly needed and approved.\n\nNote: Disabling the OpenSLP service may affect monitoring and third-party systems that use the WBEM DTMF protocols.","descriptions":[{"label":"default","data":"OpenSLP implements the Service Location Protocol to help CIM clients discover CIM servers over TCP 427. This service is not widely needed and has had vulnerabilities exposed in the past. To reduce attack surface area and following the minimum functionality principal, the OpenSLP service must be disabled unless explicitly needed and approved.\n\nNote: Disabling the OpenSLP service may affect monitoring and third-party systems that use the WBEM DTMF protocols."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", locate the \"slpd\" service and verify it is \"Stopped\" and the \"Startup Policy\" is set to \"Start and stop manually\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"slpd\"}\n\nIf the slpd service does not have a \"Policy\" of \"off\" or is running, this is a finding."},{"label":"fix","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\" select the \"slpd\" service and click the \"Stop\" button.\n\nClick \"Edit Startup policy...\" and select the \"Start and stop manually\" radio button. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"slpd\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"slpd\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000231","rid":"SV-ESXI-80-000231","stig_id":"ESXI-80-000231","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000231' do\n  title 'The ESXi host OpenSLP service must be disabled.'\n  desc  \"\n    OpenSLP implements the Service Location Protocol to help CIM clients discover CIM servers over TCP 427. This service is not widely needed and has had vulnerabilities exposed in the past. To reduce attack surface area and following the minimum functionality principal, the OpenSLP service must be disabled unless explicitly needed and approved.\n\n    Note: Disabling the OpenSLP service may affect monitoring and third-party systems that use the WBEM DTMF protocols.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", locate the \\\"slpd\\\" service and verify it is \\\"Stopped\\\" and the \\\"Startup Policy\\\" is set to \\\"Start and stop manually\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"slpd\\\"}\n\n    If the slpd service does not have a \\\"Policy\\\" of \\\"off\\\" or is running, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\" select the \\\"slpd\\\" service and click the \\\"Stop\\\" button.\n\n    Click \\\"Edit Startup policy...\\\" and select the \\\"Start and stop manually\\\" radio button. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"slpd\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"slpd\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000231'\n  tag rid: 'SV-ESXI-80-000231'\n  tag stig_id: 'ESXI-80-000231'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000231.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000232","title":"The ESXi host must enable audit logging.","desc":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell.","descriptions":[{"label":"default","data":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.auditRecord.storageEnable\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable\n\nIf the \"Syslog.global.auditRecord.storageEnable\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.auditRecord.storageEnable\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Set-AdvancedSetting -Value \"true\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000232","rid":"SV-ESXI-80-000232","stig_id":"ESXI-80-000232","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000232' do\n  title 'The ESXi host must enable audit logging.'\n  desc  \"\n    ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\n    To operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\n    Note: Audit records can be viewed locally via the \\\"/bin/viewAudit\\\" utility over SSH or at the ESXi shell.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.auditRecord.storageEnable\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable\n\n    If the \\\"Syslog.global.auditRecord.storageEnable\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.auditRecord.storageEnable\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Set-AdvancedSetting -Value \\\"true\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000232'\n  tag rid: 'SV-ESXI-80-000232'\n  tag stig_id: 'ESXI-80-000232'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000232.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000233","title":"The ESXi host must off-load audit records via syslog.","desc":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell.","descriptions":[{"label":"default","data":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.auditRecord.remoteEnable\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable\n\nIf the \"Syslog.global.auditRecord.remoteEnable\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.auditRecord.remoteEnable\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Set-AdvancedSetting -Value \"true\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000342-VMM-001230","gid":"V-ESXI-80-000233","rid":"SV-ESXI-80-000233","stig_id":"ESXI-80-000233","cci":["CCI-001851"],"nist":["AU-4 (1)"]},"code":"control 'ESXI-80-000233' do\n  title 'The ESXi host must off-load audit records via syslog.'\n  desc  \"\n    ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\n    To operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\n    Note: Audit records can be viewed locally via the \\\"/bin/viewAudit\\\" utility over SSH or at the ESXi shell.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.auditRecord.remoteEnable\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable\n\n    If the \\\"Syslog.global.auditRecord.remoteEnable\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.auditRecord.remoteEnable\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Set-AdvancedSetting -Value \\\"true\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000342-VMM-001230'\n  tag gid: 'V-ESXI-80-000233'\n  tag rid: 'SV-ESXI-80-000233'\n  tag stig_id: 'ESXI-80-000233'\n  tag cci: ['CCI-001851']\n  tag nist: ['AU-4 (1)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000233.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000234","title":"The ESXi host must enable strict x509 verification for SSL syslog endpoints.","desc":"When sending syslog data to a remote host via SSL, the ESXi host is presented with the endpoint's SSL server certificate. In addition to trust verification, configured elsewhere, this \"x509-strict\" option performs additional validity checks on CA root certificates during verification.\n\nThese checks are generally not performed (CA roots are inherently trusted) and might cause incompatibilities with existing, misconfigured CA roots. The NIAP requirements in the Virtualization Protection Profile and Server Virtualization Extended Package, however, require even CA roots to pass validations.","descriptions":[{"label":"default","data":"When sending syslog data to a remote host via SSL, the ESXi host is presented with the endpoint's SSL server certificate. In addition to trust verification, configured elsewhere, this \"x509-strict\" option performs additional validity checks on CA root certificates during verification.\n\nThese checks are generally not performed (CA roots are inherently trusted) and might cause incompatibilities with existing, misconfigured CA roots. The NIAP requirements in the Virtualization Protection Profile and Server Virtualization Extended Package, however, require even CA roots to pass validations."},{"label":"rationale","data":""},{"label":"check","data":"If SSL is not used for a syslog target, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.certificate.strictX509Compliance\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance\n\nIf the \"Syslog.global.certificate.strictX509Compliance\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.certificate.strictX509Compliance\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Set-AdvancedSetting -Value \"true\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000234","rid":"SV-ESXI-80-000234","stig_id":"ESXI-80-000234","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000234' do\n  title 'The ESXi host must enable strict x509 verification for SSL syslog endpoints.'\n  desc  \"\n    When sending syslog data to a remote host via SSL, the ESXi host is presented with the endpoint's SSL server certificate. In addition to trust verification, configured elsewhere, this \\\"x509-strict\\\" option performs additional validity checks on CA root certificates during verification.\n\n    These checks are generally not performed (CA roots are inherently trusted) and might cause incompatibilities with existing, misconfigured CA roots. The NIAP requirements in the Virtualization Protection Profile and Server Virtualization Extended Package, however, require even CA roots to pass validations.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If SSL is not used for a syslog target, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.certificate.strictX509Compliance\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance\n\n    If the \\\"Syslog.global.certificate.strictX509Compliance\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.certificate.strictX509Compliance\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Set-AdvancedSetting -Value \\\"true\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000234'\n  tag rid: 'SV-ESXI-80-000234'\n  tag stig_id: 'ESXI-80-000234'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000234.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000235","title":"The ESXi host must forward audit records containing information to establish what type of events occurred.","desc":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.\n\nAudit record content that may be necessary to satisfy this requirement includes, for example, time stamps, source and destination addresses, user/process/VM identifiers, event descriptions, success/fail indications, filenames involved, and access control or flow control rules invoked.\n\nAssociating event types with detected events in the ESXi audit logs provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured host.","descriptions":[{"label":"default","data":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.\n\nAudit record content that may be necessary to satisfy this requirement includes, for example, time stamps, source and destination addresses, user/process/VM identifiers, event descriptions, success/fail indications, filenames involved, and access control or flow control rules invoked.\n\nAssociating event types with detected events in the ESXi audit logs provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured host."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logLevel\" value and verify it is set to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel\n\nIf the \"Syslog.global.logLevel\" setting is not set to \"info\", this is a finding.\n\nNote: Verbose logging level is acceptable for troubleshooting purposes."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logLevel\" value and configure it to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel | Set-AdvancedSetting -Value \"info\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000037-VMM-000150","gid":"V-ESXI-80-000235","rid":"SV-ESXI-80-000235","stig_id":"ESXI-80-000235","cci":["CCI-000130"],"nist":["AU-3"]},"code":"control 'ESXI-80-000235' do\n  title 'The ESXi host must forward audit records containing information to establish what type of events occurred.'\n  desc  \"\n    Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.\n\n    Audit record content that may be necessary to satisfy this requirement includes, for example, time stamps, source and destination addresses, user/process/VM identifiers, event descriptions, success/fail indications, filenames involved, and access control or flow control rules invoked.\n\n    Associating event types with detected events in the ESXi audit logs provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured host.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logLevel\\\" value and verify it is set to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel\n\n    If the \\\"Syslog.global.logLevel\\\" setting is not set to \\\"info\\\", this is a finding.\n\n    Note: Verbose logging level is acceptable for troubleshooting purposes.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logLevel\\\" value and configure it to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel | Set-AdvancedSetting -Value \\\"info\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000037-VMM-000150'\n  tag gid: 'V-ESXI-80-000235'\n  tag rid: 'SV-ESXI-80-000235'\n  tag stig_id: 'ESXI-80-000235'\n  tag cci: ['CCI-000130']\n  tag nist: ['AU-3']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logLevel | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'info' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000235.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000236","title":"The ESXi host must not be configured to override virtual machine (VM) configurations.","desc":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.","descriptions":[{"label":"default","data":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# stat -c \"%s\" /etc/vmware/settings\n\nExpected result:\n\n0\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# echo -n >/etc/vmware/settings"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000236","rid":"SV-ESXI-80-000236","stig_id":"ESXI-80-000236","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000236' do\n  title 'The ESXi host must not be configured to override virtual machine (VM) configurations.'\n  desc  \"\n    Each VM on an ESXi host runs in its own \\\"vmx\\\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\n    This can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # stat -c \\\"%s\\\" /etc/vmware/settings\n\n    Expected result:\n\n    0\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # echo -n >/etc/vmware/settings\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000236'\n  tag rid: 'SV-ESXI-80-000236'\n  tag stig_id: 'ESXI-80-000236'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000236.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000237","title":"The ESXi host must not be configured to override virtual machine (VM) logger settings.","desc":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.","descriptions":[{"label":"default","data":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# grep \"^vmx\\.log\" /etc/vmware/config\n\nIf the command produces any output, this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following commands:\n\n# cp /etc/vmware/config /etc/vmware/config.bak\n# grep -v \"^vmx\\.log\" /etc/vmware/config.bak>/etc/vmware/config"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000237","rid":"SV-ESXI-80-000237","stig_id":"ESXI-80-000237","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000237' do\n  title 'The ESXi host must not be configured to override virtual machine (VM) logger settings.'\n  desc  \"\n    Each VM on an ESXi host runs in its own \\\"vmx\\\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\n    This can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # grep \\\"^vmx\\\\.log\\\" /etc/vmware/config\n\n    If the command produces any output, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following commands:\n\n    # cp /etc/vmware/config /etc/vmware/config.bak\n    # grep -v \\\"^vmx\\\\.log\\\" /etc/vmware/config.bak>/etc/vmware/config\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000237'\n  tag rid: 'SV-ESXI-80-000237'\n  tag stig_id: 'ESXI-80-000237'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000237.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000238","title":"The ESXi host must require TPM-based configuration encryption.","desc":"An ESXi host's configuration consists of configuration files for each service that runs on the host. The configuration files typically reside in the /etc/ directory, but they can also reside in other namespaces. The configuration files contain run-time information about the state of the services. Over time, the default values in the configuration files might change, for example, when settings on the ESXi host are changed.\n\nA cron job backs up the ESXi configuration files periodically, when ESXi shuts down gracefully or on demand, and creates an archived configuration file in the boot bank. When ESXi reboots, it reads the archived configuration file and recreates the state that ESXi was in when the backup was taken.\n\nBefore vSphere 7.0 Update 2, the archived ESXi configuration file is not encrypted. In vSphere 7.0 Update 2 and later, the archived configuration file is encrypted. When the ESXi host is configured with a Trusted Platform Module (TPM), the TPM is used to \"seal\" the configuration to the host, providing a strong security guarantee and additional protection from offline attacks.\n\nConfiguration encryption uses the physical TPM when it is available and supported at install or upgrade time. If the TPM was added or enabled later, the ESXi host must be told to reconfigure to use the newly available TPM. Once the TPM configuration encryption is enabled, it cannot be disabled.","descriptions":[{"label":"default","data":"An ESXi host's configuration consists of configuration files for each service that runs on the host. The configuration files typically reside in the /etc/ directory, but they can also reside in other namespaces. The configuration files contain run-time information about the state of the services. Over time, the default values in the configuration files might change, for example, when settings on the ESXi host are changed.\n\nA cron job backs up the ESXi configuration files periodically, when ESXi shuts down gracefully or on demand, and creates an archived configuration file in the boot bank. When ESXi reboots, it reads the archived configuration file and recreates the state that ESXi was in when the backup was taken.\n\nBefore vSphere 7.0 Update 2, the archived ESXi configuration file is not encrypted. In vSphere 7.0 Update 2 and later, the archived configuration file is encrypted. When the ESXi host is configured with a Trusted Platform Module (TPM), the TPM is used to \"seal\" the configuration to the host, providing a strong security guarantee and additional protection from offline attacks.\n\nConfiguration encryption uses the physical TPM when it is available and supported at install or upgrade time. If the TPM was added or enabled later, the ESXi host must be told to reconfigure to use the newly available TPM. Once the TPM configuration encryption is enabled, it cannot be disabled."},{"label":"rationale","data":""},{"label":"check","data":"If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\nFrom an ESXi shell, run the following command:\n\n# esxcli system settings encryption get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.settings.encryption.get.invoke() | Select Mode\n\nExpected result:\n\nMode: TPM\n\nIf the \"Mode\" is not set to \"TPM\", this is a finding."},{"label":"fix","data":"Ensure the TPM 2.0 chip is enabled in the BIOS and the ESX UI does not show any errors about a present but unavailable TPM.\n\nThis setting cannot be configured until the TPM is properly enabled in firmware.\n\nFrom an ESXi shell, run the following command:\n\n# esxcli system settings encryption set --mode=TPM\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n$arguments.mode = \"TPM\"\n$esxcli.system.settings.encryption.set.Invoke($arguments)\n\nEvacuate the host and gracefully reboot for changes to take effect."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000238","rid":"SV-ESXI-80-000238","stig_id":"ESXI-80-000238","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000238' do\n  title 'The ESXi host must require TPM-based configuration encryption.'\n  desc  \"\n    An ESXi host's configuration consists of configuration files for each service that runs on the host. The configuration files typically reside in the /etc/ directory, but they can also reside in other namespaces. The configuration files contain run-time information about the state of the services. Over time, the default values in the configuration files might change, for example, when settings on the ESXi host are changed.\n\n    A cron job backs up the ESXi configuration files periodically, when ESXi shuts down gracefully or on demand, and creates an archived configuration file in the boot bank. When ESXi reboots, it reads the archived configuration file and recreates the state that ESXi was in when the backup was taken.\n\n    Before vSphere 7.0 Update 2, the archived ESXi configuration file is not encrypted. In vSphere 7.0 Update 2 and later, the archived configuration file is encrypted. When the ESXi host is configured with a Trusted Platform Module (TPM), the TPM is used to \\\"seal\\\" the configuration to the host, providing a strong security guarantee and additional protection from offline attacks.\n\n    Configuration encryption uses the physical TPM when it is available and supported at install or upgrade time. If the TPM was added or enabled later, the ESXi host must be told to reconfigure to use the newly available TPM. Once the TPM configuration encryption is enabled, it cannot be disabled.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\n    From an ESXi shell, run the following command:\n\n    # esxcli system settings encryption get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.settings.encryption.get.invoke() | Select Mode\n\n    Expected result:\n\n    Mode: TPM\n\n    If the \\\"Mode\\\" is not set to \\\"TPM\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Ensure the TPM 2.0 chip is enabled in the BIOS and the ESX UI does not show any errors about a present but unavailable TPM.\n\n    This setting cannot be configured until the TPM is properly enabled in firmware.\n\n    From an ESXi shell, run the following command:\n\n    # esxcli system settings encryption set --mode=TPM\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n    $arguments.mode = \\\"TPM\\\"\n    $esxcli.system.settings.encryption.set.Invoke($arguments)\n\n    Evacuate the host and gracefully reboot for changes to take effect.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000238'\n  tag rid: 'SV-ESXI-80-000238'\n  tag stig_id: 'ESXI-80-000238'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty Mode\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'TPM' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000238.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000239","title":"The ESXi host must configure the firewall to restrict access to services running on the host.","desc":"Unrestricted access to services running on an ESXi host can expose a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to only allow access from authorized networks.","descriptions":[{"label":"default","data":"Unrestricted access to services running on an ESXi host can expose a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to only allow access from authorized networks."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Firewall.\n\nUnder the \"Allowed IP addresses\" column, review the allowed IPs for each service.\n\nCheck this for \"Incoming\" and \"Outgoing\" sections.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostFirewallException | Where {$_.Enabled -eq $true} | Select Name,Enabled,@{N=\"AllIPEnabled\";E={$_.ExtensionData.AllowedHosts.AllIP}}\n\nIf for an enabled service \"Allow connections from any IP address\" is selected, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Firewall.\n\nClick \"Edit...\". For each enabled service, uncheck the check box to \"Allow connections from any IP address\" and input the site-specific network(s) required.\n\nThe following example formats are acceptable:\n\n192.168.0.0/24\n192.168.1.2, 2001::1/64\nfd3e:29a6:0a81:e478::/64\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n#This disables the allow all rule for the target service. We are targeting the sshServer service in this example.\n$arguments = $esxcli.network.firewall.ruleset.set.CreateArgs()\n$arguments.rulesetid = \"sshServer\"\n$arguments.allowedall = $false\n$esxcli.network.firewall.ruleset.set.Invoke($arguments)\n\n#Next add the allowed IPs for the service. Note doing the \"vSphere Web Client\" service this way may disable access but may be done through vCenter or through the console.\n$arguments = $esxcli.network.firewall.ruleset.allowedip.add.CreateArgs()\n$arguments.rulesetid = \"sshServer\"\n$arguments.ipaddress = \"10.0.0.0/8\"\n$esxcli.network.firewall.ruleset.allowedip.add.Invoke($arguments)\n\nThis must be done for each enabled service."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000239","rid":"SV-ESXI-80-000239","stig_id":"ESXI-80-000239","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000239' do\n  title 'The ESXi host must configure the firewall to restrict access to services running on the host.'\n  desc  'Unrestricted access to services running on an ESXi host can expose a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to only allow access from authorized networks.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Firewall.\n\n    Under the \\\"Allowed IP addresses\\\" column, review the allowed IPs for each service.\n\n    Check this for \\\"Incoming\\\" and \\\"Outgoing\\\" sections.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostFirewallException | Where {$_.Enabled -eq $true} | Select Name,Enabled,@{N=\\\"AllIPEnabled\\\";E={$_.ExtensionData.AllowedHosts.AllIP}}\n\n    If for an enabled service \\\"Allow connections from any IP address\\\" is selected, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Firewall.\n\n    Click \\\"Edit...\\\". For each enabled service, uncheck the check box to \\\"Allow connections from any IP address\\\" and input the site-specific network(s) required.\n\n    The following example formats are acceptable:\n\n    192.168.0.0/24\n    192.168.1.2, 2001::1/64\n    fd3e:29a6:0a81:e478::/64\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    #This disables the allow all rule for the target service. We are targeting the sshServer service in this example.\n    $arguments = $esxcli.network.firewall.ruleset.set.CreateArgs()\n    $arguments.rulesetid = \\\"sshServer\\\"\n    $arguments.allowedall = $false\n    $esxcli.network.firewall.ruleset.set.Invoke($arguments)\n\n    #Next add the allowed IPs for the service. Note doing the \\\"vSphere Web Client\\\" service this way may disable access but may be done through vCenter or through the console.\n    $arguments = $esxcli.network.firewall.ruleset.allowedip.add.CreateArgs()\n    $arguments.rulesetid = \\\"sshServer\\\"\n    $arguments.ipaddress = \\\"10.0.0.0/8\\\"\n    $esxcli.network.firewall.ruleset.allowedip.add.Invoke($arguments)\n\n    This must be done for each enabled service.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000239'\n  tag rid: 'SV-ESXI-80-000239'\n  tag stig_id: 'ESXI-80-000239'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"(Get-VMHost -Name #{vmhost} | Get-VMHostFirewallException | Where {$_.Enabled -eq $true}).ExtensionData.AllowedHosts.AllIP\"\n      powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |result|\n        describe result do\n          it { should_not cmp 'True' }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000239.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000240","title":"The ESXi host when using Host Profiles and/or Auto Deploy must use the vSphere Authentication Proxy to protect passwords when adding themselves to Active Directory.","desc":"If a host is configured to join an Active Directory domain using Host Profiles and/or Auto Deploy, the Active Directory credentials are saved in the profile and are transmitted over the network.\n\nTo avoid having to save Active Directory credentials in the Host Profile and to avoid transmitting Active Directory credentials over the network, use the vSphere Authentication Proxy.","descriptions":[{"label":"default","data":"If a host is configured to join an Active Directory domain using Host Profiles and/or Auto Deploy, the Active Directory credentials are saved in the profile and are transmitted over the network.\n\nTo avoid having to save Active Directory credentials in the Host Profile and to avoid transmitting Active Directory credentials over the network, use the vSphere Authentication Proxy."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nIf the organization is not using Host Profiles to join Active Directory, this is not applicable.\n\nFrom the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\nClick a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration >> Join Domain Method.\n\nIf the method used to join hosts to a domain is not set to \"Use vSphere Authentication Proxy to add the host to domain\", this is a finding.\n\nor\n\nFrom a PowerCLI command prompt while connected to vCenter, run the following command:\n\nGet-VMHost | Select Name, ` @{N=\"HostProfile\";E={$_ | Get-VMHostProfile}}, ` @{N=\"JoinADEnabled\";E={($_ | Get-VmHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled}}, ` @{N=\"JoinDomainMethod\";E={(($_ | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory | Select -ExpandProperty Policy | Where {$_.Id -eq \"JoinDomainMethodPolicy\"}).Policyoption.Id}}\n\nIf \"JoinADEnabled\" is \"True\" and \"JoinDomainMethod\" is not \"FixedCAMConfigOption\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\nClick a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration.\n\nClick \"Edit Host Profile...\". Set the \"Join Domain Method\" to \"Use vSphere Authentication Proxy to add the host to domain\" and provide the IP address of the vSphere Authentication Proxy server.\n\nClick \"Save\"."}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000240","rid":"SV-ESXI-80-000240","stig_id":"ESXI-80-000240","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000240' do\n  title 'The ESXi host when using Host Profiles and/or Auto Deploy must use the vSphere Authentication Proxy to protect passwords when adding themselves to Active Directory.'\n  desc  \"\n    If a host is configured to join an Active Directory domain using Host Profiles and/or Auto Deploy, the Active Directory credentials are saved in the profile and are transmitted over the network.\n\n    To avoid having to save Active Directory credentials in the Host Profile and to avoid transmitting Active Directory credentials over the network, use the vSphere Authentication Proxy.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    If the organization is not using Host Profiles to join Active Directory, this is not applicable.\n\n    From the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\n    Click a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration >> Join Domain Method.\n\n    If the method used to join hosts to a domain is not set to \\\"Use vSphere Authentication Proxy to add the host to domain\\\", this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to vCenter, run the following command:\n\n    Get-VMHost | Select Name, ` @{N=\\\"HostProfile\\\";E={$_ | Get-VMHostProfile}}, ` @{N=\\\"JoinADEnabled\\\";E={($_ | Get-VmHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled}}, ` @{N=\\\"JoinDomainMethod\\\";E={(($_ | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory | Select -ExpandProperty Policy | Where {$_.Id -eq \\\"JoinDomainMethodPolicy\\\"}).Policyoption.Id}}\n\n    If \\\"JoinADEnabled\\\" is \\\"True\\\" and \\\"JoinDomainMethod\\\" is not \\\"FixedCAMConfigOption\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\n    Click a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration.\n\n    Click \\\"Edit Host Profile...\\\". Set the \\\"Join Domain Method\\\" to \\\"Use vSphere Authentication Proxy to add the host to domain\\\" and provide the IP address of the vSphere Authentication Proxy server.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000240'\n  tag rid: 'SV-ESXI-80-000240'\n  tag stig_id: 'ESXI-80-000240'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    setimpact = true\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostProfile\"\n      hostprofile = powercli_command(command).stdout\n\n      if hostprofile.empty?\n        describe \"There are no attached host profiles host: #{vmhost}. This control is not applicable.\" do\n          skip \"There are no attached host profiles host: #{vmhost}. This control is not applicable.\"\n        end\n      else\n        command1 = \"(Get-VMHost -Name #{vmhost} | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled\"\n        adEnabled = powercli_command(command1).stdout.strip\n\n        if adEnabled.match?('True')\n          command2 = \"(Get-VMHost -Name #{vmhost} | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory | Select-Object -ExpandProperty Policy | Where {$_.Id -eq 'JoinDomainMethodPolicy'} | Select-Object -ExpandProperty PolicyOption | Select-Object -ExpandProperty Id\"\n          describe powercli_command(command2) do\n            its('stdout.strip') { should cmp 'FixedCAMConfigOption' }\n          end\n          setimpact = false\n        else\n          describe \"Active Directory is not enabled on host: #{vmhost}. This control is not applicable.\" do\n            skip \"Active Directory is not enabled on host: #{vmhost}. This control is not applicable.\"\n          end\n        end\n      end\n    end\n  else\n    describe 'No ESXi hosts found. Review inputs provided for errors and rerun profile.' do\n      skip 'No ESXi hosts found. Review inputs provided for errors and rerun profile.'\n    end\n    setimpact = false\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000240.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000241","title":"The ESXi host must not use the default Active Directory ESX Admin group.","desc":"When adding ESXi hosts to Active Directory, all user/group accounts assigned to the Active Directory group \"ESX Admins\" will have full administrative access to the host.\n\nIf this group is not controlled or known to the system administrators, it may be used for inappropriate access to the host. Therefore, the default group must be changed to a site-specific Active Directory group and membership must be severely restricted.","descriptions":[{"label":"default","data":"When adding ESXi hosts to Active Directory, all user/group accounts assigned to the Active Directory group \"ESX Admins\" will have full administrative access to the host.\n\nIf this group is not controlled or known to the system administrators, it may be used for inappropriate access to the host. Therefore, the default group must be changed to a site-specific Active Directory group and membership must be severely restricted."},{"label":"rationale","data":""},{"label":"check","data":"For systems that do not use Active Directory, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" value and verify it is not set to \"ESX Admins\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup\n\nIf the \"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" setting is set to \"ESX Admins\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" key and configure its value to an appropriate Active Directory group other than \"ESX Admins\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup | Set-AdvancedSetting -Value \"<site specific AD group>\"\n\nNote: Changing the group name does not remove the permissions of the previous group."}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000241","rid":"SV-ESXI-80-000241","stig_id":"ESXI-80-000241","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000241' do\n  title 'The ESXi host must not use the default Active Directory ESX Admin group.'\n  desc  \"\n    When adding ESXi hosts to Active Directory, all user/group accounts assigned to the Active Directory group \\\"ESX Admins\\\" will have full administrative access to the host.\n\n    If this group is not controlled or known to the system administrators, it may be used for inappropriate access to the host. Therefore, the default group must be changed to a site-specific Active Directory group and membership must be severely restricted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For systems that do not use Active Directory, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" value and verify it is not set to \\\"ESX Admins\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup\n\n    If the \\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" setting is set to \\\"ESX Admins\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" key and configure its value to an appropriate Active Directory group other than \\\"ESX Admins\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup | Set-AdvancedSetting -Value \\\"<site specific AD group>\\\"\n\n    Note: Changing the group name does not remove the permissions of the previous group.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000241'\n  tag rid: 'SV-ESXI-80-000241'\n  tag stig_id: 'ESXI-80-000241'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"\n      domainstatus = powercli_command(command).stdout\n      if domainstatus.empty?\n        impact 0.0\n        describe '' do\n          skip \"The ESXi host #{vmhost} is not joined to AD, so this control is not applicable.\"\n        end\n      else\n        command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup | Select-Object -ExpandProperty Value\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should_not cmp 'ESX Admins' }\n          its('stdout.strip') { should cmp \"#{input('adAdminGroup')}\" }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000241.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000243","title":"The ESXi host must configure a persistent log location for all locally stored logs.","desc":"ESXi can be configured to store log files on an in-memory file system. This occurs when the host's \"/scratch\" directory is linked to \"/tmp/scratch\". When this is done, only a single day's worth of logs are stored at any time. In addition, log files will be reinitialized upon each reboot.\n\nThis presents a security risk as user activity logged on the host is only stored temporarily and will not persist across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.\n\nNote: Scratch space is configured automatically during installation or first boot of an ESXi host and does not usually need to be configured manually.\n\nIf ESXi is installed on an SD card or USB device, a persistent log location may not be configured upon install as normal.","descriptions":[{"label":"default","data":"ESXi can be configured to store log files on an in-memory file system. This occurs when the host's \"/scratch\" directory is linked to \"/tmp/scratch\". When this is done, only a single day's worth of logs are stored at any time. In addition, log files will be reinitialized upon each reboot.\n\nThis presents a security risk as user activity logged on the host is only stored temporarily and will not persist across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.\n\nNote: Scratch space is configured automatically during installation or first boot of an ESXi host and does not usually need to be configured manually.\n\nIf ESXi is installed on an SD card or USB device, a persistent log location may not be configured upon install as normal."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logDir\" value and verify it is set to a persistent location.\n\nIf the value of the setting is \"[] /scratch/logs\", verify the advanced setting \"ScratchConfig.CurrentScratchLocation\" is not set to \"/tmp/scratch\". This is a nonpersistent location.\n\nIf \"Syslog.global.logDir\" is not configured to a persistent location, this is a finding.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.syslog.config.get.Invoke() | Select LocalLogOutput,LocalLogOutputIsPersistent\n\nIf the \"LocalLogOutputIsPersistent\" value is not true, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logDir\" value and set it to a known persistent location.\n\nAn example is shown below, where 51dda02d-fade5016-8a08-005056171889 is the UUID of the target datastore:\n\n/vmfs/volumes/51dda02d-fade5016-8a08-005056171889\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logDir | Set-AdvancedSetting -Value \"New Log Location\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000341-VMM-001220","gid":"V-ESXI-80-000243","rid":"SV-ESXI-80-000243","stig_id":"ESXI-80-000243","cci":["CCI-001849"],"nist":["AU-4"]},"code":"control 'ESXI-80-000243' do\n  title 'The ESXi host must configure a persistent log location for all locally stored logs.'\n  desc  \"\n    ESXi can be configured to store log files on an in-memory file system. This occurs when the host's \\\"/scratch\\\" directory is linked to \\\"/tmp/scratch\\\". When this is done, only a single day's worth of logs are stored at any time. In addition, log files will be reinitialized upon each reboot.\n\n    This presents a security risk as user activity logged on the host is only stored temporarily and will not persist across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.\n\n    Note: Scratch space is configured automatically during installation or first boot of an ESXi host and does not usually need to be configured manually.\n\n    If ESXi is installed on an SD card or USB device, a persistent log location may not be configured upon install as normal.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logDir\\\" value and verify it is set to a persistent location.\n\n    If the value of the setting is \\\"[] /scratch/logs\\\", verify the advanced setting \\\"ScratchConfig.CurrentScratchLocation\\\" is not set to \\\"/tmp/scratch\\\". This is a nonpersistent location.\n\n    If \\\"Syslog.global.logDir\\\" is not configured to a persistent location, this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.syslog.config.get.Invoke() | Select LocalLogOutput,LocalLogOutputIsPersistent\n\n    If the \\\"LocalLogOutputIsPersistent\\\" value is not true, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logDir\\\" value and set it to a known persistent location.\n\n    An example is shown below, where 51dda02d-fade5016-8a08-005056171889 is the UUID of the target datastore:\n\n    /vmfs/volumes/51dda02d-fade5016-8a08-005056171889\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logDir | Set-AdvancedSetting -Value \\\"New Log Location\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000341-VMM-001220'\n  tag gid: 'V-ESXI-80-000243'\n  tag rid: 'SV-ESXI-80-000243'\n  tag stig_id: 'ESXI-80-000243'\n  tag cci: ['CCI-001849']\n  tag nist: ['AU-4']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.get.Invoke() | Select-Object -ExpandProperty LocalLogOutputIsPersistent\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000243.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000244","title":"The ESXi host must enforce the exclusive running of executables from approved VIBs.","desc":"The \"execInstalledOnly\" advanced ESXi boot option, when set to TRUE, guarantees that the VMkernel executes only those binaries that have been packaged as part of a signed VIB. While this option is effective on its own, it can be further enhanced by telling the Secure Boot to check with the TPM to make sure that the boot process does not proceed unless this setting is enabled. This further protects against malicious offline changes to ESXi configuration to disable the \"execInstalledOnly\" option.","descriptions":[{"label":"default","data":"The \"execInstalledOnly\" advanced ESXi boot option, when set to TRUE, guarantees that the VMkernel executes only those binaries that have been packaged as part of a signed VIB. While this option is effective on its own, it can be further enhanced by telling the Secure Boot to check with the TPM to make sure that the boot process does not proceed unless this setting is enabled. This further protects against malicious offline changes to ESXi configuration to disable the \"execInstalledOnly\" option."},{"label":"rationale","data":""},{"label":"check","data":"If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"VMkernel.Boot.execInstalledOnly\" value and verify that it is \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly\n\nIf the \"VMkernel.Boot.execInstalledOnly\" setting is not \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"VMkernel.Boot.execInstalledOnly\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Set-AdvancedSetting -Value True"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000244","rid":"SV-ESXI-80-000244","stig_id":"ESXI-80-000244","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000244' do\n  title 'The ESXi host must enforce the exclusive running of executables from approved VIBs.'\n  desc  'The \"execInstalledOnly\" advanced ESXi boot option, when set to TRUE, guarantees that the VMkernel executes only those binaries that have been packaged as part of a signed VIB. While this option is effective on its own, it can be further enhanced by telling the Secure Boot to check with the TPM to make sure that the boot process does not proceed unless this setting is enabled. This further protects against malicious offline changes to ESXi configuration to disable the \"execInstalledOnly\" option.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"VMkernel.Boot.execInstalledOnly\\\" value and verify that it is \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly\n\n    If the \\\"VMkernel.Boot.execInstalledOnly\\\" setting is not \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"VMkernel.Boot.execInstalledOnly\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Set-AdvancedSetting -Value True\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000244'\n  tag rid: 'SV-ESXI-80-000244'\n  tag stig_id: 'ESXI-80-000244'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000244.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000245","title":"The ESXi host must use sufficient entropy for cryptographic operations.","desc":"Starting in vSphere 8.0, the ESXi Entropy implementation supports the FIPS 140-3 and EAL4 certifications. Kernel boot options control which entropy sources to activate on an ESXi host.\n\nIn computing, the term \"entropy\" refers to random characters and data that are collected for use in cryptography, such as generating encryption keys to secure data transmitted over a network. Entropy is required by security for generating keys and communicating securely over the network. Entropy is often collected from a variety of sources on a system.\n\nFIPS entropy handling is the default behavior if the following conditions are true:\n\n-The hardware supports RDSEED.\n-The disableHwrng VMkernel boot option isn't present or is FALSE.\n-The entropySources VMkernel boot option isn't present or is 0 (zero).","descriptions":[{"label":"default","data":"Starting in vSphere 8.0, the ESXi Entropy implementation supports the FIPS 140-3 and EAL4 certifications. Kernel boot options control which entropy sources to activate on an ESXi host.\n\nIn computing, the term \"entropy\" refers to random characters and data that are collected for use in cryptography, such as generating encryption keys to secure data transmitted over a network. Entropy is required by security for generating keys and communicating securely over the network. Entropy is often collected from a variety of sources on a system.\n\nFIPS entropy handling is the default behavior if the following conditions are true:\n\n-The hardware supports RDSEED.\n-The disableHwrng VMkernel boot option isn't present or is FALSE.\n-The entropySources VMkernel boot option isn't present or is 0 (zero)."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following commands:\n\n# esxcli system settings kernel list -o disableHwrng\n# esxcli system settings kernel list -o entropySources\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.settings.kernel.list.invoke() | Where {$_.Name -eq \"disableHwrng\" -or $_.Name -eq \"entropySources\"}\n\nIf \"disableHwrng\" is not set to \"false\", this is a finding.\nIf \"entropySources\" is not set to \"0\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following commands:\n\n# esxcli system settings kernel set -s disableHwrng -v FALSE\n# esxcli system settings kernel set -s entropySources -v 0\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.settings.kernel.set.CreateArgs()\n$arguments.setting = \"disableHwrng\"\n$arguments.value = \"FALSE\"\n$esxcli.system.settings.kernel.set.invoke($arguments)\n$arguments.setting = \"entropySources\"\n$arguments.value = \"0\"\n$esxcli.system.settings.kernel.set.invoke($arguments)\n\nReboot the ESXi host after updating entropy settings."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000245","rid":"SV-ESXI-80-000245","stig_id":"ESXI-80-000245","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000245' do\n  title 'The ESXi host must use sufficient entropy for cryptographic operations.'\n  desc  \"\n    Starting in vSphere 8.0, the ESXi Entropy implementation supports the FIPS 140-3 and EAL4 certifications. Kernel boot options control which entropy sources to activate on an ESXi host.\n\n    In computing, the term \\\"entropy\\\" refers to random characters and data that are collected for use in cryptography, such as generating encryption keys to secure data transmitted over a network. Entropy is required by security for generating keys and communicating securely over the network. Entropy is often collected from a variety of sources on a system.\n\n    FIPS entropy handling is the default behavior if the following conditions are true:\n\n    -The hardware supports RDSEED.\n    -The disableHwrng VMkernel boot option isn't present or is FALSE.\n    -The entropySources VMkernel boot option isn't present or is 0 (zero).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following commands:\n\n    # esxcli system settings kernel list -o disableHwrng\n    # esxcli system settings kernel list -o entropySources\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.settings.kernel.list.invoke() | Where {$_.Name -eq \\\"disableHwrng\\\" -or $_.Name -eq \\\"entropySources\\\"}\n\n    If \\\"disableHwrng\\\" is not set to \\\"false\\\", this is a finding.\n    If \\\"entropySources\\\" is not set to \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following commands:\n\n    # esxcli system settings kernel set -s disableHwrng -v FALSE\n    # esxcli system settings kernel set -s entropySources -v 0\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.settings.kernel.set.CreateArgs()\n    $arguments.setting = \\\"disableHwrng\\\"\n    $arguments.value = \\\"FALSE\\\"\n    $esxcli.system.settings.kernel.set.invoke($arguments)\n    $arguments.setting = \\\"entropySources\\\"\n    $arguments.value = \\\"0\\\"\n    $esxcli.system.settings.kernel.set.invoke($arguments)\n\n    Reboot the ESXi host after updating entropy settings.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000245'\n  tag rid: 'SV-ESXI-80-000245'\n  tag stig_id: 'ESXI-80-000245'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \\\"disableHwrng\\\"} | Select-Object -ExpandProperty Configured\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'FALSE' }\n      end\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \\\"entropySources\\\"} | Select-Object -ExpandProperty Configured\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '0' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000245.rb"},"waiver_data":{},"results":[]},{"id":"ESXI-80-000246","title":"The ESXi host must not enable log filtering.","desc":"The log filtering capability lets you modify the logging policy of the syslog service that is running on an ESXi host. You can create log filters to reduce the number of repetitive entries in the ESXi logs and to deny specific log events entirely.\n\nSetting a limit to the amount of logging information restricts the ability to detect and respond to potential security issues or system failures properly.","descriptions":[{"label":"default","data":"The log filtering capability lets you modify the logging policy of the syslog service that is running on an ESXi host. You can create log filters to reduce the number of repetitive entries in the ESXi logs and to deny specific log events entirely.\n\nSetting a limit to the amount of logging information restricts the ability to detect and respond to potential security issues or system failures properly."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli system syslog config logfilter get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.syslog.config.logfilter.get.invoke()\n\nIf \"LogFilteringEnabled\" is not set to \"false\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# esxcli system syslog config logfilter set --log-filtering-enabled=false\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.syslog.config.logfilter.set.CreateArgs()\n$arguments.logfilteringenabled = $false\n$esxcli.system.syslog.config.logfilter.set.invoke($arguments)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000246","rid":"SV-ESXI-80-000246","stig_id":"ESXI-80-000246","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000246' do\n  title 'The ESXi host must not enable log filtering.'\n  desc  \"\n    The log filtering capability lets you modify the logging policy of the syslog service that is running on an ESXi host. You can create log filters to reduce the number of repetitive entries in the ESXi logs and to deny specific log events entirely.\n\n    Setting a limit to the amount of logging information restricts the ability to detect and respond to potential security issues or system failures properly.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system syslog config logfilter get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.syslog.config.logfilter.get.invoke()\n\n    If \\\"LogFilteringEnabled\\\" is not set to \\\"false\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system syslog config logfilter set --log-filtering-enabled=false\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.syslog.config.logfilter.set.CreateArgs()\n    $arguments.logfilteringenabled = $false\n    $esxcli.system.syslog.config.logfilter.set.invoke($arguments)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000246'\n  tag rid: 'SV-ESXI-80-000246'\n  tag stig_id: 'ESXI-80-000246'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.logfilter.get.invoke() | Select-Object -ExpandProperty LogFilteringEnabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000246.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000189","title":"Virtual machines (VMs) must have copy operations disabled.","desc":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.","descriptions":[{"label":"default","data":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.copy.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.copy.disable\n\nIf the virtual machine advanced setting \"isolation.tools.copy.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.copy.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.copy.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.copy.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000189","rid":"SV-VMCH-80-000189","stig_id":"VMCH-80-000189","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000189' do\n  title 'Virtual machines (VMs) must have copy operations disabled.'\n  desc  'Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.copy.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.copy.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.copy.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.copy.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.copy.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.copy.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000189'\n  tag rid: 'SV-VMCH-80-000189'\n  tag stig_id: 'VMCH-80-000189'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.copy.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000189.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000191","title":"Virtual machines (VMs) must have drag and drop operations disabled.","desc":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.","descriptions":[{"label":"default","data":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.dnd.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable\n\nIf the virtual machine advanced setting \"isolation.tools.dnd.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.dnd.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.dnd.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000191","rid":"SV-VMCH-80-000191","stig_id":"VMCH-80-000191","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000191' do\n  title 'Virtual machines (VMs) must have drag and drop operations disabled.'\n  desc  'Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.dnd.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.dnd.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.dnd.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.dnd.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000191'\n  tag rid: 'SV-VMCH-80-000191'\n  tag stig_id: 'VMCH-80-000191'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.dnd.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000191.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000192","title":"Virtual machines (VMs) must have paste operations disabled.","desc":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.","descriptions":[{"label":"default","data":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.paste.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.paste.disable\n\nIf the virtual machine advanced setting \"isolation.tools.paste.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.paste.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.paste.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.paste.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000192","rid":"SV-VMCH-80-000192","stig_id":"VMCH-80-000192","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000192' do\n  title 'Virtual machines (VMs) must have paste operations disabled.'\n  desc  'Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.paste.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.paste.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.paste.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.paste.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.paste.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.paste.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000192'\n  tag rid: 'SV-VMCH-80-000192'\n  tag stig_id: 'VMCH-80-000192'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.paste.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000192.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000193","title":"Virtual machines (VMs) must have virtual disk shrinking disabled.","desc":"Shrinking a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to shrink is available to nonadministrative users operating within the VM's guest operating system.","descriptions":[{"label":"default","data":"Shrinking a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to shrink is available to nonadministrative users operating within the VM's guest operating system."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.diskShrink.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable\n\nIf the virtual machine advanced setting \"isolation.tools.diskShrink.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.diskShrink.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.diskShrink.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000193","rid":"SV-VMCH-80-000193","stig_id":"VMCH-80-000193","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000193' do\n  title 'Virtual machines (VMs) must have virtual disk shrinking disabled.'\n  desc  \"\n    Shrinking a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\n    However, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to shrink is available to nonadministrative users operating within the VM's guest operating system.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.diskShrink.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskShrink.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskShrink.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.diskShrink.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000193'\n  tag rid: 'SV-VMCH-80-000193'\n  tag stig_id: 'VMCH-80-000193'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000193.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000194","title":"Virtual machines (VMs) must have virtual disk wiping disabled.","desc":"Shrinking and wiping (erasing) a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to wipe (erase) is available to nonadministrative users operating within the VM's guest operating system.","descriptions":[{"label":"default","data":"Shrinking and wiping (erasing) a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to wipe (erase) is available to nonadministrative users operating within the VM's guest operating system."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.diskWiper.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable\n\nIf the virtual machine advanced setting \"isolation.tools.diskWiper.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.diskWiper.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.diskWiper.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000194","rid":"SV-VMCH-80-000194","stig_id":"VMCH-80-000194","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000194' do\n  title 'Virtual machines (VMs) must have virtual disk wiping disabled.'\n  desc  \"\n    Shrinking and wiping (erasing) a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\n    However, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to wipe (erase) is available to nonadministrative users operating within the VM's guest operating system.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.diskWiper.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskWiper.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskWiper.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.diskWiper.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000194'\n  tag rid: 'SV-VMCH-80-000194'\n  tag stig_id: 'VMCH-80-000194'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000194.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000195","title":"Virtual machines (VMs) must limit console sharing.","desc":"By default, more than one user at a time can connect to remote console sessions. When multiple sessions are activated, each terminal window receives a notification about the new session. If an administrator in the VM logs in using a VMware remote console during their session, a nonadministrator in the VM might connect to the console and observe the administrator's actions.\n\nAlso, this could result in an administrator losing console access to a VM. For example, if a jump box is being used for an open console session and the administrator loses connection to that box, the console session remains open. Allowing two console sessions permits debugging via a shared session. For the highest security, allow only one remote console session at a time.","descriptions":[{"label":"default","data":"By default, more than one user at a time can connect to remote console sessions. When multiple sessions are activated, each terminal window receives a notification about the new session. If an administrator in the VM logs in using a VMware remote console during their session, a nonadministrator in the VM might connect to the console and observe the administrator's actions.\n\nAlso, this could result in an administrator losing console access to a VM. For example, if a jump box is being used for an open console session and the administrator loses connection to that box, the console session remains open. Allowing two console sessions permits debugging via a shared session. For the highest security, allow only one remote console session at a time."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"RemoteDisplay.maxConnections\" value is set to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections\n\nIf the virtual machine advanced setting \"RemoteDisplay.maxConnections\" does not exist or is not set to \"1\", this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"RemoteDisplay.maxConnections\" value and set it to \"1\".\n\nIf the setting does not exist, add the Name and Value setting at the bottom of screen.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections | Set-AdvancedSetting -Value 1\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000195","rid":"SV-VMCH-80-000195","stig_id":"VMCH-80-000195","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000195' do\n  title 'Virtual machines (VMs) must limit console sharing.'\n  desc  \"\n    By default, more than one user at a time can connect to remote console sessions. When multiple sessions are activated, each terminal window receives a notification about the new session. If an administrator in the VM logs in using a VMware remote console during their session, a nonadministrator in the VM might connect to the console and observe the administrator's actions.\n\n    Also, this could result in an administrator losing console access to a VM. For example, if a jump box is being used for an open console session and the administrator loses connection to that box, the console session remains open. Allowing two console sessions permits debugging via a shared session. For the highest security, allow only one remote console session at a time.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"RemoteDisplay.maxConnections\\\" value is set to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections\n\n    If the virtual machine advanced setting \\\"RemoteDisplay.maxConnections\\\" does not exist or is not set to \\\"1\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"RemoteDisplay.maxConnections\\\" value and set it to \\\"1\\\".\n\n    If the setting does not exist, add the Name and Value setting at the bottom of screen.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections | Set-AdvancedSetting -Value 1\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000195'\n  tag rid: 'SV-VMCH-80-000195'\n  tag stig_id: 'VMCH-80-000195'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name RemoteDisplay.maxConnections | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should cmp '1' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000195.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000196","title":"Virtual machines (VMs) must limit informational messages from the virtual machine to the VMX file.","desc":"The configuration file containing these name-value pairs is limited to a size of 1MB. If not limited, VMware tools in the guest operating system are capable of sending a large and continuous data stream to the host. This 1MB capacity should be sufficient for most cases, but this value can change if necessary.\n\nThe value can be increased if large amounts of custom information are being stored in the configuration file. The default limit is 1MB.","descriptions":[{"label":"default","data":"The configuration file containing these name-value pairs is limited to a size of 1MB. If not limited, VMware tools in the guest operating system are capable of sending a large and continuous data stream to the host. This 1MB capacity should be sufficient for most cases, but this value can change if necessary.\n\nThe value can be increased if large amounts of custom information are being stored in the configuration file. The default limit is 1MB."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"tools.setinfo.sizeLimit\" value is set to \"1048576\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit\n\nIf the virtual machine advanced setting \"tools.setinfo.sizeLimit\" is not set to \"1048576\", this is a finding.\n\nIf the virtual machine advanced setting \"tools.setinfo.sizeLimit\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"tools.setinfo.sizeLimit\" value and set it to \"1048576\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit | Set-AdvancedSetting -Value 1048576\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000196","rid":"SV-VMCH-80-000196","stig_id":"VMCH-80-000196","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000196' do\n  title 'Virtual machines (VMs) must limit informational messages from the virtual machine to the VMX file.'\n  desc  \"\n    The configuration file containing these name-value pairs is limited to a size of 1MB. If not limited, VMware tools in the guest operating system are capable of sending a large and continuous data stream to the host. This 1MB capacity should be sufficient for most cases, but this value can change if necessary.\n\n    The value can be increased if large amounts of custom information are being stored in the configuration file. The default limit is 1MB.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"tools.setinfo.sizeLimit\\\" value is set to \\\"1048576\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit\n\n    If the virtual machine advanced setting \\\"tools.setinfo.sizeLimit\\\" is not set to \\\"1048576\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"tools.setinfo.sizeLimit\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"tools.setinfo.sizeLimit\\\" value and set it to \\\"1048576\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit | Set-AdvancedSetting -Value 1048576\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000196'\n  tag rid: 'SV-VMCH-80-000196'\n  tag stig_id: 'VMCH-80-000196'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name tools.setinfo.sizeLimit | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp '1048576' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000196.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000197","title":"Virtual machines (VMs) must prevent unauthorized removal, connection and modification of devices.","desc":"In a virtual machine, users and processes without root or administrator privileges can connect or disconnect devices, such as network adaptors and CD-ROM drives, and can modify device settings. Use the virtual machine settings editor or configuration editor to remove unneeded or unused hardware devices. To use the device again, prevent a user or running process in the virtual machine from connecting, disconnecting, or modifying a device from within the guest operating system.\n\nBy default, a rogue user with nonadministrator privileges in a virtual machine can:\n\n1. Connect a disconnected CD-ROM drive and access sensitive information on the media left in the drive.\n2. Disconnect a network adaptor to isolate the virtual machine from its network, which is a denial of service.\n3. Modify settings on a device.","descriptions":[{"label":"default","data":"In a virtual machine, users and processes without root or administrator privileges can connect or disconnect devices, such as network adaptors and CD-ROM drives, and can modify device settings. Use the virtual machine settings editor or configuration editor to remove unneeded or unused hardware devices. To use the device again, prevent a user or running process in the virtual machine from connecting, disconnecting, or modifying a device from within the guest operating system.\n\nBy default, a rogue user with nonadministrator privileges in a virtual machine can:\n\n1. Connect a disconnected CD-ROM drive and access sensitive information on the media left in the drive.\n2. Disconnect a network adaptor to isolate the virtual machine from its network, which is a denial of service.\n3. Modify settings on a device."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.device.connectable.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.device.connectable.disable\n\nIf the virtual machine advanced setting \"isolation.device.connectable.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.device.connectable.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.device.connectable.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.device.connectable.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000197","rid":"SV-VMCH-80-000197","stig_id":"VMCH-80-000197","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000197' do\n  title 'Virtual machines (VMs) must prevent unauthorized removal, connection and modification of devices.'\n  desc  \"\n    In a virtual machine, users and processes without root or administrator privileges can connect or disconnect devices, such as network adaptors and CD-ROM drives, and can modify device settings. Use the virtual machine settings editor or configuration editor to remove unneeded or unused hardware devices. To use the device again, prevent a user or running process in the virtual machine from connecting, disconnecting, or modifying a device from within the guest operating system.\n\n    By default, a rogue user with nonadministrator privileges in a virtual machine can:\n\n    1. Connect a disconnected CD-ROM drive and access sensitive information on the media left in the drive.\n    2. Disconnect a network adaptor to isolate the virtual machine from its network, which is a denial of service.\n    3. Modify settings on a device.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.device.connectable.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.device.connectable.disable\n\n    If the virtual machine advanced setting \\\"isolation.device.connectable.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.device.connectable.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.device.connectable.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.device.connectable.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000197'\n  tag rid: 'SV-VMCH-80-000197'\n  tag stig_id: 'VMCH-80-000197'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.device.connectable.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000197.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000198","title":"Virtual machines (VMs) must not be able to obtain host information from the hypervisor.","desc":"If enabled, a VM can obtain detailed information about the physical host. The default value for the parameter is FALSE. This setting should not be TRUE unless a particular VM requires this information for performance monitoring. An adversary could use this information to inform further attacks on the host.","descriptions":[{"label":"default","data":"If enabled, a VM can obtain detailed information about the physical host. The default value for the parameter is FALSE. This setting should not be TRUE unless a particular VM requires this information for performance monitoring. An adversary could use this information to inform further attacks on the host."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"tools.guestlib.enableHostInfo\" value is set to \"false\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo\n\nIf the virtual machine advanced setting \"tools.guestlib.enableHostInfo\" is not set to \"false\", this is a finding.\n\nIf the virtual machine advanced setting \"tools.guestlib.enableHostInfo\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"tools.guestlib.enableHostInfo\" value and set it to \"false\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo | Set-AdvancedSetting -Value false\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000198","rid":"SV-VMCH-80-000198","stig_id":"VMCH-80-000198","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000198' do\n  title 'Virtual machines (VMs) must not be able to obtain host information from the hypervisor.'\n  desc  'If enabled, a VM can obtain detailed information about the physical host. The default value for the parameter is FALSE. This setting should not be TRUE unless a particular VM requires this information for performance monitoring. An adversary could use this information to inform further attacks on the host.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"tools.guestlib.enableHostInfo\\\" value is set to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo\n\n    If the virtual machine advanced setting \\\"tools.guestlib.enableHostInfo\\\" is not set to \\\"false\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"tools.guestlib.enableHostInfo\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"tools.guestlib.enableHostInfo\\\" value and set it to \\\"false\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo | Set-AdvancedSetting -Value false\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000198'\n  tag rid: 'SV-VMCH-80-000198'\n  tag stig_id: 'VMCH-80-000198'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'false' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000198.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000199","title":"Virtual machines (VMs) must have shared salt values disabled.","desc":"When salting is enabled (Mem.ShareForceSalting=1 or 2) to share a page between two virtual machines, both salt and the content of the page must be same. A salt value is a configurable advanced option for each virtual machine. The salt values can be specified manually in the virtual machine's advanced settings with the new option \"sched.mem.pshare.salt\".\n\nIf this option is not present in the virtual machine's advanced settings, the value of the \"vc.uuid\" option is taken as the default value. Because the \"vc.uuid\" is unique to each virtual machine, by default Transparent Page Sharing (TPS) happens only among the pages belonging to a particular virtual machine (Intra-VM).","descriptions":[{"label":"default","data":"When salting is enabled (Mem.ShareForceSalting=1 or 2) to share a page between two virtual machines, both salt and the content of the page must be same. A salt value is a configurable advanced option for each virtual machine. The salt values can be specified manually in the virtual machine's advanced settings with the new option \"sched.mem.pshare.salt\".\n\nIf this option is not present in the virtual machine's advanced settings, the value of the \"vc.uuid\" option is taken as the default value. Because the \"vc.uuid\" is unique to each virtual machine, by default Transparent Page Sharing (TPS) happens only among the pages belonging to a particular virtual machine (Intra-VM)."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"sched.mem.pshare.salt\" setting does not exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name sched.mem.pshare.salt\n\nIf the virtual machine advanced setting \"sched.mem.pshare.salt\" exists, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nDelete the \"sched.mem.pshare.salt\" setting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name sched.mem.pshare.salt | Remove-AdvancedSetting\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000199","rid":"SV-VMCH-80-000199","stig_id":"VMCH-80-000199","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000199' do\n  title 'Virtual machines (VMs) must have shared salt values disabled.'\n  desc  \"\n    When salting is enabled (Mem.ShareForceSalting=1 or 2) to share a page between two virtual machines, both salt and the content of the page must be same. A salt value is a configurable advanced option for each virtual machine. The salt values can be specified manually in the virtual machine's advanced settings with the new option \\\"sched.mem.pshare.salt\\\".\n\n    If this option is not present in the virtual machine's advanced settings, the value of the \\\"vc.uuid\\\" option is taken as the default value. Because the \\\"vc.uuid\\\" is unique to each virtual machine, by default Transparent Page Sharing (TPS) happens only among the pages belonging to a particular virtual machine (Intra-VM).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"sched.mem.pshare.salt\\\" setting does not exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name sched.mem.pshare.salt\n\n    If the virtual machine advanced setting \\\"sched.mem.pshare.salt\\\" exists, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Delete the \\\"sched.mem.pshare.salt\\\" setting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name sched.mem.pshare.salt | Remove-AdvancedSetting\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000199'\n  tag rid: 'SV-VMCH-80-000199'\n  tag stig_id: 'VMCH-80-000199'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name sched.mem.pshare.salt | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000199.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000200","title":"Virtual machines (VMs) must disable access through the \"dvfilter\" network Application Programming Interface (API).","desc":"An attacker might compromise a VM by using the \"dvFilter\" API. Configure only VMs that need this access to use the API.","descriptions":[{"label":"default","data":"An attacker might compromise a VM by using the \"dvFilter\" API. Configure only VMs that need this access to use the API."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the settings with the format \"ethernet*.filter*.name\" do not exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name \"ethernet*.filter*.name*\"\n\nIf the virtual machine advanced setting \"ethernet*.filter*.name\" exists and dvfilters are not in use, this is a finding.\n\nIf the virtual machine advanced setting \"ethernet*.filter*.name\" exists and the value is not valid, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nLook for settings with the format \"ethernet*.filter*.name\".\n\nEnsure only required VMs use this setting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name ethernetX.filterY.name | Remove-AdvancedSetting\n\nNote: Change the X and Y values to match the specific setting in the organization's environment.\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000200","rid":"SV-VMCH-80-000200","stig_id":"VMCH-80-000200","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000200' do\n  title 'Virtual machines (VMs) must disable access through the \"dvfilter\" network Application Programming Interface (API).'\n  desc  'An attacker might compromise a VM by using the \"dvFilter\" API. Configure only VMs that need this access to use the API.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the settings with the format \\\"ethernet*.filter*.name\\\" do not exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name \\\"ethernet*.filter*.name*\\\"\n\n    If the virtual machine advanced setting \\\"ethernet*.filter*.name\\\" exists and dvfilters are not in use, this is a finding.\n\n    If the virtual machine advanced setting \\\"ethernet*.filter*.name\\\" exists and the value is not valid, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Look for settings with the format \\\"ethernet*.filter*.name\\\".\n\n    Ensure only required VMs use this setting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name ethernetX.filterY.name | Remove-AdvancedSetting\n\n    Note: Change the X and Y values to match the specific setting in the organization's environment.\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000200'\n  tag rid: 'SV-VMCH-80-000200'\n  tag stig_id: 'VMCH-80-000200'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name ethernet*.filter* | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000200.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000201","title":"Virtual machines (VMs) must be configured to lock when the last console connection is closed.","desc":"When accessing the VM console, the guest operating system must be locked when the last console user disconnects, limiting the possibility of session hijacking. This setting only applies to Windows-based VMs with VMware tools installed.","descriptions":[{"label":"default","data":"When accessing the VM console, the guest operating system must be locked when the last console user disconnects, limiting the possibility of session hijacking. This setting only applies to Windows-based VMs with VMware tools installed."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\nVerify the option \"Lock the guest operating system when the last remote user disconnects\" is checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock\n\nIf the virtual machine advanced setting \"tools.guest.desktop.autolock\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"tools.guest.desktop.autolock\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\nCheck the box next to \"Lock the guest operating system when the last remote user disconnects\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock | Set-AdvancedSetting -Value true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000201","rid":"SV-VMCH-80-000201","stig_id":"VMCH-80-000201","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000201' do\n  title 'Virtual machines (VMs) must be configured to lock when the last console connection is closed.'\n  desc  'When accessing the VM console, the guest operating system must be locked when the last console user disconnects, limiting the possibility of session hijacking. This setting only applies to Windows-based VMs with VMware tools installed.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\n    Verify the option \\\"Lock the guest operating system when the last remote user disconnects\\\" is checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock\n\n    If the virtual machine advanced setting \\\"tools.guest.desktop.autolock\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"tools.guest.desktop.autolock\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\n    Check the box next to \\\"Lock the guest operating system when the last remote user disconnects\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock | Set-AdvancedSetting -Value true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000201'\n  tag rid: 'SV-VMCH-80-000201'\n  tag stig_id: 'VMCH-80-000201'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name tools.guest.desktop.autolock | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000201.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000202","title":"Virtual machines (VMs) must disable 3D features when not required.","desc":"For performance reasons, it is recommended that 3D acceleration be disabled on virtual machines that do not require 3D functionality (e.g., most server workloads or desktops not using 3D applications).","descriptions":[{"label":"default","data":"For performance reasons, it is recommended that 3D acceleration be disabled on virtual machines that do not require 3D functionality (e.g., most server workloads or desktops not using 3D applications)."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\nExpand the \"Video card\" and verify the \"Enable 3D Support\" checkbox is unchecked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name mks.enable3d\n\nIf the virtual machine advanced setting \"mks.enable3d\" exists and is not set to \"false\", this is a finding.\n\nIf the virtual machine advanced setting \"mks.enable3d\" does not exist, this is not a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\nExpand the \"Video card\" and uncheck the \"Enable 3D Support\" checkbox.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name mks.enable3d | Set-AdvancedSetting -Value \"false\"\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000202","rid":"SV-VMCH-80-000202","stig_id":"VMCH-80-000202","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000202' do\n  title 'Virtual machines (VMs) must disable 3D features when not required.'\n  desc  'For performance reasons, it is recommended that 3D acceleration be disabled on virtual machines that do not require 3D functionality (e.g., most server workloads or desktops not using 3D applications).'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\n    Expand the \\\"Video card\\\" and verify the \\\"Enable 3D Support\\\" checkbox is unchecked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name mks.enable3d\n\n    If the virtual machine advanced setting \\\"mks.enable3d\\\" exists and is not set to \\\"false\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"mks.enable3d\\\" does not exist, this is not a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\n    Expand the \\\"Video card\\\" and uncheck the \\\"Enable 3D Support\\\" checkbox.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name mks.enable3d | Set-AdvancedSetting -Value \\\"false\\\"\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000202'\n  tag rid: 'SV-VMCH-80-000202'\n  tag stig_id: 'VMCH-80-000202'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name mks.enable3d | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'false' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000202.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000203","title":"Virtual machines (VMs) must enable encryption for vMotion.","desc":"vMotion migrations in vSphere 6.0 and earlier transferred working memory and CPU state information in clear text over the vMotion network. As of vSphere 6.5, this transfer can be transparently encrypted using 256-bit AES-GCM with negligible performance impact.\n\nvSphere enables encrypted vMotion by default as \"Opportunistic\", meaning that encrypted channels are used where supported, but the operation will continue in plain text where encryption is not supported.\n\nFor example, when vMotioning between two hosts, encryption will always be used. However, because 6.0 and earlier releases do not support this feature, vMotion from a 7.0 host to a 6.0 host would be allowed but would not be encrypted. If the encryption is set to \"Required\", vMotions to unsupported hosts will fail. This must be set to \"Opportunistic\" or \"Required\".","descriptions":[{"label":"default","data":"vMotion migrations in vSphere 6.0 and earlier transferred working memory and CPU state information in clear text over the vMotion network. As of vSphere 6.5, this transfer can be transparently encrypted using 256-bit AES-GCM with negligible performance impact.\n\nvSphere enables encrypted vMotion by default as \"Opportunistic\", meaning that encrypted channels are used where supported, but the operation will continue in plain text where encryption is not supported.\n\nFor example, when vMotioning between two hosts, encryption will always be used. However, because 6.0 and earlier releases do not support this feature, vMotion from a 7.0 host to a 6.0 host would be allowed but would not be encrypted. If the encryption is set to \"Required\", vMotions to unsupported hosts will fail. This must be set to \"Opportunistic\" or \"Required\"."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {($_.ExtensionData.Config.MigrateEncryption -eq \"disabled\")}\n\nIf the \"Encrypted vMotion\" setting does not have a value of \"Opportunistic\" or \"Required\", this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nFor \"Encrypted vMotion\" set the value to \"Opportunistic\" or \"Required\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.MigrateEncryption = New-Object VMware.Vim.VirtualMachineConfigSpecEncryptedVMotionModes\n$spec.MigrateEncryption = $true\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000203","rid":"SV-VMCH-80-000203","stig_id":"VMCH-80-000203","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000203' do\n  title 'Virtual machines (VMs) must enable encryption for vMotion.'\n  desc  \"\n    vMotion migrations in vSphere 6.0 and earlier transferred working memory and CPU state information in clear text over the vMotion network. As of vSphere 6.5, this transfer can be transparently encrypted using 256-bit AES-GCM with negligible performance impact.\n\n    vSphere enables encrypted vMotion by default as \\\"Opportunistic\\\", meaning that encrypted channels are used where supported, but the operation will continue in plain text where encryption is not supported.\n\n    For example, when vMotioning between two hosts, encryption will always be used. However, because 6.0 and earlier releases do not support this feature, vMotion from a 7.0 host to a 6.0 host would be allowed but would not be encrypted. If the encryption is set to \\\"Required\\\", vMotions to unsupported hosts will fail. This must be set to \\\"Opportunistic\\\" or \\\"Required\\\".\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {($_.ExtensionData.Config.MigrateEncryption -eq \\\"disabled\\\")}\n\n    If the \\\"Encrypted vMotion\\\" setting does not have a value of \\\"Opportunistic\\\" or \\\"Required\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    For \\\"Encrypted vMotion\\\" set the value to \\\"Opportunistic\\\" or \\\"Required\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.MigrateEncryption = New-Object VMware.Vim.VirtualMachineConfigSpecEncryptedVMotionModes\n    $spec.MigrateEncryption = $true\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000203'\n  tag rid: 'SV-VMCH-80-000203'\n  tag stig_id: 'VMCH-80-000203'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    list = ['opportunistic', 'required']\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.MigrateEncryption\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_in list }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000203.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000204","title":"Virtual machines (VMs) must enable encryption for Fault Tolerance.","desc":"Fault Tolerance log traffic can be encrypted. This could contain sensitive data from the protected machine's memory or CPU instructions.\n\nvSphere Fault Tolerance performs frequent checks between a primary VM and secondary VM so the secondary VM can quickly resume from the last successful checkpoint. The checkpoint contains the VM state that has been modified since the previous checkpoint.\n\nWhen Fault Tolerance is turned on, FT encryption is set to \"Opportunistic\" by default, which means it enables encryption only if both the primary and secondary host are capable of encryption.","descriptions":[{"label":"default","data":"Fault Tolerance log traffic can be encrypted. This could contain sensitive data from the protected machine's memory or CPU instructions.\n\nvSphere Fault Tolerance performs frequent checks between a primary VM and secondary VM so the secondary VM can quickly resume from the last successful checkpoint. The checkpoint contains the VM state that has been modified since the previous checkpoint.\n\nWhen Fault Tolerance is turned on, FT encryption is set to \"Opportunistic\" by default, which means it enables encryption only if both the primary and secondary host are capable of encryption."},{"label":"rationale","data":""},{"label":"check","data":"If the Virtual Machine does not have Fault Tolerance enabled, this is not applicable.\n\nFor each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {($_.ExtensionData.Config.FtEncryptionMode -ne \"ftEncryptionOpportunistic\") -and ($_.ExtensionData.Config.FtEncryptionMode -ne \"ftEncryptionRequired\")}\n\nIf the \"Encrypted FT\" setting does not have a value of \"Opportunistic\" or \"Required\", this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nFor \"Encrypted FT\" set the value to \"Opportunistic\" or \"Required\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.FTEncryption = New-Object VMware.Vim.VMware.Vim.VirtualMachineConfigSpecEncryptedFtModes\n$spec.FT = ftEncryptionOpportunistic or ftEncryptionRequired\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000204","rid":"SV-VMCH-80-000204","stig_id":"VMCH-80-000204","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000204' do\n  title 'Virtual machines (VMs) must enable encryption for Fault Tolerance.'\n  desc  \"\n    Fault Tolerance log traffic can be encrypted. This could contain sensitive data from the protected machine's memory or CPU instructions.\n\n    vSphere Fault Tolerance performs frequent checks between a primary VM and secondary VM so the secondary VM can quickly resume from the last successful checkpoint. The checkpoint contains the VM state that has been modified since the previous checkpoint.\n\n    When Fault Tolerance is turned on, FT encryption is set to \\\"Opportunistic\\\" by default, which means it enables encryption only if both the primary and secondary host are capable of encryption.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If the Virtual Machine does not have Fault Tolerance enabled, this is not applicable.\n\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {($_.ExtensionData.Config.FtEncryptionMode -ne \\\"ftEncryptionOpportunistic\\\") -and ($_.ExtensionData.Config.FtEncryptionMode -ne \\\"ftEncryptionRequired\\\")}\n\n    If the \\\"Encrypted FT\\\" setting does not have a value of \\\"Opportunistic\\\" or \\\"Required\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    For \\\"Encrypted FT\\\" set the value to \\\"Opportunistic\\\" or \\\"Required\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.FTEncryption = New-Object VMware.Vim.VMware.Vim.VirtualMachineConfigSpecEncryptedFtModes\n    $spec.FT = ftEncryptionOpportunistic or ftEncryptionRequired\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000204'\n  tag rid: 'SV-VMCH-80-000204'\n  tag stig_id: 'VMCH-80-000204'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    list = ['ftEncryptionOpportunistic', 'ftEncryptionRequired']\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.FtEncryptionMode\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_in list }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000204.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000205","title":"Virtual machines (VMs) must configure log size.","desc":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, the size of these logs is unlimited, and they are only rotated on vMotion or power events. This can cause storage issues at scale for VMs that do not vMotion or power cycle often.","descriptions":[{"label":"default","data":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, the size of these logs is unlimited, and they are only rotated on vMotion or power events. This can cause storage issues at scale for VMs that do not vMotion or power cycle often."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"log.rotateSize\" value is set to \"2048000\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.rotateSize\n\nIf the virtual machine advanced setting \"log.rotateSize\" is not set to \"2048000\", this is a finding.\n\nIf the virtual machine advanced setting \"log.rotateSize\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"log.rotateSize\" value and set it to \"2048000\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.rotateSize | Set-AdvancedSetting -Value 2048000\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000205","rid":"SV-VMCH-80-000205","stig_id":"VMCH-80-000205","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000205' do\n  title 'Virtual machines (VMs) must configure log size.'\n  desc  \"\n    The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\n    By default, the size of these logs is unlimited, and they are only rotated on vMotion or power events. This can cause storage issues at scale for VMs that do not vMotion or power cycle often.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"log.rotateSize\\\" value is set to \\\"2048000\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.rotateSize\n\n    If the virtual machine advanced setting \\\"log.rotateSize\\\" is not set to \\\"2048000\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"log.rotateSize\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"log.rotateSize\\\" value and set it to \\\"2048000\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.rotateSize | Set-AdvancedSetting -Value 2048000\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000205'\n  tag rid: 'SV-VMCH-80-000205'\n  tag stig_id: 'VMCH-80-000205'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name log.rotateSize | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp '2048000' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000205.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000206","title":"Virtual machines (VMs) must configure log retention.","desc":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, 10 of these logs are retained. This is normally sufficient for most environments, but this configuration must be verified and maintained.","descriptions":[{"label":"default","data":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, 10 of these logs are retained. This is normally sufficient for most environments, but this configuration must be verified and maintained."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"log.keepOld\" value is set to \"10\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.keepOld\n\nIf the virtual machine advanced setting \"log.keepOld\" is not set to \"10\", this is a finding.\n\nIf the virtual machine advanced setting \"log.keepOld\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"log.keepOld\" value and set it to \"10\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.keepOld | Set-AdvancedSetting -Value 10\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000206","rid":"SV-VMCH-80-000206","stig_id":"VMCH-80-000206","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000206' do\n  title 'Virtual machines (VMs) must configure log retention.'\n  desc  \"\n    The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\n    By default, 10 of these logs are retained. This is normally sufficient for most environments, but this configuration must be verified and maintained.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"log.keepOld\\\" value is set to \\\"10\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.keepOld\n\n    If the virtual machine advanced setting \\\"log.keepOld\\\" is not set to \\\"10\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"log.keepOld\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"log.keepOld\\\" value and set it to \\\"10\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.keepOld | Set-AdvancedSetting -Value 10\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000206'\n  tag rid: 'SV-VMCH-80-000206'\n  tag stig_id: 'VMCH-80-000206'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name log.keepOld | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp '10' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000206.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000207","title":"Virtual machines (VMs) must enable logging.","desc":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including, but not limited to, power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations and machine clones. Due to the value these logs provide for the continued availability of each VM and potential security incidents, these logs must be enabled.","descriptions":[{"label":"default","data":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including, but not limited to, power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations and machine clones. Due to the value these logs provide for the continued availability of each VM and potential security incidents, these logs must be enabled."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\nEnsure that the checkbox next to \"Enable logging\" is checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {$_.ExtensionData.Config.Flags.EnableLogging -ne \"True\"}\n\nIf logging is not enabled, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\nClick the checkbox next to \"Enable logging\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.Flags = New-Object VMware.Vim.VirtualMachineFlagInfo\n$spec.Flags.enableLogging = $true\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000207","rid":"SV-VMCH-80-000207","stig_id":"VMCH-80-000207","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000207' do\n  title 'Virtual machines (VMs) must enable logging.'\n  desc  'The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including, but not limited to, power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations and machine clones. Due to the value these logs provide for the continued availability of each VM and potential security incidents, these logs must be enabled.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\n    Ensure that the checkbox next to \\\"Enable logging\\\" is checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {$_.ExtensionData.Config.Flags.EnableLogging -ne \\\"True\\\"}\n\n    If logging is not enabled, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\n    Click the checkbox next to \\\"Enable logging\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.Flags = New-Object VMware.Vim.VirtualMachineFlagInfo\n    $spec.Flags.enableLogging = $true\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000207'\n  tag rid: 'SV-VMCH-80-000207'\n  tag stig_id: 'VMCH-80-000207'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Flags.EnableLogging\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000207.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000208","title":"Virtual machines (VMs) must not use independent, non-persistent disks.","desc":"The security issue with nonpersistent disk mode is that successful attackers, with a simple shutdown or reboot, might undo or remove any traces they were ever on the machine. To safeguard against this risk, production virtual machines should be set to use persistent disk mode; additionally, ensure activity within the VM is logged remotely on a separate server, such as a syslog server or equivalent Windows-based event collector. Without a persistent record of activity on a VM, administrators might never know whether they have been attacked or hacked.\n\nThere can be valid use cases for these types of disks, such as with an application presentation solution where read-only disks are desired, and such cases should be identified and documented.","descriptions":[{"label":"default","data":"The security issue with nonpersistent disk mode is that successful attackers, with a simple shutdown or reboot, might undo or remove any traces they were ever on the machine. To safeguard against this risk, production virtual machines should be set to use persistent disk mode; additionally, ensure activity within the VM is logged remotely on a separate server, such as a syslog server or equivalent Windows-based event collector. Without a persistent record of activity on a VM, administrators might never know whether they have been attacked or hacked.\n\nThere can be valid use cases for these types of disks, such as with an application presentation solution where read-only disks are desired, and such cases should be identified and documented."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the attached hard disks and verify they are not configured as independent nonpersistent disks.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-HardDisk | Select Parent, Name, Filename, DiskType, Persistence | FT -AutoSize\n\nIf the virtual machine has attached disks that are in independent nonpersistent mode and are not documented, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the target hard disk and change the mode to persistent or uncheck Independent.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run one of the following commands:\n\nGet-VM \"VM Name\" | Get-HardDisk | Set-HardDisk -Persistence IndependentPersistent\n\nor\n\nGet-VM \"VM Name\" | Get-HardDisk | Set-HardDisk -Persistence Persistent"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000208","rid":"SV-VMCH-80-000208","stig_id":"VMCH-80-000208","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000208' do\n  title 'Virtual machines (VMs) must not use independent, non-persistent disks.'\n  desc  \"\n    The security issue with nonpersistent disk mode is that successful attackers, with a simple shutdown or reboot, might undo or remove any traces they were ever on the machine. To safeguard against this risk, production virtual machines should be set to use persistent disk mode; additionally, ensure activity within the VM is logged remotely on a separate server, such as a syslog server or equivalent Windows-based event collector. Without a persistent record of activity on a VM, administrators might never know whether they have been attacked or hacked.\n\n    There can be valid use cases for these types of disks, such as with an application presentation solution where read-only disks are desired, and such cases should be identified and documented.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the attached hard disks and verify they are not configured as independent nonpersistent disks.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-HardDisk | Select Parent, Name, Filename, DiskType, Persistence | FT -AutoSize\n\n    If the virtual machine has attached disks that are in independent nonpersistent mode and are not documented, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the target hard disk and change the mode to persistent or uncheck Independent.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run one of the following commands:\n\n    Get-VM \\\"VM Name\\\" | Get-HardDisk | Set-HardDisk -Persistence IndependentPersistent\n\n    or\n\n    Get-VM \\\"VM Name\\\" | Get-HardDisk | Set-HardDisk -Persistence Persistent\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000208'\n  tag rid: 'SV-VMCH-80-000208'\n  tag stig_id: 'VMCH-80-000208'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-HardDisk | Select-Object -ExpandProperty Persistence\"\n      results = powercli_command(command)\n      results.stdout.split.each do |disk|\n        describe \"Checking the VM: #{vm} for Non-Persistent Hard Disks\" do\n          subject { disk }\n          it { should_not cmp 'IndependentNonPersistent' }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000208.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000209","title":"Virtual machines (VMs) must remove unneeded floppy devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Get-FloppyDrive | Select Parent, Name, ConnectionState\n\nIf a virtual machine has a floppy drive connected, this is a finding."},{"label":"fix","data":"Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nThe VM must be powered off to remove a floppy drive.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-FloppyDrive | Remove-FloppyDrive"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000209","rid":"SV-VMCH-80-000209","stig_id":"VMCH-80-000209","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000209' do\n  title 'Virtual machines (VMs) must remove unneeded floppy devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Get-FloppyDrive | Select Parent, Name, ConnectionState\n\n    If a virtual machine has a floppy drive connected, this is a finding.\n  \"\n  desc 'fix', \"\n    Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    The VM must be powered off to remove a floppy drive.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-FloppyDrive | Remove-FloppyDrive\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000209'\n  tag rid: 'SV-VMCH-80-000209'\n  tag stig_id: 'VMCH-80-000209'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-FloppyDrive\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for Floppy drives\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000209.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000210","title":"Virtual machines (VMs) must remove unneeded CD/DVD devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the VMs hardware and verify no CD/DVD drives are connected.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Get-CDDrive | Where {$_.extensiondata.connectable.connected -eq $true} | Select Parent,Name\n\nIf a virtual machine has a CD/DVD drive connected other than temporarily, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the CD/DVD drive and uncheck \"Connected\" and \"Connect at power on\" and remove any attached ISOs.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-CDDrive | Set-CDDrive -NoMedia"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000210","rid":"SV-VMCH-80-000210","stig_id":"VMCH-80-000210","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000210' do\n  title 'Virtual machines (VMs) must remove unneeded CD/DVD devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the VMs hardware and verify no CD/DVD drives are connected.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Get-CDDrive | Where {$_.extensiondata.connectable.connected -eq $true} | Select Parent,Name\n\n    If a virtual machine has a CD/DVD drive connected other than temporarily, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the CD/DVD drive and uncheck \\\"Connected\\\" and \\\"Connect at power on\\\" and remove any attached ISOs.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-CDDrive | Set-CDDrive -NoMedia\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000210'\n  tag rid: 'SV-VMCH-80-000210'\n  tag stig_id: 'VMCH-80-000210'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}' | Get-CDDrive).ExtensionData.connectable.connected\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"Checking the VM: #{vm} for CD/DVD drives\" do\n          subject { result }\n          it { should cmp 'false' }\n        end\n        describe \"Checking the VM: #{vm} for CD/DVD drives\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000210.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000211","title":"Virtual machines (VMs) must remove unneeded parallel devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \"parallel\"}\n\nIf a virtual machine has a parallel device present, this is a finding."},{"label":"fix","data":"Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nThe VM must be powered off to remove a parallel device.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$pport = (Get-VM -Name <vmname>).ExtensionData.Config.Hardware.Device | Where {$_.DeviceInfo.Label -match \"Parallel\"}\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.DeviceChange += New-Object VMware.Vim.VirtualDeviceConfigSpec\n$spec.DeviceChange[-1].device = $pport\n$spec.DeviceChange[-1].operation = \"remove\"\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000211","rid":"SV-VMCH-80-000211","stig_id":"VMCH-80-000211","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000211' do\n  title 'Virtual machines (VMs) must remove unneeded parallel devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \\\"parallel\\\"}\n\n    If a virtual machine has a parallel device present, this is a finding.\n  \"\n  desc 'fix', \"\n    Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    The VM must be powered off to remove a parallel device.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $pport = (Get-VM -Name <vmname>).ExtensionData.Config.Hardware.Device | Where {$_.DeviceInfo.Label -match \\\"Parallel\\\"}\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.DeviceChange += New-Object VMware.Vim.VirtualDeviceConfigSpec\n    $spec.DeviceChange[-1].device = $pport\n    $spec.DeviceChange[-1].operation = \\\"remove\\\"\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000211'\n  tag rid: 'SV-VMCH-80-000211'\n  tag stig_id: 'VMCH-80-000211'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Hardware.Device.DeviceInfo.label\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for parallel devices\" do\n        subject { result }\n        it { should_not match 'Parallel' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000211.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000212","title":"Virtual machines (VMs) must remove unneeded serial devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the VMs hardware and verify no serial devices exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \"serial\"}\n\nIf a virtual machine has a serial device present, this is a finding."},{"label":"fix","data":"The VM must be powered off to remove a serial device.\n\nFor each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the serial device, click the circled \"X\" to remove it, and click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000212","rid":"SV-VMCH-80-000212","stig_id":"VMCH-80-000212","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000212' do\n  title 'Virtual machines (VMs) must remove unneeded serial devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the VMs hardware and verify no serial devices exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \\\"serial\\\"}\n\n    If a virtual machine has a serial device present, this is a finding.\n  \"\n  desc  'fix', \"\n    The VM must be powered off to remove a serial device.\n\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the serial device, click the circled \\\"X\\\" to remove it, and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000212'\n  tag rid: 'SV-VMCH-80-000212'\n  tag stig_id: 'VMCH-80-000212'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Hardware.Device.DeviceInfo.label\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for serial devices\" do\n        subject { result }\n        it { should_not match 'Serial' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000212.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000213","title":"Virtual machines (VMs) must remove unneeded USB devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the VMs hardware and verify no USB devices exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\nGet-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \"usb\"}\nGet-VM | Get-UsbDevice\n\nIf a virtual machine has any USB devices or USB controllers present, this is a finding.\n\nIf USB smart card readers are used to pass smart cards through the VM console to a VM, the use of a USB controller and USB devices for that purpose is not a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the USB controller, click the circled \"X\" to remove it, and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-USBDevice | Remove-USBDevice\n\nNote:  This will not remove the USB controller, just any connected devices."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000213","rid":"SV-VMCH-80-000213","stig_id":"VMCH-80-000213","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000213' do\n  title 'Virtual machines (VMs) must remove unneeded USB devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the VMs hardware and verify no USB devices exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    Get-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \\\"usb\\\"}\n    Get-VM | Get-UsbDevice\n\n    If a virtual machine has any USB devices or USB controllers present, this is a finding.\n\n    If USB smart card readers are used to pass smart cards through the VM console to a VM, the use of a USB controller and USB devices for that purpose is not a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the USB controller, click the circled \\\"X\\\" to remove it, and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-USBDevice | Remove-USBDevice\n\n    Note:  This will not remove the USB controller, just any connected devices.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000213'\n  tag rid: 'SV-VMCH-80-000213'\n  tag stig_id: 'VMCH-80-000213'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Hardware.Device.DeviceInfo.label\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for USB devices\" do\n        subject { result }\n        it { should_not match 'USB' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000213.rb"},"waiver_data":{},"results":[]},{"id":"VMCH-80-000214","title":"Virtual machines (VMs) must disable DirectPath I/O devices when not required.","desc":"VMDirectPath I/O (PCI passthrough) enables direct assignment of hardware PCI functions to VMs. This gives the VM access to the PCI functions with minimal intervention from the ESXi host. This is a powerful feature for legitimate applications such as virtualized storage appliances, backup appliances, dedicated graphics, etc., but it also allows a potential attacker highly privileged access to underlying hardware and the PCI bus.","descriptions":[{"label":"default","data":"VMDirectPath I/O (PCI passthrough) enables direct assignment of hardware PCI functions to VMs. This gives the VM access to the PCI functions with minimal intervention from the ESXi host. This is a powerful feature for legitimate applications such as virtualized storage appliances, backup appliances, dedicated graphics, etc., but it also allows a potential attacker highly privileged access to underlying hardware and the PCI bus."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, view the Summary tab.\n\nReview the PCI devices section and verify none exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-PassthroughDevice\n\nIf the virtual machine has passthrough devices present, and the specific device returned is not approved, this is a finding."},{"label":"fix","data":"From the vSphere Client, select the Virtual Machine, right click and go to Edit Settings >> Virtual Hardware tab.\n\nFind the unexpected PCI device returned from the check.\n\nHover the mouse over the device and click the circled \"X\" to remove the device. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-PassthroughDevice | Remove-PassthroughDevice"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000214","rid":"SV-VMCH-80-000214","stig_id":"VMCH-80-000214","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000214' do\n  title 'Virtual machines (VMs) must disable DirectPath I/O devices when not required.'\n  desc  'VMDirectPath I/O (PCI passthrough) enables direct assignment of hardware PCI functions to VMs. This gives the VM access to the PCI functions with minimal intervention from the ESXi host. This is a powerful feature for legitimate applications such as virtualized storage appliances, backup appliances, dedicated graphics, etc., but it also allows a potential attacker highly privileged access to underlying hardware and the PCI bus.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, view the Summary tab.\n\n    Review the PCI devices section and verify none exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-PassthroughDevice\n\n    If the virtual machine has passthrough devices present, and the specific device returned is not approved, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, select the Virtual Machine, right click and go to Edit Settings >> Virtual Hardware tab.\n\n    Find the unexpected PCI device returned from the check.\n\n    Hover the mouse over the device and click the circled \\\"X\\\" to remove the device. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-PassthroughDevice | Remove-PassthroughDevice\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000214'\n  tag rid: 'SV-VMCH-80-000214'\n  tag stig_id: 'VMCH-80-000214'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-PassthroughDevice\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for PCI passthrough devices\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000214.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000009","title":"The vCenter Server must use TLS 1.2, at a minimum, to protect the confidentiality of sensitive data during electronic dissemination using remote access.","desc":"Using older unauthorized versions or incorrectly configuring protocol negotiation makes the gateway vulnerable to known and unknown attacks that exploit vulnerabilities in this protocol.","descriptions":[{"label":"default","data":"Using older unauthorized versions or incorrectly configuring protocol negotiation makes the gateway vulnerable to known and unknown attacks that exploit vulnerabilities in this protocol."},{"label":"rationale","data":""},{"label":"check","data":"At the command prompt on the vCenter Server Appliance, run the following command:\n\n# /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc scan\n\nIf the output indicates versions of TLS other than 1.2 are enabled, this is a finding."},{"label":"fix","data":"At the command prompt on the vCenter Server Appliance, run the following command:\n\n# /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc update -p TLSv1.2\n\nvCenter services will be restarted as part of the reconfiguration. The operating system will not be restarted.\n\nThe \"--no-restart\" flag can be added to restart services at a later time.\n\nChanges will not take effect until all services are restarted or the appliance is rebooted."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-APP-000014","satisfies":["SRG-APP-000156","SRG-APP-000157","SRG-APP-000219","SRG-APP-000439","SRG-APP-000440","SRG-APP-000441","SRG-APP-000442","SRG-APP-000560","SRG-APP-000565","SRG-APP-000625","SRG-APP-000645"],"gid":"V-VCSA-80-000009","rid":"SV-VCSA-80-000009","stig_id":"VCSA-80-000009","cci":["CCI-000068","CCI-000382","CCI-001184","CCI-001453","CCI-001941","CCI-001942","CCI-002418","CCI-002420","CCI-002421","CCI-002422","CCI-002450"],"nist":["AC-17 (2)","CM-7 b","IA-2 (8)","IA-2 (9)","SC-13","SC-23","SC-8","SC-8 (1)","SC-8 (2)"]},"code":"control 'VCSA-80-000009' do\n  title 'The vCenter Server must use TLS 1.2, at a minimum, to protect the confidentiality of sensitive data during electronic dissemination using remote access.'\n  desc  'Using older unauthorized versions or incorrectly configuring protocol negotiation makes the gateway vulnerable to known and unknown attacks that exploit vulnerabilities in this protocol.'\n  desc  'rationale', ''\n  desc  'check', \"\n    At the command prompt on the vCenter Server Appliance, run the following command:\n\n    # /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc scan\n\n    If the output indicates versions of TLS other than 1.2 are enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    At the command prompt on the vCenter Server Appliance, run the following command:\n\n    # /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc update -p TLSv1.2\n\n    vCenter services will be restarted as part of the reconfiguration. The operating system will not be restarted.\n\n    The \\\"--no-restart\\\" flag can be added to restart services at a later time.\n\n    Changes will not take effect until all services are restarted or the appliance is rebooted.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-APP-000014'\n  tag satisfies: ['SRG-APP-000156', 'SRG-APP-000157', 'SRG-APP-000219', 'SRG-APP-000439', 'SRG-APP-000440', 'SRG-APP-000441', 'SRG-APP-000442', 'SRG-APP-000560', 'SRG-APP-000565', 'SRG-APP-000625', 'SRG-APP-000645']\n  tag gid: 'V-VCSA-80-000009'\n  tag rid: 'SV-VCSA-80-000009'\n  tag stig_id: 'VCSA-80-000009'\n  tag cci: ['CCI-000068', 'CCI-000382', 'CCI-001184', 'CCI-001453', 'CCI-001941', 'CCI-001942', 'CCI-002418', 'CCI-002420', 'CCI-002421', 'CCI-002422', 'CCI-002450']\n  tag nist: ['AC-17 (2)', 'CM-7 b', 'IA-2 (8)', 'IA-2 (9)', 'SC-13', 'SC-23', 'SC-8', 'SC-8 (1)', 'SC-8 (2)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000009.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000023","title":"The vCenter Server must enforce the limit of three consecutive invalid login attempts by a user.","desc":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account.","descriptions":[{"label":"default","data":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nThe following lockout policy should be set as follows:\n\nMaximum number of failed login attempts: 3\n\nIf this account lockout policy is not configured as stated, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nClick \"Edit\".\n\nSet the \"Maximum number of failed login attempts\" to \"3\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000065","gid":"V-VCSA-80-000023","rid":"SV-VCSA-80-000023","stig_id":"VCSA-80-000023","cci":["CCI-000044"],"nist":["AC-7 a"]},"code":"control 'VCSA-80-000023' do\n  title 'The vCenter Server must enforce the limit of three consecutive invalid login attempts by a user.'\n  desc  'By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account. '\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    The following lockout policy should be set as follows:\n\n    Maximum number of failed login attempts: 3\n\n    If this account lockout policy is not configured as stated, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Maximum number of failed login attempts\\\" to \\\"3\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000065'\n  tag gid: 'V-VCSA-80-000023'\n  tag rid: 'SV-VCSA-80-000023'\n  tag stig_id: 'VCSA-80-000023'\n  tag cci: ['CCI-000044']\n  tag nist: ['AC-7 a']\n\n  command = '(Get-SsoLockoutPolicy).MaxFailedAttempts'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp '3' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000023.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000024","title":"The vCenter Server must display the Standard Mandatory DOD Notice and Consent Banner before logon.","desc":"Display of the DOD-approved use notification before granting access to the application ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with DTM-08-060. Use the following verbiage for applications that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for operating systems that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of the DOD-approved use notification before granting access to the application ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with DTM-08-060. Use the following verbiage for applications that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for operating systems that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\nIf the selection box next to \"Show login message\" is disabled, \"Details of login message\" is not configured to the standard DOD User Agreement, or the \"Consent checkbox\" is disabled, this is a finding.\n\nNote: Refer to vulnerability discussion for user agreement language."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\nClick \"Edit\".\n\nClick the \"Show login message\" slider to enable.\n\nConfigure the \"Login message\" to \"DOD User Agreement\".\n\nClick the \"Consent checkbox\" slider to enable.\n\nSet the \"Details of login message\" to the Standard Mandatory DOD Notice and Consent Banner text.\n\nClick \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000068","satisfies":["SRG-APP-000069","SRG-APP-000070"],"gid":"V-VCSA-80-000024","rid":"SV-VCSA-80-000024","stig_id":"VCSA-80-000024","cci":["CCI-000048","CCI-000050","CCI-001384"],"nist":["AC-8 a","AC-8 b","AC-8 c 1"]},"code":"control 'VCSA-80-000024' do\n  title 'The vCenter Server must display the Standard Mandatory DOD Notice and Consent Banner before logon.'\n  desc  \"\n    Display of the DOD-approved use notification before granting access to the application ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with DTM-08-060. Use the following verbiage for applications that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for operating systems that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\n    If the selection box next to \\\"Show login message\\\" is disabled, \\\"Details of login message\\\" is not configured to the standard DOD User Agreement, or the \\\"Consent checkbox\\\" is disabled, this is a finding.\n\n    Note: Refer to vulnerability discussion for user agreement language.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Show login message\\\" slider to enable.\n\n    Configure the \\\"Login message\\\" to \\\"DOD User Agreement\\\".\n\n    Click the \\\"Consent checkbox\\\" slider to enable.\n\n    Set the \\\"Details of login message\\\" to the Standard Mandatory DOD Notice and Consent Banner text.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000068'\n  tag satisfies: ['SRG-APP-000069', 'SRG-APP-000070']\n  tag gid: 'V-VCSA-80-000024'\n  tag rid: 'SV-VCSA-80-000024'\n  tag stig_id: 'VCSA-80-000024'\n  tag cci: ['CCI-000048', 'CCI-000050', 'CCI-001384']\n  tag nist: ['AC-8 a', 'AC-8 b', 'AC-8 c 1']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000024.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000034","title":"The vCenter Server must produce audit records containing information to establish what type of events occurred.","desc":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.","descriptions":[{"label":"default","data":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify the \"config.log.level\" value is set to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.log.level and verify it is set to \"info\".\n\nIf the \"config.log.level\" value is not set to \"info\" or does not exist, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"config.log.level\" setting to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.log.level | Set-AdvancedSetting -Value info"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000095","gid":"V-VCSA-80-000034","rid":"SV-VCSA-80-000034","stig_id":"VCSA-80-000034","cci":["CCI-000130"],"nist":["AU-3"]},"code":"control 'VCSA-80-000034' do\n  title 'The vCenter Server must produce audit records containing information to establish what type of events occurred.'\n  desc  'Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify the \\\"config.log.level\\\" value is set to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.log.level and verify it is set to \\\"info\\\".\n\n    If the \\\"config.log.level\\\" value is not set to \\\"info\\\" or does not exist, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"config.log.level\\\" setting to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.log.level | Set-AdvancedSetting -Value info\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000095'\n  tag gid: 'V-VCSA-80-000034'\n  tag rid: 'SV-VCSA-80-000034'\n  tag stig_id: 'VCSA-80-000034'\n  tag cci: ['CCI-000130']\n  tag nist: ['AU-3']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.log.level | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'info' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000034.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000057","title":"vCenter Server plugins must be verified.","desc":"The vCenter Server includes a vSphere Client extensibility framework, which provides the ability to extend the vSphere Client with menu selections or toolbar icons that provide access to vCenter Server add-on components or external, web-based functionality.\n\nvSphere Client plugins or extensions run at the same privilege level as the user. Malicious extensions might masquerade as useful add-ons while compromising the system by stealing credentials or incorrectly configuring the system.\n\nAdditionally, vCenter comes with a number of plugins preinstalled that may or may not be necessary for proper operation.","descriptions":[{"label":"default","data":"The vCenter Server includes a vSphere Client extensibility framework, which provides the ability to extend the vSphere Client with menu selections or toolbar icons that provide access to vCenter Server add-on components or external, web-based functionality.\n\nvSphere Client plugins or extensions run at the same privilege level as the user. Malicious extensions might masquerade as useful add-ons while compromising the system by stealing credentials or incorrectly configuring the system.\n\nAdditionally, vCenter comes with a number of plugins preinstalled that may or may not be necessary for proper operation."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins.\n\nView the Installed/Available Plug-ins list and verify they are all identified as authorized VMware, third-party (partner), and/or site-specific approved plug-ins.\n\nIf any installed/available plug-ins in the viewable list cannot be verified as allowed vSphere Client plug-ins from trusted sources or are not in active use, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins, click the radio button next to the unknown plug-in, and click \"Disable\".\n\nIf the plugin will not be needed in the future, proceed to uninstall the plug-in.\n\nTo uninstall plug-ins, do the following:\n\nIf vCenter Server is in linked mode, perform this procedure on the vCenter Server that is used to install the plug-in initially and then restart the vCenter Server services on the linked vCenter Server:\n\nIn a web browser, navigate to \"http://vCenter_Server_name_or_IP/mob\", where \"vCenter_Server_name_or_IP/mob\" is the name of the vCenter Server or its IP address.\n\nClick \"Content\".\n\nClick \"ExtensionManager\".\n\nSelect and copy the name of the plug-in to be removed from the list of values under \"Properties\".\n\nClick \"UnregisterExtension\". A new window appears.\n\nPaste the name of the plug-in and click \"Invoke Method\". This removes the plug-in.\n\nClose the window.\n\nRefresh the Managed Object Type:ManagedObjectReference:ExtensionManager window to verify the plug-in is removed successfully.\n\nNote: If the plug-in still appears, restart the vSphere Client.\n\nNote: The Managed Object Browser (MOB) may have to be enabled temporarily if it was disabled previously."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000141","gid":"V-VCSA-80-000057","rid":"SV-VCSA-80-000057","stig_id":"VCSA-80-000057","cci":["CCI-000381"],"nist":["CM-7 a"]},"code":"control 'VCSA-80-000057' do\n  title 'vCenter Server plugins must be verified.'\n  desc  \"\n    The vCenter Server includes a vSphere Client extensibility framework, which provides the ability to extend the vSphere Client with menu selections or toolbar icons that provide access to vCenter Server add-on components or external, web-based functionality.\n\n    vSphere Client plugins or extensions run at the same privilege level as the user. Malicious extensions might masquerade as useful add-ons while compromising the system by stealing credentials or incorrectly configuring the system.\n\n    Additionally, vCenter comes with a number of plugins preinstalled that may or may not be necessary for proper operation.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins.\n\n    View the Installed/Available Plug-ins list and verify they are all identified as authorized VMware, third-party (partner), and/or site-specific approved plug-ins.\n\n    If any installed/available plug-ins in the viewable list cannot be verified as allowed vSphere Client plug-ins from trusted sources or are not in active use, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins, click the radio button next to the unknown plug-in, and click \\\"Disable\\\".\n\n    If the plugin will not be needed in the future, proceed to uninstall the plug-in.\n\n    To uninstall plug-ins, do the following:\n\n    If vCenter Server is in linked mode, perform this procedure on the vCenter Server that is used to install the plug-in initially and then restart the vCenter Server services on the linked vCenter Server:\n\n    In a web browser, navigate to \\\"http://vCenter_Server_name_or_IP/mob\\\", where \\\"vCenter_Server_name_or_IP/mob\\\" is the name of the vCenter Server or its IP address.\n\n    Click \\\"Content\\\".\n\n    Click \\\"ExtensionManager\\\".\n\n    Select and copy the name of the plug-in to be removed from the list of values under \\\"Properties\\\".\n\n    Click \\\"UnregisterExtension\\\". A new window appears.\n\n    Paste the name of the plug-in and click \\\"Invoke Method\\\". This removes the plug-in.\n\n    Close the window.\n\n    Refresh the Managed Object Type:ManagedObjectReference:ExtensionManager window to verify the plug-in is removed successfully.\n\n    Note: If the plug-in still appears, restart the vSphere Client.\n\n    Note: The Managed Object Browser (MOB) may have to be enabled temporarily if it was disabled previously.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000141'\n  tag gid: 'V-VCSA-80-000057'\n  tag rid: 'SV-VCSA-80-000057'\n  tag stig_id: 'VCSA-80-000057'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000057.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000059","title":"The vCenter Server must uniquely identify and authenticate users or processes acting on behalf of users.","desc":"To ensure accountability and prevent unauthenticated access, organizational users must be identified and authenticated to prevent potential misuse and compromise of the system.\n\nOrganizational users include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors). Organizational users (and any processes acting on behalf of users) must be uniquely identified and authenticated for all accesses except the following.\n\n(i) Accesses explicitly identified and documented by the organization. Organizations document specific user actions that can be performed on the information system without identification or authentication; and\n(ii) Accesses that occur through authorized use of group authenticators without individual authentication. Organizations may require unique identification of individuals in group accounts (e.g., shared privilege accounts) or for detailed accountability of individual activity.\n\nUsing Active Directory or an identity provider for authentication provides more robust account management capabilities and accountability.","descriptions":[{"label":"default","data":"To ensure accountability and prevent unauthenticated access, organizational users must be identified and authenticated to prevent potential misuse and compromise of the system.\n\nOrganizational users include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors). Organizational users (and any processes acting on behalf of users) must be uniquely identified and authenticated for all accesses except the following.\n\n(i) Accesses explicitly identified and documented by the organization. Organizations document specific user actions that can be performed on the information system without identification or authentication; and\n(ii) Accesses that occur through authorized use of group authenticators without individual authentication. Organizations may require unique identification of individuals in group accounts (e.g., shared privilege accounts) or for detailed accountability of individual activity.\n\nUsing Active Directory or an identity provider for authentication provides more robust account management capabilities and accountability."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nIf the identity provider type is \"embedded\" and there is no identity source of type \"Active Directory\" (either Windows Integrated Authentication or LDAP), this is a finding.\n\nIf the identity provider type is \"Microsoft ADFS\" or another supported identity provider, this is NOT a finding."},{"label":"fix","data":"When using the embedded identity provider type, perform the following:\n\nFrom the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Identity Sources.\n\nClick \"Add\".\n\nSelect either \"Active Directory over LDAP\" or \"Active Directory (Windows Integrated Authentication)\" and configure appropriately.\n\nNote: Windows Integrated Authentication requires that the vCenter server be joined to Active Directory before configuration via Administration >> Single Sign On >> Configuration >> Identity Provider >> Active Directory Domain.\n\nOR\n\nTo change the identity provider type to a third-party identity provider such as Microsoft ADFS, perform the following:\n\nFrom the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nClick \"Change Identity Provider\".\n\nSelect \"Microsoft ADFS\" and click \"Next\".\n\nEnter the ADFS server information and User and Group details and click \"Finish\".\n\nFor additional information on configuring ADFS for use with vCenter, refer to the vSphere documentation."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000148","satisfies":["SRG-APP-000153","SRG-APP-000163","SRG-APP-000180","SRG-APP-000234"],"gid":"V-VCSA-80-000059","rid":"SV-VCSA-80-000059","stig_id":"VCSA-80-000059","cci":["CCI-000764","CCI-000770","CCI-000795","CCI-000804","CCI-001682"],"nist":["AC-2 (2)","IA-2","IA-2 (5)","IA-4 e","IA-8"]},"code":"control 'VCSA-80-000059' do\n  title 'The vCenter Server must uniquely identify and authenticate users or processes acting on behalf of users.'\n  desc  \"\n    To ensure accountability and prevent unauthenticated access, organizational users must be identified and authenticated to prevent potential misuse and compromise of the system.\n\n    Organizational users include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors). Organizational users (and any processes acting on behalf of users) must be uniquely identified and authenticated for all accesses except the following.\n\n    (i) Accesses explicitly identified and documented by the organization. Organizations document specific user actions that can be performed on the information system without identification or authentication; and\n    (ii) Accesses that occur through authorized use of group authenticators without individual authentication. Organizations may require unique identification of individuals in group accounts (e.g., shared privilege accounts) or for detailed accountability of individual activity.\n\n    Using Active Directory or an identity provider for authentication provides more robust account management capabilities and accountability.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    If the identity provider type is \\\"embedded\\\" and there is no identity source of type \\\"Active Directory\\\" (either Windows Integrated Authentication or LDAP), this is a finding.\n\n    If the identity provider type is \\\"Microsoft ADFS\\\" or another supported identity provider, this is NOT a finding.\n  \"\n  desc 'fix', \"\n    When using the embedded identity provider type, perform the following:\n\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Identity Sources.\n\n    Click \\\"Add\\\".\n\n    Select either \\\"Active Directory over LDAP\\\" or \\\"Active Directory (Windows Integrated Authentication)\\\" and configure appropriately.\n\n    Note: Windows Integrated Authentication requires that the vCenter server be joined to Active Directory before configuration via Administration >> Single Sign On >> Configuration >> Identity Provider >> Active Directory Domain.\n\n    OR\n\n    To change the identity provider type to a third-party identity provider such as Microsoft ADFS, perform the following:\n\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    Click \\\"Change Identity Provider\\\".\n\n    Select \\\"Microsoft ADFS\\\" and click \\\"Next\\\".\n\n    Enter the ADFS server information and User and Group details and click \\\"Finish\\\".\n\n    For additional information on configuring ADFS for use with vCenter, refer to the vSphere documentation.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000148'\n  tag satisfies: ['SRG-APP-000153', 'SRG-APP-000163', 'SRG-APP-000180', 'SRG-APP-000234']\n  tag gid: 'V-VCSA-80-000059'\n  tag rid: 'SV-VCSA-80-000059'\n  tag stig_id: 'VCSA-80-000059'\n  tag cci: ['CCI-000764', 'CCI-000770', 'CCI-000795', 'CCI-000804', 'CCI-001682']\n  tag nist: ['AC-2 (2)', 'IA-2', 'IA-2 (5)', 'IA-4 e', 'IA-8']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000059.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000060","title":"The vCenter Server must require multifactor authentication.","desc":"Without the use of multifactor authentication, the ease of access to privileged functions is greatly increased.\n\nMultifactor authentication requires using two or more factors to achieve authentication.\n\nFactors include:\n(i) something a user knows (e.g., password/PIN);\n(ii) something a user has (e.g., cryptographic identification device, token); or\n(iii) something a user is (e.g., biometric).","descriptions":[{"label":"default","data":"Without the use of multifactor authentication, the ease of access to privileged functions is greatly increased.\n\nMultifactor authentication requires using two or more factors to achieve authentication.\n\nFactors include:\n(i) something a user knows (e.g., password/PIN);\n(ii) something a user has (e.g., cryptographic identification device, token); or\n(iii) something a user is (e.g., biometric)."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nIf the embedded identity provider is used, click on \"Smart Card Authentication\".\n\nIf the embedded identity provider is used and \"Smart Card Authentication\" is not enabled, this is a finding.\n\nIf a third-party identity provider is used, such as Microsoft ADFS, and it does not require multifactor authentication to log on to vCenter, this is a finding."},{"label":"fix","data":"To configure smart card authentication for vCenter when using the embedded identity provider, refer to the vSphere documentation.\n\nFor vCenter Servers using a third-party identity provider, consult the product's documentation for enabling multifactor authentication."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000149","satisfies":["SRG-APP-000080","SRG-APP-000150","SRG-APP-000391","SRG-APP-000402"],"gid":"V-VCSA-80-000060","rid":"SV-VCSA-80-000060","stig_id":"VCSA-80-000060","cci":["CCI-000166","CCI-000765","CCI-000766","CCI-001953","CCI-002009"],"nist":["AU-10","IA-2 (1)","IA-2 (12)","IA-2 (2)","IA-8 (1)"]},"code":"control 'VCSA-80-000060' do\n  title 'The vCenter Server must require multifactor authentication.'\n  desc  \"\n    Without the use of multifactor authentication, the ease of access to privileged functions is greatly increased.\n\n    Multifactor authentication requires using two or more factors to achieve authentication.\n\n    Factors include:\n    (i) something a user knows (e.g., password/PIN);\n    (ii) something a user has (e.g., cryptographic identification device, token); or\n    (iii) something a user is (e.g., biometric).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    If the embedded identity provider is used, click on \\\"Smart Card Authentication\\\".\n\n    If the embedded identity provider is used and \\\"Smart Card Authentication\\\" is not enabled, this is a finding.\n\n    If a third-party identity provider is used, such as Microsoft ADFS, and it does not require multifactor authentication to log on to vCenter, this is a finding.\n  \"\n  desc 'fix', \"\n    To configure smart card authentication for vCenter when using the embedded identity provider, refer to the vSphere documentation.\n\n    For vCenter Servers using a third-party identity provider, consult the product's documentation for enabling multifactor authentication.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000149'\n  tag satisfies: ['SRG-APP-000080', 'SRG-APP-000150', 'SRG-APP-000391', 'SRG-APP-000402']\n  tag gid: 'V-VCSA-80-000060'\n  tag rid: 'SV-VCSA-80-000060'\n  tag stig_id: 'VCSA-80-000060'\n  tag cci: ['CCI-000166', 'CCI-000765', 'CCI-000766', 'CCI-001953', 'CCI-002009']\n  tag nist: ['AU-10', 'IA-2 (1)', 'IA-2 (12)', 'IA-2 (2)', 'IA-8 (1)']\n\n  if input('embeddedIdp')\n    command = '(Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled'\n    describe powercli_command(command) do\n      its('stdout.strip') { should cmp 'true' }\n    end\n  else\n    describe 'This check is a manual or policy based check and must be reviewed manually.' do\n      skip 'This check is a manual or policy based check and must be reviewed manually.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000060.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000069","title":"The vCenter Server passwords must be at least 15 characters in length.","desc":"The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nPassword complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password. The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nUse of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password.","descriptions":[{"label":"default","data":"The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nPassword complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password. The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nUse of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Minimum Length\" setting.\n\nMinimum Length: 15\n\nIf the password policy is not configured with a \"Minimum Length\" policy of \"15\" or more, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet the \"Minimum Length\" to \"15\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000164","gid":"V-VCSA-80-000069","rid":"SV-VCSA-80-000069","stig_id":"VCSA-80-000069","cci":["CCI-000205"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000069' do\n  title 'The vCenter Server passwords must be at least 15 characters in length.'\n  desc  \"\n    The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\n    Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password. The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\n    Use of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Minimum Length\\\" setting.\n\n    Minimum Length: 15\n\n    If the password policy is not configured with a \\\"Minimum Length\\\" policy of \\\"15\\\" or more, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Minimum Length\\\" to \\\"15\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000164'\n  tag gid: 'V-VCSA-80-000069'\n  tag rid: 'SV-VCSA-80-000069'\n  tag stig_id: 'VCSA-80-000069'\n  tag cci: ['CCI-000205']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinLength'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 15 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000069.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000070","title":"The vCenter Server must prohibit password reuse for a minimum of five generations.","desc":"Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nTo meet password policy requirements, passwords must be changed at specific policy-based intervals.\n\nIf the information system or application allows the user to consecutively reuse their password when that password has exceeded its defined lifetime, the result is a password that is not changed per policy requirements.","descriptions":[{"label":"default","data":"Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nTo meet password policy requirements, passwords must be changed at specific policy-based intervals.\n\nIf the information system or application allows the user to consecutively reuse their password when that password has exceeded its defined lifetime, the result is a password that is not changed per policy requirements."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Restrict reuse\" setting.\n\nRestrict reuse: Users cannot reuse any previous 5 passwords\n\nIf the password policy is not configured with a \"Restrict reuse\" policy of \"5\" or more, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet the \"Restrict reuse\" to \"5\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000165","gid":"V-VCSA-80-000070","rid":"SV-VCSA-80-000070","stig_id":"VCSA-80-000070","cci":["CCI-000200"],"nist":["IA-5 (1) (e)"]},"code":"control 'VCSA-80-000070' do\n  title 'The vCenter Server must prohibit password reuse for a minimum of five generations.'\n  desc  \"\n    Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    To meet password policy requirements, passwords must be changed at specific policy-based intervals.\n\n    If the information system or application allows the user to consecutively reuse their password when that password has exceeded its defined lifetime, the result is a password that is not changed per policy requirements.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Restrict reuse\\\" setting.\n\n    Restrict reuse: Users cannot reuse any previous 5 passwords\n\n    If the password policy is not configured with a \\\"Restrict reuse\\\" policy of \\\"5\\\" or more, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Restrict reuse\\\" to \\\"5\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000165'\n  tag gid: 'V-VCSA-80-000070'\n  tag rid: 'SV-VCSA-80-000070'\n  tag stig_id: 'VCSA-80-000070'\n  tag cci: ['CCI-000200']\n  tag nist: ['IA-5 (1) (e)']\n\n  command = '(Get-SsoPasswordPolicy).ProhibitedPreviousPasswordsCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 5 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000070.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000071","title":"The vCenter Server passwords must contain at least one uppercase character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password is, the greater the number of possible combinations that need to be tested before the password is compromised.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password is, the greater the number of possible combinations that need to be tested before the password is compromised."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 uppercase characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more uppercase characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"uppercase characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000166","gid":"V-VCSA-80-000071","rid":"SV-VCSA-80-000071","stig_id":"VCSA-80-000071","cci":["CCI-000192"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000071' do\n  title 'The vCenter Server passwords must contain at least one uppercase character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password is, the greater the number of possible combinations that need to be tested before the password is compromised.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 uppercase characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more uppercase characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"uppercase characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000166'\n  tag gid: 'V-VCSA-80-000071'\n  tag rid: 'SV-VCSA-80-000071'\n  tag stig_id: 'VCSA-80-000071'\n  tag cci: ['CCI-000192']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinUppercaseCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000071.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000072","title":"The vCenter Server passwords must contain at least one lowercase character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 lowercase characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more lowercase characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"lowercase characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000167","gid":"V-VCSA-80-000072","rid":"SV-VCSA-80-000072","stig_id":"VCSA-80-000072","cci":["CCI-000193"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000072' do\n  title 'The vCenter Server passwords must contain at least one lowercase character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 lowercase characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more lowercase characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"lowercase characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000167'\n  tag gid: 'V-VCSA-80-000072'\n  tag rid: 'SV-VCSA-80-000072'\n  tag stig_id: 'VCSA-80-000072'\n  tag cci: ['CCI-000193']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinLowercaseCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000072.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000073","title":"The vCenter Server passwords must contain at least one numeric character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 numeric characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more numeric characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"numeric characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000168","gid":"V-VCSA-80-000073","rid":"SV-VCSA-80-000073","stig_id":"VCSA-80-000073","cci":["CCI-000194"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000073' do\n  title 'The vCenter Server passwords must contain at least one numeric character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 numeric characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more numeric characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"numeric characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000168'\n  tag gid: 'V-VCSA-80-000073'\n  tag rid: 'SV-VCSA-80-000073'\n  tag stig_id: 'VCSA-80-000073'\n  tag cci: ['CCI-000194']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinNumericCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000073.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000074","title":"The vCenter Server passwords must contain at least one special character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor in determining how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n\nSpecial characters are not alphanumeric. Examples include: ~ ! @ # $ % ^ *.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor in determining how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n\nSpecial characters are not alphanumeric. Examples include: ~ ! @ # $ % ^ *."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 special characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more special characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"special characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000169","gid":"V-VCSA-80-000074","rid":"SV-VCSA-80-000074","stig_id":"VCSA-80-000074","cci":["CCI-001619"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000074' do\n  title 'The vCenter Server passwords must contain at least one special character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor in determining how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n\n    Special characters are not alphanumeric. Examples include: ~ ! @ # $ % ^ *.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 special characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more special characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"special characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000169'\n  tag gid: 'V-VCSA-80-000074'\n  tag rid: 'SV-VCSA-80-000074'\n  tag stig_id: 'VCSA-80-000074'\n  tag cci: ['CCI-001619']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinSpecialCharCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000074.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000077","title":"The vCenter Server must enable FIPS-validated cryptography.","desc":"FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules use authentication that meets DOD requirements.\n\nIn vSphere 6.7 and later, ESXi and vCenter Server use FIPS-validated cryptography to protect management interfaces and the VMware Certificate Authority (VMCA).\n\nvSphere 7.0 Update 2 and later adds additional FIPS-validated cryptography to vCenter Server Appliance. By default, this FIPS validation option is disabled and must be enabled.","descriptions":[{"label":"default","data":"FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules use authentication that meets DOD requirements.\n\nIn vSphere 6.7 and later, ESXi and vCenter Server use FIPS-validated cryptography to protect management interfaces and the VMware Certificate Authority (VMCA).\n\nvSphere 7.0 Update 2 and later adds additional FIPS-validated cryptography to vCenter Server Appliance. By default, this FIPS validation option is disabled and must be enabled."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Web Client, go to Developer Center >> API Explorer.\n\nFrom the \"Select API\" drop-down menu, select appliance.\n\nExpand system/security/global_fips >> GET.\n\nClick \"Execute\" and then \"Copy Response\" to view the results.\n\nExample response:\n\n{\n    \"enabled\": true\n}\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nInvoke-GetSystemGlobalFips\n\nIf global FIPS mode is not enabled, this is a finding."},{"label":"fix","data":"From the vSphere Web Client go to Developer Center >> API Explorer.\n\nFrom the \"Select API\" drop-down menu, select appliance.\n\nExpand system/security/global_fips >> PUT.\n\nIn the response body under \"Try it out\" paste the following:\n\n{\n    \"enabled\": true\n}\n\nClick \"Execute\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n$spec = Initialize-SystemSecurityGlobalFipsUpdateSpec -Enabled $true; Invoke-SetSystemGlobalFips -SystemSecurityGlobalFipsUpdateSpec $spec\n\nNote: The vCenter server reboots after FIPS is enabled or disabled."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-APP-000172","satisfies":["SRG-APP-000179","SRG-APP-000224","SRG-APP-000231","SRG-APP-000412","SRG-APP-000514","SRG-APP-000555","SRG-APP-000600","SRG-APP-000610","SRG-APP-000620","SRG-APP-000630","SRG-APP-000635"],"gid":"V-VCSA-80-000077","rid":"SV-VCSA-80-000077","stig_id":"VCSA-80-000077","cci":["CCI-000197","CCI-000803","CCI-001188","CCI-001199","CCI-001967","CCI-002450","CCI-003123"],"nist":["IA-3 (1)","IA-5 (1) (c)","IA-7","MA-4 (6)","SC-13","SC-23 (3)","SC-28"]},"code":"control 'VCSA-80-000077' do\n  title 'The vCenter Server must enable FIPS-validated cryptography.'\n  desc  \"\n    FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules use authentication that meets DOD requirements.\n\n    In vSphere 6.7 and later, ESXi and vCenter Server use FIPS-validated cryptography to protect management interfaces and the VMware Certificate Authority (VMCA).\n\n    vSphere 7.0 Update 2 and later adds additional FIPS-validated cryptography to vCenter Server Appliance. By default, this FIPS validation option is disabled and must be enabled.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, go to Developer Center >> API Explorer.\n\n    From the \\\"Select API\\\" drop-down menu, select appliance.\n\n    Expand system/security/global_fips >> GET.\n\n    Click \\\"Execute\\\" and then \\\"Copy Response\\\" to view the results.\n\n    Example response:\n\n    {\n        \\\"enabled\\\": true\n    }\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Invoke-GetSystemGlobalFips\n\n    If global FIPS mode is not enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Web Client go to Developer Center >> API Explorer.\n\n    From the \\\"Select API\\\" drop-down menu, select appliance.\n\n    Expand system/security/global_fips >> PUT.\n\n    In the response body under \\\"Try it out\\\" paste the following:\n\n    {\n        \\\"enabled\\\": true\n    }\n\n    Click \\\"Execute\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    $spec = Initialize-SystemSecurityGlobalFipsUpdateSpec -Enabled $true; Invoke-SetSystemGlobalFips -SystemSecurityGlobalFipsUpdateSpec $spec\n\n    Note: The vCenter server reboots after FIPS is enabled or disabled.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-APP-000172'\n  tag satisfies: ['SRG-APP-000179', 'SRG-APP-000224', 'SRG-APP-000231', 'SRG-APP-000412', 'SRG-APP-000514', 'SRG-APP-000555', 'SRG-APP-000600', 'SRG-APP-000610', 'SRG-APP-000620', 'SRG-APP-000630', 'SRG-APP-000635']\n  tag gid: 'V-VCSA-80-000077'\n  tag rid: 'SV-VCSA-80-000077'\n  tag stig_id: 'VCSA-80-000077'\n  tag cci: ['CCI-000197', 'CCI-000803', 'CCI-001188', 'CCI-001199', 'CCI-001967', 'CCI-002450', 'CCI-003123']\n  tag nist: ['IA-3 (1)', 'IA-5 (1) (c)', 'IA-7', 'MA-4 (6)', 'SC-13', 'SC-23 (3)', 'SC-28']\n\n  command = 'Invoke-GetSystemGlobalFips | Select-Object -ExpandProperty enabled'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'True' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000077.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000079","title":"The vCenter Server must enforce a 90-day maximum password lifetime restriction.","desc":"Any password, no matter how complex, can eventually be cracked. Therefore, passwords must be changed at specific intervals.\n\nOne method of minimizing this risk is to use complex passwords and periodically change them. If the application does not limit the lifetime of passwords and force users to change their passwords, there is the risk that the system and/or application passwords could be compromised.\n\nThis requirement does not include emergency administration accounts, which are meant for access to the application in case of failure. These accounts are not required to have maximum password lifetime restrictions.","descriptions":[{"label":"default","data":"Any password, no matter how complex, can eventually be cracked. Therefore, passwords must be changed at specific intervals.\n\nOne method of minimizing this risk is to use complex passwords and periodically change them. If the application does not limit the lifetime of passwords and force users to change their passwords, there is the risk that the system and/or application passwords could be compromised.\n\nThis requirement does not include emergency administration accounts, which are meant for access to the application in case of failure. These accounts are not required to have maximum password lifetime restrictions."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Maximum lifetime\" setting.\n\nMaximum lifetime: Password must be changed every 90 days\n\nIf the password policy is not configured with \"Maximum lifetime\" policy of \"90\" or less, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"Maximum lifetime\" to \"90\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000174","gid":"V-VCSA-80-000079","rid":"SV-VCSA-80-000079","stig_id":"VCSA-80-000079","cci":["CCI-000199"],"nist":["IA-5 (1) (d)"]},"code":"control 'VCSA-80-000079' do\n  title 'The vCenter Server must enforce a 90-day maximum password lifetime restriction.'\n  desc  \"\n    Any password, no matter how complex, can eventually be cracked. Therefore, passwords must be changed at specific intervals.\n\n    One method of minimizing this risk is to use complex passwords and periodically change them. If the application does not limit the lifetime of passwords and force users to change their passwords, there is the risk that the system and/or application passwords could be compromised.\n\n    This requirement does not include emergency administration accounts, which are meant for access to the application in case of failure. These accounts are not required to have maximum password lifetime restrictions.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Maximum lifetime\\\" setting.\n\n    Maximum lifetime: Password must be changed every 90 days\n\n    If the password policy is not configured with \\\"Maximum lifetime\\\" policy of \\\"90\\\" or less, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"Maximum lifetime\\\" to \\\"90\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000174'\n  tag gid: 'V-VCSA-80-000079'\n  tag rid: 'SV-VCSA-80-000079'\n  tag stig_id: 'VCSA-80-000079'\n  tag cci: ['CCI-000199']\n  tag nist: ['IA-5 (1) (d)']\n\n  command = '(Get-SsoPasswordPolicy).PasswordLifetimeDays'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp <= 90 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000079.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000080","title":"The vCenter Server must enable revocation checking for certificate-based authentication.","desc":"The system must establish the validity of the user-supplied identity certificate using Online Certificate Status Protocol (OCSP) and/or Certificate Revocation List (CRL) revocation checking.","descriptions":[{"label":"default","data":"The system must establish the validity of the user-supplied identity certificate using Online Certificate Status Protocol (OCSP) and/or Certificate Revocation List (CRL) revocation checking."},{"label":"rationale","data":""},{"label":"check","data":"If a federated identity provider is configured and used for an identity source and supports Smartcard authentication, this is not applicable.\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nUnder Smart card authentication settings >> Certificate revocation, verify \"Revocation check\" does not show as disabled.\n\nIf \"Revocation check\" shows as disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nUnder Smart card authentication settings >> Certificate revocation, click the \"Edit\" button.\n\nConfigure revocation checking per site requirements. OCSP with CRL failover is recommended.\n\nBy default, both locations are pulled from the cert. CRL location can be overridden in this screen, and local responders can be specified via the sso-config command line tool. See the vSphere documentation for more information."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000175","satisfies":["SRG-APP-000392","SRG-APP-000401","SRG-APP-000403"],"gid":"V-VCSA-80-000080","rid":"SV-VCSA-80-000080","stig_id":"VCSA-80-000080","cci":["CCI-000185","CCI-001954","CCI-001991","CCI-002010"],"nist":["IA-2 (12)","IA-5 (2) (a)","IA-5 (2) (d)","IA-8 (1)"]},"code":"control 'VCSA-80-000080' do\n  title 'The vCenter Server must enable revocation checking for certificate-based authentication.'\n  desc  'The system must establish the validity of the user-supplied identity certificate using Online Certificate Status Protocol (OCSP) and/or Certificate Revocation List (CRL) revocation checking.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If a federated identity provider is configured and used for an identity source and supports Smartcard authentication, this is not applicable.\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Under Smart card authentication settings >> Certificate revocation, verify \\\"Revocation check\\\" does not show as disabled.\n\n    If \\\"Revocation check\\\" shows as disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Under Smart card authentication settings >> Certificate revocation, click the \\\"Edit\\\" button.\n\n    Configure revocation checking per site requirements. OCSP with CRL failover is recommended.\n\n    By default, both locations are pulled from the cert. CRL location can be overridden in this screen, and local responders can be specified via the sso-config command line tool. See the vSphere documentation for more information.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000175'\n  tag satisfies: ['SRG-APP-000392', 'SRG-APP-000401', 'SRG-APP-000403']\n  tag gid: 'V-VCSA-80-000080'\n  tag rid: 'SV-VCSA-80-000080'\n  tag stig_id: 'VCSA-80-000080'\n  tag cci: ['CCI-000185', 'CCI-001954', 'CCI-001991', 'CCI-002010']\n  tag nist: ['IA-2 (12)', 'IA-5 (2) (a)', 'IA-5 (2) (d)', 'IA-8 (1)']\n\n  if input('embeddedIdp')\n    describe.one do\n      describe powercli_command('(Get-SsoAuthenticationPolicy).OCSPEnabled') do\n        its('stdout.strip') { should cmp 'true' }\n      end\n      describe powercli_command('(Get-SsoAuthenticationPolicy).UseInCertCRL') do\n        its('stdout.strip') { should cmp 'true' }\n      end\n      describe powercli_command('(Get-SsoAuthenticationPolicy).CRLUrl') do\n        its('stdout.strip') { should_not cmp '' }\n      end\n    end\n  else\n    describe 'This check is a manual or policy based check and must be reviewed manually.' do\n      skip 'This check is a manual or policy based check and must be reviewed manually.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000080.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000089","title":"The vCenter Server must terminate vSphere Client sessions after 15 minutes of inactivity.","desc":"Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free resources committed by the managed network element.","descriptions":[{"label":"default","data":"Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free resources committed by the managed network element."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\nView the value of the \"Session timeout\" setting.\n\nIf the \"Session timeout\" is not set to \"15 minute(s)\" or less this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\nClick \"Edit\" and enter \"15\" minutes into the \"Session timeout\" setting. Click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000190","satisfies":["SRG-APP-000295","SRG-APP-000389"],"gid":"V-VCSA-80-000089","rid":"SV-VCSA-80-000089","stig_id":"VCSA-80-000089","cci":["CCI-001133","CCI-002038","CCI-002361"],"nist":["AC-12","IA-11","SC-10"]},"code":"control 'VCSA-80-000089' do\n  title 'The vCenter Server must terminate vSphere Client sessions after 15 minutes of inactivity.'\n  desc  'Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free resources committed by the managed network element.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\n    View the value of the \\\"Session timeout\\\" setting.\n\n    If the \\\"Session timeout\\\" is not set to \\\"15 minute(s)\\\" or less this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\n    Click \\\"Edit\\\" and enter \\\"15\\\" minutes into the \\\"Session timeout\\\" setting. Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000190'\n  tag satisfies: ['SRG-APP-000295', 'SRG-APP-000389']\n  tag gid: 'V-VCSA-80-000089'\n  tag rid: 'SV-VCSA-80-000089'\n  tag stig_id: 'VCSA-80-000089'\n  tag cci: ['CCI-001133', 'CCI-002038', 'CCI-002361']\n  tag nist: ['AC-12', 'IA-11', 'SC-10']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000089.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000095","title":"The vCenter Server user roles must be verified.","desc":"Users and service accounts must only be assigned privileges they require. Least privilege requires that these privileges must only be assigned if needed to reduce risk of confidentiality, availability, or integrity loss.","descriptions":[{"label":"default","data":"Users and service accounts must only be assigned privileges they require. Least privilege requires that these privileges must only be assigned if needed to reduce risk of confidentiality, availability, or integrity loss."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nView each role and verify the users and/or groups assigned to it by clicking on \"Usage\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\nApplication service account and user required privileges should be documented.\n\nIf any user or service account has more privileges than required, this is a finding."},{"label":"fix","data":"To update a user's or group's permissions to an existing role with reduced permissions, do the following:\n\nFrom the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\nSelect the user or group, click the pencil button, change the assigned role, and click \"OK\".\n\nNote: If permissions are assigned on a specific object, the role must be updated where it is assigned (for example, at the cluster level).\n\nTo create a new role with reduced permissions, do the following:\n\nFrom the vSphere Client, go to Administration >> Access Control >> Roles.\n\nClick the green plus sign and enter a name for the role and select only the specific permissions required.\n\nUsers can then be assigned to the newly created role."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000211","satisfies":["SRG-APP-000233","SRG-APP-000380"],"gid":"V-VCSA-80-000095","rid":"SV-VCSA-80-000095","stig_id":"VCSA-80-000095","cci":["CCI-001082","CCI-001084","CCI-001813"],"nist":["CM-5 (1)","SC-2","SC-3"]},"code":"control 'VCSA-80-000095' do\n  title 'The vCenter Server user roles must be verified.'\n  desc  'Users and service accounts must only be assigned privileges they require. Least privilege requires that these privileges must only be assigned if needed to reduce risk of confidentiality, availability, or integrity loss.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    View each role and verify the users and/or groups assigned to it by clicking on \\\"Usage\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\n    Application service account and user required privileges should be documented.\n\n    If any user or service account has more privileges than required, this is a finding.\n  \"\n  desc 'fix', \"\n    To update a user's or group's permissions to an existing role with reduced permissions, do the following:\n\n    From the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\n    Select the user or group, click the pencil button, change the assigned role, and click \\\"OK\\\".\n\n    Note: If permissions are assigned on a specific object, the role must be updated where it is assigned (for example, at the cluster level).\n\n    To create a new role with reduced permissions, do the following:\n\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Click the green plus sign and enter a name for the role and select only the specific permissions required.\n\n    Users can then be assigned to the newly created role.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000211'\n  tag satisfies: ['SRG-APP-000233', 'SRG-APP-000380']\n  tag gid: 'V-VCSA-80-000095'\n  tag rid: 'SV-VCSA-80-000095'\n  tag stig_id: 'VCSA-80-000095'\n  tag cci: ['CCI-001082', 'CCI-001084', 'CCI-001813']\n  tag nist: ['CM-5 (1)', 'SC-2', 'SC-3']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000095.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000110","title":"The vCenter Server must manage excess capacity, bandwidth, or other redundancy to limit the effects of information flooding types of denial-of-service (DoS) attacks by enabling Network I/O Control (NIOC).","desc":"DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.\n\nManaging excess capacity ensures sufficient capacity is available to counter flooding attacks. Employing increased capacity and service redundancy may reduce the susceptibility to some DoS attacks. Managing excess capacity may include, for example, establishing selected usage priorities, quotas, or partitioning.","descriptions":[{"label":"default","data":"DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.\n\nManaging excess capacity ensures sufficient capacity is available to counter flooding attacks. Employing increased capacity and service redundancy may reduce the susceptibility to some DoS attacks. Managing excess capacity may include, for example, establishing selected usage priorities, quotas, or partitioning."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nView the \"Properties\" pane and verify \"Network I/O Control\" is \"Enabled\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | select Name,@{N=\"NIOC Enabled\";E={$_.ExtensionData.config.NetworkResourceManagementEnabled}}\n\nIf \"Network I/O Control\" is disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nIn the \"Properties\" pane, click \"Edit\". Change \"Network I/O Control\" to \"Enabled\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n(Get-VDSwitch \"VDSwitch Name\" | Get-View).EnableNetworkResourceManagement($true)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000247","gid":"V-VCSA-80-000110","rid":"SV-VCSA-80-000110","stig_id":"VCSA-80-000110","cci":["CCI-001095"],"nist":["SC-5 (2)"]},"code":"control 'VCSA-80-000110' do\n  title 'The vCenter Server must manage excess capacity, bandwidth, or other redundancy to limit the effects of information flooding types of denial-of-service (DoS) attacks by enabling Network I/O Control (NIOC).'\n  desc  \"\n    DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.\n\n    Managing excess capacity ensures sufficient capacity is available to counter flooding attacks. Employing increased capacity and service redundancy may reduce the susceptibility to some DoS attacks. Managing excess capacity may include, for example, establishing selected usage priorities, quotas, or partitioning.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    View the \\\"Properties\\\" pane and verify \\\"Network I/O Control\\\" is \\\"Enabled\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | select Name,@{N=\\\"NIOC Enabled\\\";E={$_.ExtensionData.config.NetworkResourceManagementEnabled}}\n\n    If \\\"Network I/O Control\\\" is disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    In the \\\"Properties\\\" pane, click \\\"Edit\\\". Change \\\"Network I/O Control\\\" to \\\"Enabled\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    (Get-VDSwitch \\\"VDSwitch Name\\\" | Get-View).EnableNetworkResourceManagement($true)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000247'\n  tag gid: 'V-VCSA-80-000110'\n  tag rid: 'SV-VCSA-80-000110'\n  tag stig_id: 'VCSA-80-000110'\n  tag cci: ['CCI-001095']\n  tag nist: ['SC-5 (2)']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.NetworkResourceManagementEnabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000110.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000123","title":"The vCenter Server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, on every Single Sign-On (SSO) account action.","desc":"Once an attacker establishes initial access to a system, they often attempt to create a persistent method of reestablishing access. One way to accomplish this is for the attacker to create a new account. They may also try to hijack an existing account by changing a password or enabling a previously disabled account. Therefore, all actions performed on accounts in the SSO domain much be alerted on in vCenter at a minimum and ideally on a Security Information and Event Management (SIEM) system as well.\n\nTo ensure the appropriate personnel are alerted about SSO account actions, create a new vCenter alarm for the \"com.vmware.sso.PrincipalManagement\" event ID and configure the alert mechanisms appropriately.","descriptions":[{"label":"default","data":"Once an attacker establishes initial access to a system, they often attempt to create a persistent method of reestablishing access. One way to accomplish this is for the attacker to create a new account. They may also try to hijack an existing account by changing a password or enabling a previously disabled account. Therefore, all actions performed on accounts in the SSO domain much be alerted on in vCenter at a minimum and ideally on a Security Information and Event Management (SIEM) system as well.\n\nTo ensure the appropriate personnel are alerted about SSO account actions, create a new vCenter alarm for the \"com.vmware.sso.PrincipalManagement\" event ID and configure the alert mechanisms appropriately."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\nVerify there is an alarm created to alert upon all SSO account actions.\n\nThe alarm name may vary, but it is suggested to name it \"SSO account actions - com.vmware.sso.PrincipalManagement\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AlarmDefinition | Where {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \"com.vmware.sso.PrincipalManagement\"} | Select Name,Enabled,@{N=\"EventTypeId\";E={$_.ExtensionData.Info.Expression.Expression.EventTypeId}}\n\nIf an alarm is not created to alert on SSO account actions, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\nClick \"Add\".\n\nProvide the alarm name of \"SSO account actions - com.vmware.sso.PrincipalManagement\" and an optional description.\n\nFrom the \"Target type\" dropdown menu, select \"vCenter Server\".\n\nClick \"Next\".\n\nPaste \"com.vmware.sso.PrincipalManagement\" (without quotes) in the line after \"IF\" and press \"Enter\".\n\nNext to \"Trigger the alarm and\", select \"Show as Warning\".\n\nConfigure the desired notification actions that will inform the SA and ISSO of the event.\n\nClick \"Next\". Click \"Next\" again. Click \"Create\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000291","satisfies":["SRG-APP-000292","SRG-APP-000293","SRG-APP-000294","SRG-APP-000320"],"gid":"V-VCSA-80-000123","rid":"SV-VCSA-80-000123","stig_id":"VCSA-80-000123","cci":["CCI-001683","CCI-001684","CCI-001685","CCI-001686","CCI-002132"],"nist":["AC-2 (4)"]},"code":"control 'VCSA-80-000123' do\n  title 'The vCenter Server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, on every Single Sign-On (SSO) account action.'\n  desc  \"\n    Once an attacker establishes initial access to a system, they often attempt to create a persistent method of reestablishing access. One way to accomplish this is for the attacker to create a new account. They may also try to hijack an existing account by changing a password or enabling a previously disabled account. Therefore, all actions performed on accounts in the SSO domain much be alerted on in vCenter at a minimum and ideally on a Security Information and Event Management (SIEM) system as well.\n\n    To ensure the appropriate personnel are alerted about SSO account actions, create a new vCenter alarm for the \\\"com.vmware.sso.PrincipalManagement\\\" event ID and configure the alert mechanisms appropriately.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\n    Verify there is an alarm created to alert upon all SSO account actions.\n\n    The alarm name may vary, but it is suggested to name it \\\"SSO account actions - com.vmware.sso.PrincipalManagement\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AlarmDefinition | Where {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \\\"com.vmware.sso.PrincipalManagement\\\"} | Select Name,Enabled,@{N=\\\"EventTypeId\\\";E={$_.ExtensionData.Info.Expression.Expression.EventTypeId}}\n\n    If an alarm is not created to alert on SSO account actions, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\n    Click \\\"Add\\\".\n\n    Provide the alarm name of \\\"SSO account actions - com.vmware.sso.PrincipalManagement\\\" and an optional description.\n\n    From the \\\"Target type\\\" dropdown menu, select \\\"vCenter Server\\\".\n\n    Click \\\"Next\\\".\n\n    Paste \\\"com.vmware.sso.PrincipalManagement\\\" (without quotes) in the line after \\\"IF\\\" and press \\\"Enter\\\".\n\n    Next to \\\"Trigger the alarm and\\\", select \\\"Show as Warning\\\".\n\n    Configure the desired notification actions that will inform the SA and ISSO of the event.\n\n    Click \\\"Next\\\". Click \\\"Next\\\" again. Click \\\"Create\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000291'\n  tag satisfies: ['SRG-APP-000292', 'SRG-APP-000293', 'SRG-APP-000294', 'SRG-APP-000320']\n  tag gid: 'V-VCSA-80-000123'\n  tag rid: 'SV-VCSA-80-000123'\n  tag stig_id: 'VCSA-80-000123'\n  tag cci: ['CCI-001683', 'CCI-001684', 'CCI-001685', 'CCI-001686', 'CCI-002132']\n  tag nist: ['AC-2 (4)']\n\n  command = 'Get-AlarmDefinition | Where-Object {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \"com.vmware.sso.PrincipalManagement\"} | Select-Object -ExpandProperty Enabled'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'true' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000123.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000145","title":"The vCenter Server must set the interval for counting failed login attempts to at least 15 minutes.","desc":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account.","descriptions":[{"label":"default","data":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nView the value of the \"Time interval between failures\" setting.\n\nTime interval between failures: 900 seconds\n\nIf the lockout policy is not configured with \"Time interval between failures\" policy of \"900\" or more, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nClick \"Edit\".\n\nSet the \"Time interval between failures\" to \"900\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000345","gid":"V-VCSA-80-000145","rid":"SV-VCSA-80-000145","stig_id":"VCSA-80-000145","cci":["CCI-002238"],"nist":["AC-7 b"]},"code":"control 'VCSA-80-000145' do\n  title 'The vCenter Server must set the interval for counting failed login attempts to at least 15 minutes.'\n  desc  'By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    View the value of the \\\"Time interval between failures\\\" setting.\n\n    Time interval between failures: 900 seconds\n\n    If the lockout policy is not configured with \\\"Time interval between failures\\\" policy of \\\"900\\\" or more, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Time interval between failures\\\" to \\\"900\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000345'\n  tag gid: 'V-VCSA-80-000145'\n  tag rid: 'SV-VCSA-80-000145'\n  tag stig_id: 'VCSA-80-000145'\n  tag cci: ['CCI-002238']\n  tag nist: ['AC-7 b']\n\n  command = '(Get-SsoLockoutPolicy).FailedAttemptIntervalSec'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 900 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000145.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000148","title":"The vCenter Server must be configured to send logs to a central log server.","desc":"vCenter must be configured to send near real-time log data to syslog collectors so information will be available to investigators in the case of a security incident or to assist in troubleshooting.","descriptions":[{"label":"default","data":"vCenter must be configured to send near real-time log data to syslog collectors so information will be available to investigators in the case of a security incident or to assist in troubleshooting."},{"label":"rationale","data":""},{"label":"check","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Syslog\" on the left navigation pane.\n\nOn the resulting pane on the right, verify at least one site-specific syslog receiver is configured and is listed as \"Reachable\".\n\nIf no valid syslog collector is configured or if the collector is not listed as \"Reachable\", this is a finding."},{"label":"fix","data":"Open the VAMI by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with an SSO account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Syslog\" on the left navigation pane.\n\nOn the resulting pane on the right, click \"Edit\" or \"Configure\".\n\nEdit or add the address and port of a site-specific syslog aggregator or Security Information Event Management (SIEM) system with the appropriate protocol.\n\nUser Datagram Protocol (UDP) is discouraged due to its stateless and unencrypted nature. Transport Layer Security (TLS) is preferred.\n\nClick \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000358","gid":"V-VCSA-80-000148","rid":"SV-VCSA-80-000148","stig_id":"VCSA-80-000148","cci":["CCI-001851"],"nist":["AU-4 (1)"]},"code":"control 'VCSA-80-000148' do\n  title 'The vCenter Server must be configured to send logs to a central log server.'\n  desc  'vCenter must be configured to send near real-time log data to syslog collectors so information will be available to investigators in the case of a security incident or to assist in troubleshooting.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Syslog\\\" on the left navigation pane.\n\n    On the resulting pane on the right, verify at least one site-specific syslog receiver is configured and is listed as \\\"Reachable\\\".\n\n    If no valid syslog collector is configured or if the collector is not listed as \\\"Reachable\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Open the VAMI by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with an SSO account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Syslog\\\" on the left navigation pane.\n\n    On the resulting pane on the right, click \\\"Edit\\\" or \\\"Configure\\\".\n\n    Edit or add the address and port of a site-specific syslog aggregator or Security Information Event Management (SIEM) system with the appropriate protocol.\n\n    User Datagram Protocol (UDP) is discouraged due to its stateless and unencrypted nature. Transport Layer Security (TLS) is preferred.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000358'\n  tag gid: 'V-VCSA-80-000148'\n  tag rid: 'SV-VCSA-80-000148'\n  tag stig_id: 'VCSA-80-000148'\n  tag cci: ['CCI-001851']\n  tag nist: ['AU-4 (1)']\n\n  command = 'Invoke-GetLoggingForwarding | Select-Object -ExpandProperty hostname'\n  logservers = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if logservers.empty?\n    describe \"No log servers configured: #{logservers}\" do\n      subject { logservers }\n      it { should_not be_empty }\n    end\n  else\n    logservers.each do |server|\n      describe server do\n        subject { server }\n        it { should be_in input('syslogServers') }\n      end\n    end\n    logserverstatuscommand = 'Invoke-TestLoggingForwarding | Select-Object -ExpandProperty state'\n    logserverstatus = powercli_command(logserverstatuscommand).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n    logserverstatus.each do |status|\n      describe status do\n        subject { status }\n        it { should cmp 'UP' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000148.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000150","title":"The vCenter server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, of all audit failure events requiring real-time alerts.","desc":"It is critical for the appropriate personnel to be aware if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability and system operation may be adversely affected.\n\nAlerts provide organizations with urgent messages. Real-time alerts provide these messages immediately (i.e., the time from event detection to alert occurs in seconds or less).","descriptions":[{"label":"default","data":"It is critical for the appropriate personnel to be aware if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability and system operation may be adversely affected.\n\nAlerts provide organizations with urgent messages. Real-time alerts provide these messages immediately (i.e., the time from event detection to alert occurs in seconds or less)."},{"label":"rationale","data":""},{"label":"check","data":"Review the Central Logging Server being used to verify it is configured to alert the SA and ISSO, at a minimum, on any AO-defined events. Otherwise, this is a finding.\n\nIf there are no AO-defined events, this is not a finding."},{"label":"fix","data":"Configure the Central Logging Server being used to alert the SA and ISSO, at a minimum, on any AO-defined events."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000360","satisfies":["SRG-APP-000379","SRG-APP-000510"],"gid":"V-VCSA-80-000150","rid":"SV-VCSA-80-000150","stig_id":"VCSA-80-000150","cci":["CCI-000172","CCI-001744","CCI-001858"],"nist":["AU-12 c","AU-5 (2)","CM-3 (5)"]},"code":"control 'VCSA-80-000150' do\n  title 'The vCenter server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, of all audit failure events requiring real-time alerts.'\n  desc  \"\n    It is critical for the appropriate personnel to be aware if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability and system operation may be adversely affected.\n\n    Alerts provide organizations with urgent messages. Real-time alerts provide these messages immediately (i.e., the time from event detection to alert occurs in seconds or less).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Review the Central Logging Server being used to verify it is configured to alert the SA and ISSO, at a minimum, on any AO-defined events. Otherwise, this is a finding.\n\n    If there are no AO-defined events, this is not a finding.\n  \"\n  desc 'fix', 'Configure the Central Logging Server being used to alert the SA and ISSO, at a minimum, on any AO-defined events.'\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000360'\n  tag satisfies: ['SRG-APP-000379', 'SRG-APP-000510']\n  tag gid: 'V-VCSA-80-000150'\n  tag rid: 'SV-VCSA-80-000150'\n  tag stig_id: 'VCSA-80-000150'\n  tag cci: ['CCI-000172', 'CCI-001744', 'CCI-001858']\n  tag nist: ['AU-12 c', 'AU-5 (2)', 'CM-3 (5)']\n\n  describe 'This check is a manual or policy based check' do\n    skip 'This must be reviewed manually'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000150.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000158","title":"The vCenter Server must compare internal information system clocks at least every 24 hours with an authoritative time server.","desc":"Inaccurate time stamps make it more difficult to correlate events and can lead to an inaccurate analysis. Determining the correct time a particular event occurred on a system is critical when conducting forensic analysis and investigating system events. Sources outside of the configured acceptable allowance (drift) may be inaccurate. Additionally, unnecessary synchronization may have an adverse impact on system performance and may indicate malicious activity.\n\nSynchronizing internal information system clocks to an authoritative time server provides uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.","descriptions":[{"label":"default","data":"Inaccurate time stamps make it more difficult to correlate events and can lead to an inaccurate analysis. Determining the correct time a particular event occurred on a system is critical when conducting forensic analysis and investigating system events. Sources outside of the configured acceptable allowance (drift) may be inaccurate. Additionally, unnecessary synchronization may have an adverse impact on system performance and may indicate malicious activity.\n\nSynchronizing internal information system clocks to an authoritative time server provides uniformity of time stamps for information systems with multiple system clocks and systems connected over a network."},{"label":"rationale","data":""},{"label":"check","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Time\" on the left navigation pane.\n\nOn the resulting pane on the right, verify at least one authorized time server is configured and is listed as \"Reachable\".\n\nIf \"NTP\" is not enabled and at least one authorized time server configured, this is a finding."},{"label":"fix","data":"Open the VAMI by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with an SSO account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Time\" on the left navigation pane.\n\nOn the resulting pane on the right, click \"Edit\" under \"Time Synchronization\".\n\nSelect \"NTP\" for \"Mode\" and enter a list of authorized time servers separated by commas. Click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000371","gid":"V-VCSA-80-000158","rid":"SV-VCSA-80-000158","stig_id":"VCSA-80-000158","cci":["CCI-001891"],"nist":["AU-8 (1) (a)"]},"code":"control 'VCSA-80-000158' do\n  title 'The vCenter Server must compare internal information system clocks at least every 24 hours with an authoritative time server.'\n  desc  \"\n    Inaccurate time stamps make it more difficult to correlate events and can lead to an inaccurate analysis. Determining the correct time a particular event occurred on a system is critical when conducting forensic analysis and investigating system events. Sources outside of the configured acceptable allowance (drift) may be inaccurate. Additionally, unnecessary synchronization may have an adverse impact on system performance and may indicate malicious activity.\n\n    Synchronizing internal information system clocks to an authoritative time server provides uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Time\\\" on the left navigation pane.\n\n    On the resulting pane on the right, verify at least one authorized time server is configured and is listed as \\\"Reachable\\\".\n\n    If \\\"NTP\\\" is not enabled and at least one authorized time server configured, this is a finding.\n  \"\n  desc 'fix', \"\n    Open the VAMI by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with an SSO account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Time\\\" on the left navigation pane.\n\n    On the resulting pane on the right, click \\\"Edit\\\" under \\\"Time Synchronization\\\".\n\n    Select \\\"NTP\\\" for \\\"Mode\\\" and enter a list of authorized time servers separated by commas. Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000371'\n  tag gid: 'V-VCSA-80-000158'\n  tag rid: 'SV-VCSA-80-000158'\n  tag stig_id: 'VCSA-80-000158'\n  tag cci: ['CCI-001891']\n  tag nist: ['AU-8 (1) (a)']\n\n  command = 'Invoke-GetTimesync'\n  timesync = powercli_command(command).stdout.strip\n\n  if timesync == 'NTP'\n    ntpserverscommand = 'Invoke-GetNtp'\n    ntpservers = powercli_command(ntpserverscommand).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n    ntpservers.each do |server|\n      describe server do\n        subject { server }\n        it { should be_in input('ntpServers') }\n      end\n      ntpstatuscommand = \"Initialize-NtpTestRequestBody -Servers #{server} | Invoke-TestNtp | Select-Object -ExpandProperty status\"\n      ntpstatus = powercli_command(ntpstatuscommand).stdout.strip\n      describe ntpstatus do\n        subject { ntpstatus }\n        it { should cmp 'SERVER_REACHABLE' }\n      end\n    end\n  else\n    describe \"Timesync Configuration: #{timesync}\" do\n      subject { timesync }\n      it { should cmp 'NTP' }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000158.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000195","title":"The vCenter Server Machine Secure Sockets Layer (SSL) certificate must be issued by a DOD certificate authority.","desc":"Untrusted certificate authorities (CA) can issue certificates, but they may be issued by organizations or individuals that seek to compromise DOD systems or by organizations with insufficient security controls. If the CA used for verifying the certificate is not a DOD-approved CA, trust of this CA has not been established.\n\nThe DOD will only accept public key infrastructure (PKI) certificates obtained from a DOD-approved internal or external certificate authority. Reliance on CAs for the establishment of secure sessions includes, for example, the use of Transport Layer Security (TLS) certificates.\n\nThe default self-signed, VMware Certificate Authority (VMCA)-issued vCenter reverse proxy certificate must be replaced with a DOD-approved certificate. The use of a DOD certificate on the vCenter reverse proxy and other services assures clients that the service they are connecting to is legitimate and trusted.","descriptions":[{"label":"default","data":"Untrusted certificate authorities (CA) can issue certificates, but they may be issued by organizations or individuals that seek to compromise DOD systems or by organizations with insufficient security controls. If the CA used for verifying the certificate is not a DOD-approved CA, trust of this CA has not been established.\n\nThe DOD will only accept public key infrastructure (PKI) certificates obtained from a DOD-approved internal or external certificate authority. Reliance on CAs for the establishment of secure sessions includes, for example, the use of Transport Layer Security (TLS) certificates.\n\nThe default self-signed, VMware Certificate Authority (VMCA)-issued vCenter reverse proxy certificate must be replaced with a DOD-approved certificate. The use of a DOD certificate on the vCenter reverse proxy and other services assures clients that the service they are connecting to is legitimate and trusted."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\nClick \"View Details\" and examine the \"Issuer Information\" block.\n\nIf the issuer specified is not a DOD approved certificate authority, this is a finding."},{"label":"fix","data":"Obtain a DOD-issued certificate and private key for each vCenter in the system following the requirements below:\n\nKey size: 2048 bits or more (PEM encoded)\nCRT format (Base-64)\nx509 version 3\nSubjectAltName must contain DNS Name=<machine_FQDN>\nContains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\nExport the entire certificate issuing chain up to the root in Base-64 format. Concatenate the individual certificates into one file with the \".cer\" extension.\n\nFrom the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\nClick Actions >> Import and Replace Certificate.\n\nSelect the \"Replace with external CA certificate\" radio button and click \"Next\".\n\nSupply the CA-issued certificate , the exported roots file, and the private key.\n\nClick \"Replace\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000427","gid":"V-VCSA-80-000195","rid":"SV-VCSA-80-000195","stig_id":"VCSA-80-000195","cci":["CCI-002470"],"nist":["SC-23 (5)"]},"code":"control 'VCSA-80-000195' do\n  title 'The vCenter Server Machine Secure Sockets Layer (SSL) certificate must be issued by a DOD certificate authority.'\n  desc  \"\n    Untrusted certificate authorities (CA) can issue certificates, but they may be issued by organizations or individuals that seek to compromise DOD systems or by organizations with insufficient security controls. If the CA used for verifying the certificate is not a DOD-approved CA, trust of this CA has not been established.\n\n    The DOD will only accept public key infrastructure (PKI) certificates obtained from a DOD-approved internal or external certificate authority. Reliance on CAs for the establishment of secure sessions includes, for example, the use of Transport Layer Security (TLS) certificates.\n\n    The default self-signed, VMware Certificate Authority (VMCA)-issued vCenter reverse proxy certificate must be replaced with a DOD-approved certificate. The use of a DOD certificate on the vCenter reverse proxy and other services assures clients that the service they are connecting to is legitimate and trusted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\n    Click \\\"View Details\\\" and examine the \\\"Issuer Information\\\" block.\n\n    If the issuer specified is not a DOD approved certificate authority, this is a finding.\n  \"\n  desc 'fix', \"\n    Obtain a DOD-issued certificate and private key for each vCenter in the system following the requirements below:\n\n    Key size: 2048 bits or more (PEM encoded)\n    CRT format (Base-64)\n    x509 version 3\n    SubjectAltName must contain DNS Name=<machine_FQDN>\n    Contains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\n    Export the entire certificate issuing chain up to the root in Base-64 format. Concatenate the individual certificates into one file with the \\\".cer\\\" extension.\n\n    From the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\n    Click Actions >> Import and Replace Certificate.\n\n    Select the \\\"Replace with external CA certificate\\\" radio button and click \\\"Next\\\".\n\n    Supply the CA-issued certificate , the exported roots file, and the private key.\n\n    Click \\\"Replace\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000427'\n  tag gid: 'V-VCSA-80-000195'\n  tag rid: 'SV-VCSA-80-000195'\n  tag stig_id: 'VCSA-80-000195'\n  tag cci: ['CCI-002470']\n  tag nist: ['SC-23 (5)']\n\n  vcenter = powercli_command('$global:DefaultViServers.Name').stdout.strip\n  describe ssl_certificate(host: \"#{vcenter}\", port: 443) do\n    its('issuer_organization') { should cmp 'U.S. Government' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000195.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000196","title":"The vCenter Server must enable data at rest encryption for vSAN.","desc":"Applications handling data requiring \"data at rest\" protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest.\n\nData encryption is a common technique used in environments that require additional levels of security.  It consists of a process to ensure that data can only be consumed by systems that have appropriate levels of access.  Approved systems must have and use the appropriate cryptographic keys to encrypt and decrypt the data.  Systems that do not have the keys will not be able to consume the data in any meaningful way, as it will remain encrypted in accordance to the commonly used Advanced Encryption Standard (AES) from the National Institute of Standards and Technology, or NIST.\n\nvSAN supports Data-At-Rest Encryption and Data-in-Transit Encryption and uses an AES 256 cipher. Data is encrypted after all other processing, such as deduplication, is performed. Data at rest encryption protects data on storage devices, in case a device is removed from the cluster.","descriptions":[{"label":"default","data":"Applications handling data requiring \"data at rest\" protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest.\n\nData encryption is a common technique used in environments that require additional levels of security.  It consists of a process to ensure that data can only be consumed by systems that have appropriate levels of access.  Approved systems must have and use the appropriate cryptographic keys to encrypt and decrypt the data.  Systems that do not have the keys will not be able to consume the data in any meaningful way, as it will remain encrypted in accordance to the commonly used Advanced Encryption Standard (AES) from the National Institute of Standards and Technology, or NIST.\n\nvSAN supports Data-At-Rest Encryption and Data-in-Transit Encryption and uses an AES 256 cipher. Data is encrypted after all other processing, such as deduplication, is performed. Data at rest encryption protects data on storage devices, in case a device is removed from the cluster."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\nReview the \"Data-at-rest encryption\" status.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Get-VsanClusterConfiguration | Select-Object Name,EncryptionEnabled\n\nIf \"Data-At-Rest encryption\" is not enabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\nClick \"Edit\".\n\nEnable \"Data-At-Rest encryption\" and select a pre-configured key provider from the drop down. Click \"Apply\".\n\nNote: Before enabling, read and understand the operational implications of enabling data at rest encryption in vSAN and how it effects capacity, performance, and recovery scenarios."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000428","gid":"V-VCSA-80-000196","rid":"SV-VCSA-80-000196","stig_id":"VCSA-80-000196","cci":["CCI-002475"],"nist":["SC-28 (1)"]},"code":"control 'VCSA-80-000196' do\n  title 'The vCenter Server must enable data at rest encryption for vSAN.'\n  desc  \"\n    Applications handling data requiring \\\"data at rest\\\" protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest.\n\n    Data encryption is a common technique used in environments that require additional levels of security.  It consists of a process to ensure that data can only be consumed by systems that have appropriate levels of access.  Approved systems must have and use the appropriate cryptographic keys to encrypt and decrypt the data.  Systems that do not have the keys will not be able to consume the data in any meaningful way, as it will remain encrypted in accordance to the commonly used Advanced Encryption Standard (AES) from the National Institute of Standards and Technology, or NIST.\n\n    vSAN supports Data-At-Rest Encryption and Data-in-Transit Encryption and uses an AES 256 cipher. Data is encrypted after all other processing, such as deduplication, is performed. Data at rest encryption protects data on storage devices, in case a device is removed from the cluster.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Review the \\\"Data-at-rest encryption\\\" status.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Get-VsanClusterConfiguration | Select-Object Name,EncryptionEnabled\n\n    If \\\"Data-At-Rest encryption\\\" is not enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Click \\\"Edit\\\".\n\n    Enable \\\"Data-At-Rest encryption\\\" and select a pre-configured key provider from the drop down. Click \\\"Apply\\\".\n\n    Note: Before enabling, read and understand the operational implications of enabling data at rest encryption in vSAN and how it effects capacity, performance, and recovery scenarios.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000428'\n  tag gid: 'V-VCSA-80-000196'\n  tag rid: 'SV-VCSA-80-000196'\n  tag stig_id: 'VCSA-80-000196'\n  tag cci: ['CCI-002475']\n  tag nist: ['SC-28 (1)']\n\n  # Get all clusters with vSAN enabled\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object | Select-Object -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !clusters.empty?\n    clusters.each do |cluster|\n      command = \"Get-Cluster -Name #{cluster} | Get-VsanClusterConfiguration | Select-Object -ExpandProperty EncryptionEnabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No clusters with vSAN enabled found...skipping tests' do\n      skip 'No clusters with vSAN enabled found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000196.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000248","title":"The vCenter Server must disable the Customer Experience Improvement Program (CEIP).","desc":"The VMware CEIP sends VMware anonymized system information that is used to improve the quality, reliability, and functionality of VMware products and services. For confidentiality purposes this feature must be disabled.","descriptions":[{"label":"default","data":"The VMware CEIP sends VMware anonymized system information that is used to improve the quality, reliability, and functionality of VMware products and services. For confidentiality purposes this feature must be disabled."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\nIf Customer Experience Improvement \"Program Status\" is \"Joined\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\nClick \"Leave Program\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000248","rid":"SV-VCSA-80-000248","stig_id":"VCSA-80-000248","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000248' do\n  title 'The vCenter Server must disable the Customer Experience Improvement Program (CEIP).'\n  desc  'The VMware CEIP sends VMware anonymized system information that is used to improve the quality, reliability, and functionality of VMware products and services. For confidentiality purposes this feature must be disabled.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\n    If Customer Experience Improvement \\\"Program Status\\\" is \\\"Joined\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\n    Click \\\"Leave Program\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000248'\n  tag rid: 'SV-VCSA-80-000248'\n  tag stig_id: 'VCSA-80-000248'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000248.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000253","title":"The vCenter server must enforce SNMPv3 security features where SNMP is required.","desc":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. SNMPv3 can be configured for identification and cryptographically based authentication.\n\nSNMPv3 defines a user-based security model (USM) and a view-based access control model (VACM). SNMPv3 USM provides data integrity, data origin authentication, message replay protection, and protection against disclosure of the message payload. SNMPv3 VACM provides access control to determine whether a specific type of access (read or write) to the management information is allowed. Implement both VACM and USM for full protection.\n\nSNMPv3 must be disabled by default and enabled only if used. SNMP v3 provides security feature enhancements to SNMP, including encryption and message authentication.","descriptions":[{"label":"default","data":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. SNMPv3 can be configured for identification and cryptographically based authentication.\n\nSNMPv3 defines a user-based security model (USM) and a view-based access control model (VACM). SNMPv3 USM provides data integrity, data origin authentication, message replay protection, and protection against disclosure of the message payload. SNMPv3 VACM provides access control to determine whether a specific type of access (read or write) to the management information is allowed. Implement both VACM and USM for full protection.\n\nSNMPv3 must be disabled by default and enabled only if used. SNMP v3 provides security feature enhancements to SNMP, including encryption and message authentication."},{"label":"rationale","data":""},{"label":"check","data":"At the command prompt on the vCenter Server Appliance, run the following commands:\n\n# appliancesh\n# snmp.get\n\nNote: The \"appliancesh\" command is not needed if the default shell has not been changed for root.\n\nIf \"Enable\" is set to \"False\", this is not a finding.\n\nIf \"Enable\" is set to \"True\" and \"Authentication\" is not set to \"SHA1\", this is a finding.\n\nIf \"Enable\" is set to \"True\" and \"Privacy\" is not set to \"AES128\", this is a finding.\n\nIf any \"Users\" are configured with a \"Sec_level\" that does not equal \"priv\", this is a finding."},{"label":"fix","data":"At the command prompt on the vCenter Server Appliance, run the following commands:\n\n# appliancesh\n# snmp.set --authentication SHA1\n# snmp.set --privacy AES128\n\nTo change the security level of a user, run the following command:\n\n# snmp.set --users <username>/<auth_password> <priv_password>/priv"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000575","gid":"V-VCSA-80-000253","rid":"SV-VCSA-80-000253","stig_id":"VCSA-80-000253","cci":["CCI-001967"],"nist":["IA-3 (1)"]},"code":"control 'VCSA-80-000253' do\n  title 'The vCenter server must enforce SNMPv3 security features where SNMP is required.'\n  desc  \"\n    SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. SNMPv3 can be configured for identification and cryptographically based authentication.\n\n    SNMPv3 defines a user-based security model (USM) and a view-based access control model (VACM). SNMPv3 USM provides data integrity, data origin authentication, message replay protection, and protection against disclosure of the message payload. SNMPv3 VACM provides access control to determine whether a specific type of access (read or write) to the management information is allowed. Implement both VACM and USM for full protection.\n\n    SNMPv3 must be disabled by default and enabled only if used. SNMP v3 provides security feature enhancements to SNMP, including encryption and message authentication.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    At the command prompt on the vCenter Server Appliance, run the following commands:\n\n    # appliancesh\n    # snmp.get\n\n    Note: The \\\"appliancesh\\\" command is not needed if the default shell has not been changed for root.\n\n    If \\\"Enable\\\" is set to \\\"False\\\", this is not a finding.\n\n    If \\\"Enable\\\" is set to \\\"True\\\" and \\\"Authentication\\\" is not set to \\\"SHA1\\\", this is a finding.\n\n    If \\\"Enable\\\" is set to \\\"True\\\" and \\\"Privacy\\\" is not set to \\\"AES128\\\", this is a finding.\n\n    If any \\\"Users\\\" are configured with a \\\"Sec_level\\\" that does not equal \\\"priv\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    At the command prompt on the vCenter Server Appliance, run the following commands:\n\n    # appliancesh\n    # snmp.set --authentication SHA1\n    # snmp.set --privacy AES128\n\n    To change the security level of a user, run the following command:\n\n    # snmp.set --users <username>/<auth_password> <priv_password>/priv\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000575'\n  tag gid: 'V-VCSA-80-000253'\n  tag rid: 'SV-VCSA-80-000253'\n  tag stig_id: 'VCSA-80-000253'\n  tag cci: ['CCI-001967']\n  tag nist: ['IA-3 (1)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000253.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000265","title":"The vCenter server must disable SNMPv1/2 receivers.","desc":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. Therefore, SNMPv1/2 receivers must be disabled, while SNMPv3 is configured in another control. vCenter exposes SNMP v1/2 in the UI and SNMPv3 in the CLI.","descriptions":[{"label":"default","data":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. Therefore, SNMPv1/2 receivers must be disabled, while SNMPv3 is configured in another control. vCenter exposes SNMP v1/2 in the UI and SNMPv3 in the CLI."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick \"Edit\".\n\nOn the \"SNMP receivers\" tab, note the presence of any enabled receiver.\n\nIf there are any enabled receivers, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick \"Edit\".\n\nOn the \"SNMP receivers\" tab, ensure all receivers are disabled."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000575","gid":"V-VCSA-80-000265","rid":"SV-VCSA-80-000265","stig_id":"VCSA-80-000265","cci":["CCI-001967"],"nist":["IA-3 (1)"]},"code":"control 'VCSA-80-000265' do\n  title 'The vCenter server must disable SNMPv1/2 receivers.'\n  desc  'SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. Therefore, SNMPv1/2 receivers must be disabled, while SNMPv3 is configured in another control. vCenter exposes SNMP v1/2 in the UI and SNMPv3 in the CLI.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click \\\"Edit\\\".\n\n    On the \\\"SNMP receivers\\\" tab, note the presence of any enabled receiver.\n\n    If there are any enabled receivers, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click \\\"Edit\\\".\n\n    On the \\\"SNMP receivers\\\" tab, ensure all receivers are disabled.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000575'\n  tag gid: 'V-VCSA-80-000265'\n  tag rid: 'SV-VCSA-80-000265'\n  tag stig_id: 'VCSA-80-000265'\n  tag cci: ['CCI-001967']\n  tag nist: ['IA-3 (1)']\n\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.1.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.2.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.3.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.4.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000265.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000266","title":"The vCenter Server must require an administrator to unlock an account locked due to excessive login failures.","desc":"By requiring that Single Sign-On (SSO) accounts be unlocked manually, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. When the account unlock time is set to zero, once an account is locked it can only be unlocked manually by an administrator.","descriptions":[{"label":"default","data":"By requiring that Single Sign-On (SSO) accounts be unlocked manually, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. When the account unlock time is set to zero, once an account is locked it can only be unlocked manually by an administrator."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nView the value of the \"Unlock time\" setting.\n\nUnlock time: 0 seconds\n\nIf the lockout policy is not configured with \"Unlock time\" policy of \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nClick \"Edit\".\n\nSet the \"Unlock time\" to \"0\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000345","gid":"V-VCSA-80-000266","rid":"SV-VCSA-80-000266","stig_id":"VCSA-80-000266","cci":["CCI-002238"],"nist":["AC-7 b"]},"code":"control 'VCSA-80-000266' do\n  title 'The vCenter Server must require an administrator to unlock an account locked due to excessive login failures.'\n  desc  'By requiring that Single Sign-On (SSO) accounts be unlocked manually, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. When the account unlock time is set to zero, once an account is locked it can only be unlocked manually by an administrator.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    View the value of the \\\"Unlock time\\\" setting.\n\n    Unlock time: 0 seconds\n\n    If the lockout policy is not configured with \\\"Unlock time\\\" policy of \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Unlock time\\\" to \\\"0\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000345'\n  tag gid: 'V-VCSA-80-000266'\n  tag rid: 'SV-VCSA-80-000266'\n  tag stig_id: 'VCSA-80-000266'\n  tag cci: ['CCI-002238']\n  tag nist: ['AC-7 b']\n\n  command = '(Get-SsoLockoutPolicy).AutoUnlockIntervalSec'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp '0' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000266.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000267","title":"The vCenter Server must disable the distributed virtual switch health check.","desc":"Network health check is disabled by default. Once enabled, the health check packets contain information on host#, vds#, and port#, which an attacker would find useful. It is recommended that network health check be used for troubleshooting and turned off when troubleshooting is finished.","descriptions":[{"label":"default","data":"Network health check is disabled by default. Once enabled, the health check packets contain information on host#, vds#, and port#, which an attacker would find useful. It is recommended that network health check be used for troubleshooting and turned off when troubleshooting is finished."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Health Check.\n\nView the health check pane and verify the \"VLAN and MTU\" and \"Teaming and failover\" checks are \"Disabled\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$vds = Get-VDSwitch\n$vds.ExtensionData.Config.HealthCheckConfig\n\nIf the health check feature is enabled on distributed switches and is not on temporarily for troubleshooting purposes, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Health Check.\n\nClick \"Edit\".\n\nDisable the \"VLAN and MTU\" and \"Teaming and failover\" checks.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-View -ViewType DistributedVirtualSwitch | ?{($_.config.HealthCheckConfig | ?{$_.enable -notmatch \"False\"})}| %{$_.UpdateDVSHealthCheckConfig(@((New-Object Vmware.Vim.VMwareDVSVlanMtuHealthCheckConfig -property @{enable=0}),(New-Object Vmware.Vim.VMwareDVSTeamingHealthCheckConfig -property @{enable=0})))}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000267","rid":"SV-VCSA-80-000267","stig_id":"VCSA-80-000267","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000267' do\n  title 'The vCenter Server must disable the distributed virtual switch health check.'\n  desc  'Network health check is disabled by default. Once enabled, the health check packets contain information on host#, vds#, and port#, which an attacker would find useful. It is recommended that network health check be used for troubleshooting and turned off when troubleshooting is finished.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Health Check.\n\n    View the health check pane and verify the \\\"VLAN and MTU\\\" and \\\"Teaming and failover\\\" checks are \\\"Disabled\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $vds = Get-VDSwitch\n    $vds.ExtensionData.Config.HealthCheckConfig\n\n    If the health check feature is enabled on distributed switches and is not on temporarily for troubleshooting purposes, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Health Check.\n\n    Click \\\"Edit\\\".\n\n    Disable the \\\"VLAN and MTU\\\" and \\\"Teaming and failover\\\" checks.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-View -ViewType DistributedVirtualSwitch | ?{($_.config.HealthCheckConfig | ?{$_.enable -notmatch \\\"False\\\"})}| %{$_.UpdateDVSHealthCheckConfig(@((New-Object Vmware.Vim.VMwareDVSVlanMtuHealthCheckConfig -property @{enable=0}),(New-Object Vmware.Vim.VMwareDVSTeamingHealthCheckConfig -property @{enable=0})))}\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000267'\n  tag rid: 'SV-VCSA-80-000267'\n  tag stig_id: 'VCSA-80-000267'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.HealthCheckConfig | Select-Object -ExpandProperty Enable\"\n      checks = powercli_command(command)\n      checks.stdout.split.each do |hc|\n        describe \"Health check for #{vds}\" do\n          subject { hc }\n          it { should cmp 'false' }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000267.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000268","title":"The vCenter Server must set the distributed port group Forged Transmits policy to \"Reject\".","desc":"If the virtual machine operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nWhen the \"Forged Transmits\" option is set to \"Accept\", ESXi does not compare source and effective MAC addresses.\n\nTo protect against MAC impersonation, set the \"Forged Transmits\" option to \"Reject\". The host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to determine if they match. If the addresses do not match, the ESXi host drops the packet.","descriptions":[{"label":"default","data":"If the virtual machine operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nWhen the \"Forged Transmits\" option is set to \"Accept\", ESXi does not compare source and effective MAC addresses.\n\nTo protect against MAC impersonation, set the \"Forged Transmits\" option to \"Reject\". The host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to determine if they match. If the addresses do not match, the ESXi host drops the packet."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nVerify \"Forged Transmits\" is set to \"Reject\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\nIf the \"Forged Transmits\" policy is set to accept for a non-uplink port, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Security\" tab.\n\nSet \"Forged Transmits\" to \"Reject\".\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000268","rid":"SV-VCSA-80-000268","stig_id":"VCSA-80-000268","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000268' do\n  title 'The vCenter Server must set the distributed port group Forged Transmits policy to \"Reject\".'\n  desc  \"\n    If the virtual machine operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    When the \\\"Forged Transmits\\\" option is set to \\\"Accept\\\", ESXi does not compare source and effective MAC addresses.\n\n    To protect against MAC impersonation, set the \\\"Forged Transmits\\\" option to \\\"Reject\\\". The host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to determine if they match. If the addresses do not match, the ESXi host drops the packet.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Verify \\\"Forged Transmits\\\" is set to \\\"Reject\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\n    If the \\\"Forged Transmits\\\" policy is set to accept for a non-uplink port, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Security\\\" tab.\n\n    Set \\\"Forged Transmits\\\" to \\\"Reject\\\".\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000268'\n  tag rid: 'SV-VCSA-80-000268'\n  tag stig_id: 'VCSA-80-000268'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000268.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000269","title":"The vCenter Server must set the distributed port group Media Access Control (MAC) Address Change policy to \"Reject\".","desc":"If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent virtual machines from changing their effective MAC address and will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing.","descriptions":[{"label":"default","data":"If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent virtual machines from changing their effective MAC address and will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nVerify \"MAC Address Changes\" is set to \"Reject\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\nIf the \"MAC Address Changes\" policy is set to accept, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Security\" tab.\n\nSet \"MAC Address Changes\" to \"Reject\".\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000269","rid":"SV-VCSA-80-000269","stig_id":"VCSA-80-000269","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000269' do\n  title 'The vCenter Server must set the distributed port group Media Access Control (MAC) Address Change policy to \"Reject\".'\n  desc  \"\n    If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    This will prevent virtual machines from changing their effective MAC address and will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Verify \\\"MAC Address Changes\\\" is set to \\\"Reject\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\n    If the \\\"MAC Address Changes\\\" policy is set to accept, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Security\\\" tab.\n\n    Set \\\"MAC Address Changes\\\" to \\\"Reject\\\".\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000269'\n  tag rid: 'SV-VCSA-80-000269'\n  tag stig_id: 'VCSA-80-000269'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000269.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000270","title":"The vCenter Server must set the distributed port group Promiscuous Mode policy to \"Reject\".","desc":"When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the port group have the potential of reading all packets across that network, meaning only the virtual machines connected to that port group.\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting.","descriptions":[{"label":"default","data":"When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the port group have the potential of reading all packets across that network, meaning only the virtual machines connected to that port group.\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nVerify \"Promiscuous Mode\" is set to \"Reject\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\nIf the \"Promiscuous Mode\" policy is set to accept, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Security\" tab.\n\nSet \"Promiscuous Mode\" to \"Reject\".\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000270","rid":"SV-VCSA-80-000270","stig_id":"VCSA-80-000270","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000270' do\n  title 'The vCenter Server must set the distributed port group Promiscuous Mode policy to \"Reject\".'\n  desc  \"\n    When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the port group have the potential of reading all packets across that network, meaning only the virtual machines connected to that port group.\n\n    Promiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Verify \\\"Promiscuous Mode\\\" is set to \\\"Reject\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\n    If the \\\"Promiscuous Mode\\\" policy is set to accept, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Security\\\" tab.\n\n    Set \\\"Promiscuous Mode\\\" to \\\"Reject\\\".\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000270'\n  tag rid: 'SV-VCSA-80-000270'\n  tag stig_id: 'VCSA-80-000270'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000270.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000271","title":"The vCenter Server must only send NetFlow traffic to authorized collectors.","desc":"The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network, making it easier for a man-in-the-middle attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target Internet Protocols (IPs) are correct.","descriptions":[{"label":"default","data":"The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network, making it easier for a man-in-the-middle attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target Internet Protocols (IPs) are correct."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nTo view NetFlow Collector IPs configured on distributed switches:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> NetFlow.\n\nView the NetFlow pane and verify any collector IP addresses are valid and in use for troubleshooting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | select Name,@{N=\"NetFlowCollectorIPs\";E={$_.ExtensionData.config.IpfixConfig.CollectorIpAddress}}\n\nTo view if NetFlow is enabled on any distributed port groups:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed port group >> Manage >> Settings >> Policies.\n\nGo to \"Monitoring\" and view the NetFlow status.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | Select Name,VirtualSwitch,@{N=\"NetFlowEnabled\";E={$_.Extensiondata.Config.defaultPortConfig.ipfixEnabled.Value}}\n\nIf NetFlow is configured and the collector IP is not known and documented, this is a finding."},{"label":"fix","data":"To remove collector IPs, do the following:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> NetFlow.\n\nClick \"Edit\".\n\nRemove any unknown collector IPs.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$dvs = Get-VDSwitch dvswitch | Get-View\nForEach($vs in $dvs){\n$spec = New-Object VMware.Vim.VMwareDVSConfigSpec\n$spec.configversion = $vs.Config.ConfigVersion\n$spec.IpfixConfig = New-Object VMware.Vim.VMwareIpfixConfig\n$spec.IpfixConfig.CollectorIpAddress = \"\"\n$spec.IpfixConfig.CollectorPort = \"0\"\n$spec.IpfixConfig.ActiveFlowTimeout = \"60\"\n$spec.IpfixConfig.IdleFlowTimeout = \"15\"\n$spec.IpfixConfig.SamplingRate = \"0\"\n$spec.IpfixConfig.InternalFlowsOnly = $False\n$vs.ReconfigureDvs_Task($spec)\n}\n\nNote: This will reset the NetFlow collector configuration back to the defaults.\n\nTo disable NetFlow on a distributed port group, do the following:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Monitoring\" tab.\n\nChange \"NetFlow\" to \"Disabled\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$pgs = Get-VDPortgroup | Get-View\nForEach($pg in $pgs){\n$spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n$spec.configversion = $pg.Config.ConfigVersion\n$spec.defaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting\n$spec.defaultPortConfig.ipfixEnabled = New-Object VMware.Vim.BoolPolicy\n$spec.defaultPortConfig.ipfixEnabled.inherited = $false\n$spec.defaultPortConfig.ipfixEnabled.value = $false\n$pg.ReconfigureDVPortgroup_Task($spec)\n}"}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000271","rid":"SV-VCSA-80-000271","stig_id":"VCSA-80-000271","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000271' do\n  title 'The vCenter Server must only send NetFlow traffic to authorized collectors.'\n  desc  'The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network, making it easier for a man-in-the-middle attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target Internet Protocols (IPs) are correct.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    To view NetFlow Collector IPs configured on distributed switches:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> NetFlow.\n\n    View the NetFlow pane and verify any collector IP addresses are valid and in use for troubleshooting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | select Name,@{N=\\\"NetFlowCollectorIPs\\\";E={$_.ExtensionData.config.IpfixConfig.CollectorIpAddress}}\n\n    To view if NetFlow is enabled on any distributed port groups:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed port group >> Manage >> Settings >> Policies.\n\n    Go to \\\"Monitoring\\\" and view the NetFlow status.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | Select Name,VirtualSwitch,@{N=\\\"NetFlowEnabled\\\";E={$_.Extensiondata.Config.defaultPortConfig.ipfixEnabled.Value}}\n\n    If NetFlow is configured and the collector IP is not known and documented, this is a finding.\n  \"\n  desc 'fix', \"\n    To remove collector IPs, do the following:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> NetFlow.\n\n    Click \\\"Edit\\\".\n\n    Remove any unknown collector IPs.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $dvs = Get-VDSwitch dvswitch | Get-View\n    ForEach($vs in $dvs){\n    $spec = New-Object VMware.Vim.VMwareDVSConfigSpec\n    $spec.configversion = $vs.Config.ConfigVersion\n    $spec.IpfixConfig = New-Object VMware.Vim.VMwareIpfixConfig\n    $spec.IpfixConfig.CollectorIpAddress = \\\"\\\"\n    $spec.IpfixConfig.CollectorPort = \\\"0\\\"\n    $spec.IpfixConfig.ActiveFlowTimeout = \\\"60\\\"\n    $spec.IpfixConfig.IdleFlowTimeout = \\\"15\\\"\n    $spec.IpfixConfig.SamplingRate = \\\"0\\\"\n    $spec.IpfixConfig.InternalFlowsOnly = $False\n    $vs.ReconfigureDvs_Task($spec)\n    }\n\n    Note: This will reset the NetFlow collector configuration back to the defaults.\n\n    To disable NetFlow on a distributed port group, do the following:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Monitoring\\\" tab.\n\n    Change \\\"NetFlow\\\" to \\\"Disabled\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $pgs = Get-VDPortgroup | Get-View\n    ForEach($pg in $pgs){\n    $spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n    $spec.configversion = $pg.Config.ConfigVersion\n    $spec.defaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting\n    $spec.defaultPortConfig.ipfixEnabled = New-Object VMware.Vim.BoolPolicy\n    $spec.defaultPortConfig.ipfixEnabled.inherited = $false\n    $spec.defaultPortConfig.ipfixEnabled.value = $false\n    $pg.ReconfigureDVPortgroup_Task($spec)\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000271'\n  tag rid: 'SV-VCSA-80-000271'\n  tag stig_id: 'VCSA-80-000271'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.strip.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  if vdswitches.empty?\n    impact 0.0\n    describe '' do\n      skip 'No distributed switches found to check. This is not applicable.'\n    end\n  else\n    setimpact = true\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.IpfixConfig.CollectorIpAddress\"\n      result = powercli_command(command).stdout.strip\n      if !result.empty?\n        describe '' do\n          subject { result }\n          it { should cmp \"#{input('ipfixCollectorAddress')}\" }\n        end\n        setimpact = false\n      else\n        describe '' do\n          skip \"Ipfix CollectorIpAddress not configured...skipping #{vds}.\"\n        end\n      end\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000271.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000272","title":"The vCenter Server must configure all port groups to a value other than that of the native virtual local area network (VLAN).","desc":"ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up belonging to native VLAN of the physical switch.\n\nFor example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a \"1\"; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a \"1\" instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged).\n\nIf the ESXi virtual switch port group uses the native VLAN ID, traffic from those virtual machines will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic.","descriptions":[{"label":"default","data":"ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up belonging to native VLAN of the physical switch.\n\nFor example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a \"1\"; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a \"1\" instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged).\n\nIf the ESXi virtual switch port group uses the native VLAN ID, traffic from those virtual machines will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nReview the port group VLAN tags and verify they are not set to the native VLAN ID of the attached physical switch.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | select Name, VlanConfiguration\n\nIf any port group is configured with the native VLAN of the ESXi hosts attached physical switch, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab.\n\nChange the VLAN ID to a non-native VLAN.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup \"portgroup name\" | Set-VDVlanConfiguration -VlanId \"New VLAN#\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000272","rid":"SV-VCSA-80-000272","stig_id":"VCSA-80-000272","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000272' do\n  title 'The vCenter Server must configure all port groups to a value other than that of the native virtual local area network (VLAN).'\n  desc  \"\n    ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up belonging to native VLAN of the physical switch.\n\n    For example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a \\\"1\\\"; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a \\\"1\\\" instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged).\n\n    If the ESXi virtual switch port group uses the native VLAN ID, traffic from those virtual machines will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Review the port group VLAN tags and verify they are not set to the native VLAN ID of the attached physical switch.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | select Name, VlanConfiguration\n\n    If any port group is configured with the native VLAN of the ESXi hosts attached physical switch, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab.\n\n    Change the VLAN ID to a non-native VLAN.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup \\\"portgroup name\\\" | Set-VDVlanConfiguration -VlanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000272'\n  tag rid: 'SV-VCSA-80-000272'\n  tag stig_id: 'VCSA-80-000272'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not cmp '1' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000272.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000273","title":"The vCenter Server must not configure VLAN Trunking unless Virtual Guest Tagging (VGT) is required and authorized.","desc":"When a port group is set to VLAN Trunking, the vSwitch passes all network frames in the specified range to the attached virtual machines without modifying the virtual local area network (VLAN) tags. In vSphere, this is referred to as VGT.\n\nThe virtual machine must process the VLAN information itself via an 802.1Q driver in the operating system. VLAN Trunking must only be implemented if the attached virtual machines have been specifically authorized and are capable of managing VLAN tags themselves.\n\nIf VLAN Trunking is enabled inappropriately, it may cause a denial of service or allow a virtual machine to interact with traffic on an unauthorized VLAN.","descriptions":[{"label":"default","data":"When a port group is set to VLAN Trunking, the vSwitch passes all network frames in the specified range to the attached virtual machines without modifying the virtual local area network (VLAN) tags. In vSphere, this is referred to as VGT.\n\nThe virtual machine must process the VLAN information itself via an 802.1Q driver in the operating system. VLAN Trunking must only be implemented if the attached virtual machines have been specifically authorized and are capable of managing VLAN tags themselves.\n\nIf VLAN Trunking is enabled inappropriately, it may cause a denial of service or allow a virtual machine to interact with traffic on an unauthorized VLAN."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nReview the port group \"VLAN Type\" and \"VLAN trunk range\", if present.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | Where {$_.ExtensionData.Config.Uplink -ne \"True\"} | Select Name,VlanConfiguration\n\nIf any port group is configured with \"VLAN trunking\" and is not documented as a needed exception (such as NSX appliances), this is a finding.\n\nIf any port group is authorized to be configured with \"VLAN trunking\" but is not configured with the most limited range necessary, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab.\n\nIf \"VLAN trunking\" is not authorized, remove it by setting \"VLAN type\" to \"VLAN\" and configure an appropriate VLAN ID. Click \"OK\".\n\nIf \"VLAN trunking\" is authorized but the range is too broad, modify the range in the \"VLAN trunk range\" field to the minimum necessary and authorized range. An example range would be \"1,3-5,8\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command to configure trunking:\n\nGet-VDPortgroup \"Portgroup Name\" | Set-VDVlanConfiguration -VlanTrunkRange \"<VLAN Range(s) comma separated>\"\n\nor\n\nRun this command to configure a single VLAN ID:\n\nGet-VDPortgroup \"Portgroup Name\" | Set-VDVlanConfiguration -VlanId \"<New VLAN#>\""}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000273","rid":"SV-VCSA-80-000273","stig_id":"VCSA-80-000273","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000273' do\n  title 'The vCenter Server must not configure VLAN Trunking unless Virtual Guest Tagging (VGT) is required and authorized.'\n  desc  \"\n    When a port group is set to VLAN Trunking, the vSwitch passes all network frames in the specified range to the attached virtual machines without modifying the virtual local area network (VLAN) tags. In vSphere, this is referred to as VGT.\n\n    The virtual machine must process the VLAN information itself via an 802.1Q driver in the operating system. VLAN Trunking must only be implemented if the attached virtual machines have been specifically authorized and are capable of managing VLAN tags themselves.\n\n    If VLAN Trunking is enabled inappropriately, it may cause a denial of service or allow a virtual machine to interact with traffic on an unauthorized VLAN.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Review the port group \\\"VLAN Type\\\" and \\\"VLAN trunk range\\\", if present.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | Where {$_.ExtensionData.Config.Uplink -ne \\\"True\\\"} | Select Name,VlanConfiguration\n\n    If any port group is configured with \\\"VLAN trunking\\\" and is not documented as a needed exception (such as NSX appliances), this is a finding.\n\n    If any port group is authorized to be configured with \\\"VLAN trunking\\\" but is not configured with the most limited range necessary, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab.\n\n    If \\\"VLAN trunking\\\" is not authorized, remove it by setting \\\"VLAN type\\\" to \\\"VLAN\\\" and configure an appropriate VLAN ID. Click \\\"OK\\\".\n\n    If \\\"VLAN trunking\\\" is authorized but the range is too broad, modify the range in the \\\"VLAN trunk range\\\" field to the minimum necessary and authorized range. An example range would be \\\"1,3-5,8\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command to configure trunking:\n\n    Get-VDPortgroup \\\"Portgroup Name\\\" | Set-VDVlanConfiguration -VlanTrunkRange \\\"<VLAN Range(s) comma separated>\\\"\n\n    or\n\n    Run this command to configure a single VLAN ID:\n\n    Get-VDPortgroup \\\"Portgroup Name\\\" | Set-VDVlanConfiguration -VlanId \\\"<New VLAN#>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000273'\n  tag rid: 'SV-VCSA-80-000273'\n  tag stig_id: 'VCSA-80-000273'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Where-Object {(($_.IsUplink -eq $false) -and ($_.VlanConfiguration -match \"Trunk\"))} | Select-Object -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    impact 0.0\n    describe '' do\n      skip 'No distributed port groups found to check. This is not applicable.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId.Start\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not cmp '0' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId.End\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not cmp '4094' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000273.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000274","title":"The vCenter Server must not configure all port groups to virtual local area network (VLAN) values reserved by upstream physical switches.","desc":"Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001 to 1024 and 4094, while Nexus switches typically reserve 3968 to 4094.\n\nCheck with the documentation for the organization's specific switch. Using a reserved VLAN might result in a denial of service on the network.","descriptions":[{"label":"default","data":"Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001 to 1024 and 4094, while Nexus switches typically reserve 3968 to 4094.\n\nCheck with the documentation for the organization's specific switch. Using a reserved VLAN might result in a denial of service on the network."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nReview the port group VLAN tags and verify that they are not set to a reserved VLAN ID.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | select Name, VlanConfiguration\n\nIf any port group is configured with a reserved VLAN ID, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab. Change the VLAN ID to an unreserved VLAN ID.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup \"portgroup name\" | Set-VDVlanConfiguration -VlanId \"New VLAN#\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000274","rid":"SV-VCSA-80-000274","stig_id":"VCSA-80-000274","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000274' do\n  title 'The vCenter Server must not configure all port groups to virtual local area network (VLAN) values reserved by upstream physical switches.'\n  desc  \"\n    Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001 to 1024 and 4094, while Nexus switches typically reserve 3968 to 4094.\n\n    Check with the documentation for the organization's specific switch. Using a reserved VLAN might result in a denial of service on the network.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Review the port group VLAN tags and verify that they are not set to a reserved VLAN ID.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | select Name, VlanConfiguration\n\n    If any port group is configured with a reserved VLAN ID, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab. Change the VLAN ID to an unreserved VLAN ID.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup \\\"portgroup name\\\" | Set-VDVlanConfiguration -VlanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000274'\n  tag rid: 'SV-VCSA-80-000274'\n  tag stig_id: 'VCSA-80-000274'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vlanlist = ['1001', '1024', '3968', '4047', '4094']\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not be_in vlanlist }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000274.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000275","title":"The vCenter Server must configure the \"vpxuser\" auto-password to be changed every 30 days.","desc":"By default, vCenter will change the \"vpxuser\" password automatically every 30 days. Ensure this setting meets site policies. If it does not, configure it to meet password aging policies.\n\nNote: It is very important the password aging policy is not shorter than the default interval that is set to automatically change the \"vpxuser\" password to preclude the possibility that vCenter might be locked out of an ESXi host.","descriptions":[{"label":"default","data":"By default, vCenter will change the \"vpxuser\" password automatically every 30 days. Ensure this setting meets site policies. If it does not, configure it to meet password aging policies.\n\nNote: It is very important the password aging policy is not shorter than the default interval that is set to automatically change the \"vpxuser\" password to preclude the possibility that vCenter might be locked out of an ESXi host."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify that \"VirtualCenter.VimPasswordExpirationInDays\" is set to \"30\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays\n\nIf the \"VirtualCenter.VimPasswordExpirationInDays\" is set to a value other than \"30\" or does not exist, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"VirtualCenter.VimPasswordExpirationInDays\" value to \"30\" or if the value does not exist create it by entering the values in the \"Key\" and \"Value\" fields and clicking \"Add\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nIf the setting already exists:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays | Set-AdvancedSetting -Value 30\n\nIf the setting does not exist:\n\nNew-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays -Value 30"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000275","rid":"SV-VCSA-80-000275","stig_id":"VCSA-80-000275","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000275' do\n  title 'The vCenter Server must configure the \"vpxuser\" auto-password to be changed every 30 days.'\n  desc  \"\n    By default, vCenter will change the \\\"vpxuser\\\" password automatically every 30 days. Ensure this setting meets site policies. If it does not, configure it to meet password aging policies.\n\n    Note: It is very important the password aging policy is not shorter than the default interval that is set to automatically change the \\\"vpxuser\\\" password to preclude the possibility that vCenter might be locked out of an ESXi host.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify that \\\"VirtualCenter.VimPasswordExpirationInDays\\\" is set to \\\"30\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays\n\n    If the \\\"VirtualCenter.VimPasswordExpirationInDays\\\" is set to a value other than \\\"30\\\" or does not exist, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"VirtualCenter.VimPasswordExpirationInDays\\\" value to \\\"30\\\" or if the value does not exist create it by entering the values in the \\\"Key\\\" and \\\"Value\\\" fields and clicking \\\"Add\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    If the setting already exists:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays | Set-AdvancedSetting -Value 30\n\n    If the setting does not exist:\n\n    New-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays -Value 30\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000275'\n  tag rid: 'SV-VCSA-80-000275'\n  tag stig_id: 'VCSA-80-000275'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name VirtualCenter.VimPasswordExpirationInDays | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp '30' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000275.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000276","title":"The vCenter Server must configure the \"vpxuser\" password to meet length policy.","desc":"The \"vpxuser\" password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies.\n\nLonger passwords make brute-force password attacks more difficult. The \"vpxuser\" password is added by vCenter, meaning no manual intervention is normally required. The \"vpxuser\" password length must never be modified to less than the default length of 32 characters.","descriptions":[{"label":"default","data":"The \"vpxuser\" password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies.\n\nLonger passwords make brute-force password attacks more difficult. The \"vpxuser\" password is added by vCenter, meaning no manual intervention is normally required. The \"vpxuser\" password length must never be modified to less than the default length of 32 characters."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify that \"config.vpxd.hostPasswordLength\" is set to \"32\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength and verify it is set to 32.\n\nIf the \"config.vpxd.hostPasswordLength\" is set to a value other than \"32, this is a finding.\n\nIf the setting does not exist, this is not a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"config.vpxd.hostPasswordLength\" value to \"32\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength | Set-AdvancedSetting -Value 32"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000276","rid":"SV-VCSA-80-000276","stig_id":"VCSA-80-000276","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000276' do\n  title 'The vCenter Server must configure the \"vpxuser\" password to meet length policy.'\n  desc  \"\n    The \\\"vpxuser\\\" password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies.\n\n    Longer passwords make brute-force password attacks more difficult. The \\\"vpxuser\\\" password is added by vCenter, meaning no manual intervention is normally required. The \\\"vpxuser\\\" password length must never be modified to less than the default length of 32 characters.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify that \\\"config.vpxd.hostPasswordLength\\\" is set to \\\"32\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength and verify it is set to 32.\n\n    If the \\\"config.vpxd.hostPasswordLength\\\" is set to a value other than \\\"32, this is a finding.\n\n    If the setting does not exist, this is not a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"config.vpxd.hostPasswordLength\\\" value to \\\"32\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength | Set-AdvancedSetting -Value 32\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000276'\n  tag rid: 'SV-VCSA-80-000276'\n  tag stig_id: 'VCSA-80-000276'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.vpxd.hostPasswordLength | Select-Object -ExpandProperty Value'\n  describe.one do\n    describe powercli_command(command) do\n      its('stdout.strip') { should cmp '32' }\n    end\n    describe powercli_command(command) do\n      its('stdout.strip') { should be_empty }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000276.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000277","title":"The vCenter Server must be isolated from the public internet but must still allow for patch notification and delivery.","desc":"vCenter and the embedded Lifecycle Manager system must never have a direct route to the internet. Despite this, updates and patches sourced from VMware on the internet must be delivered in a timely manner.\n\nThere are two methods to accomplish this: a proxy server and the Update Manager Download Service (UMDS). UMDS is an optional module for Lifecycle Manager that fetches upgrades for virtual appliances, patch metadata, patch binaries, and notifications that would not otherwise be available to an isolated Lifecycle Manager directly.\n\nAlternatively, a proxy for Lifecycle Manager can be configured to allow controlled, limited access to the public internet for the sole purpose of patch gathering. Either solution mitigates the risk of internet connectivity by limiting its scope and use.","descriptions":[{"label":"default","data":"vCenter and the embedded Lifecycle Manager system must never have a direct route to the internet. Despite this, updates and patches sourced from VMware on the internet must be delivered in a timely manner.\n\nThere are two methods to accomplish this: a proxy server and the Update Manager Download Service (UMDS). UMDS is an optional module for Lifecycle Manager that fetches upgrades for virtual appliances, patch metadata, patch binaries, and notifications that would not otherwise be available to an isolated Lifecycle Manager directly.\n\nAlternatively, a proxy for Lifecycle Manager can be configured to allow controlled, limited access to the public internet for the sole purpose of patch gathering. Either solution mitigates the risk of internet connectivity by limiting its scope and use."},{"label":"rationale","data":""},{"label":"check","data":"Check the following conditions:\n\n1. Lifecycle Manager must be configured to use the UMDS.\n\nOR\n\n2. Lifecycle Manager must be configured to use a proxy server for access to VMware patch repositories.\n\nOR\n\n3. Lifecycle Manager must disable internet patch repositories and any patches must be manually validated and imported as needed.\n\nOption 1:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nVerify the \"Download patches from a UMDS shared repository\" radio button is selected and that a valid UMDS repository is supplied.\n\nClick \"Cancel\".\n\nIf this is not set, this is a finding.\n\nOption 2:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nVerify the \"Download patches directly from the internet\" radio button is selected.\n\nClick \"Cancel\".\n\nNavigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\nVerify that \"HTTPS\" is \"Enabled\".\n\nClick the \"HTTPS\" row.\n\nVerify the proxy server configuration is accurate.\n\nIf this is not set, this is a finding.\n\nOption 3:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\nVerify the \"Automatic downloads\" option is disabled.\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nVerify any download sources are disabled.\n\nIf this is not set, this is a finding."},{"label":"fix","data":"Option 1:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nSelect the \"Download patches from a UMDS shared repository\" radio button and supply a valid UMDS repository.\n\nClick \"Save\".\n\nOption 2:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nSelect the \"Download patches directly from the internet\" radio button.\n\nClick \"Save\".\n\nNavigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\nClick \"Edit\".\n\nSlide \"HTTPS\" to \"Enabled\".\n\nSupply the appropriate proxy server configuration.\n\nClick \"Save\".\n\nOption 3:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\nClick \"Edit\" and uncheck \"Download patches\".\n\nUnder \"Patch Setup\" select each download source and click Disable."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000277","rid":"SV-VCSA-80-000277","stig_id":"VCSA-80-000277","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000277' do\n  title 'The vCenter Server must be isolated from the public internet but must still allow for patch notification and delivery.'\n  desc  \"\n    vCenter and the embedded Lifecycle Manager system must never have a direct route to the internet. Despite this, updates and patches sourced from VMware on the internet must be delivered in a timely manner.\n\n    There are two methods to accomplish this: a proxy server and the Update Manager Download Service (UMDS). UMDS is an optional module for Lifecycle Manager that fetches upgrades for virtual appliances, patch metadata, patch binaries, and notifications that would not otherwise be available to an isolated Lifecycle Manager directly.\n\n    Alternatively, a proxy for Lifecycle Manager can be configured to allow controlled, limited access to the public internet for the sole purpose of patch gathering. Either solution mitigates the risk of internet connectivity by limiting its scope and use.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Check the following conditions:\n\n    1. Lifecycle Manager must be configured to use the UMDS.\n\n    OR\n\n    2. Lifecycle Manager must be configured to use a proxy server for access to VMware patch repositories.\n\n    OR\n\n    3. Lifecycle Manager must disable internet patch repositories and any patches must be manually validated and imported as needed.\n\n    Option 1:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Verify the \\\"Download patches from a UMDS shared repository\\\" radio button is selected and that a valid UMDS repository is supplied.\n\n    Click \\\"Cancel\\\".\n\n    If this is not set, this is a finding.\n\n    Option 2:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Verify the \\\"Download patches directly from the internet\\\" radio button is selected.\n\n    Click \\\"Cancel\\\".\n\n    Navigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\n    Verify that \\\"HTTPS\\\" is \\\"Enabled\\\".\n\n    Click the \\\"HTTPS\\\" row.\n\n    Verify the proxy server configuration is accurate.\n\n    If this is not set, this is a finding.\n\n    Option 3:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\n    Verify the \\\"Automatic downloads\\\" option is disabled.\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Verify any download sources are disabled.\n\n    If this is not set, this is a finding.\n  \"\n  desc 'fix', \"\n    Option 1:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Select the \\\"Download patches from a UMDS shared repository\\\" radio button and supply a valid UMDS repository.\n\n    Click \\\"Save\\\".\n\n    Option 2:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Select the \\\"Download patches directly from the internet\\\" radio button.\n\n    Click \\\"Save\\\".\n\n    Navigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\n    Click \\\"Edit\\\".\n\n    Slide \\\"HTTPS\\\" to \\\"Enabled\\\".\n\n    Supply the appropriate proxy server configuration.\n\n    Click \\\"Save\\\".\n\n    Option 3:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\n    Click \\\"Edit\\\" and uncheck \\\"Download patches\\\".\n\n    Under \\\"Patch Setup\\\" select each download source and click Disable.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000277'\n  tag rid: 'SV-VCSA-80-000277'\n  tag stig_id: 'VCSA-80-000277'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000277.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000278","title":"The vCenter Server must use unique service accounts when applications connect to vCenter.","desc":"To not violate nonrepudiation (i.e., deny the authenticity of who is connecting to vCenter), when applications need to connect to vCenter they must use unique service accounts.","descriptions":[{"label":"default","data":"To not violate nonrepudiation (i.e., deny the authenticity of who is connecting to vCenter), when applications need to connect to vCenter they must use unique service accounts."},{"label":"rationale","data":""},{"label":"check","data":"Verify each external application that connects to vCenter has a unique service account dedicated to that application.\n\nFor example, there should be separate accounts for Log Insight, Operations Manager, or anything else that requires an account to access vCenter.\n\nIf any application shares a service account that is used to connect to vCenter, this is a finding."},{"label":"fix","data":"For applications sharing service accounts, create a new service account to assign to the application so that no application shares a service account with another.\n\nWhen standing up a new application that requires access to vCenter, always create a new service account prior to installation and grant only the permissions needed for that application."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000278","rid":"SV-VCSA-80-000278","stig_id":"VCSA-80-000278","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000278' do\n  title 'The vCenter Server must use unique service accounts when applications connect to vCenter.'\n  desc  'To not violate nonrepudiation (i.e., deny the authenticity of who is connecting to vCenter), when applications need to connect to vCenter they must use unique service accounts.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Verify each external application that connects to vCenter has a unique service account dedicated to that application.\n\n    For example, there should be separate accounts for Log Insight, Operations Manager, or anything else that requires an account to access vCenter.\n\n    If any application shares a service account that is used to connect to vCenter, this is a finding.\n  \"\n  desc  'fix', \"\n    For applications sharing service accounts, create a new service account to assign to the application so that no application shares a service account with another.\n\n    When standing up a new application that requires access to vCenter, always create a new service account prior to installation and grant only the permissions needed for that application.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000278'\n  tag rid: 'SV-VCSA-80-000278'\n  tag stig_id: 'VCSA-80-000278'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000278.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000279","title":"The vCenter Server must protect the confidentiality and integrity of transmitted information by isolating Internet Protocol (IP)-based storage traffic.","desc":"Virtual machines might share virtual switches and virtual local area networks (VLAN) with the IP-based storage configurations.\n\nIP-based storage includes vSAN, Internet Small Computer System Interface (iSCSI), and Network File System (NFS). This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and virtual machines will limit unauthorized users from viewing the traffic.","descriptions":[{"label":"default","data":"Virtual machines might share virtual switches and virtual local area networks (VLAN) with the IP-based storage configurations.\n\nIP-based storage includes vSAN, Internet Small Computer System Interface (iSCSI), and Network File System (NFS). This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and virtual machines will limit unauthorized users from viewing the traffic."},{"label":"rationale","data":""},{"label":"check","data":"If IP-based storage is not used, this is not applicable.\n\nIP-based storage (iSCSI, NFS, vSAN) VMkernel port groups must be in a dedicated VLAN that can be on a standard or distributed virtual switch that is logically separated from other traffic types.\n\nThe check for this will be unique per environment.\n\nTo check a standard switch, do the following:\n\nFrom the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and note the VLAN ID associated with each port group.\n\nVerify it is dedicated to that purpose and is logically separated from other traffic types.\n\nTo check a distributed switch, do the following,\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect and expand a distributed switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to the \"Summary\" tab.\n\nNote the VLAN ID associated with each port group and verify it is dedicated to that purpose and is logically separated from other traffic types.\n\nIf any IP-based storage networks are not isolated from other traffic types, this is a finding."},{"label":"fix","data":"Configuration of an IP-based VMkernel will be unique to each environment.\n\nTo configure VLANs and traffic types, do the following:\n\nStandard switch:\n\nFrom the vSphere Client, select the ESXi host and go to Configure >> Networking >> VMkernel adapters.\n\nSelect the Storage VMkernel (for any IP-based storage). Click \"Edit...\" and click the \"Port properties\" tab.\n\nUncheck everything (unless vSAN).\n\nClick the \"IPv4\" settings or \"IPv6\" settings tab.\n\nEnter the appropriate IP address and subnet information.\n\nClick \"OK\".\n\nFrom the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and click \"...\". Click \"Edit Settings\". On the \"Properties\" tab, enter the appropriate VLAN ID and click \"OK\".\n\nDistributed switch:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Topology.\n\nSelect the Storage VMkernel (for any IP-based storage). Click \"...\" and click \"Edit Settings\".\n\nOn the \"Port properties\" tab, uncheck everything (unless vSAN).\n\nClick the \"IPv4\" settings or \"IPv6\" settings tab.\n\nEnter the appropriate IP address and subnet information.\n\nClick \"OK\".\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect and expand a distributed switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab.\n\nEnter the appropriate VLAN type and ID and click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000279","rid":"SV-VCSA-80-000279","stig_id":"VCSA-80-000279","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000279' do\n  title 'The vCenter Server must protect the confidentiality and integrity of transmitted information by isolating Internet Protocol (IP)-based storage traffic.'\n  desc  \"\n    Virtual machines might share virtual switches and virtual local area networks (VLAN) with the IP-based storage configurations.\n\n    IP-based storage includes vSAN, Internet Small Computer System Interface (iSCSI), and Network File System (NFS). This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\n    To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and virtual machines will limit unauthorized users from viewing the traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If IP-based storage is not used, this is not applicable.\n\n    IP-based storage (iSCSI, NFS, vSAN) VMkernel port groups must be in a dedicated VLAN that can be on a standard or distributed virtual switch that is logically separated from other traffic types.\n\n    The check for this will be unique per environment.\n\n    To check a standard switch, do the following:\n\n    From the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and note the VLAN ID associated with each port group.\n\n    Verify it is dedicated to that purpose and is logically separated from other traffic types.\n\n    To check a distributed switch, do the following,\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select and expand a distributed switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to the \\\"Summary\\\" tab.\n\n    Note the VLAN ID associated with each port group and verify it is dedicated to that purpose and is logically separated from other traffic types.\n\n    If any IP-based storage networks are not isolated from other traffic types, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of an IP-based VMkernel will be unique to each environment.\n\n    To configure VLANs and traffic types, do the following:\n\n    Standard switch:\n\n    From the vSphere Client, select the ESXi host and go to Configure >> Networking >> VMkernel adapters.\n\n    Select the Storage VMkernel (for any IP-based storage). Click \\\"Edit...\\\" and click the \\\"Port properties\\\" tab.\n\n    Uncheck everything (unless vSAN).\n\n    Click the \\\"IPv4\\\" settings or \\\"IPv6\\\" settings tab.\n\n    Enter the appropriate IP address and subnet information.\n\n    Click \\\"OK\\\".\n\n    From the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and click \\\"...\\\". Click \\\"Edit Settings\\\". On the \\\"Properties\\\" tab, enter the appropriate VLAN ID and click \\\"OK\\\".\n\n    Distributed switch:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Topology.\n\n    Select the Storage VMkernel (for any IP-based storage). Click \\\"...\\\" and click \\\"Edit Settings\\\".\n\n    On the \\\"Port properties\\\" tab, uncheck everything (unless vSAN).\n\n    Click the \\\"IPv4\\\" settings or \\\"IPv6\\\" settings tab.\n\n    Enter the appropriate IP address and subnet information.\n\n    Click \\\"OK\\\".\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select and expand a distributed switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab.\n\n    Enter the appropriate VLAN type and ID and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000279'\n  tag rid: 'SV-VCSA-80-000279'\n  tag stig_id: 'VCSA-80-000279'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000279.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000280","title":"The vCenter server must be configured to send events to a central log server.","desc":"vCenter server generates volumes of security-relevant application-level events. Examples include logins, system reconfigurations, system degradation warnings, and more. To ensure these events are available for forensic analysis and correlation, they must be sent to the syslog and forwarded on to the configured Security Information and Event Management (SIEM) system and/or central log server.\n\nThe vCenter server sends events to syslog by default, but this configuration must be verified and maintained.","descriptions":[{"label":"default","data":"vCenter server generates volumes of security-relevant application-level events. Examples include logins, system reconfigurations, system degradation warnings, and more. To ensure these events are available for forensic analysis and correlation, they must be sent to the syslog and forwarded on to the configured Security Information and Event Management (SIEM) system and/or central log server.\n\nThe vCenter server sends events to syslog by default, but this configuration must be verified and maintained."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify that \"vpxd.event.syslog.enabled\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled\n\nIf the \"vpxd.event.syslog.enabled\" value is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"vpxd.event.syslog.enabled\" setting to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled | Set-AdvancedSetting -Value true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000358","gid":"V-VCSA-80-000280","rid":"SV-VCSA-80-000280","stig_id":"VCSA-80-000280","cci":["CCI-001851"],"nist":["AU-4 (1)"]},"code":"control 'VCSA-80-000280' do\n  title 'The vCenter server must be configured to send events to a central log server.'\n  desc  \"\n    vCenter server generates volumes of security-relevant application-level events. Examples include logins, system reconfigurations, system degradation warnings, and more. To ensure these events are available for forensic analysis and correlation, they must be sent to the syslog and forwarded on to the configured Security Information and Event Management (SIEM) system and/or central log server.\n\n    The vCenter server sends events to syslog by default, but this configuration must be verified and maintained.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify that \\\"vpxd.event.syslog.enabled\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled\n\n    If the \\\"vpxd.event.syslog.enabled\\\" value is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"vpxd.event.syslog.enabled\\\" setting to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled | Set-AdvancedSetting -Value true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000358'\n  tag gid: 'V-VCSA-80-000280'\n  tag rid: 'SV-VCSA-80-000280'\n  tag stig_id: 'VCSA-80-000280'\n  tag cci: ['CCI-001851']\n  tag nist: ['AU-4 (1)']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name vpxd.event.syslog.enabled | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'true' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000280.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000281","title":"The vCenter Server must disable or restrict the connectivity between vSAN Health Check and public Hardware Compatibility List (HCL) by use of an external proxy server.","desc":"The vSAN Health Check is able to download the HCL from VMware to check compliance against the underlying vSAN Cluster hosts. To ensure the vCenter server is not directly downloading content from the internet, this functionality must be disabled. If this feature is necessary, an external proxy server must be configured.","descriptions":[{"label":"default","data":"The vSAN Health Check is able to download the HCL from VMware to check compliance against the underlying vSAN Cluster hosts. To ensure the vCenter server is not directly downloading content from the internet, this functionality must be disabled. If this feature is necessary, an external proxy server must be configured."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\nIf the HCL internet download is not required, verify \"Status\" is \"Disabled\".\n\nIf the \"Status\" is \"Enabled\", this is a finding.\n\nIf the HCL internet download is required, verify \"Status\" is \"Enabled\" and a proxy host is configured.\n\nIf \"Status\" is \"Enabled\" and a proxy is not configured, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\nClick \"Edit\".\n\nIf the HCL internet download is not required, ensure that \"Status\" is \"Disabled\".\n\nIf the HCL internet download is required, ensure that \"Status\" is \"Enabled\" and that a proxy host is appropriately configured."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000281","rid":"SV-VCSA-80-000281","stig_id":"VCSA-80-000281","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000281' do\n  title 'The vCenter Server must disable or restrict the connectivity between vSAN Health Check and public Hardware Compatibility List (HCL) by use of an external proxy server.'\n  desc  'The vSAN Health Check is able to download the HCL from VMware to check compliance against the underlying vSAN Cluster hosts. To ensure the vCenter server is not directly downloading content from the internet, this functionality must be disabled. If this feature is necessary, an external proxy server must be configured.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\n    If the HCL internet download is not required, verify \\\"Status\\\" is \\\"Disabled\\\".\n\n    If the \\\"Status\\\" is \\\"Enabled\\\", this is a finding.\n\n    If the HCL internet download is required, verify \\\"Status\\\" is \\\"Enabled\\\" and a proxy host is configured.\n\n    If \\\"Status\\\" is \\\"Enabled\\\" and a proxy is not configured, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\n    Click \\\"Edit\\\".\n\n    If the HCL internet download is not required, ensure that \\\"Status\\\" is \\\"Disabled\\\".\n\n    If the HCL internet download is required, ensure that \\\"Status\\\" is \\\"Enabled\\\" and that a proxy host is appropriately configured.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000281'\n  tag rid: 'SV-VCSA-80-000281'\n  tag stig_id: 'VCSA-80-000281'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  # Get all clusters with vSAN enabled\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object | Select-Object -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !clusters.empty?\n    command = '$vsanphview = Get-VsanView -Id VsanPhoneHomeSystem-vsan-phonehome-system; $vsanphview.QueryVsanCloudHealthStatus().InternetConnectivity'\n    vcinternetenabled = powercli_command(command).stdout.strip\n\n    if vcinternetenabled == 'True'\n      proxycommand = '$vsanhealthview = Get-VsanView -Id VsanVcClusterHealthSystem-vsan-cluster-health-system; $vsanhealthview.VsanHealthQueryVsanProxyConfig().Host'\n      describe powercli_command(proxycommand) do\n        its('stdout.strip') { should_not cmp '' }\n      end\n    else\n      describe 'Enable Internet access for all vSAN clusters.' do\n        subject { vcinternetenabled }\n        it { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No clusters with vSAN enabled found...skipping tests' do\n      skip 'No clusters with vSAN enabled found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000281.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000282","title":"The vCenter Server must configure the vSAN Datastore name to a unique name.","desc":"A vSAN Datastore name by default is \"vsanDatastore\". If more than one vSAN cluster is present in vCenter, both datastores will have the same name by default, potentially leading to confusion and manually misplaced workloads.","descriptions":[{"label":"default","data":"A vSAN Datastore name by default is \"vsanDatastore\". If more than one vSAN cluster is present in vCenter, both datastores will have the same name by default, potentially leading to confusion and manually misplaced workloads."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Datastores.\n\nReview the datastores and identify any datastores with \"vSAN\" as the datastore type.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nIf($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\nWrite-Host \"vSAN Enabled Cluster found\"\nGet-Cluster | where {$_.VsanEnabled} | Get-Datastore | where {$_.type -match \"vsan\"}\n}\nelse{\nWrite-Host \"vSAN is not enabled, this finding is not applicable.\"\n}\n\nIf vSAN is enabled and a datastore is named \"vsanDatastore\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Datastores.\n\nRight-click on the datastore named \"vsanDatastore\" and select \"Rename\".\n\nRename the datastore based on site-specific naming standards.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nIf($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\nWrite-Host \"vSAN Enabled Cluster found\"\n$Clusters = Get-Cluster | where {$_.VsanEnabled}\nForeach ($clus in $clusters){\n $clus | Get-Datastore | where {$_.type -match \"vsan\"} | Set-Datastore -Name $(($clus.name) + \"_vSAN_Datastore\")\n}\n}\nelse{\nWrite-Host \"vSAN is not enabled, this finding is not applicable.\"\n}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000282","rid":"SV-VCSA-80-000282","stig_id":"VCSA-80-000282","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000282' do\n  title 'The vCenter Server must configure the vSAN Datastore name to a unique name.'\n  desc  'A vSAN Datastore name by default is \"vsanDatastore\". If more than one vSAN cluster is present in vCenter, both datastores will have the same name by default, potentially leading to confusion and manually misplaced workloads.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Datastores.\n\n    Review the datastores and identify any datastores with \\\"vSAN\\\" as the datastore type.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    If($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\n    Write-Host \\\"vSAN Enabled Cluster found\\\"\n    Get-Cluster | where {$_.VsanEnabled} | Get-Datastore | where {$_.type -match \\\"vsan\\\"}\n    }\n    else{\n    Write-Host \\\"vSAN is not enabled, this finding is not applicable.\\\"\n    }\n\n    If vSAN is enabled and a datastore is named \\\"vsanDatastore\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Datastores.\n\n    Right-click on the datastore named \\\"vsanDatastore\\\" and select \\\"Rename\\\".\n\n    Rename the datastore based on site-specific naming standards.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    If($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\n    Write-Host \\\"vSAN Enabled Cluster found\\\"\n    $Clusters = Get-Cluster | where {$_.VsanEnabled}\n    Foreach ($clus in $clusters){\n     $clus | Get-Datastore | where {$_.type -match \\\"vsan\\\"} | Set-Datastore -Name $(($clus.name) + \\\"_vSAN_Datastore\\\")\n    }\n    }\n    else{\n    Write-Host \\\"vSAN is not enabled, this finding is not applicable.\\\"\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000282'\n  tag rid: 'SV-VCSA-80-000282'\n  tag stig_id: 'VCSA-80-000282'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-Cluster | Where-Object {$_.VsanEnabled} | Get-Datastore | Where-Object {$_.type -match \"vsan\"} | Select-Object -ExpandProperty Name'\n  vsandatastores = powercli_command(command).stdout.strip.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vsandatastores.empty?\n    describe '' do\n      skip 'No VSAN datastores found to check.'\n    end\n  else\n    vsandatastores.each do |ds|\n      describe '' do\n        subject { ds }\n        it { should_not cmp 'vsanDatastore' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000282.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000283","title":"The vCenter Server must disable Username/Password and Windows Integrated Authentication.","desc":"All forms of authentication other than Common Access Card (CAC) must be disabled. Password authentication can be temporarily reenabled for emergency access to the local Single Sign-On (SSO) accounts or Active Directory user/pass accounts, but it must be disabled as soon as CAC authentication is functional.","descriptions":[{"label":"default","data":"All forms of authentication other than Common Access Card (CAC) must be disabled. Password authentication can be temporarily reenabled for emergency access to the local Single Sign-On (SSO) accounts or Active Directory user/pass accounts, but it must be disabled as soon as CAC authentication is functional."},{"label":"rationale","data":""},{"label":"check","data":"If a federated identity provider is configured and used for an identity source, this is not applicable.\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nUnder \"Authentication method\", examine the allowed methods.\n\nIf \"Smart card authentication\" is not enabled and \"Password and windows session authentication\" is not disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nNext to \"Authentication method\", click \"Edit\".\n\nSelect to radio button to \"Enable smart card authentication\".\n\nClick \"Save\".\n\nTo re-enable password authentication for troubleshooting purposes, run the following command on the vCenter Server Appliance:\n\n# /opt/vmware/bin/sso-config.sh -set_authn_policy -pwdAuthn true -winAuthn false -certAuthn false -securIDAuthn false -t vsphere.local"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000283","rid":"SV-VCSA-80-000283","stig_id":"VCSA-80-000283","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000283' do\n  title 'The vCenter Server must disable Username/Password and Windows Integrated Authentication.'\n  desc  'All forms of authentication other than Common Access Card (CAC) must be disabled. Password authentication can be temporarily reenabled for emergency access to the local Single Sign-On (SSO) accounts or Active Directory user/pass accounts, but it must be disabled as soon as CAC authentication is functional.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If a federated identity provider is configured and used for an identity source, this is not applicable.\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Under \\\"Authentication method\\\", examine the allowed methods.\n\n    If \\\"Smart card authentication\\\" is not enabled and \\\"Password and windows session authentication\\\" is not disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Next to \\\"Authentication method\\\", click \\\"Edit\\\".\n\n    Select to radio button to \\\"Enable smart card authentication\\\".\n\n    Click \\\"Save\\\".\n\n    To re-enable password authentication for troubleshooting purposes, run the following command on the vCenter Server Appliance:\n\n    # /opt/vmware/bin/sso-config.sh -set_authn_policy -pwdAuthn true -winAuthn false -certAuthn false -securIDAuthn false -t vsphere.local\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000283'\n  tag rid: 'SV-VCSA-80-000283'\n  tag stig_id: 'VCSA-80-000283'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  if input('embeddedIdp')\n    describe powercli_command('(Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled') do\n      its('stdout.strip') { should cmp 'true' }\n    end\n    describe powercli_command('(Get-SsoAuthenticationPolicy).PasswordAuthnEnabled') do\n      its('stdout.strip') { should cmp 'false' }\n    end\n    describe powercli_command('(Get-SsoAuthenticationPolicy).WindowsAuthnEnabled') do\n      its('stdout.strip') { should cmp 'false' }\n    end\n  else\n    describe 'A federated IDP is configured so this is Not Applicable.' do\n      skip 'A federated IDP is configured so this is Not Applicable.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000283.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000284","title":"The vCenter Server must restrict access to the default roles with cryptographic permissions.","desc":"In vSphere, the built-in \"Administrator\" role contains permission to perform cryptographic operations such as Key Management Server (KMS) functions and encrypting and decrypting virtual machine disks. This role must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use.\n\nA new built-in role called \"No Cryptography Administrator\" exists to provide all administrative permissions except cryptographic operations. Permissions must be restricted such that normal vSphere administrators are assigned the \"No Cryptography Administrator\" role or more restrictive.\n\nThe \"Administrator\" role must be tightly controlled and must not be applied to administrators who will not be doing cryptographic work. Catastrophic data loss can result from poorly administered cryptography.","descriptions":[{"label":"default","data":"In vSphere, the built-in \"Administrator\" role contains permission to perform cryptographic operations such as Key Management Server (KMS) functions and encrypting and decrypting virtual machine disks. This role must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use.\n\nA new built-in role called \"No Cryptography Administrator\" exists to provide all administrative permissions except cryptographic operations. Permissions must be restricted such that normal vSphere administrators are assigned the \"No Cryptography Administrator\" role or more restrictive.\n\nThe \"Administrator\" role must be tightly controlled and must not be applied to administrators who will not be doing cryptographic work. Catastrophic data loss can result from poorly administered cryptography."},{"label":"rationale","data":""},{"label":"check","data":"By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\nFrom the vSphere Client, go to Administration >> Access Control >> Roles.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VIPermission | Where {$_.Role -eq \"Admin\" -or $_.Role -eq \"NoTrustedAdmin\" -or $_.Role -eq \"vCLSAdmin\" -or $_.Role -eq \"vSphereKubernetesManager\"} | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\nIf there are any users or groups assigned to the default roles with cryptographic permissions and are not explicitly designated to perform cryptographic operations, this is a finding.\n\nThe built-in solution users assigned to the administrator role are NOT a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nMove any accounts not explicitly designated for cryptographic operations, other than Solution Users, to other roles such as \"No Cryptography Administrator\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000284","rid":"SV-VCSA-80-000284","stig_id":"VCSA-80-000284","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000284' do\n  title 'The vCenter Server must restrict access to the default roles with cryptographic permissions.'\n  desc  \"\n    In vSphere, the built-in \\\"Administrator\\\" role contains permission to perform cryptographic operations such as Key Management Server (KMS) functions and encrypting and decrypting virtual machine disks. This role must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use.\n\n    A new built-in role called \\\"No Cryptography Administrator\\\" exists to provide all administrative permissions except cryptographic operations. Permissions must be restricted such that normal vSphere administrators are assigned the \\\"No Cryptography Administrator\\\" role or more restrictive.\n\n    The \\\"Administrator\\\" role must be tightly controlled and must not be applied to administrators who will not be doing cryptographic work. Catastrophic data loss can result from poorly administered cryptography.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VIPermission | Where {$_.Role -eq \\\"Admin\\\" -or $_.Role -eq \\\"NoTrustedAdmin\\\" -or $_.Role -eq \\\"vCLSAdmin\\\" -or $_.Role -eq \\\"vSphereKubernetesManager\\\"} | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\n    If there are any users or groups assigned to the default roles with cryptographic permissions and are not explicitly designated to perform cryptographic operations, this is a finding.\n\n    The built-in solution users assigned to the administrator role are NOT a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Move any accounts not explicitly designated for cryptographic operations, other than Solution Users, to other roles such as \\\"No Cryptography Administrator\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000284'\n  tag rid: 'SV-VCSA-80-000284'\n  tag stig_id: 'VCSA-80-000284'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vcCryptoAdmins = input('vcCryptoAdmins')\n\n  # Get all users/groups with Admin/Administrator role excluding vpxd- accounts\n  command = 'Get-VIPermission | Where-Object {($_.Role -eq \"Admin\" -or $_.Role -eq \"NoTrustedAdmin\" -or $_.Role -eq \"vCLSAdmin\" -or $_.Role -eq \"vSphereKubernetesManager\") -and $_.Principal -notmatch \"vpxd-\"} | Select-Object -ExpandProperty Principal'\n  cryptoadmins = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !cryptoadmins.empty?\n    cryptoadmins.each do |cryptoadmin|\n      describe cryptoadmin do\n        subject { cryptoadmin }\n        it { should be_in vcCryptoAdmins }\n      end\n    end\n  else\n    describe 'No users/groups found assigned to crypto roles...skipping tests.' do\n      skip 'No users/groups found assigned to crypto roles...skipping tests.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000284.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000285","title":"The vCenter Server must restrict access to cryptographic permissions.","desc":"These permissions must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use. Catastrophic data loss can result from poorly administered cryptography.","descriptions":[{"label":"default","data":"These permissions must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use. Catastrophic data loss can result from poorly administered cryptography."},{"label":"rationale","data":""},{"label":"check","data":"By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\nFrom the vSphere Client, go to Administration >> Access Control >> Roles.\n\nHighlight each role and click the 'Privileges\" button in the right pane.\n\nVerify that only the Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager and any site-specific cryptographic roles have the following permissions:\n\nCryptographic Operations privileges\nGlobal.Diagnostics\nHost.Inventory.Add host to cluster\nHost.Inventory.Add standalone host\nHost.Local operations.Manage user groups\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$roles = Get-VIRole\nForEach($role in $roles){\n    $privileges = $role.PrivilegeList\n    If($privileges -match \"Crypto*\" -or $privileges -match \"Global.Diagnostics\" -or $privileges -match \"Host.Inventory.Add*\" -or $privileges -match \"Host.Local operations.Manage user groups\"){\n    Write-Host \"$role has Cryptographic privileges\"\n    }\n}\n\nIf any role other than the four default roles contain the permissions listed above and is not authorized to perform cryptographic related operations, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nHighlight the target custom role and click \"Edit\".\n\nRemove the following permissions from any custom role that is not authorized to perform cryptographic related operations:\n\nCryptographic Operations privileges\nGlobal.Diagnostics\nHost.Inventory.Add host to cluster\nHost.Inventory.Add standalone host\nHost.Local operations.Manage user groups"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000285","rid":"SV-VCSA-80-000285","stig_id":"VCSA-80-000285","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000285' do\n  title 'The vCenter Server must restrict access to cryptographic permissions.'\n  desc  'These permissions must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use. Catastrophic data loss can result from poorly administered cryptography.'\n  desc  'rationale', ''\n  desc  'check', \"\n    By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Highlight each role and click the 'Privileges\\\" button in the right pane.\n\n    Verify that only the Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager and any site-specific cryptographic roles have the following permissions:\n\n    Cryptographic Operations privileges\n    Global.Diagnostics\n    Host.Inventory.Add host to cluster\n    Host.Inventory.Add standalone host\n    Host.Local operations.Manage user groups\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $roles = Get-VIRole\n    ForEach($role in $roles){\n        $privileges = $role.PrivilegeList\n        If($privileges -match \\\"Crypto*\\\" -or $privileges -match \\\"Global.Diagnostics\\\" -or $privileges -match \\\"Host.Inventory.Add*\\\" -or $privileges -match \\\"Host.Local operations.Manage user groups\\\"){\n        Write-Host \\\"$role has Cryptographic privileges\\\"\n        }\n    }\n\n    If any role other than the four default roles contain the permissions listed above and is not authorized to perform cryptographic related operations, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Highlight the target custom role and click \\\"Edit\\\".\n\n    Remove the following permissions from any custom role that is not authorized to perform cryptographic related operations:\n\n    Cryptographic Operations privileges\n    Global.Diagnostics\n    Host.Inventory.Add host to cluster\n    Host.Inventory.Add standalone host\n    Host.Local operations.Manage user groups\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000285'\n  tag rid: 'SV-VCSA-80-000285'\n  tag stig_id: 'VCSA-80-000285'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vcCryptoRoles = input('vcCryptoRoles')\n\n  command = 'Get-VIRole | Where-Object {$_.PrivilegeList -match \"Crypto*\" -or $_.PrivilegeList -match \"Global.Diagnostics\" -or $_.PrivilegeList -match \"Host.Inventory.Add*\" -or $_.PrivilegeList -match \"Host.Local operations.Manage user groups\"} | Select-Object -ExpandProperty Name'\n  cryptoroles = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !cryptoroles.empty?\n    cryptoroles.each do |cryptorole|\n      describe cryptorole do\n        subject { cryptorole }\n        it { should be_in vcCryptoRoles }\n      end\n    end\n  else\n    describe 'No roles found with crypto permissions...skipping tests.' do\n      skip 'No roles found with crypto permissions...skipping tests.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000285.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000286","title":"The vCenter Server must have Mutual Challenge Handshake Authentication Protocol (CHAP) configured for vSAN Internet Small Computer System Interface (iSCSI) targets.","desc":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, the potential exists for a man-in-the-middle attack in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.","descriptions":[{"label":"default","data":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, the potential exists for a man-in-the-middle attack in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN or if vSAN is enabled but iSCSI is not enabled, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\nFor each iSCSI target, review the value in the \"Authentication\" column.\n\nIf the Authentication method is not set to \"CHAP_Mutual\" for any iSCSI target, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\nFor each iSCSI target, select the item and click \"Edit\".\n\nChange the \"Authentication\" field to \"Mutual CHAP\" and configure the incoming and outgoing users and secrets appropriately."}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000286","rid":"SV-VCSA-80-000286","stig_id":"VCSA-80-000286","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000286' do\n  title 'The vCenter Server must have Mutual Challenge Handshake Authentication Protocol (CHAP) configured for vSAN Internet Small Computer System Interface (iSCSI) targets.'\n  desc  'When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, the potential exists for a man-in-the-middle attack in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN or if vSAN is enabled but iSCSI is not enabled, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\n    For each iSCSI target, review the value in the \\\"Authentication\\\" column.\n\n    If the Authentication method is not set to \\\"CHAP_Mutual\\\" for any iSCSI target, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\n    For each iSCSI target, select the item and click \\\"Edit\\\".\n\n    Change the \\\"Authentication\\\" field to \\\"Mutual CHAP\\\" and configure the incoming and outgoing users and secrets appropriately.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000286'\n  tag rid: 'SV-VCSA-80-000286'\n  tag stig_id: 'VCSA-80-000286'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  setimpact = true\n  if !clusters.empty?\n    clusters.each do |cluster|\n      iscsiEnabled = powercli_command(\"(Get-VsanClusterConfiguration -Cluster \\\"#{cluster}\\\").IscsiTargetServiceEnabled\").stdout.strip\n      if iscsiEnabled == 'True'\n        command = \"(Get-VsanClusterConfiguration -Cluster \\\"#{cluster}\\\").DefaultIscsiAuthenticationType\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp 'MutualChap' }\n        end\n        setimpact = false\n      else\n        describe \"vSAN iSCSI service not enabled on cluster: #{cluster}...this is not applicable.\" do\n          skip \"vSAN iSCSI service not enabled on cluster: #{cluster}...this is not applicable.\"\n        end\n      end\n    end\n  else\n    describe '' do\n      skip 'No vSAN enabled clusters found...this is not applicable.'\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000286.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000287","title":"The vCenter Server must have new Key Encryption Keys (KEKs) reissued at regular intervals for vSAN encrypted datastore(s).","desc":"The KEK for a vSAN encrypted datastore is generated by the Key Management Server (KMS) and serves as a wrapper and lock around the Disk Encryption Key (DEK). The DEK is generated by the host and is used to encrypt and decrypt the datastore. A shallow rekey is a procedure in which the KMS issues a new KEK to the ESXi host, which rewraps the DEK but does not change the DEK or any data on disk.\n\nThis operation must be done on a regular, site-defined interval and can be viewed as similar in criticality to changing an administrative password. If the KMS is compromised, a standing operational procedure to rekey will put a time limit on the usefulness of any stolen KMS data.","descriptions":[{"label":"default","data":"The KEK for a vSAN encrypted datastore is generated by the Key Management Server (KMS) and serves as a wrapper and lock around the Disk Encryption Key (DEK). The DEK is generated by the host and is used to encrypt and decrypt the datastore. A shallow rekey is a procedure in which the KMS issues a new KEK to the ESXi host, which rewraps the DEK but does not change the DEK or any data on disk.\n\nThis operation must be done on a regular, site-defined interval and can be viewed as similar in criticality to changing an administrative password. If the KMS is compromised, a standing operational procedure to rekey will put a time limit on the usefulness of any stolen KMS data."},{"label":"rationale","data":""},{"label":"check","data":"If vSAN is not in use, this is not applicable.\n\nInterview the system administrator (SA) to determine that a procedure has been put in place to perform a shallow rekey of all vSAN encrypted datastores at regular, site-defined intervals.\n\nVMware recommends a 60-day rekey task, but this interval must be defined by the SA and the information system security officer (ISSO).\n\nIf vSAN encryption is not in use, this is not a finding.\n\nIf vSAN encryption is in use and a regular rekey procedure is not in place, this is a finding."},{"label":"fix","data":"If vSAN encryption is in use, ensure that a regular rekey procedure is in place."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000287","rid":"SV-VCSA-80-000287","stig_id":"VCSA-80-000287","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000287' do\n  title 'The vCenter Server must have new Key Encryption Keys (KEKs) reissued at regular intervals for vSAN encrypted datastore(s).'\n  desc  \"\n    The KEK for a vSAN encrypted datastore is generated by the Key Management Server (KMS) and serves as a wrapper and lock around the Disk Encryption Key (DEK). The DEK is generated by the host and is used to encrypt and decrypt the datastore. A shallow rekey is a procedure in which the KMS issues a new KEK to the ESXi host, which rewraps the DEK but does not change the DEK or any data on disk.\n\n    This operation must be done on a regular, site-defined interval and can be viewed as similar in criticality to changing an administrative password. If the KMS is compromised, a standing operational procedure to rekey will put a time limit on the usefulness of any stolen KMS data.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If vSAN is not in use, this is not applicable.\n\n    Interview the system administrator (SA) to determine that a procedure has been put in place to perform a shallow rekey of all vSAN encrypted datastores at regular, site-defined intervals.\n\n    VMware recommends a 60-day rekey task, but this interval must be defined by the SA and the information system security officer (ISSO).\n\n    If vSAN encryption is not in use, this is not a finding.\n\n    If vSAN encryption is in use and a regular rekey procedure is not in place, this is a finding.\n  \"\n  desc 'fix', 'If vSAN encryption is in use, ensure that a regular rekey procedure is in place.'\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000287'\n  tag rid: 'SV-VCSA-80-000287'\n  tag stig_id: 'VCSA-80-000287'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000287.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000288","title":"The vCenter Server must use secure Lightweight Directory Access Protocol (LDAPS) when adding an LDAP identity source.","desc":"LDAP is an industry standard protocol for querying directory services such as Active Directory. This protocol can operate in clear text or over a Secure Sockets Layer (SSL)/Transport Layer Security (TLS) encrypted tunnel. To protect confidentiality of LDAP communications, secure LDAP (LDAPS) must be explicitly configured when adding an LDAP identity source in vSphere Single Sign-On (SSO).\n\nWhen configuring an identity source and supplying an SSL certificate, vCenter will enforce LDAPS. The server URLs do not need to be explicitly provided if an SSL certificate is uploaded.","descriptions":[{"label":"default","data":"LDAP is an industry standard protocol for querying directory services such as Active Directory. This protocol can operate in clear text or over a Secure Sockets Layer (SSL)/Transport Layer Security (TLS) encrypted tunnel. To protect confidentiality of LDAP communications, secure LDAP (LDAPS) must be explicitly configured when adding an LDAP identity source in vSphere Single Sign-On (SSO).\n\nWhen configuring an identity source and supplying an SSL certificate, vCenter will enforce LDAPS. The server URLs do not need to be explicitly provided if an SSL certificate is uploaded."},{"label":"rationale","data":""},{"label":"check","data":"If LDAP is not used as an identity provider, this is not applicable.\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nClick the \"Identity Sources\" tab.\n\nFor each identity source of type \"Active Directory over LDAP\", if the \"Server URL\" does not indicate \"ldaps://\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nClick the \"Identity Sources\" tab.\n\nFor each identity source of type \"Active Directory over LDAP\" where LDAPS is not configured, highlight the item and click \"Edit\".\n\nEnsure the primary and secondary server URLs, if specified, are configured for \"ldaps://\".\n\nAt the bottom, click the \"Browse\" button, select the AD LDAP cert previously exported to your local computer, click \"Open\", and \"Save\" to complete modifications.\n\nNote: With LDAPS, the server must be a specific domain controller and its specific certificate or the domain alias with a certificate that is valid for that URL."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000288","rid":"SV-VCSA-80-000288","stig_id":"VCSA-80-000288","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000288' do\n  title 'The vCenter Server must use secure Lightweight Directory Access Protocol (LDAPS) when adding an LDAP identity source.'\n  desc  \"\n    LDAP is an industry standard protocol for querying directory services such as Active Directory. This protocol can operate in clear text or over a Secure Sockets Layer (SSL)/Transport Layer Security (TLS) encrypted tunnel. To protect confidentiality of LDAP communications, secure LDAP (LDAPS) must be explicitly configured when adding an LDAP identity source in vSphere Single Sign-On (SSO).\n\n    When configuring an identity source and supplying an SSL certificate, vCenter will enforce LDAPS. The server URLs do not need to be explicitly provided if an SSL certificate is uploaded.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If LDAP is not used as an identity provider, this is not applicable.\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    Click the \\\"Identity Sources\\\" tab.\n\n    For each identity source of type \\\"Active Directory over LDAP\\\", if the \\\"Server URL\\\" does not indicate \\\"ldaps://\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    Click the \\\"Identity Sources\\\" tab.\n\n    For each identity source of type \\\"Active Directory over LDAP\\\" where LDAPS is not configured, highlight the item and click \\\"Edit\\\".\n\n    Ensure the primary and secondary server URLs, if specified, are configured for \\\"ldaps://\\\".\n\n    At the bottom, click the \\\"Browse\\\" button, select the AD LDAP cert previously exported to your local computer, click \\\"Open\\\", and \\\"Save\\\" to complete modifications.\n\n    Note: With LDAPS, the server must be a specific domain controller and its specific certificate or the domain alias with a certificate that is valid for that URL.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000288'\n  tag rid: 'SV-VCSA-80-000288'\n  tag stig_id: 'VCSA-80-000288'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000288.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000290","title":"The vCenter Server must limit membership to the \"SystemConfiguration.BashShellAdministrators\" Single Sign-On (SSO) group.","desc":"vCenter SSO integrates with PAM in the underlying Photon operating system so members of the \"SystemConfiguration.BashShellAdministrators\" SSO group can log on to the operating system without needing a separate account. However, even though unique SSO users log on, they are transparently using a group account named \"sso-user\" as far as Photon auditing is concerned. While the audit trail can still be traced back to the individual SSO user, it is a more involved process.\n\nTo force accountability and nonrepudiation, the SSO group \"SystemConfiguration.BashShellAdministrators\" must be severely restricted.","descriptions":[{"label":"default","data":"vCenter SSO integrates with PAM in the underlying Photon operating system so members of the \"SystemConfiguration.BashShellAdministrators\" SSO group can log on to the operating system without needing a separate account. However, even though unique SSO users log on, they are transparently using a group account named \"sso-user\" as far as Photon auditing is concerned. While the audit trail can still be traced back to the individual SSO user, it is a more involved process.\n\nTo force accountability and nonrepudiation, the SSO group \"SystemConfiguration.BashShellAdministrators\" must be severely restricted."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"SystemConfiguration.BashShellAdministrators\" group appears.\n\nClick \"SystemConfiguration.BashShellAdministrators\".\n\nReview the members of the group and ensure that only authorized accounts are present.\n\nNote: By default the Administrator and a unique service account similar to \"vmware-applmgmtservice-714684a4-342f-4eff-a232-cdc21def00c2\" will be in the group and should not be removed.\n\nIf there are any accounts present as members of SystemConfiguration.BashShellAdministrators that are not authorized, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"SystemConfiguration.BashShellAdministrators\" group appears.\n\nClick \"SystemConfiguration.BashShellAdministrators\".\n\nClick the three vertical dots next to the name of each unauthorized account.\n\nSelect \"Remove Member\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000290","rid":"SV-VCSA-80-000290","stig_id":"VCSA-80-000290","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000290' do\n  title 'The vCenter Server must limit membership to the \"SystemConfiguration.BashShellAdministrators\" Single Sign-On (SSO) group.'\n  desc  \"\n    vCenter SSO integrates with PAM in the underlying Photon operating system so members of the \\\"SystemConfiguration.BashShellAdministrators\\\" SSO group can log on to the operating system without needing a separate account. However, even though unique SSO users log on, they are transparently using a group account named \\\"sso-user\\\" as far as Photon auditing is concerned. While the audit trail can still be traced back to the individual SSO user, it is a more involved process.\n\n    To force accountability and nonrepudiation, the SSO group \\\"SystemConfiguration.BashShellAdministrators\\\" must be severely restricted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"SystemConfiguration.BashShellAdministrators\\\" group appears.\n\n    Click \\\"SystemConfiguration.BashShellAdministrators\\\".\n\n    Review the members of the group and ensure that only authorized accounts are present.\n\n    Note: By default the Administrator and a unique service account similar to \\\"vmware-applmgmtservice-714684a4-342f-4eff-a232-cdc21def00c2\\\" will be in the group and should not be removed.\n\n    If there are any accounts present as members of SystemConfiguration.BashShellAdministrators that are not authorized, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"SystemConfiguration.BashShellAdministrators\\\" group appears.\n\n    Click \\\"SystemConfiguration.BashShellAdministrators\\\".\n\n    Click the three vertical dots next to the name of each unauthorized account.\n\n    Select \\\"Remove Member\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000290'\n  tag rid: 'SV-VCSA-80-000290'\n  tag stig_id: 'VCSA-80-000290'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  bashShellAdminUsers = input('bashShellAdminUsers')\n  # Get appliance management user and add to list of authorized users. Unique to each vCenter.\n  applmgmtuser = powercli_command('Get-SsoGroup -Domain vsphere.local -Name applmgmtSvcUsers | Get-SsoPersonUser | Select-Object -ExpandProperty Name').stdout.strip\n  bashShellAdminUsers.push(applmgmtuser)\n  users = powercli_command('Get-SsoGroup -Domain vsphere.local -Name SystemConfiguration.BashShellAdministrators | Get-SsoPersonUser | Select-Object -ExpandProperty Name')\n  if users.stdout.empty?\n    describe 'Stderr should be empty if no users found' do\n      subject { users.stderr }\n      it { should be_empty }\n    end\n    describe 'No users found in SystemConfiguration.BashShellAdministrators' do\n      subject { users.stdout }\n      it { should be_empty }\n    end\n  else\n    users.stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |user|\n      describe user do\n        it { should be_in bashShellAdminUsers }\n      end\n    end\n  end\n  bashShellAdminGroups = input('bashShellAdminGroups')\n  groups = powercli_command('Get-SsoGroup -Domain vsphere.local -Name SystemConfiguration.BashShellAdministrators | Get-SsoGroup | Select-Object -ExpandProperty Name')\n  if groups.stdout.empty?\n    describe 'Stderr should be empty if no groups found' do\n      subject { groups.stderr }\n      it { should be_empty }\n    end\n    describe 'No groups found in SystemConfiguration.BashShellAdministrators' do\n      subject { groups.stdout }\n      it { should be_empty }\n    end\n  else\n    groups.stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |group|\n      describe group do\n        it { should be_in bashShellAdminGroups }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000290.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000291","title":"The vCenter Server must limit membership to the \"TrustedAdmins\" Single Sign-On (SSO) group.","desc":"The vSphere \"TrustedAdmins\" group grants additional rights to administer the vSphere Trust Authority feature.\n\nTo force accountability and nonrepudiation, the SSO group \"TrustedAdmins\" must be severely restricted.","descriptions":[{"label":"default","data":"The vSphere \"TrustedAdmins\" group grants additional rights to administer the vSphere Trust Authority feature.\n\nTo force accountability and nonrepudiation, the SSO group \"TrustedAdmins\" must be severely restricted."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"TrustedAdmins\" group appears.\n\nClick \"TrustedAdmins\".\n\nReview the members of the group and ensure that only authorized accounts are present.\n\nNote: These accounts act as root on the Photon operating system and have the ability to severely damage vCenter, inadvertently or otherwise.\n\nIf there are any accounts present as members of TrustedAdmins that are not authorized, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"TrustedAdmins\" group appears.\n\nClick \"TrustedAdmins\".\n\nClick the three vertical dots next to the name of each unauthorized account.\n\nSelect \"Remove Member\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000291","rid":"SV-VCSA-80-000291","stig_id":"VCSA-80-000291","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000291' do\n  title 'The vCenter Server must limit membership to the \"TrustedAdmins\" Single Sign-On (SSO) group.'\n  desc  \"\n    The vSphere \\\"TrustedAdmins\\\" group grants additional rights to administer the vSphere Trust Authority feature.\n\n    To force accountability and nonrepudiation, the SSO group \\\"TrustedAdmins\\\" must be severely restricted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"TrustedAdmins\\\" group appears.\n\n    Click \\\"TrustedAdmins\\\".\n\n    Review the members of the group and ensure that only authorized accounts are present.\n\n    Note: These accounts act as root on the Photon operating system and have the ability to severely damage vCenter, inadvertently or otherwise.\n\n    If there are any accounts present as members of TrustedAdmins that are not authorized, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"TrustedAdmins\\\" group appears.\n\n    Click \\\"TrustedAdmins\\\".\n\n    Click the three vertical dots next to the name of each unauthorized account.\n\n    Select \\\"Remove Member\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000291'\n  tag rid: 'SV-VCSA-80-000291'\n  tag stig_id: 'VCSA-80-000291'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  trustedAdminUsers = input('trustedAdminUsers')\n  users = powercli_command('Get-SsoGroup -Domain vsphere.local -Name TrustedAdmins | Get-SsoPersonUser | Select-Object -ExpandProperty Name')\n  if users.stdout.empty?\n    describe 'Stderr should be empty if no users found' do\n      subject { users.stderr }\n      it { should be_empty }\n    end\n    describe 'No users found in TrustedAdmins' do\n      subject { users.stdout }\n      it { should be_empty }\n    end\n  else\n    users.stdout.split.each do |user|\n      describe user do\n        it { should be_in trustedAdminUsers }\n      end\n    end\n  end\n  trustedAdminGroups = input('trustedAdminGroups')\n  groups = powercli_command('Get-SsoGroup -Domain vsphere.local -Name TrustedAdmins | Get-SsoGroup | Select-Object -ExpandProperty Name')\n  if groups.stdout.empty?\n    describe 'Stderr should be empty if no groups found' do\n      subject { groups.stderr }\n      it { should be_empty }\n    end\n    describe 'No groups found in TrustedAdmins' do\n      subject { groups.stdout }\n      it { should be_empty }\n    end\n  else\n    groups.stdout.split.each do |group|\n      describe group do\n        it { should be_in trustedAdminGroups }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000291.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000292","title":"The vCenter server configuration must be backed up on a regular basis.","desc":"vCenter server is the control plane for the vSphere infrastructure and all the workloads it hosts. As such, vCenter is usually a highly critical system in its own right. Backups of vCenter can now be made at a data and configuration level versus traditional storage/image-based backups. This reduces recovery time by letting the system administrator (SA) spin up a new vCenter while simultaneously importing the backed-up data.\n\nFor sites that implement the Native Key Provider (NKP), introduced in 7.0 Update 2, regular vCenter backups are critical. In a recovery scenario where the virtual machine files are intact but vCenter was lost, the encrypted virtual machines will not be able to boot as their private keys were stored in vCenter after it was last backed up. When using the NKP, vCenter becomes critical to the virtual machine workloads and ceases to be just the control plane.","descriptions":[{"label":"default","data":"vCenter server is the control plane for the vSphere infrastructure and all the workloads it hosts. As such, vCenter is usually a highly critical system in its own right. Backups of vCenter can now be made at a data and configuration level versus traditional storage/image-based backups. This reduces recovery time by letting the system administrator (SA) spin up a new vCenter while simultaneously importing the backed-up data.\n\nFor sites that implement the Native Key Provider (NKP), introduced in 7.0 Update 2, regular vCenter backups are critical. In a recovery scenario where the virtual machine files are intact but vCenter was lost, the encrypted virtual machines will not be able to boot as their private keys were stored in vCenter after it was last backed up. When using the NKP, vCenter becomes critical to the virtual machine workloads and ceases to be just the control plane."},{"label":"rationale","data":""},{"label":"check","data":"Option 1:\n\nIf vCenter is backed up in a traditional manner, at the storage array level, interview the SA to determine configuration and schedule.\n\nOption 2:\n\nFor vCenter native backup functionality, open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Backup\" on the left navigation pane.\n\nOn the resulting pane on the right, verify the \"Status\" is \"Enabled\".\n\nClick \"Status\" to expand the backup details.\n\nIf vCenter server backups are not configured and there is no other vCenter backup system, this is a finding.\n\nIf the backup configuration is not set to a proper, reachable location or if the schedule is anything less frequent than \"Daily\", this is a finding."},{"label":"fix","data":"Option 1:\n\nImplement and document a VMware-supported storage/image-based backup schedule.\n\nOption 2:\n\nTo configure vCenter native backup functionality, open the VAMI by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with an SSO account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Backup\" on the left navigation pane.\n\nOn the resulting pane on the right, click \"Configure\" (or \"Edit\" for an existing configuration).\n\nEnter site-specific information for the backup job.\n\nEnsure \"Schedule\" is set to \"Daily\". Limiting the number of retained backups is recommended but not required.\n\nClick \"Create\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000292","rid":"SV-VCSA-80-000292","stig_id":"VCSA-80-000292","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000292' do\n  title 'The vCenter server configuration must be backed up on a regular basis.'\n  desc  \"\n    vCenter server is the control plane for the vSphere infrastructure and all the workloads it hosts. As such, vCenter is usually a highly critical system in its own right. Backups of vCenter can now be made at a data and configuration level versus traditional storage/image-based backups. This reduces recovery time by letting the system administrator (SA) spin up a new vCenter while simultaneously importing the backed-up data.\n\n    For sites that implement the Native Key Provider (NKP), introduced in 7.0 Update 2, regular vCenter backups are critical. In a recovery scenario where the virtual machine files are intact but vCenter was lost, the encrypted virtual machines will not be able to boot as their private keys were stored in vCenter after it was last backed up. When using the NKP, vCenter becomes critical to the virtual machine workloads and ceases to be just the control plane.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Option 1:\n\n    If vCenter is backed up in a traditional manner, at the storage array level, interview the SA to determine configuration and schedule.\n\n    Option 2:\n\n    For vCenter native backup functionality, open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Backup\\\" on the left navigation pane.\n\n    On the resulting pane on the right, verify the \\\"Status\\\" is \\\"Enabled\\\".\n\n    Click \\\"Status\\\" to expand the backup details.\n\n    If vCenter server backups are not configured and there is no other vCenter backup system, this is a finding.\n\n    If the backup configuration is not set to a proper, reachable location or if the schedule is anything less frequent than \\\"Daily\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Option 1:\n\n    Implement and document a VMware-supported storage/image-based backup schedule.\n\n    Option 2:\n\n    To configure vCenter native backup functionality, open the VAMI by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with an SSO account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Backup\\\" on the left navigation pane.\n\n    On the resulting pane on the right, click \\\"Configure\\\" (or \\\"Edit\\\" for an existing configuration).\n\n    Enter site-specific information for the backup job.\n\n    Ensure \\\"Schedule\\\" is set to \\\"Daily\\\". Limiting the number of retained backups is recommended but not required.\n\n    Click \\\"Create\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000292'\n  tag rid: 'SV-VCSA-80-000292'\n  tag stig_id: 'VCSA-80-000292'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  if input('backup3rdParty')\n    describe '3rd party backups indicated. This check is a manual or policy based check and must be reviewed manually.' do\n      skip '3rd party backups indicated. This check is a manual or policy based check and must be reviewed manually.'\n    end\n  else\n    command = '(Invoke-ListRecoveryBackupSchedules).default.enable'\n    backupsenabled = powercli_command(command).stdout.strip\n\n    describe 'File based backups should be enabled.' do\n      subject { backupsenabled }\n      it { should cmp 'true' }\n    end\n\n    if backupsenabled == 'True'\n      # check that backups are scheduled daily. if so the days configuration will be empty\n      # if a custom schedule is specified and every day is selected this will fail and that should be changed to daily\n      backupschedule = powercli_command('(Invoke-ListRecoveryBackupSchedules).default.recurrence_info.days').stdout.strip\n      describe 'Backups should be scheduled daily.' do\n        subject { backupschedule }\n        it { should cmp '' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000292.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000293","title":"The vCenter server must have task and event retention set to at least 30 days.","desc":"vCenter tasks and events contain valuable historical actions, useful in troubleshooting availability issues and for incident forensics. While vCenter events are sent to central log servers in real time, it is important that administrators have quick access to this information when needed.\n\nvCenter retains 30 days of tasks and events by default, and this is sufficient for most purposes. The vCenter disk partitions are also sized with this in mind. Decreasing is not recommended for operational reasons, while increasing is not recommended unless guided by VMware support due to the partition sizing concerns.","descriptions":[{"label":"default","data":"vCenter tasks and events contain valuable historical actions, useful in troubleshooting availability issues and for incident forensics. While vCenter events are sent to central log servers in real time, it is important that administrators have quick access to this information when needed.\n\nvCenter retains 30 days of tasks and events by default, and this is sufficient for most purposes. The vCenter disk partitions are also sized with this in mind. Decreasing is not recommended for operational reasons, while increasing is not recommended unless guided by VMware support due to the partition sizing concerns."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick to expand the \"Database\" section.\n\nNote the \"Task retention\" and \"Event retention\" values.\n\nIf either value is configured to less than \"30\" days, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick \"Edit\".\n\nOn the \"Database\" tab, set the value for both \"Task retention\" and \"Event retention\" to \"30\" days (default) or greater, as required by your site.\n\nClick \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000293","rid":"SV-VCSA-80-000293","stig_id":"VCSA-80-000293","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000293' do\n  title 'The vCenter server must have task and event retention set to at least 30 days.'\n  desc  \"\n    vCenter tasks and events contain valuable historical actions, useful in troubleshooting availability issues and for incident forensics. While vCenter events are sent to central log servers in real time, it is important that administrators have quick access to this information when needed.\n\n    vCenter retains 30 days of tasks and events by default, and this is sufficient for most purposes. The vCenter disk partitions are also sized with this in mind. Decreasing is not recommended for operational reasons, while increasing is not recommended unless guided by VMware support due to the partition sizing concerns.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click to expand the \\\"Database\\\" section.\n\n    Note the \\\"Task retention\\\" and \\\"Event retention\\\" values.\n\n    If either value is configured to less than \\\"30\\\" days, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click \\\"Edit\\\".\n\n    On the \\\"Database\\\" tab, set the value for both \\\"Task retention\\\" and \\\"Event retention\\\" to \\\"30\\\" days (default) or greater, as required by your site.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000293'\n  tag rid: 'SV-VCSA-80-000293'\n  tag stig_id: 'VCSA-80-000293'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name event.maxAge | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= '30' }\n  end\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name task.maxAge | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= '30' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000293.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000294","title":"The vCenter server Native Key Provider must be backed up with a strong password.","desc":"The vCenter Native Key Provider feature was introduced in 7.0 U2 and acts as a key provider for encryption based capabilities such as encrypted virtual machines without requiring an external KMS solution.  When enabling this feature a backup must be taken which is a PKCS#12 formatted file and if no password is provided during the backup process this presents the opportunity for this to be used maliciously and compromise the environment.","descriptions":[{"label":"default","data":"The vCenter Native Key Provider feature was introduced in 7.0 U2 and acts as a key provider for encryption based capabilities such as encrypted virtual machines without requiring an external KMS solution.  When enabling this feature a backup must be taken which is a PKCS#12 formatted file and if no password is provided during the backup process this presents the opportunity for this to be used maliciously and compromise the environment."},{"label":"rationale","data":""},{"label":"check","data":"If the vCenter Native Key Provider feature is not in use, this is not applicable.\n\nInterview the system administrator and determine if a password was provided for any backups taken of the Native Key Provider.\n\nIf backups exist for the Native Key Provider that are not password protected, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Key Providers.\n\nSelect the Native Key Provider, click \"Back-up\", and check the box \"Protect Native Key Provider data with password\".\n\nProvide a strong password and click \"Back up key provider\".\n\nDelete any previous backups that were not protected with a password."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000294","rid":"SV-VCSA-80-000294","stig_id":"VCSA-80-000294","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000294' do\n  title 'The vCenter server Native Key Provider must be backed up with a strong password.'\n  desc  'The vCenter Native Key Provider feature was introduced in 7.0 U2 and acts as a key provider for encryption based capabilities such as encrypted virtual machines without requiring an external KMS solution.  When enabling this feature a backup must be taken which is a PKCS#12 formatted file and if no password is provided during the backup process this presents the opportunity for this to be used maliciously and compromise the environment.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If the vCenter Native Key Provider feature is not in use, this is not applicable.\n\n    Interview the system administrator and determine if a password was provided for any backups taken of the Native Key Provider.\n\n    If backups exist for the Native Key Provider that are not password protected, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Key Providers.\n\n    Select the Native Key Provider, click \\\"Back-up\\\", and check the box \\\"Protect Native Key Provider data with password\\\".\n\n    Provide a strong password and click \\\"Back up key provider\\\".\n\n    Delete any previous backups that were not protected with a password.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000294'\n  tag rid: 'SV-VCSA-80-000294'\n  tag stig_id: 'VCSA-80-000294'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000294.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000295","title":"The vCenter server must require authentication for published content libraries.","desc":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale. When publishing a content library it can be protected by requiring authentication for subscribers.","descriptions":[{"label":"default","data":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale. When publishing a content library it can be protected by requiring authentication for subscribers."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Content Libraries.\n\nReview the \"Password Protected\" column.\n\nIf a content library is published and is not password protected, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Content Libraries.\n\nSelect the target content library.\n\nSelect \"Actions\" then \"Edit Settings\".\n\nClick the checkbox to \"Enable user authentication for access to this content library\".\n\nEnter and confirm a password for the content library. Click \"Ok\".\n\nNote: Any subscribed content libraries will need to be updated to enable authentication and provide the password."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000295","rid":"SV-VCSA-80-000295","stig_id":"VCSA-80-000295","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000295' do\n  title 'The vCenter server must require authentication for published content libraries.'\n  desc  'In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale. When publishing a content library it can be protected by requiring authentication for subscribers.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Review the \\\"Password Protected\\\" column.\n\n    If a content library is published and is not password protected, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Select the target content library.\n\n    Select \\\"Actions\\\" then \\\"Edit Settings\\\".\n\n    Click the checkbox to \\\"Enable user authentication for access to this content library\\\".\n\n    Enter and confirm a password for the content library. Click \\\"Ok\\\".\n\n    Note: Any subscribed content libraries will need to be updated to enable authentication and provide the password.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000295'\n  tag rid: 'SV-VCSA-80-000295'\n  tag stig_id: 'VCSA-80-000295'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-ContentLibrary | Select-Object -ExpandProperty Id'\n  libraries = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  setimpact = true\n  if !libraries.empty?\n    libraries.each do |library|\n      libinfo = powercli_command(\"Invoke-GetLibraryIdContent #{library} | ConvertTo-Json\").stdout\n      libinfojson = JSON.parse(libinfo)\n      if libinfojson['publish_info']['published'] == true\n        describe \"Authentication should be enabled on Content Library: #{libinfojson['name']}\" do\n          subject { libinfojson }\n          its(['publish_info', 'authentication_method']) { should cmp 'BASIC' }\n        end\n        setimpact = false\n      else\n        describe \"Publishing not enabled on Content Library: #{libinfojson['name']}. This control is not applicable.\" do\n          skip \"Publishing not enabled on Content Library: #{libinfojson['name']}. This control is not applicable.\"\n        end\n      end\n    end\n  else\n    describe '' do\n      skip 'No content libraries found. This control is not applicable.'\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000295.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000296","title":"The vCenter server must enable the OVF security policy for content libraries.","desc":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale.\n\nYou can protect the OVF items by applying default OVF security policy to a content library. The OVF security policy enforces strict validation on OVF items when you deploy or update the item, import items, or synchronize OVF and OVA templates. To make sure that the OVF and OVA templates are signed by a trusted certificate, you can add the OVF signing certificate from a trusted CA.","descriptions":[{"label":"default","data":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale.\n\nYou can protect the OVF items by applying default OVF security policy to a content library. The OVF security policy enforces strict validation on OVF items when you deploy or update the item, import items, or synchronize OVF and OVA templates. To make sure that the OVF and OVA templates are signed by a trusted certificate, you can add the OVF signing certificate from a trusted CA."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Content Libraries.\n\nReview the \"Security Policy\" column.\n\nIf a content library does not have the \"OVF default policy\" enabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Content Libraries.\n\nSelect the target content library.\n\nSelect \"Actions\" then \"Edit Settings\".\n\nClick the checkbox to \"Apply Security Policy\". Click \"OK\".\n\nNote: If you disable the security policy of a content library, you cannot reuse the existing OVF items."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000296","rid":"SV-VCSA-80-000296","stig_id":"VCSA-80-000296","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000296' do\n  title 'The vCenter server must enable the OVF security policy for content libraries.'\n  desc  \"\n    In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale.\n\n    You can protect the OVF items by applying default OVF security policy to a content library. The OVF security policy enforces strict validation on OVF items when you deploy or update the item, import items, or synchronize OVF and OVA templates. To make sure that the OVF and OVA templates are signed by a trusted certificate, you can add the OVF signing certificate from a trusted CA.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Review the \\\"Security Policy\\\" column.\n\n    If a content library does not have the \\\"OVF default policy\\\" enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Select the target content library.\n\n    Select \\\"Actions\\\" then \\\"Edit Settings\\\".\n\n    Click the checkbox to \\\"Apply Security Policy\\\". Click \\\"OK\\\".\n\n    Note: If you disable the security policy of a content library, you cannot reuse the existing OVF items.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000296'\n  tag rid: 'SV-VCSA-80-000296'\n  tag stig_id: 'VCSA-80-000296'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-ContentLibrary | Select-Object -ExpandProperty Id'\n  libraries = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  setimpact = true\n  if !libraries.empty?\n    libraries.each do |library|\n      libinfo = powercli_command(\"Invoke-GetLibraryIdContent #{library} | ConvertTo-Json\").stdout\n      libinfojson = JSON.parse(libinfo)\n      describe \"OVF security policy should be enabled on Content Library: #{libinfojson['name']}\" do\n        subject { libinfojson }\n        its(['security_policy_id']) { should_not be nil }\n      end\n      setimpact = false\n    end\n  else\n    describe '' do\n      skip 'No content libraries found. This control is not applicable.'\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000296.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000298","title":"The vCenter Server must separate authentication and authorization for administrators.","desc":"Many organizations do both authentication and authorization using a centralized directory service such as Active Directory. Attackers who compromise an identity source can often add themselves to authorization groups, and simply log into systems they should not otherwise have access to. Additionally, reliance on central identity systems means that the administrators of those systems are potentially infrastructure administrators, too, as they can add themselves to infrastructure access groups at will.\n\nThe use of local SSO groups for authorization helps prevent this avenue of attack by allowing the centralized identity source to still authenticate users but moving authorization into vCenter itself.","descriptions":[{"label":"default","data":"Many organizations do both authentication and authorization using a centralized directory service such as Active Directory. Attackers who compromise an identity source can often add themselves to authorization groups, and simply log into systems they should not otherwise have access to. Additionally, reliance on central identity systems means that the administrators of those systems are potentially infrastructure administrators, too, as they can add themselves to infrastructure access groups at will.\n\nThe use of local SSO groups for authorization helps prevent this avenue of attack by allowing the centralized identity source to still authenticate users but moving authorization into vCenter itself."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nView the Administrator role and any other role providing administrative access to vCenter to verify the users and/or groups assigned to it by clicking on \"Usage\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\nIf any user or group is directly assigned a role with administrative access to vCenter that is from an identity provider, this is a finding.\n\nNote: Users and/or groups assigned to roles should be from the \"VSPHERE.LOCAL\" identity source."},{"label":"fix","data":"To add groups from an identity provider to the local SSO Administrators group, as an example, do the following:\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Groups.\n\nSelect the Administrators group and click \"Edit\".\n\nIn the \"Add Members\" section, select the identity source and type the name of the target user/group in the search bar.\n\nSelect the target user/group to add them and click \"Save\".\n\nNote: A new SSO group or groups can be created as needed and used to provide authorization to vCenter.\n\nTo remove identity provider users/groups from a role, do the following:\n\nFrom the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\nSelect the offending user/group and click \"Delete\".\n\nNote: If permissions are assigned on a specific object, then the role must be updated where it is assigned (for example, at the cluster level)."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000298","rid":"SV-VCSA-80-000298","stig_id":"VCSA-80-000298","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000298' do\n  title 'The vCenter Server must separate authentication and authorization for administrators.'\n  desc  \"\n    Many organizations do both authentication and authorization using a centralized directory service such as Active Directory. Attackers who compromise an identity source can often add themselves to authorization groups, and simply log into systems they should not otherwise have access to. Additionally, reliance on central identity systems means that the administrators of those systems are potentially infrastructure administrators, too, as they can add themselves to infrastructure access groups at will.\n\n    The use of local SSO groups for authorization helps prevent this avenue of attack by allowing the centralized identity source to still authenticate users but moving authorization into vCenter itself.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    View the Administrator role and any other role providing administrative access to vCenter to verify the users and/or groups assigned to it by clicking on \\\"Usage\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\n    If any user or group is directly assigned a role with administrative access to vCenter that is from an identity provider, this is a finding.\n\n    Note: Users and/or groups assigned to roles should be from the \\\"VSPHERE.LOCAL\\\" identity source.\n  \"\n  desc 'fix', \"\n    To add groups from an identity provider to the local SSO Administrators group, as an example, do the following:\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Groups.\n\n    Select the Administrators group and click \\\"Edit\\\".\n\n    In the \\\"Add Members\\\" section, select the identity source and type the name of the target user/group in the search bar.\n\n    Select the target user/group to add them and click \\\"Save\\\".\n\n    Note: A new SSO group or groups can be created as needed and used to provide authorization to vCenter.\n\n    To remove identity provider users/groups from a role, do the following:\n\n    From the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\n    Select the offending user/group and click \\\"Delete\\\".\n\n    Note: If permissions are assigned on a specific object, then the role must be updated where it is assigned (for example, at the cluster level).\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000298'\n  tag rid: 'SV-VCSA-80-000298'\n  tag stig_id: 'VCSA-80-000298'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000298.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000299","title":"The vCenter Server must disable CDP/LLDP on distributed switches.","desc":"The vSphere Distributed Virtual Switch can participate in Cisco Discovery Protocol (CDP) or Link Layer Discovery Protocol (LLDP), as a listener, advertiser, or both. The information is sensitive, including IP addresses, system names, software versions, and more. It can be used by an adversary to gain a better understanding of your environment, and to impersonate devices. It is also transmitted unencrypted on the network, and as such the recommendation is to disable it.","descriptions":[{"label":"default","data":"The vSphere Distributed Virtual Switch can participate in Cisco Discovery Protocol (CDP) or Link Layer Discovery Protocol (LLDP), as a listener, advertiser, or both. The information is sensitive, including IP addresses, system names, software versions, and more. It can be used by an adversary to gain a better understanding of your environment, and to impersonate devices. It is also transmitted unencrypted on the network, and as such the recommendation is to disable it."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nReview the \"Discovery Protocol\" configuration.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | Select Name,LinkDiscoveryProtocolOperation\n\nIf any distributed switch does not have \"Discovery Protocols\" disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nSelect the advanced tab and update the \"Type\" under \"Discovery Protocol\" to disabled and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch -Name \"DSwitch\" | Set-VDSwitch -LinkDiscoveryProtocolOperation \"Disabled\""}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000299","rid":"SV-VCSA-80-000299","stig_id":"VCSA-80-000299","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000299' do\n  title 'The vCenter Server must disable CDP/LLDP on distributed switches.'\n  desc  'The vSphere Distributed Virtual Switch can participate in Cisco Discovery Protocol (CDP) or Link Layer Discovery Protocol (LLDP), as a listener, advertiser, or both. The information is sensitive, including IP addresses, system names, software versions, and more. It can be used by an adversary to gain a better understanding of your environment, and to impersonate devices. It is also transmitted unencrypted on the network, and as such the recommendation is to disable it.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    Review the \\\"Discovery Protocol\\\" configuration.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | Select Name,LinkDiscoveryProtocolOperation\n\n    If any distributed switch does not have \\\"Discovery Protocols\\\" disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Select the advanced tab and update the \\\"Type\\\" under \\\"Discovery Protocol\\\" to disabled and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch -Name \\\"DSwitch\\\" | Set-VDSwitch -LinkDiscoveryProtocolOperation \\\"Disabled\\\"\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000299'\n  tag rid: 'SV-VCSA-80-000299'\n  tag stig_id: 'VCSA-80-000299'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"Get-VDSwitch -Name \\\"#{vds}\\\" | Select -ExpandProperty LinkDiscoveryProtocolOperation\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'Disabled' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000299.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000300","title":"The vCenter Server must remove unauthorized port mirroring sessions on distributed switches.","desc":"The vSphere Distributed Virtual Switch can enable port mirroring sessions allowing traffic to be mirrored from one source to a destination. If port mirroring is configured unknowingly this could allow an attacker to observe network traffic of virtual machines.","descriptions":[{"label":"default","data":"The vSphere Distributed Virtual Switch can enable port mirroring sessions allowing traffic to be mirrored from one source to a destination. If port mirroring is configured unknowingly this could allow an attacker to observe network traffic of virtual machines."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Port Mirroring.\n\nReview any configured \"Port Mirroring\" sessions.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | select Name,@{N=\"Port Mirroring Sessions\";E={$_.ExtensionData.Config.VspanSession.Name}}\n\nIf there are any unauthorized port mirroring sessions configured, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Port Mirroring.\n\nSelect the unauthorized \"Port Mirroring\" session and click \"Remove\". Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000300","rid":"SV-VCSA-80-000300","stig_id":"VCSA-80-000300","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000300' do\n  title 'The vCenter Server must remove unauthorized port mirroring sessions on distributed switches.'\n  desc  'The vSphere Distributed Virtual Switch can enable port mirroring sessions allowing traffic to be mirrored from one source to a destination. If port mirroring is configured unknowingly this could allow an attacker to observe network traffic of virtual machines.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Port Mirroring.\n\n    Review any configured \\\"Port Mirroring\\\" sessions.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | select Name,@{N=\\\"Port Mirroring Sessions\\\";E={$_.ExtensionData.Config.VspanSession.Name}}\n\n    If there are any unauthorized port mirroring sessions configured, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Port Mirroring.\n\n    Select the unauthorized \\\"Port Mirroring\\\" session and click \\\"Remove\\\". Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000300'\n  tag rid: 'SV-VCSA-80-000300'\n  tag stig_id: 'VCSA-80-000300'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.VspanSession\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000300.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000301","title":"The vCenter Server must not override port group settings at the port level on distributed switches.","desc":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf there are cases where particular VMs require unique configurations then a different port group with the required configuration should be created instead of overriding port group settings.","descriptions":[{"label":"default","data":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf there are cases where particular VMs require unique configurations then a different port group with the required configuration should be created instead of overriding port group settings."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nReview the \"Override port policies\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n(Get-VDPortgroup).ExtensionData.Config.Policy\n\nIf there are any distributed port groups that allow overridden port policies, this is a finding.\n\nNote: This does not apply to the \"Block Ports\" or \"Configure reset at disconnect\" policies."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nSelect advanced and update all port policies besides \"Block Ports\" to \"disabled\" and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n$pgs = Get-VDPortgroup | Get-View\nForEach($pg in $pgs){\n$spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n$spec.configversion = $pg.Config.ConfigVersion\n$spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n$spec.Policy.VlanOverrideAllowed = $False\n$spec.Policy.UplinkTeamingOverrideAllowed = $False\n$spec.Policy.SecurityPolicyOverrideAllowed = $False\n$spec.Policy.IpfixOverrideAllowed = $False\n$spec.Policy.BlockOverrideAllowed = $True\n$spec.Policy.ShapingOverrideAllowed = $False\n$spec.Policy.VendorConfigOverrideAllowed = $False\n$spec.Policy.TrafficFilterOverrideAllowed = $False\n$pg.ReconfigureDVPortgroup_Task($spec)\n}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000301","rid":"SV-VCSA-80-000301","stig_id":"VCSA-80-000301","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000301' do\n  title 'The vCenter Server must not override port group settings at the port level on distributed switches.'\n  desc  \"\n    Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\n    If there are cases where particular VMs require unique configurations then a different port group with the required configuration should be created instead of overriding port group settings.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Review the \\\"Override port policies\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    (Get-VDPortgroup).ExtensionData.Config.Policy\n\n    If there are any distributed port groups that allow overridden port policies, this is a finding.\n\n    Note: This does not apply to the \\\"Block Ports\\\" or \\\"Configure reset at disconnect\\\" policies.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Select advanced and update all port policies besides \\\"Block Ports\\\" to \\\"disabled\\\" and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    $pgs = Get-VDPortgroup | Get-View\n    ForEach($pg in $pgs){\n    $spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n    $spec.configversion = $pg.Config.ConfigVersion\n    $spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n    $spec.Policy.VlanOverrideAllowed = $False\n    $spec.Policy.UplinkTeamingOverrideAllowed = $False\n    $spec.Policy.SecurityPolicyOverrideAllowed = $False\n    $spec.Policy.IpfixOverrideAllowed = $False\n    $spec.Policy.BlockOverrideAllowed = $True\n    $spec.Policy.ShapingOverrideAllowed = $False\n    $spec.Policy.VendorConfigOverrideAllowed = $False\n    $spec.Policy.TrafficFilterOverrideAllowed = $False\n    $pg.ReconfigureDVPortgroup_Task($spec)\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000301'\n  tag rid: 'SV-VCSA-80-000301'\n  tag stig_id: 'VCSA-80-000301'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000301.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000302","title":"The vCenter Server must reset port configuration when virtual machines are disconnected.","desc":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf any unknown or unauthorized per-port overrides exist and are not discarded when a virtual machine is disconnected from that port then a future virtual machine connected to that port may receive a less secure port.","descriptions":[{"label":"default","data":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf any unknown or unauthorized per-port overrides exist and are not discarded when a virtual machine is disconnected from that port then a future virtual machine connected to that port may receive a less secure port."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nReview the \"Configure reset at disconnect\" setting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n(Get-VDPortgroup).ExtensionData.Config.Policy.PortConfigResetAtDisconnect\n\nIf there are any distributed port groups with \"Configure reset at disconnect\" configured to \"disabled\" or \"False\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nSelect advanced and update \"Configure reset at disconnect\" to be enabled and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n$pgs = Get-VDPortgroup | Get-View\nForEach($pg in $pgs){\n$spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n$spec.configversion = $pg.Config.ConfigVersion\n$spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n$spec.Policy.PortConfigResetAtDisconnect = $True\n$pg.ReconfigureDVPortgroup_Task($spec)\n}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000302","rid":"SV-VCSA-80-000302","stig_id":"VCSA-80-000302","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000302' do\n  title 'The vCenter Server must reset port configuration when virtual machines are disconnected.'\n  desc  \"\n    Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\n    If any unknown or unauthorized per-port overrides exist and are not discarded when a virtual machine is disconnected from that port then a future virtual machine connected to that port may receive a less secure port.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Review the \\\"Configure reset at disconnect\\\" setting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    (Get-VDPortgroup).ExtensionData.Config.Policy.PortConfigResetAtDisconnect\n\n    If there are any distributed port groups with \\\"Configure reset at disconnect\\\" configured to \\\"disabled\\\" or \\\"False\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Select advanced and update \\\"Configure reset at disconnect\\\" to be enabled and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    $pgs = Get-VDPortgroup | Get-View\n    ForEach($pg in $pgs){\n    $spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n    $spec.configversion = $pg.Config.ConfigVersion\n    $spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n    $spec.Policy.PortConfigResetAtDisconnect = $True\n    $pg.ReconfigureDVPortgroup_Task($spec)\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000302'\n  tag rid: 'SV-VCSA-80-000302'\n  tag stig_id: 'VCSA-80-000302'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'True' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000302.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000303","title":"The vCenter Server must disable Secure Shell (SSH) access.","desc":"vCenter Server is delivered as an appliance, and intended to be managed through the VAMI, vSphere Client, and APIs. SSH is a troubleshooting and support tool and should only be enabled when necessary.\n\nvCenter Server High Availability uses SSH to coordinate the replication and failover between the nodes. Use of this feature requires SSH to remain enabled.","descriptions":[{"label":"default","data":"vCenter Server is delivered as an appliance, and intended to be managed through the VAMI, vSphere Client, and APIs. SSH is a troubleshooting and support tool and should only be enabled when necessary.\n\nvCenter Server High Availability uses SSH to coordinate the replication and failover between the nodes. Use of this feature requires SSH to remain enabled."},{"label":"rationale","data":""},{"label":"check","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Access\" on the left navigation pane.\n\nIf \"SSH Login\" is not \"Deactivated\", this is a finding."},{"label":"fix","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Access\" on the left navigation pane.\n\nClick \"Edit\" then disable \"Activate SSH Login\" and click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000303","rid":"SV-VCSA-80-000303","stig_id":"VCSA-80-000303","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000303' do\n  title 'The vCenter Server must disable Secure Shell (SSH) access.'\n  desc  \"\n    vCenter Server is delivered as an appliance, and intended to be managed through the VAMI, vSphere Client, and APIs. SSH is a troubleshooting and support tool and should only be enabled when necessary.\n\n    vCenter Server High Availability uses SSH to coordinate the replication and failover between the nodes. Use of this feature requires SSH to remain enabled.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Access\\\" on the left navigation pane.\n\n    If \\\"SSH Login\\\" is not \\\"Deactivated\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Access\\\" on the left navigation pane.\n\n    Click \\\"Edit\\\" then disable \\\"Activate SSH Login\\\" and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000303'\n  tag rid: 'SV-VCSA-80-000303'\n  tag stig_id: 'VCSA-80-000303'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe powercli_command('Invoke-GetAccessSsh').stdout.strip do\n    it { should_not cmp 'true' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000303.rb"},"waiver_data":{},"results":[]},{"id":"VCSA-80-000304","title":"The vCenter Server must enable data in transit encryption for vSAN.","desc":"Transit encryption must be enabled to prevent unauthorized disclosure information and to protect the confidentiality of organizational information.\n\nvSAN data-in-transit encryption has the following characteristics:\n-vSAN uses AES-256 bit encryption on data in transit.\n-Forward secrecy is enforced for vSAN data-in-transit encryption.\n-Traffic between data hosts and witness hosts is encrypted.\n-File service data traffic between the VDFS proxy and VDFS server is encrypted.\n-vSAN file services inter-host connections are encrypted.\n-vSAN uses symmetric keys that are generated dynamically and shared between hosts. Hosts dynamically generate an encryption key when they establish a connection, and they use the key to encrypt all traffic between the hosts. You do not need a key management server to perform data-in-transit encryption.\n\nEach host is authenticated when it joins the cluster, ensuring connections only to trusted hosts are allowed. When a host is removed from the cluster, it is authentication certificate is removed.\n\nvSAN data-in-transit encryption is a cluster-wide setting. When enabled, all data and metadata traffic is encrypted as it transits across hosts.","descriptions":[{"label":"default","data":"Transit encryption must be enabled to prevent unauthorized disclosure information and to protect the confidentiality of organizational information.\n\nvSAN data-in-transit encryption has the following characteristics:\n-vSAN uses AES-256 bit encryption on data in transit.\n-Forward secrecy is enforced for vSAN data-in-transit encryption.\n-Traffic between data hosts and witness hosts is encrypted.\n-File service data traffic between the VDFS proxy and VDFS server is encrypted.\n-vSAN file services inter-host connections are encrypted.\n-vSAN uses symmetric keys that are generated dynamically and shared between hosts. Hosts dynamically generate an encryption key when they establish a connection, and they use the key to encrypt all traffic between the hosts. You do not need a key management server to perform data-in-transit encryption.\n\nEach host is authenticated when it joins the cluster, ensuring connections only to trusted hosts are allowed. When a host is removed from the cluster, it is authentication certificate is removed.\n\nvSAN data-in-transit encryption is a cluster-wide setting. When enabled, all data and metadata traffic is encrypted as it transits across hosts."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\nReview the \"Data-in-transit encryption\" status.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system\n$vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name <cluster name>).ExtensionData.MoRef).DataInTransitEncryptionConfig\n\nRepeat these steps for each vSAN enabled cluster in the environment.\n\nIf \"Data-In-Transit encryption\" is not enabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\nClick \"Edit\".\n\nEnable \"Data-In-Transit encryption\" and choose a rekey interval suitable for the environment then click \"Apply\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000304","rid":"SV-VCSA-80-000304","stig_id":"VCSA-80-000304","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000304' do\n  title 'The vCenter Server must enable data in transit encryption for vSAN.'\n  desc  \"\n    Transit encryption must be enabled to prevent unauthorized disclosure information and to protect the confidentiality of organizational information.\n\n    vSAN data-in-transit encryption has the following characteristics:\n    -vSAN uses AES-256 bit encryption on data in transit.\n    -Forward secrecy is enforced for vSAN data-in-transit encryption.\n    -Traffic between data hosts and witness hosts is encrypted.\n    -File service data traffic between the VDFS proxy and VDFS server is encrypted.\n    -vSAN file services inter-host connections are encrypted.\n    -vSAN uses symmetric keys that are generated dynamically and shared between hosts. Hosts dynamically generate an encryption key when they establish a connection, and they use the key to encrypt all traffic between the hosts. You do not need a key management server to perform data-in-transit encryption.\n\n    Each host is authenticated when it joins the cluster, ensuring connections only to trusted hosts are allowed. When a host is removed from the cluster, it is authentication certificate is removed.\n\n    vSAN data-in-transit encryption is a cluster-wide setting. When enabled, all data and metadata traffic is encrypted as it transits across hosts.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Review the \\\"Data-in-transit encryption\\\" status.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system\n    $vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name <cluster name>).ExtensionData.MoRef).DataInTransitEncryptionConfig\n\n    Repeat these steps for each vSAN enabled cluster in the environment.\n\n    If \\\"Data-In-Transit encryption\\\" is not enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Click \\\"Edit\\\".\n\n    Enable \\\"Data-In-Transit encryption\\\" and choose a rekey interval suitable for the environment then click \\\"Apply\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000304'\n  tag rid: 'SV-VCSA-80-000304'\n  tag stig_id: 'VCSA-80-000304'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  # Get all clusters with vSAN enabled\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object | Select-Object -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !clusters.empty?\n    clusters.each do |cluster|\n      command = \"$vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system; $vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name #{cluster}).ExtensionData.MoRef).DataInTransitEncryptionConfig.Enabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No clusters with vSAN enabled found...skipping tests' do\n      skip 'No clusters with vSAN enabled found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000304.rb"},"waiver_data":{},"results":[]}],"status":"loaded","status_message":""},{"name":"VMware vSphere 8.0 ESXi STIG Readiness Guide","version":"1.0.1","sha256":"2bcc2c137feae91b11def65ec768521718f04b22c0b53c3f1946c843c4a9a10b","title":"VMware vSphere 8.0 ESXi STIG Readiness Guide","maintainer":"The Authors","summary":"An InSpec Compliance Profile","license":"Apache-2.0","copyright":"The Authors","supports":[],"attributes":[],"parent_profile":"vmware-vsphere-8.0-stig-baseline","groups":[{"id":"controls/ESXI-80-000005.rb","controls":["ESXI-80-000005"]},{"id":"controls/ESXI-80-000006.rb","controls":["ESXI-80-000006"]},{"id":"controls/ESXI-80-000008.rb","controls":["ESXI-80-000008"]},{"id":"controls/ESXI-80-000010.rb","controls":["ESXI-80-000010"]},{"id":"controls/ESXI-80-000014.rb","controls":["ESXI-80-000014"]},{"id":"controls/ESXI-80-000015.rb","controls":["ESXI-80-000015"]},{"id":"controls/ESXI-80-000035.rb","controls":["ESXI-80-000035"]},{"id":"controls/ESXI-80-000043.rb","controls":["ESXI-80-000043"]},{"id":"controls/ESXI-80-000047.rb","controls":["ESXI-80-000047"]},{"id":"controls/ESXI-80-000049.rb","controls":["ESXI-80-000049"]},{"id":"controls/ESXI-80-000052.rb","controls":["ESXI-80-000052"]},{"id":"controls/ESXI-80-000068.rb","controls":["ESXI-80-000068"]},{"id":"controls/ESXI-80-000085.rb","controls":["ESXI-80-000085"]},{"id":"controls/ESXI-80-000094.rb","controls":["ESXI-80-000094"]},{"id":"controls/ESXI-80-000111.rb","controls":["ESXI-80-000111"]},{"id":"controls/ESXI-80-000113.rb","controls":["ESXI-80-000113"]},{"id":"controls/ESXI-80-000114.rb","controls":["ESXI-80-000114"]},{"id":"controls/ESXI-80-000124.rb","controls":["ESXI-80-000124"]},{"id":"controls/ESXI-80-000133.rb","controls":["ESXI-80-000133"]},{"id":"controls/ESXI-80-000145.rb","controls":["ESXI-80-000145"]},{"id":"controls/ESXI-80-000160.rb","controls":["ESXI-80-000160"]},{"id":"controls/ESXI-80-000161.rb","controls":["ESXI-80-000161"]},{"id":"controls/ESXI-80-000187.rb","controls":["ESXI-80-000187"]},{"id":"controls/ESXI-80-000189.rb","controls":["ESXI-80-000189"]},{"id":"controls/ESXI-80-000191.rb","controls":["ESXI-80-000191"]},{"id":"controls/ESXI-80-000192.rb","controls":["ESXI-80-000192"]},{"id":"controls/ESXI-80-000193.rb","controls":["ESXI-80-000193"]},{"id":"controls/ESXI-80-000194.rb","controls":["ESXI-80-000194"]},{"id":"controls/ESXI-80-000195.rb","controls":["ESXI-80-000195"]},{"id":"controls/ESXI-80-000196.rb","controls":["ESXI-80-000196"]},{"id":"controls/ESXI-80-000198.rb","controls":["ESXI-80-000198"]},{"id":"controls/ESXI-80-000199.rb","controls":["ESXI-80-000199"]},{"id":"controls/ESXI-80-000201.rb","controls":["ESXI-80-000201"]},{"id":"controls/ESXI-80-000202.rb","controls":["ESXI-80-000202"]},{"id":"controls/ESXI-80-000203.rb","controls":["ESXI-80-000203"]},{"id":"controls/ESXI-80-000204.rb","controls":["ESXI-80-000204"]},{"id":"controls/ESXI-80-000205.rb","controls":["ESXI-80-000205"]},{"id":"controls/ESXI-80-000206.rb","controls":["ESXI-80-000206"]},{"id":"controls/ESXI-80-000207.rb","controls":["ESXI-80-000207"]},{"id":"controls/ESXI-80-000208.rb","controls":["ESXI-80-000208"]},{"id":"controls/ESXI-80-000209.rb","controls":["ESXI-80-000209"]},{"id":"controls/ESXI-80-000210.rb","controls":["ESXI-80-000210"]},{"id":"controls/ESXI-80-000211.rb","controls":["ESXI-80-000211"]},{"id":"controls/ESXI-80-000212.rb","controls":["ESXI-80-000212"]},{"id":"controls/ESXI-80-000213.rb","controls":["ESXI-80-000213"]},{"id":"controls/ESXI-80-000214.rb","controls":["ESXI-80-000214"]},{"id":"controls/ESXI-80-000215.rb","controls":["ESXI-80-000215"]},{"id":"controls/ESXI-80-000216.rb","controls":["ESXI-80-000216"]},{"id":"controls/ESXI-80-000217.rb","controls":["ESXI-80-000217"]},{"id":"controls/ESXI-80-000218.rb","controls":["ESXI-80-000218"]},{"id":"controls/ESXI-80-000219.rb","controls":["ESXI-80-000219"]},{"id":"controls/ESXI-80-000220.rb","controls":["ESXI-80-000220"]},{"id":"controls/ESXI-80-000221.rb","controls":["ESXI-80-000221"]},{"id":"controls/ESXI-80-000222.rb","controls":["ESXI-80-000222"]},{"id":"controls/ESXI-80-000223.rb","controls":["ESXI-80-000223"]},{"id":"controls/ESXI-80-000224.rb","controls":["ESXI-80-000224"]},{"id":"controls/ESXI-80-000225.rb","controls":["ESXI-80-000225"]},{"id":"controls/ESXI-80-000226.rb","controls":["ESXI-80-000226"]},{"id":"controls/ESXI-80-000227.rb","controls":["ESXI-80-000227"]},{"id":"controls/ESXI-80-000228.rb","controls":["ESXI-80-000228"]},{"id":"controls/ESXI-80-000229.rb","controls":["ESXI-80-000229"]},{"id":"controls/ESXI-80-000230.rb","controls":["ESXI-80-000230"]},{"id":"controls/ESXI-80-000231.rb","controls":["ESXI-80-000231"]},{"id":"controls/ESXI-80-000232.rb","controls":["ESXI-80-000232"]},{"id":"controls/ESXI-80-000233.rb","controls":["ESXI-80-000233"]},{"id":"controls/ESXI-80-000234.rb","controls":["ESXI-80-000234"]},{"id":"controls/ESXI-80-000235.rb","controls":["ESXI-80-000235"]},{"id":"controls/ESXI-80-000236.rb","controls":["ESXI-80-000236"]},{"id":"controls/ESXI-80-000237.rb","controls":["ESXI-80-000237"]},{"id":"controls/ESXI-80-000238.rb","controls":["ESXI-80-000238"]},{"id":"controls/ESXI-80-000239.rb","controls":["ESXI-80-000239"]},{"id":"controls/ESXI-80-000240.rb","controls":["ESXI-80-000240"]},{"id":"controls/ESXI-80-000241.rb","controls":["ESXI-80-000241"]},{"id":"controls/ESXI-80-000243.rb","controls":["ESXI-80-000243"]},{"id":"controls/ESXI-80-000244.rb","controls":["ESXI-80-000244"]},{"id":"controls/ESXI-80-000245.rb","controls":["ESXI-80-000245"]},{"id":"controls/ESXI-80-000246.rb","controls":["ESXI-80-000246"]}],"controls":[{"id":"ESXI-80-000005","title":"The ESXi host must enforce the limit of three consecutive invalid logon attempts by a user.","desc":"By limiting the number of failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Once the configured number of attempts is reached, the account is locked by the ESXi host.","descriptions":[{"label":"default","data":"By limiting the number of failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Once the configured number of attempts is reached, the account is locked by the ESXi host."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.AccountLockFailures\" value and verify it is set to \"3\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures\n\nIf the \"Security.AccountLockFailures\" setting is set to a value other than \"3\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.AccountLockFailures\" value and configure it to \"3\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures | Set-AdvancedSetting -Value 3"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000021-VMM-000050","gid":"V-ESXI-80-000005","rid":"SV-ESXI-80-000005","stig_id":"ESXI-80-000005","cci":["CCI-000044"],"nist":["AC-7 a"]},"code":"control 'ESXI-80-000005' do\n  title 'The ESXi host must enforce the limit of three consecutive invalid logon attempts by a user.'\n  desc  'By limiting the number of failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Once the configured number of attempts is reached, the account is locked by the ESXi host.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.AccountLockFailures\\\" value and verify it is set to \\\"3\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures\n\n    If the \\\"Security.AccountLockFailures\\\" setting is set to a value other than \\\"3\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.AccountLockFailures\\\" value and configure it to \\\"3\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountLockFailures | Set-AdvancedSetting -Value 3\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000021-VMM-000050'\n  tag gid: 'V-ESXI-80-000005'\n  tag rid: 'SV-ESXI-80-000005'\n  tag stig_id: 'ESXI-80-000005'\n  tag cci: ['CCI-000044']\n  tag nist: ['AC-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.AccountLockFailures | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '3' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000005.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.AccountLockFailures | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"3\"","run_time":0.5624994,"start_time":"2023-06-07T08:28:29-06:00","message":"\nexpected: 3\n     got: 0\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.AccountLockFailures | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000006","title":"The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via the Direct Console User Interface (DCUI).","desc":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Annotations.WelcomeMessage\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage\n\nIf the \"Annotations.WelcomeMessage\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Annotations.WelcomeMessage\" value and set it to the following. Click \"OK\".\n\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{hostname} , {ip}{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{esxproduct} {esxversion}{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{memory} RAM{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:black}{color:white}\t{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By      {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  using this IS (which includes any device attached to this IS), you consent to the following conditions:                 {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited     {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law      {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          enforcement (LE), and counterintelligence (CI) investigations.                                                  {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       At any time, the USG may inspect and seize data stored on this IS.                                              {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Communications using, or data stored on, this IS are not private, are subject to routine monitoring,            {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          interception, and search, and may be disclosed or used for any USG-authorized purpose.                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not     {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          for your personal benefit or privacy.                                                                           {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching    {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or monitoring of the content of privileged communications, or work product, related to personal representation  {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work       {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          product are private and confidential. See User Agreement for details.                                           {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n{bgcolor:black} {/color}{align:left}{bgcolor:dark-grey}{color:white}  <F2> Accept Conditions and Customize System / View Logs{/align}{align:right}<F12> Accept Conditions and Shut Down/Restart  {bgcolor:black} {/color}{/color}{/bgcolor}{/align}\n{bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Set-AdvancedSetting -Value \"<Banner text above>\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000023-VMM-000060","satisfies":["SRG-OS-000024-VMM-000070"],"gid":"V-ESXI-80-000006","rid":"SV-ESXI-80-000006","stig_id":"ESXI-80-000006","cci":["CCI-000048","CCI-000050"],"nist":["AC-8 a","AC-8 b"]},"code":"control 'ESXI-80-000006' do\n  title 'The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via the Direct Console User Interface (DCUI).'\n  desc  \"\n    Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Annotations.WelcomeMessage\\\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage\n\n    If the \\\"Annotations.WelcomeMessage\\\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Annotations.WelcomeMessage\\\" value and set it to the following. Click \\\"OK\\\".\n\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{hostname} , {ip}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{esxproduct} {esxversion}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:yellow}{memory} RAM{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:black}{color:white}\\t{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  using this IS (which includes any device attached to this IS), you consent to the following conditions:                 {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law      {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          enforcement (LE), and counterintelligence (CI) investigations.                                                  {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       At any time, the USG may inspect and seize data stored on this IS.                                              {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Communications using, or data stored on, this IS are not private, are subject to routine monitoring,            {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          interception, and search, and may be disclosed or used for any USG-authorized purpose.                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not     {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          for your personal benefit or privacy.                                                                           {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}  -       Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching    {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or monitoring of the content of privileged communications, or work product, related to personal representation  {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work       {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}          product are private and confidential. See User Agreement for details.                                           {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{align:left}{bgcolor:yellow}{color:black}                                                                                                                          {/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n    {bgcolor:black} {/color}{align:left}{bgcolor:dark-grey}{color:white}  <F2> Accept Conditions and Customize System / View Logs{/align}{align:right}<F12> Accept Conditions and Shut Down/Restart  {bgcolor:black} {/color}{/color}{/bgcolor}{/align}\n    {bgcolor:black} {/color}{bgcolor:dark-grey}{color:black}                                                                                                                          {/color}{/bgcolor}\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Set-AdvancedSetting -Value \\\"<Banner text above>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag satisfies: ['SRG-OS-000024-VMM-000070']\n  tag gid: 'V-ESXI-80-000006'\n  tag rid: 'SV-ESXI-80-000006'\n  tag stig_id: 'ESXI-80-000006'\n  tag cci: ['CCI-000048', 'CCI-000050']\n  tag nist: ['AC-8 a', 'AC-8 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      result = powercli_command(\"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Select-Object -ExpandProperty Value\")\n      describe.one do\n        describe result do\n          its('stdout.strip') { should match 'You are accessing a U.S. Government' }\n        end\n        describe result do\n          its('stdout.strip') { should match \"I've read & consent to terms in IS user agreem't\" }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000006.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Select-Object -ExpandProperty Value stdout.strip is expected to match \"You are accessing a U.S. Government\"","run_time":0.0004147,"start_time":"2023-06-07T08:28:29-06:00","message":"expected \"\" to match \"You are accessing a U.S. Government\"","exception":"RSpec::Core::MultipleExceptionError","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Select-Object -ExpandProperty Value stdout.strip is expected to match \"I've read & consent to terms in IS user agreem't\"","run_time":0.0002669,"start_time":"2023-06-07T08:28:29-06:00","message":"expected \"\" to match \"I've read & consent to terms in IS user agreem't\"","exception":"RSpec::Core::MultipleExceptionError","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Annotations.WelcomeMessage | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000008","title":"The ESXi host must enable lockdown mode.","desc":"Enabling Lockdown Mode disables direct access to an ESXi host, requiring the host to be managed remotely from vCenter Server. This is done to ensure the roles and access controls implemented in vCenter are always enforced and users cannot bypass them by logging on to a host directly.\n\nBy forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced.","descriptions":[{"label":"default","data":"Enabling Lockdown Mode disables direct access to an ESXi host, requiring the host to be managed remotely from vCenter Server. This is done to ensure the roles and access controls implemented in vCenter are always enforced and users cannot bypass them by logging on to a host directly.\n\nBy forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nScroll down to \"Lockdown Mode\" and verify it is set to \"Enabled\" (Normal or Strict).\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Select Name,@{N=\"Lockdown\";E={$_.Extensiondata.Config.LockdownMode}}\n\nIf \"Lockdown Mode\" is disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile >> Lockdown Mode.\n\nClick edit and select either the \"Normal\" or \"Strict\" radio buttons.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$level = \"lockdownNormal\" OR \"lockdownStrict\"\n$vmhost = Get-VMHost -Name <hostname> | Get-View\n$lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n$lockdown.ChangeLockdownMode($level)\n\nNote: In strict lockdown mode, the Direct Console User Interface (DCUI) service is stopped. If the connection to vCenter Server is lost and the vSphere Client is no longer available, the ESXi host becomes inaccessible."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000027-VMM-000080","gid":"V-ESXI-80-000008","rid":"SV-ESXI-80-000008","stig_id":"ESXI-80-000008","cci":["CCI-000054"],"nist":["AC-10"]},"code":"control 'ESXI-80-000008' do\n  title 'The ESXi host must enable lockdown mode.'\n  desc  \"\n    Enabling Lockdown Mode disables direct access to an ESXi host, requiring the host to be managed remotely from vCenter Server. This is done to ensure the roles and access controls implemented in vCenter are always enforced and users cannot bypass them by logging on to a host directly.\n\n    By forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Scroll down to \\\"Lockdown Mode\\\" and verify it is set to \\\"Enabled\\\" (Normal or Strict).\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Select Name,@{N=\\\"Lockdown\\\";E={$_.Extensiondata.Config.LockdownMode}}\n\n    If \\\"Lockdown Mode\\\" is disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile >> Lockdown Mode.\n\n    Click edit and select either the \\\"Normal\\\" or \\\"Strict\\\" radio buttons.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $level = \\\"lockdownNormal\\\" OR \\\"lockdownStrict\\\"\n    $vmhost = Get-VMHost -Name <hostname> | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.ChangeLockdownMode($level)\n\n    Note: In strict lockdown mode, the Direct Console User Interface (DCUI) service is stopped. If the connection to vCenter Server is lost and the vSphere Client is no longer available, the ESXi host becomes inaccessible.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000027-VMM-000080'\n  tag gid: 'V-ESXI-80-000008'\n  tag rid: 'SV-ESXI-80-000008'\n  tag stig_id: 'ESXI-80-000008'\n  tag cci: ['CCI-000054']\n  tag nist: ['AC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    list = ['lockdownNormal', 'lockdownStrict']\n    vmhosts.each do |vmhost|\n      command = \"(Get-VMHost -Name #{vmhost}).Extensiondata.Config.LockdownMode\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should be_in list }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000008.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-VMHost -Name 10.186.25.26).Extensiondata.Config.LockdownMode stdout.strip is expected to be in \"lockdownNormal\" and \"lockdownStrict\"","run_time":2.2690875,"start_time":"2023-06-07T08:28:29-06:00","message":"expected `lockdownDisabled` to be in the list: `[\"lockdownNormal\", \"lockdownStrict\"]`","resource_class":"powercli_command","resource_params":"[\"(Get-VMHost -Name 10.186.25.26).Extensiondata.Config.LockdownMode\"]","resource_id":""}]},{"id":"ESXI-80-000010","title":"The ESXi host client must be configured with an idle session timeout.","desc":"The ESXi host client is the UI served up by the host itself, outside of vCenter. It is accessed by browsing to \"https://<ESX FQDN>/ui\". ESXi is not usually administered via this interface for long periods and all users will be highly privileged. Implementing a mandatory session idle limit will ensure that orphaned, forgotten or ignored sessions will be closed promptly.","descriptions":[{"label":"default","data":"The ESXi host client is the UI served up by the host itself, outside of vCenter. It is accessed by browsing to \"https://<ESX FQDN>/ui\". ESXi is not usually administered via this interface for long periods and all users will be highly privileged. Implementing a mandatory session idle limit will ensure that orphaned, forgotten or ignored sessions will be closed promptly."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.HostClientSessionTimeout\" value and verify it is set to \"900\" or less.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout\n\nIf the \"UserVars.HostClientSessionTimeout\" setting is not set to \"900\" or less, this is a finding."},{"label":"fix","data":"Fom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.HostClientSessionTimeout\" value and configure it to \"900\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Set-AdvancedSetting -Value \"900\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000029-VMM-000100","gid":"V-ESXI-80-000010","rid":"SV-ESXI-80-000010","stig_id":"ESXI-80-000010","cci":["CCI-000057"],"nist":["AC-11 a"]},"code":"control 'ESXI-80-000010' do\n  title 'The ESXi host client must be configured with an idle session timeout.'\n  desc  'The ESXi host client is the UI served up by the host itself, outside of vCenter. It is accessed by browsing to \"https://<ESX FQDN>/ui\". ESXi is not usually administered via this interface for long periods and all users will be highly privileged. Implementing a mandatory session idle limit will ensure that orphaned, forgotten or ignored sessions will be closed promptly.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.HostClientSessionTimeout\\\" value and verify it is set to \\\"900\\\" or less.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout\n\n    If the \\\"UserVars.HostClientSessionTimeout\\\" setting is not set to \\\"900\\\" or less, this is a finding.\n  \"\n  desc  'fix', \"\n    Fom the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.HostClientSessionTimeout\\\" value and configure it to \\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Set-AdvancedSetting -Value \\\"900\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000029-VMM-000100'\n  tag gid: 'V-ESXI-80-000010'\n  tag rid: 'SV-ESXI-80-000010'\n  tag stig_id: 'ESXI-80-000010'\n  tag cci: ['CCI-000057']\n  tag nist: ['AC-11 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 900 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000010.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Select-Object -ExpandProperty Value stdout.strip is expected to cmp <= 900","run_time":0.5977933,"start_time":"2023-06-07T08:28:32-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.HostClientSessionTimeout | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000014","title":"The ESXi host Secure Shell (SSH) daemon must use FIPS 140-2 validated cryptographic modules to protect the confidentiality of remote access sessions.","desc":"Without confidentiality protection mechanisms, unauthorized individuals may gain access to sensitive information via a remote access session.\n\nOpenSSH on the ESXi host ships with a FIPS 140-2 validated cryptographic module and it is enabled by default. For backward compatibility reasons, this can be disabled so this setting must be audited and corrected if necessary.","descriptions":[{"label":"default","data":"Without confidentiality protection mechanisms, unauthorized individuals may gain access to sensitive information via a remote access session.\n\nOpenSSH on the ESXi host ships with a FIPS 140-2 validated cryptographic module and it is enabled by default. For backward compatibility reasons, this can be disabled so this setting must be audited and corrected if necessary."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli system security fips140 ssh get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.security.fips140.ssh.get.invoke()\n\nExpected result:\n\nEnabled: true\n\nIf the FIPS mode is not enabled for SSH, this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# esxcli system security fips140 ssh set -e true\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.security.fips140.ssh.set.CreateArgs()\n$arguments.enable = $true\n$esxcli.system.security.fips140.ssh.set.Invoke($arguments)"}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000033-VMM-000140","gid":"V-ESXI-80-000014","rid":"SV-ESXI-80-000014","stig_id":"ESXI-80-000014","cci":["CCI-000068"],"nist":["AC-17 (2)"]},"code":"control 'ESXI-80-000014' do\n  title 'The ESXi host Secure Shell (SSH) daemon must use FIPS 140-2 validated cryptographic modules to protect the confidentiality of remote access sessions.'\n  desc  \"\n    Without confidentiality protection mechanisms, unauthorized individuals may gain access to sensitive information via a remote access session.\n\n    OpenSSH on the ESXi host ships with a FIPS 140-2 validated cryptographic module and it is enabled by default. For backward compatibility reasons, this can be disabled so this setting must be audited and corrected if necessary.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system security fips140 ssh get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.security.fips140.ssh.get.invoke()\n\n    Expected result:\n\n    Enabled: true\n\n    If the FIPS mode is not enabled for SSH, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system security fips140 ssh set -e true\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.security.fips140.ssh.set.CreateArgs()\n    $arguments.enable = $true\n    $esxcli.system.security.fips140.ssh.set.Invoke($arguments)\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000033-VMM-000140'\n  tag gid: 'V-ESXI-80-000014'\n  tag rid: 'SV-ESXI-80-000014'\n  tag stig_id: 'ESXI-80-000014'\n  tag cci: ['CCI-000068']\n  tag nist: ['AC-17 (2)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.security.fips140.ssh.get.invoke() | Select-Object -ExpandProperty Enabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000014.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.security.fips140.ssh.get.invoke() | Select-Object -ExpandProperty Enabled stdout.strip is expected to cmp == \"true\"","run_time":0.5671294,"start_time":"2023-06-07T08:28:32-06:00","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.security.fips140.ssh.get.invoke() | Select-Object -ExpandProperty Enabled\"]","resource_id":""}]},{"id":"ESXI-80-000015","title":"The ESXi must produce audit records containing information to establish what type of events occurred.","desc":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.","descriptions":[{"label":"default","data":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.log.level\" value and verify it is set to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level\n\nIf the \"Config.HostAgent.log.level\" setting is not set to \"info\", this is a finding.\n\nNote: Verbose logging level is acceptable for troubleshooting purposes."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.log.level\" value and configure it to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level | Set-AdvancedSetting -Value \"info\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000037-VMM-000150","satisfies":["SRG-OS-000063-VMM-000310"],"gid":"V-ESXI-80-000015","rid":"SV-ESXI-80-000015","stig_id":"ESXI-80-000015","cci":["CCI-000130","CCI-000171"],"nist":["AU-12 b","AU-3"]},"code":"control 'ESXI-80-000015' do\n  title 'The ESXi must produce audit records containing information to establish what type of events occurred.'\n  desc  'Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack. '\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.log.level\\\" value and verify it is set to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level\n\n    If the \\\"Config.HostAgent.log.level\\\" setting is not set to \\\"info\\\", this is a finding.\n\n    Note: Verbose logging level is acceptable for troubleshooting purposes.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.log.level\\\" value and configure it to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.log.level | Set-AdvancedSetting -Value \\\"info\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000037-VMM-000150'\n  tag satisfies: ['SRG-OS-000063-VMM-000310']\n  tag gid: 'V-ESXI-80-000015'\n  tag rid: 'SV-ESXI-80-000015'\n  tag stig_id: 'ESXI-80-000015'\n  tag cci: ['CCI-000130', 'CCI-000171']\n  tag nist: ['AU-12 b', 'AU-3']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.log.level | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'info' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000015.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.HostAgent.log.level | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"info\"","run_time":0.745432,"start_time":"2023-06-07T08:28:33-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.HostAgent.log.level | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000035","title":"The ESXi host must enforce password complexity by configuring a password quality policy.","desc":"To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated.\n\nThe use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.","descriptions":[{"label":"default","data":"To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated.\n\nThe use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.PasswordQualityControl\" value and verify it is set to \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl\n\nIf the \"Security.PasswordQualityControl\" setting is set to a value other than \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.PasswordQualityControl\" value and configure it to \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl | Set-AdvancedSetting -Value \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000069-VMM-000360","satisfies":["SRG-OS-000070-VMM-000370","SRG-OS-000071-VMM-000380","SRG-OS-000072-VMM-000390","SRG-OS-000078-VMM-000450","SRG-OS-000266-VMM-000940"],"gid":"V-ESXI-80-000035","rid":"SV-ESXI-80-000035","stig_id":"ESXI-80-000035","cci":["CCI-000192","CCI-000193","CCI-000194","CCI-000195","CCI-000205","CCI-001619"],"nist":["IA-5 (1) (a)","IA-5 (1) (b)"]},"code":"control 'ESXI-80-000035' do\n  title 'The ESXi host must enforce password complexity by configuring a password quality policy.'\n  desc  \"\n    To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated.\n\n    The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.PasswordQualityControl\\\" value and verify it is set to \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl\n\n    If the \\\"Security.PasswordQualityControl\\\" setting is set to a value other than \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.PasswordQualityControl\\\" value and configure it to \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordQualityControl | Set-AdvancedSetting -Value \\\"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000069-VMM-000360'\n  tag satisfies: ['SRG-OS-000070-VMM-000370', 'SRG-OS-000071-VMM-000380', 'SRG-OS-000072-VMM-000390', 'SRG-OS-000078-VMM-000450', 'SRG-OS-000266-VMM-000940']\n  tag gid: 'V-ESXI-80-000035'\n  tag rid: 'SV-ESXI-80-000035'\n  tag stig_id: 'ESXI-80-000035'\n  tag cci: ['CCI-000192', 'CCI-000193', 'CCI-000194', 'CCI-000195', 'CCI-000205', 'CCI-001619']\n  tag nist: ['IA-5 (1) (a)', 'IA-5 (1) (b)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.PasswordQualityControl | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'similar=deny retry=3 min=disabled,disabled,disabled,disabled,15' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000035.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.PasswordQualityControl | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\"","run_time":0.5948543,"start_time":"2023-06-07T08:28:33-06:00","message":"\nexpected: similar=deny retry=3 min=disabled,disabled,disabled,disabled,15\n     got: retry=3 min=disabled,disabled,disabled,7,7\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.PasswordQualityControl | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000043","title":"The ESXi host must prohibit password reuse for a minimum of five generations.","desc":"If a user or root used the same password continuously or was allowed to change it back shortly after being forced to change it to something else, it would provide a potential intruder with the opportunity to keep guessing at one user's password until it was guessed correctly.","descriptions":[{"label":"default","data":"If a user or root used the same password continuously or was allowed to change it back shortly after being forced to change it to something else, it would provide a potential intruder with the opportunity to keep guessing at one user's password until it was guessed correctly."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.PasswordHistory\" value and verify it is set to \"5\" or greater.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory\n\nIf the \"Security.PasswordHistory\" setting is set to a value other than 5 or greater, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.PasswordHistory\" value and configure it to \"5\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory | Set-AdvancedSetting -Value 5"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000077-VMM-000440","gid":"V-ESXI-80-000043","rid":"SV-ESXI-80-000043","stig_id":"ESXI-80-000043","cci":["CCI-000200"],"nist":["IA-5 (1) (e)"]},"code":"control 'ESXI-80-000043' do\n  title 'The ESXi host must prohibit password reuse for a minimum of five generations.'\n  desc  \"If a user or root used the same password continuously or was allowed to change it back shortly after being forced to change it to something else, it would provide a potential intruder with the opportunity to keep guessing at one user's password until it was guessed correctly.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.PasswordHistory\\\" value and verify it is set to \\\"5\\\" or greater.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory\n\n    If the \\\"Security.PasswordHistory\\\" setting is set to a value other than 5 or greater, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.PasswordHistory\\\" value and configure it to \\\"5\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordHistory | Set-AdvancedSetting -Value 5\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000077-VMM-000440'\n  tag gid: 'V-ESXI-80-000043'\n  tag rid: 'SV-ESXI-80-000043'\n  tag stig_id: 'ESXI-80-000043'\n  tag cci: ['CCI-000200']\n  tag nist: ['IA-5 (1) (e)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.PasswordHistory | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '5' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000043.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.PasswordHistory | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"5\"","run_time":0.5999288,"start_time":"2023-06-07T08:28:34-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.PasswordHistory | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000047","title":"The ESXi host must be configured to disable nonessential capabilities by disabling the Managed Object Browser (MOB).","desc":"The MOB provides a way to explore the object model used by the VMkernel to manage the host and enables configurations to be changed. This interface is meant to be used primarily for debugging the vSphere Software Development Kit (SDK), but because there are no access controls it could also be used as a method to obtain information about a host being targeted for unauthorized access.","descriptions":[{"label":"default","data":"The MOB provides a way to explore the object model used by the VMkernel to manage the host and enables configurations to be changed. This interface is meant to be used primarily for debugging the vSphere Software Development Kit (SDK), but because there are no access controls it could also be used as a method to obtain information about a host being targeted for unauthorized access."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.plugins.solo.enableMob\" value and verify it is set to \"false\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob\n\nIf the \"Config.HostAgent.plugins.solo.enableMob\" setting is not set to \"false\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.plugins.solo.enableMob\" value and configure it to \"false\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Set-AdvancedSetting -Value false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000095-VMM-000480","gid":"V-ESXI-80-000047","rid":"SV-ESXI-80-000047","stig_id":"ESXI-80-000047","cci":["CCI-000381"],"nist":["CM-7 a"]},"code":"control 'ESXI-80-000047' do\n  title 'The ESXi host must be configured to disable nonessential capabilities by disabling the Managed Object Browser (MOB).'\n  desc  'The MOB provides a way to explore the object model used by the VMkernel to manage the host and enables configurations to be changed. This interface is meant to be used primarily for debugging the vSphere Software Development Kit (SDK), but because there are no access controls it could also be used as a method to obtain information about a host being targeted for unauthorized access.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.plugins.solo.enableMob\\\" value and verify it is set to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob\n\n    If the \\\"Config.HostAgent.plugins.solo.enableMob\\\" setting is not set to \\\"false\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.plugins.solo.enableMob\\\" value and configure it to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Set-AdvancedSetting -Value false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag gid: 'V-ESXI-80-000047'\n  tag rid: 'SV-ESXI-80-000047'\n  tag stig_id: 'ESXI-80-000047'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000047.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"false\"","run_time":0.5672678,"start_time":"2023-06-07T08:28:35-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.HostAgent.plugins.solo.enableMob | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000049","title":"The ESXi host must uniquely identify and must authenticate organizational users by using Active Directory.","desc":"Join ESXi hosts to an Active Directory domain to eliminate the need to create and maintain multiple local user accounts. Using Active Directory for user authentication simplifies the ESXi host configuration, ensures password complexity and reuse policies are enforced, and reduces the risk of security breaches and unauthorized access.\n\nNote: If the Active Directory group \"ESX Admins\" (default) exists, all users and groups assigned as members to this group will have full administrative access to all ESXi hosts in the domain.","descriptions":[{"label":"default","data":"Join ESXi hosts to an Active Directory domain to eliminate the need to create and maintain multiple local user accounts. Using Active Directory for user authentication simplifies the ESXi host configuration, ensures password complexity and reuse policies are enforced, and reduces the risk of security breaches and unauthorized access.\n\nNote: If the Active Directory group \"ESX Admins\" (default) exists, all users and groups assigned as members to this group will have full administrative access to all ESXi hosts in the domain."},{"label":"rationale","data":""},{"label":"check","data":"For systems that do not use Active Directory and have no local user accounts other than root and/or service accounts, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Authentication Services.\n\nVerify the \"Directory Services Type\" is set to \"Active Directory\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostAuthentication\n\nFor systems that do not use Active Directory and do have local user accounts, other than root and/or service accounts, this is a finding.\n\nIf the \"Directory Services Type\" is not set to \"Active Directory\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Authentication Services.\n\nClick \"Join Domain...\" and enter the AD domain to join.\n\nSelect the \"Using credentials\" radio button and enter the credentials of an account with permissions to join machines to AD (use UPN naming \"user@domain\"). Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostAuthentication | Set-VMHostAuthentication -JoinDomain -Domain \"domain name\" -User \"username\" -Password \"password\"\n\nIf any local user accounts are present besides root and service accounts, delete them by going to Host UI >> Manage >> Security & Users >> Users."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000104-VMM-000500","satisfies":["SRG-OS-000109-VMM-000550","SRG-OS-000112-VMM-000560","SRG-OS-000113-VMM-000570","SRG-OS-000123-VMM-000620"],"gid":"V-ESXI-80-000049","rid":"SV-ESXI-80-000049","stig_id":"ESXI-80-000049","cci":["CCI-000764","CCI-000770","CCI-001682","CCI-001941","CCI-001942"],"nist":["AC-2 (2)","IA-2","IA-2 (5)","IA-2 (8)","IA-2 (9)"]},"code":"control 'ESXI-80-000049' do\n  title 'The ESXi host must uniquely identify and must authenticate organizational users by using Active Directory.'\n  desc  \"\n    Join ESXi hosts to an Active Directory domain to eliminate the need to create and maintain multiple local user accounts. Using Active Directory for user authentication simplifies the ESXi host configuration, ensures password complexity and reuse policies are enforced, and reduces the risk of security breaches and unauthorized access.\n\n    Note: If the Active Directory group \\\"ESX Admins\\\" (default) exists, all users and groups assigned as members to this group will have full administrative access to all ESXi hosts in the domain.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For systems that do not use Active Directory and have no local user accounts other than root and/or service accounts, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Authentication Services.\n\n    Verify the \\\"Directory Services Type\\\" is set to \\\"Active Directory\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostAuthentication\n\n    For systems that do not use Active Directory and do have local user accounts, other than root and/or service accounts, this is a finding.\n\n    If the \\\"Directory Services Type\\\" is not set to \\\"Active Directory\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Authentication Services.\n\n    Click \\\"Join Domain...\\\" and enter the AD domain to join.\n\n    Select the \\\"Using credentials\\\" radio button and enter the credentials of an account with permissions to join machines to AD (use UPN naming \\\"user@domain\\\"). Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostAuthentication | Set-VMHostAuthentication -JoinDomain -Domain \\\"domain name\\\" -User \\\"username\\\" -Password \\\"password\\\"\n\n    If any local user accounts are present besides root and service accounts, delete them by going to Host UI >> Manage >> Security & Users >> Users.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000104-VMM-000500'\n  tag satisfies: ['SRG-OS-000109-VMM-000550', 'SRG-OS-000112-VMM-000560', 'SRG-OS-000113-VMM-000570', 'SRG-OS-000123-VMM-000620']\n  tag gid: 'V-ESXI-80-000049'\n  tag rid: 'SV-ESXI-80-000049'\n  tag stig_id: 'ESXI-80-000049'\n  tag cci: ['CCI-000764', 'CCI-000770', 'CCI-001682', 'CCI-001941', 'CCI-001942']\n  tag nist: ['AC-2 (2)', 'IA-2', 'IA-2 (5)', 'IA-2 (8)', 'IA-2 (9)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    if input('adJoined')\n      list = ['Joined', 'Ok']\n      vmhosts.each do |vmhost|\n        command = \"Get-VMHost -Name #{vmhost} | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should be_in list }\n        end\n      end\n    else\n      vmhosts.each do |vmhost|\n        command = \"Get-VMHost -Name #{vmhost} | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp '' }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000049.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus stdout.strip is expected to cmp == \"\"","run_time":0.0002824,"start_time":"2023-06-07T08:28:35-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"]","resource_id":""}]},{"id":"ESXI-80-000052","title":"The ESXi host Secure Shell (SSH) daemon must ignore .rhosts files.","desc":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH can emulate the behavior of the obsolete \"rsh\" command in allowing users to enable insecure access to their accounts via \".rhosts\" files.","descriptions":[{"label":"default","data":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH can emulate the behavior of the obsolete \"rsh\" command in allowing users to enable insecure access to their accounts via \".rhosts\" files."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep ignorerhosts\n\nExpected result:\n\nignorerhosts yes\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nIgnoreRhosts yes"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000107-VMM-000530","gid":"V-ESXI-80-000052","rid":"SV-ESXI-80-000052","stig_id":"ESXI-80-000052","cci":["CCI-000767"],"nist":["IA-2 (3)"]},"code":"control 'ESXI-80-000052' do\n  title 'The ESXi host Secure Shell (SSH) daemon must ignore .rhosts files.'\n  desc  'SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH can emulate the behavior of the obsolete \"rsh\" command in allowing users to enable insecure access to their accounts via \".rhosts\" files.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep ignorerhosts\n\n    Expected result:\n\n    ignorerhosts yes\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    IgnoreRhosts yes\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000107-VMM-000530'\n  tag gid: 'V-ESXI-80-000052'\n  tag rid: 'SV-ESXI-80-000052'\n  tag stig_id: 'ESXI-80-000052'\n  tag cci: ['CCI-000767']\n  tag nist: ['IA-2 (3)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000052.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":2.37e-05,"start_time":"2023-06-07T08:28:35-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000068","title":"The ESXi host must set a timeout to automatically end idle shell sessions after fifteen minutes.","desc":"If a user forgets to log out of their local or remote ESXi Shell session, the idle connection will remain open indefinitely and increase the likelihood of inappropriate host access via session hijacking. The \"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell sessions.","descriptions":[{"label":"default","data":"If a user forgets to log out of their local or remote ESXi Shell session, the idle connection will remain open indefinitely and increase the likelihood of inappropriate host access via session hijacking. The \"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell sessions."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.ESXiShellInteractiveTimeOut\" value and verify it is set to less than \"900\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n\nIf the \"UserVars.ESXiShellInteractiveTimeOut\" setting is set to a value greater than \"900\" or \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.ESXiShellInteractiveTimeOut\" value and configure it to \"900\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Set-AdvancedSetting -Value 900"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000163-VMM-000700","satisfies":["SRG-OS-000279-VMM-001010"],"gid":"V-ESXI-80-000068","rid":"SV-ESXI-80-000068","stig_id":"ESXI-80-000068","cci":["CCI-001133","CCI-002361"],"nist":["AC-12","SC-10"]},"code":"control 'ESXI-80-000068' do\n  title 'The ESXi host must set a timeout to automatically end idle shell sessions after fifteen minutes.'\n  desc  'If a user forgets to log out of their local or remote ESXi Shell session, the idle connection will remain open indefinitely and increase the likelihood of inappropriate host access via session hijacking. The \"ESXiShellInteractiveTimeOut\" allows the automatic termination of idle shell sessions.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" value and verify it is set to less than \\\"900\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut\n\n    If the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" setting is set to a value greater than \\\"900\\\" or \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.ESXiShellInteractiveTimeOut\\\" value and configure it to \\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Set-AdvancedSetting -Value 900\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag satisfies: ['SRG-OS-000279-VMM-001010']\n  tag gid: 'V-ESXI-80-000068'\n  tag rid: 'SV-ESXI-80-000068'\n  tag stig_id: 'ESXI-80-000068'\n  tag cci: ['CCI-001133', 'CCI-002361']\n  tag nist: ['AC-12', 'SC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 900 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000068.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Select-Object -ExpandProperty Value stdout.strip is expected to cmp <= 900","run_time":0.793578,"start_time":"2023-06-07T08:28:35-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Select-Object -ExpandProperty Value stdout.strip is expected not to cmp == 0","run_time":0.0004461,"start_time":"2023-06-07T08:28:36-06:00","message":"\nexpected: 0\n     got: 0\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellInteractiveTimeOut | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000085","title":"The ESXi host must implement Secure Boot enforcement.","desc":"Secure Boot is part of the UEFI firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and it requires that all ESXi kernel modules, drivers and VIBs be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. This control flips ESXi from merely supporting Secure Boot to requiring it. Without this setting enabled, and configuration encryption, an ESXi host could be subject to offline attacks. An attacker could simply transfer the ESXi install drive to a non-Secure Boot host and boot it up without ESXi complaining.","descriptions":[{"label":"default","data":"Secure Boot is part of the UEFI firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and it requires that all ESXi kernel modules, drivers and VIBs be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. This control flips ESXi from merely supporting Secure Boot to requiring it. Without this setting enabled, and configuration encryption, an ESXi host could be subject to offline attacks. An attacker could simply transfer the ESXi install drive to a non-Secure Boot host and boot it up without ESXi complaining."},{"label":"rationale","data":""},{"label":"check","data":"If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\nFrom an ESXi shell, run the following command:\n\n# esxcli system settings encryption get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.settings.encryption.get.invoke() | Select RequireSecureBoot\n\nExpected result:\n\nRequire Secure Boot: true\n\nIf \"Require Secure Boot\" is not enable, this is a finding."},{"label":"fix","data":"This setting cannot be configured until Secure Boot is properly enabled in the servers firmware.\n\nFrom an ESXi shell, run the following commands:\n\n# esxcli system settings encryption set --require-secure-boot=true\n# /sbin/auto-backup.sh\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n$arguments.requiresecureboot = $true\n$esxcli.system.settings.encryption.set.Invoke($arguments)\n\nEvacuate the host and gracefully reboot for changes to take effect."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000257-VMM-000910","satisfies":["SRG-OS-000258-VMM-000920","SRG-OS-000445-VMM-001780","SRG-OS-000446-VMM-001790"],"gid":"V-ESXI-80-000085","rid":"SV-ESXI-80-000085","stig_id":"ESXI-80-000085","cci":["CCI-001494","CCI-001495","CCI-002696","CCI-002699"],"nist":["AU-9","SI-6 a","SI-6 b"]},"code":"control 'ESXI-80-000085' do\n  title 'The ESXi host must implement Secure Boot enforcement.'\n  desc  \"\n    Secure Boot is part of the UEFI firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and it requires that all ESXi kernel modules, drivers and VIBs be signed by VMware or a partner subordinate.\n\n    Secure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. This control flips ESXi from merely supporting Secure Boot to requiring it. Without this setting enabled, and configuration encryption, an ESXi host could be subject to offline attacks. An attacker could simply transfer the ESXi install drive to a non-Secure Boot host and boot it up without ESXi complaining.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\n    From an ESXi shell, run the following command:\n\n    # esxcli system settings encryption get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.settings.encryption.get.invoke() | Select RequireSecureBoot\n\n    Expected result:\n\n    Require Secure Boot: true\n\n    If \\\"Require Secure Boot\\\" is not enable, this is a finding.\n  \"\n  desc 'fix', \"\n    This setting cannot be configured until Secure Boot is properly enabled in the servers firmware.\n\n    From an ESXi shell, run the following commands:\n\n    # esxcli system settings encryption set --require-secure-boot=true\n    # /sbin/auto-backup.sh\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n    $arguments.requiresecureboot = $true\n    $esxcli.system.settings.encryption.set.Invoke($arguments)\n\n    Evacuate the host and gracefully reboot for changes to take effect.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000257-VMM-000910'\n  tag satisfies: ['SRG-OS-000258-VMM-000920', 'SRG-OS-000445-VMM-001780', 'SRG-OS-000446-VMM-001790']\n  tag gid: 'V-ESXI-80-000085'\n  tag rid: 'SV-ESXI-80-000085'\n  tag stig_id: 'ESXI-80-000085'\n  tag cci: ['CCI-001494', 'CCI-001495', 'CCI-002696', 'CCI-002699']\n  tag nist: ['AU-9', 'SI-6 a', 'SI-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty RequireSecureBoot\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000085.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty RequireSecureBoot stdout.strip is expected to cmp == \"true\"","run_time":0.3651025,"start_time":"2023-06-07T08:28:36-06:00","message":"\nexpected: true\n     got: false\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty RequireSecureBoot\"]","resource_id":""}]},{"id":"ESXI-80-000094","title":"The ESXi host must enable Secure Boot.","desc":"Secure Boot is part of the Unified Extensible Firmware Interface (UEFI) firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and requires that all ESXi kernel modules, drivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. There is no ESXi control to \"turn on\" Secure Boot. Requiring Secure Boot (failing to boot without it present) is accomplished in another control.","descriptions":[{"label":"default","data":"Secure Boot is part of the Unified Extensible Firmware Interface (UEFI) firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and requires that all ESXi kernel modules, drivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a partner subordinate.\n\nSecure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. There is no ESXi control to \"turn on\" Secure Boot. Requiring Secure Boot (failing to boot without it present) is accomplished in another control."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/secureboot/bin/secureBoot.py -s\n\nIf Secure Boot is not \"Enabled\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/secureboot/bin/secureBoot.py -c\n\nIf the output indicates that Secure Boot cannot be enabled, correct the discrepancies and try again.\n\nOnce all discrepancies are resolved then the server ESXi is installed on can be updated to enable Secure Boot in the firmware.\n\nTo enable Secure Boot in the servers firmware follow the instructions for the specific manufacturer."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000278-VMM-001000","gid":"V-ESXI-80-000094","rid":"SV-ESXI-80-000094","stig_id":"ESXI-80-000094","cci":["CCI-001496"],"nist":["AU-9 (3)"]},"code":"control 'ESXI-80-000094' do\n  title 'The ESXi host must enable Secure Boot.'\n  desc  \"\n    Secure Boot is part of the Unified Extensible Firmware Interface (UEFI) firmware standard. With UEFI Secure Boot enabled, a host refuses to load any UEFI driver or app unless the operating system bootloader has a valid digital signature. Secure Boot for ESXi requires support from the firmware and requires that all ESXi kernel modules, drivers, and vSphere Installation Bundles (VIBs) be signed by VMware or a partner subordinate.\n\n    Secure Boot is enabled in the BIOS of the ESXi physical server and supported by the hypervisor boot loader. There is no ESXi control to \\\"turn on\\\" Secure Boot. Requiring Secure Boot (failing to boot without it present) is accomplished in another control.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/secureboot/bin/secureBoot.py -s\n\n    If Secure Boot is not \\\"Enabled\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/secureboot/bin/secureBoot.py -c\n\n    If the output indicates that Secure Boot cannot be enabled, correct the discrepancies and try again.\n\n    Once all discrepancies are resolved then the server ESXi is installed on can be updated to enable Secure Boot in the firmware.\n\n    To enable Secure Boot in the servers firmware follow the instructions for the specific manufacturer.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000278-VMM-001000'\n  tag gid: 'V-ESXI-80-000094'\n  tag rid: 'SV-ESXI-80-000094'\n  tag stig_id: 'ESXI-80-000094'\n  tag cci: ['CCI-001496']\n  tag nist: ['AU-9 (3)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000094.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.35e-05,"start_time":"2023-06-07T08:28:36-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000111","title":"The ESXi host must enforce an unlock timeout of 15 minutes after a user account is locked out.","desc":"By enforcing a reasonable unlock timeout after multiple failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Users must wait for the timeout period to elapse before subsequent logon attempts are allowed.","descriptions":[{"label":"default","data":"By enforcing a reasonable unlock timeout after multiple failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Users must wait for the timeout period to elapse before subsequent logon attempts are allowed."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.AccountUnlockTime\" value and verify it is set to less than \"900\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime\n\nIf the \"Security.AccountUnlockTime\" setting is less than 900 or 0, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.AccountUnlockTime\" value and configure it to \"900\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime | Set-AdvancedSetting -Value 900"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000329-VMM-001180","gid":"V-ESXI-80-000111","rid":"SV-ESXI-80-000111","stig_id":"ESXI-80-000111","cci":["CCI-002238"],"nist":["AC-7 b"]},"code":"control 'ESXI-80-000111' do\n  title 'The ESXi host must enforce an unlock timeout of 15 minutes after a user account is locked out.'\n  desc  'By enforcing a reasonable unlock timeout after multiple failed logon attempts, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. Users must wait for the timeout period to elapse before subsequent logon attempts are allowed.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.AccountUnlockTime\\\" value and verify it is set to less than \\\"900\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime\n\n    If the \\\"Security.AccountUnlockTime\\\" setting is less than 900 or 0, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.AccountUnlockTime\\\" value and configure it to \\\"900\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.AccountUnlockTime | Set-AdvancedSetting -Value 900\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000329-VMM-001180'\n  tag gid: 'V-ESXI-80-000111'\n  tag rid: 'SV-ESXI-80-000111'\n  tag stig_id: 'ESXI-80-000111'\n  tag cci: ['CCI-002238']\n  tag nist: ['AC-7 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.AccountUnlockTime | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 900 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000111.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.AccountUnlockTime | Select-Object -ExpandProperty Value stdout.strip is expected to cmp <= 900","run_time":0.7289838,"start_time":"2023-06-07T08:28:36-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.AccountUnlockTime | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.AccountUnlockTime | Select-Object -ExpandProperty Value stdout.strip is expected not to cmp == 0","run_time":0.0003639,"start_time":"2023-06-07T08:28:37-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.AccountUnlockTime | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000113","title":"The ESXi host must allocate audit record storage capacity to store at least one weeks worth of audit records.","desc":"In order to ensure ESXi has sufficient storage capacity in which to write the audit logs, audit record storage capacity should be configured.\n\nIf a central audit record storage facility is available, the local storage capacity should be sufficient to hold audit records that would accumulate during anticipated interruptions in delivery of records to the facility.","descriptions":[{"label":"default","data":"In order to ensure ESXi has sufficient storage capacity in which to write the audit logs, audit record storage capacity should be configured.\n\nIf a central audit record storage facility is available, the local storage capacity should be sufficient to hold audit records that would accumulate during anticipated interruptions in delivery of records to the facility."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.auditRecord.storageCapacity\" value and verify it is set to \"100\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity\n\nIf the \"Syslog.global.auditRecord.storageCapacity\" setting is not set to 100, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.auditRecord.storageCapacity\" value and configure it to \"100\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Set-AdvancedSetting -Value 100"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000341-VMM-001220","gid":"V-ESXI-80-000113","rid":"SV-ESXI-80-000113","stig_id":"ESXI-80-000113","cci":["CCI-001849"],"nist":["AU-4"]},"code":"control 'ESXI-80-000113' do\n  title 'The ESXi host must allocate audit record storage capacity to store at least one weeks worth of audit records.'\n  desc  \"\n    In order to ensure ESXi has sufficient storage capacity in which to write the audit logs, audit record storage capacity should be configured.\n\n    If a central audit record storage facility is available, the local storage capacity should be sufficient to hold audit records that would accumulate during anticipated interruptions in delivery of records to the facility.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.auditRecord.storageCapacity\\\" value and verify it is set to \\\"100\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity\n\n    If the \\\"Syslog.global.auditRecord.storageCapacity\\\" setting is not set to 100, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.auditRecord.storageCapacity\\\" value and configure it to \\\"100\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Set-AdvancedSetting -Value 100\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000341-VMM-001220'\n  tag gid: 'V-ESXI-80-000113'\n  tag rid: 'SV-ESXI-80-000113'\n  tag stig_id: 'ESXI-80-000113'\n  tag cci: ['CCI-001849']\n  tag nist: ['AU-4']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '100' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000113.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"100\"","run_time":0.5391943,"start_time":"2023-06-07T08:28:37-06:00","message":"\nexpected: 100\n     got: 4\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageCapacity | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000114","title":"The ESXi host must off-load logs via syslog.","desc":"Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host, it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts.\n\nLogging to a secure, centralized log server also helps prevent log tampering and provides a long-term audit record.","descriptions":[{"label":"default","data":"Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host, it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts.\n\nLogging to a secure, centralized log server also helps prevent log tampering and provides a long-term audit record."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logHost\" value and verify it is set to a site-specific syslog server.\n\nSyslog servers are specified in the following formats:\n\nudp://<IP or FQDN>:514\ntcp://<IP or FQDN>:514\nssl://<IP or FQDN>:1514\n\nMultiple servers can also be specified when separated by commas.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost\n\nIf the \"Syslog.global.logHost\" setting is not set to a valid, site-specific syslog server, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logHost\" value and configure it to a site-specific syslog server.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost | Set-AdvancedSetting -Value \"enter site specific servers\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000342-VMM-001230","satisfies":["SRG-OS-000274-VMM-000960","SRG-OS-000275-VMM-000970","SRG-OS-000277-VMM-000990","SRG-OS-000479-VMM-001990"],"gid":"V-ESXI-80-000114","rid":"SV-ESXI-80-000114","stig_id":"ESXI-80-000114","cci":["CCI-001683","CCI-001684","CCI-001686","CCI-001851"],"nist":["AC-2 (4)","AU-4 (1)"]},"code":"control 'ESXI-80-000114' do\n  title 'The ESXi host must off-load logs via syslog.'\n  desc  \"\n    Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host, it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts.\n\n    Logging to a secure, centralized log server also helps prevent log tampering and provides a long-term audit record.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logHost\\\" value and verify it is set to a site-specific syslog server.\n\n    Syslog servers are specified in the following formats:\n\n    udp://<IP or FQDN>:514\n    tcp://<IP or FQDN>:514\n    ssl://<IP or FQDN>:1514\n\n    Multiple servers can also be specified when separated by commas.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost\n\n    If the \\\"Syslog.global.logHost\\\" setting is not set to a valid, site-specific syslog server, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logHost\\\" value and configure it to a site-specific syslog server.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost | Set-AdvancedSetting -Value \\\"enter site specific servers\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000342-VMM-001230'\n  tag satisfies: ['SRG-OS-000274-VMM-000960', 'SRG-OS-000275-VMM-000970', 'SRG-OS-000277-VMM-000990', 'SRG-OS-000479-VMM-001990']\n  tag gid: 'V-ESXI-80-000114'\n  tag rid: 'SV-ESXI-80-000114'\n  tag stig_id: 'ESXI-80-000114'\n  tag cci: ['CCI-001683', 'CCI-001684', 'CCI-001686', 'CCI-001851']\n  tag nist: ['AC-2 (4)', 'AU-4 (1)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logHost | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp \"#{input('syslogServer')}\" }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000114.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.logHost | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"tcp://log.test.local:514\"","run_time":0.6258534,"start_time":"2023-06-07T08:28:38-06:00","message":"\nexpected: tcp://log.test.local:514\n     got: \n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.logHost | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000124","title":"The ESXi host must synchronize internal information system clocks to an authoritative time source.","desc":"To ensure the accuracy of the system clock, it must be synchronized with an authoritative time source within DOD. Many system functions, including time-based logon and activity restrictions, automated reports, system logs, and audit records, depend on an accurate system clock. If there is no confidence in the correctness of the system clock, time-based functions may not operate as intended and records may be of diminished value.","descriptions":[{"label":"default","data":"To ensure the accuracy of the system clock, it must be synchronized with an authoritative time source within DOD. Many system functions, including time-based logon and activity restrictions, automated reports, system logs, and audit records, depend on an accurate system clock. If there is no confidence in the correctness of the system clock, time-based functions may not operate as intended and records may be of diminished value."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Time Configuration.\n\nVerify NTP or PTP are configured, and one or more authoritative time sources are listed.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nVerify the NTP or PTP service is running and configured to start and stop with the host.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostNTPServer\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\" -or $_.Label -eq \"PTP Daemon\"}\n\nIf the NTP service is not configured with authoritative DOD time sources or the service is not configured to start and stop with the host (\"Policy\" of \"on\" in PowerCLI) or is stopped, this is a finding.\nIf PTP is used instead of NTP, this is NOT a finding."},{"label":"fix","data":"To configure NTP, perform the following:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Time Configuration.\n\nClick \"Add Service\" and select \"Network Time Protocol\".\n\nEnter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \"OK\".\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nSelect the \"NTP Daemon\" service and click \"Edit Startup Policy\".\n\nSelect \"Start and stop with host\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$NTPServers = \"ntpserver1\",\"ntpserver2\"\nGet-VMHost | Add-VMHostNTPServer $NTPServers\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\"} | Set-VMHostService -Policy On\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"NTP Daemon\"} | Start-VMHostService\n\nTo configure PTP, perform the following:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Time Configuration.\n\nClick \"Add Service\" and select \"Precision Time Protocol\".\n\nSelect the network adapter that can receive the PTP traffic.\n\nIf NTP servers are available, select \"Enable fallback\" and enter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \"OK\".\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nSelect the \"PTP Daemon\" service and click \"Edit Startup Policy\".\n\nSelect \"Start and stop with host\". Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000355-VMM-001330","satisfies":["SRG-OS-000356-VMM-001340"],"gid":"V-ESXI-80-000124","rid":"SV-ESXI-80-000124","stig_id":"ESXI-80-000124","cci":["CCI-001891","CCI-002046"],"nist":["AU-8 (1) (a)","AU-8 (1) (b)"]},"code":"control 'ESXI-80-000124' do\n  title 'The ESXi host must synchronize internal information system clocks to an authoritative time source.'\n  desc  'To ensure the accuracy of the system clock, it must be synchronized with an authoritative time source within DOD. Many system functions, including time-based logon and activity restrictions, automated reports, system logs, and audit records, depend on an accurate system clock. If there is no confidence in the correctness of the system clock, time-based functions may not operate as intended and records may be of diminished value.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Time Configuration.\n\n    Verify NTP or PTP are configured, and one or more authoritative time sources are listed.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Verify the NTP or PTP service is running and configured to start and stop with the host.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostNTPServer\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\" -or $_.Label -eq \\\"PTP Daemon\\\"}\n\n    If the NTP service is not configured with authoritative DOD time sources or the service is not configured to start and stop with the host (\\\"Policy\\\" of \\\"on\\\" in PowerCLI) or is stopped, this is a finding.\n    If PTP is used instead of NTP, this is NOT a finding.\n  \"\n  desc 'fix', \"\n    To configure NTP, perform the following:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Time Configuration.\n\n    Click \\\"Add Service\\\" and select \\\"Network Time Protocol\\\".\n\n    Enter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \\\"OK\\\".\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Select the \\\"NTP Daemon\\\" service and click \\\"Edit Startup Policy\\\".\n\n    Select \\\"Start and stop with host\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $NTPServers = \\\"ntpserver1\\\",\\\"ntpserver2\\\"\n    Get-VMHost | Add-VMHostNTPServer $NTPServers\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\"} | Set-VMHostService -Policy On\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"NTP Daemon\\\"} | Start-VMHostService\n\n    To configure PTP, perform the following:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Time Configuration.\n\n    Click \\\"Add Service\\\" and select \\\"Precision Time Protocol\\\".\n\n    Select the network adapter that can receive the PTP traffic.\n\n    If NTP servers are available, select \\\"Enable fallback\\\" and enter or update the NTP servers listed with a comma separate list of authoritative time servers. Click \\\"OK\\\".\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Select the \\\"PTP Daemon\\\" service and click \\\"Edit Startup Policy\\\".\n\n    Select \\\"Start and stop with host\\\". Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000355-VMM-001330'\n  tag satisfies: ['SRG-OS-000356-VMM-001340']\n  tag gid: 'V-ESXI-80-000124'\n  tag rid: 'SV-ESXI-80-000124'\n  tag stig_id: 'ESXI-80-000124'\n  tag cci: ['CCI-001891', 'CCI-002046']\n  tag nist: ['AU-8 (1) (a)', 'AU-8 (1) (b)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'on' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n      results = powercli_command(\"Get-VMHost -Name #{vmhost} | Get-VMHostNTPServer\").stdout\n      if !results.empty?\n        results.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |result|\n          describe \"NTP Server: #{result} for VMHost: #{vmhost}\" do\n            subject { result }\n            it { should be_in \"#{input('esxiNtpServers')}\" }\n          end\n        end\n      else\n        describe \"No NTP servers found on VMhost: #{vmhost}\" do\n          subject { results }\n          it { should_not be_empty }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000124.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Policy stdout.strip is expected to cmp == \"on\"","run_time":0.4038671,"start_time":"2023-06-07T08:28:38-06:00","message":"\nexpected: on\n     got: off\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Policy\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Running stdout.strip is expected to cmp == \"true\"","run_time":0.40368,"start_time":"2023-06-07T08:28:39-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'NTP Daemon'} | Select-Object -ExpandProperty Running\"]","resource_id":""},{"status":"failed","code_desc":"No NTP servers found on VMhost: 10.186.25.26 is expected not to be empty","run_time":0.0281583,"start_time":"2023-06-07T08:28:39-06:00","message":"expected `\"\".empty?` to be falsey, got true","resource_class":"Object","resource_params":"[]","resource_id":"No NTP servers found on VMhost: 10.186.25.26"}]},{"id":"ESXI-80-000133","title":"The ESXi Image Profile and vSphere Installation Bundle (VIB) acceptance level must be verified.","desc":"Verify the ESXi Image Profile to only allow signed VIBs. An unsigned VIB represents untested code installed on an ESXi host. The ESXi Image profile supports four acceptance levels:\n\n1. VMwareCertified - VIBs created, tested, and signed by VMware.\n2. VMwareAccepted - VIBs created by a VMware partner but tested and signed by VMware.\n3. PartnerSupported - VIBs created, tested, and signed by a certified VMware partner.\n4. CommunitySupported - VIBs that have not been tested by VMware or a VMware partner.\n\nCommunity Supported VIBs are not supported and do not have a digital signature. To protect the security and integrity of ESXi hosts, do not allow unsigned (CommunitySupported) VIBs to be installed on hosts.","descriptions":[{"label":"default","data":"Verify the ESXi Image Profile to only allow signed VIBs. An unsigned VIB represents untested code installed on an ESXi host. The ESXi Image profile supports four acceptance levels:\n\n1. VMwareCertified - VIBs created, tested, and signed by VMware.\n2. VMwareAccepted - VIBs created by a VMware partner but tested and signed by VMware.\n3. PartnerSupported - VIBs created, tested, and signed by a certified VMware partner.\n4. CommunitySupported - VIBs that have not been tested by VMware or a VMware partner.\n\nCommunity Supported VIBs are not supported and do not have a digital signature. To protect the security and integrity of ESXi hosts, do not allow unsigned (CommunitySupported) VIBs to be installed on hosts."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Host Image Profile Acceptance Level\" view the acceptance level.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.software.acceptance.get.Invoke()\n\nIf the acceptance level is \"CommunitySupported\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Host Image Profile Acceptance Level\", click \"Edit\".\n\nUsing the drop-down selection, set the acceptance level as \"VMwareCertified\", \"VMwareAccepted\", or \"PartnerSupported\". The default is \"PartnerSupported\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.software.acceptance.set.CreateArgs()\n$arguments.level = \"PartnerSupported\"\n$esxcli.software.acceptance.set.Invoke($arguments)\n\nNote: \"VMwareCertified\" or \"VMwareAccepted\" may be substituted for \"PartnerSupported\", depending on local requirements. These are case sensitive."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000366-VMM-001430","satisfies":["SRG-OS-000370-VMM-001460"],"gid":"V-ESXI-80-000133","rid":"SV-ESXI-80-000133","stig_id":"ESXI-80-000133","cci":["CCI-001749","CCI-001774"],"nist":["CM-5 (3)","CM-7 (5) (b)"]},"code":"control 'ESXI-80-000133' do\n  title 'The ESXi Image Profile and vSphere Installation Bundle (VIB) acceptance level must be verified.'\n  desc  \"\n    Verify the ESXi Image Profile to only allow signed VIBs. An unsigned VIB represents untested code installed on an ESXi host. The ESXi Image profile supports four acceptance levels:\n\n    1. VMwareCertified - VIBs created, tested, and signed by VMware.\n    2. VMwareAccepted - VIBs created by a VMware partner but tested and signed by VMware.\n    3. PartnerSupported - VIBs created, tested, and signed by a certified VMware partner.\n    4. CommunitySupported - VIBs that have not been tested by VMware or a VMware partner.\n\n    Community Supported VIBs are not supported and do not have a digital signature. To protect the security and integrity of ESXi hosts, do not allow unsigned (CommunitySupported) VIBs to be installed on hosts.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Host Image Profile Acceptance Level\\\" view the acceptance level.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.software.acceptance.get.Invoke()\n\n    If the acceptance level is \\\"CommunitySupported\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Host Image Profile Acceptance Level\\\", click \\\"Edit\\\".\n\n    Using the drop-down selection, set the acceptance level as \\\"VMwareCertified\\\", \\\"VMwareAccepted\\\", or \\\"PartnerSupported\\\". The default is \\\"PartnerSupported\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.software.acceptance.set.CreateArgs()\n    $arguments.level = \\\"PartnerSupported\\\"\n    $esxcli.software.acceptance.set.Invoke($arguments)\n\n    Note: \\\"VMwareCertified\\\" or \\\"VMwareAccepted\\\" may be substituted for \\\"PartnerSupported\\\", depending on local requirements. These are case sensitive.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000366-VMM-001430'\n  tag satisfies: ['SRG-OS-000370-VMM-001460']\n  tag gid: 'V-ESXI-80-000133'\n  tag rid: 'SV-ESXI-80-000133'\n  tag stig_id: 'ESXI-80-000133'\n  tag cci: ['CCI-001749', 'CCI-001774']\n  tag nist: ['CM-5 (3)', 'CM-7 (5) (b)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    list = ['PartnerSupported', 'VMwareCertified', 'VMwareAccepted']\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.acceptance.get.Invoke()\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should be_in list }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000133.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.acceptance.get.Invoke() stdout.strip is expected to be in \"PartnerSupported\", \"VMwareCertified\", and \"VMwareAccepted\"","run_time":2.9816989,"start_time":"2023-06-07T08:28:39-06:00","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.software.acceptance.get.Invoke()\"]","resource_id":""}]},{"id":"ESXI-80-000145","title":"The ESXi host must enable bidirectional Challenge-Handshake Authentication Protocol (CHAP) authentication for Internet Small Computer Systems Interface (iSCSI) traffic.","desc":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, there is potential for a man-in-the-middle attack, in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.","descriptions":[{"label":"default","data":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, there is potential for a man-in-the-middle attack, in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk."},{"label":"rationale","data":""},{"label":"check","data":"If iSCSI is not used, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\nSelect the iSCSI adapter >> Properties >> Authentication >> Method.\n\nView the CHAP configuration and verify CHAP is required for target and host authentication.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostHba | Where {$_.Type -eq \"iscsi\"} | Select AuthenticationProperties -ExpandProperty AuthenticationProperties\n\nIf iSCSI is used and CHAP is not set to \"required\" for both the target and host, this is a finding.\n\nIf iSCSI is used and unique CHAP secrets are not used for each host, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\nSelect the iSCSI adapter >> Properties >> Authentication.\n\nClick \"Edit...\". Set \"Authentication Method\" to \"Use bidirectional CHAP\" and enter a unique secret for each traffic flow direction.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostHba | Where {$_.Type -eq \"iscsi\"} | Set-VMHostHba -ChapType Required -ChapName \"chapname\" -ChapPassword \"password\" -MutualChapEnabled $true -MutualChapName \"mutualchapname\" -MutualChapPassword \"mutualpassword\""}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000379-VMM-001550","gid":"V-ESXI-80-000145","rid":"SV-ESXI-80-000145","stig_id":"ESXI-80-000145","cci":["CCI-001967"],"nist":["IA-3 (1)"]},"code":"control 'ESXI-80-000145' do\n  title 'The ESXi host must enable bidirectional Challenge-Handshake Authentication Protocol (CHAP) authentication for Internet Small Computer Systems Interface (iSCSI) traffic.'\n  desc  'When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, there is potential for a man-in-the-middle attack, in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If iSCSI is not used, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication >> Method.\n\n    View the CHAP configuration and verify CHAP is required for target and host authentication.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \\\"iscsi\\\"} | Select AuthenticationProperties -ExpandProperty AuthenticationProperties\n\n    If iSCSI is used and CHAP is not set to \\\"required\\\" for both the target and host, this is a finding.\n\n    If iSCSI is used and unique CHAP secrets are not used for each host, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Storage >> Storage Adapters.\n\n    Select the iSCSI adapter >> Properties >> Authentication.\n\n    Click \\\"Edit...\\\". Set \\\"Authentication Method\\\" to \\\"Use bidirectional CHAP\\\" and enter a unique secret for each traffic flow direction.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostHba | Where {$_.Type -eq \\\"iscsi\\\"} | Set-VMHostHba -ChapType Required -ChapName \\\"chapname\\\" -ChapPassword \\\"password\\\" -MutualChapEnabled $true -MutualChapName \\\"mutualchapname\\\" -MutualChapPassword \\\"mutualpassword\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000379-VMM-001550'\n  tag gid: 'V-ESXI-80-000145'\n  tag rid: 'SV-ESXI-80-000145'\n  tag stig_id: 'ESXI-80-000145'\n  tag cci: ['CCI-001967']\n  tag nist: ['IA-3 (1)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'}\"\n      iscsi_hbas = powercli_command(command).stdout\n\n      if iscsi_hbas.empty?\n        impact 0.0\n        describe '' do\n          skip 'There are no iSCSI HBAs present so this control is Not Applicable'\n        end\n      else\n        command1 = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'} | Select-Object -ExpandProperty AuthenticationProperties | Select-Object -ExpandProperty MutualChapEnabled\"\n        command2 = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'} | Select-Object -ExpandProperty AuthenticationProperties | Select-Object -ExpandProperty ChapType\"\n        describe powercli_command(command1) do\n          its('stdout.strip') { should cmp 'True' }\n        end\n        describe powercli_command(command2) do\n          its('stdout.strip') { should cmp 'Required' }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000145.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"","run_time":1.31e-05,"start_time":"2023-06-07T08:28:42-06:00","resource":"","skip_message":"There are no iSCSI HBAs present so this control is Not Applicable","resource_class":"Object","resource_params":"[]","resource_id":""}]},{"id":"ESXI-80-000160","title":"The ESXi host must protect the confidentiality and integrity of transmitted information by isolating vMotion traffic.","desc":"While encrypted vMotion is available, vMotion traffic should still be sequestered from other traffic to further protect it from attack. This network must only be accessible to other ESXi hosts, preventing outside access to the network.\n\nThe vMotion VMkernel port group must be in a dedicated VLAN that can be on a standard or distributed virtual switch as long as the vMotion VLAN is not shared by any other function and is not routed to anything but ESXi hosts.","descriptions":[{"label":"default","data":"While encrypted vMotion is available, vMotion traffic should still be sequestered from other traffic to further protect it from attack. This network must only be accessible to other ESXi hosts, preventing outside access to the network.\n\nThe vMotion VMkernel port group must be in a dedicated VLAN that can be on a standard or distributed virtual switch as long as the vMotion VLAN is not shared by any other function and is not routed to anything but ESXi hosts."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nReview the VLAN associated with any vMotion VMkernel(s) and verify they are dedicated for that purpose and are logically separated from other functions.\n\nIf long distance or cross vCenter vMotion is used the vMotion network can be routable but must be accessible to only the intended ESXi hosts.\n\nIf the vMotion port group is not on an isolated VLAN and/or is routable to systems other than ESXi hosts, this is a finding."},{"label":"fix","data":"Configuration of the vMotion VMkernel will be unique to each environment.\n\nAs an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\nFrom the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\" and select VLAN.\n\nChange the \"VLAN Type\" to \"VLAN\" and change the \"VLAN ID\" to a network allocated and dedicated to vMotion traffic exclusively. Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000423-VMM-001700","gid":"V-ESXI-80-000160","rid":"SV-ESXI-80-000160","stig_id":"ESXI-80-000160","cci":["CCI-002418"],"nist":["SC-8"]},"code":"control 'ESXI-80-000160' do\n  title 'The ESXi host must protect the confidentiality and integrity of transmitted information by isolating vMotion traffic.'\n  desc  \"\n    While encrypted vMotion is available, vMotion traffic should still be sequestered from other traffic to further protect it from attack. This network must only be accessible to other ESXi hosts, preventing outside access to the network.\n\n    The vMotion VMkernel port group must be in a dedicated VLAN that can be on a standard or distributed virtual switch as long as the vMotion VLAN is not shared by any other function and is not routed to anything but ESXi hosts.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Review the VLAN associated with any vMotion VMkernel(s) and verify they are dedicated for that purpose and are logically separated from other functions.\n\n    If long distance or cross vCenter vMotion is used the vMotion network can be routable but must be accessible to only the intended ESXi hosts.\n\n    If the vMotion port group is not on an isolated VLAN and/or is routable to systems other than ESXi hosts, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of the vMotion VMkernel will be unique to each environment.\n\n    As an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\" and select VLAN.\n\n    Change the \\\"VLAN Type\\\" to \\\"VLAN\\\" and change the \\\"VLAN ID\\\" to a network allocated and dedicated to vMotion traffic exclusively. Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-ESXI-80-000160'\n  tag rid: 'SV-ESXI-80-000160'\n  tag stig_id: 'ESXI-80-000160'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -VMKernel | Where-Object {$_.VMotionEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n      vmks = powercli_command(command).stdout\n\n      if vmks.empty?\n        describe '' do\n          skip 'There are no VMKernel adapters with vMotion enabled so this control is N/A.'\n        end\n      else\n        vmks.split.each do |vmk|\n          # Check to see if vMotion and any other services are enabled on the same VMkernel adapter\n          command2 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VsanTrafficEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n          describe powercli_command(command2) do\n            its('stdout.strip') { should be_empty }\n          end\n          # Get vMotion Port Group Name\n          command3 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Select-Object -ExpandProperty PortGroupName\"\n          pgname = powercli_command(command3).stdout.strip\n          # Test standard port groups\n          command4 = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup -Name \\\"#{pgname}\\\" -Standard | Select-Object -ExpandProperty VlanId\"\n          stdpgs = powercli_command(command4).stdout.strip\n          unless stdpgs.empty?\n            describe 'Checking standand port group VLAN ID' do\n              subject { stdpgs }\n              it { should cmp \"#{input('vMotionVlanId')}\" }\n            end\n          end\n          describe 'SA Interview' do\n            skip 'SA also needs to confirm this VLAN is dedicated to vMotion and not routable except to other ESXi hosts.'\n          end\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000160.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"","run_time":7.4e-06,"start_time":"2023-06-07T08:28:42-06:00","resource":"","skip_message":"There are no VMKernel adapters with vMotion enabled so this control is N/A.","resource_class":"Object","resource_params":"[]","resource_id":""}]},{"id":"ESXI-80-000161","title":"The ESXi host must maintain the confidentiality and integrity of information during transmission by exclusively enabling Transport Layer Security (TLS) 1.2.","desc":"TLS 1.0 and 1.1 are deprecated protocols with well-published shortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces and SSLv3, TL 1.1, and 1.0 disabled, where supported.\n\nMandating TLS 1.2 may break third-party integrations and add-ons to vSphere. Test these integrations carefully after implementing TLS 1.2 and roll back where appropriate.\n\nOn interfaces where required functionality is broken with TLS 1.2, this finding is not applicable until such time as the third-party software supports TLS 1.2.\n\nModify TLS settings in the following order:\n1. vCenter.\n2. ESXi.","descriptions":[{"label":"default","data":"TLS 1.0 and 1.1 are deprecated protocols with well-published shortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces and SSLv3, TL 1.1, and 1.0 disabled, where supported.\n\nMandating TLS 1.2 may break third-party integrations and add-ons to vSphere. Test these integrations carefully after implementing TLS 1.2 and roll back where appropriate.\n\nOn interfaces where required functionality is broken with TLS 1.2, this finding is not applicable until such time as the third-party software supports TLS 1.2.\n\nModify TLS settings in the following order:\n1. vCenter.\n2. ESXi."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.ESXiVPsDisabledProtocols\" value and verify it is set to \"sslv3,tlsv1,tlsv1.1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols\n\nIf the \"UserVars.ESXiVPsDisabledProtocols\" setting is set to a value other than \"sslv3,tlsv1,tlsv1.1\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.ESXiVPsDisabledProtocols\" value and configure it to \"sslv3,tlsv1,tlsv1.1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Set-AdvancedSetting -Value \"sslv3,tlsv1,tlsv1.1\""}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000425-VMM-001710","satisfies":["SRG-OS-000426-VMM-001720"],"gid":"V-ESXI-80-000161","rid":"SV-ESXI-80-000161","stig_id":"ESXI-80-000161","cci":["CCI-002420","CCI-002422"],"nist":["SC-8 (2)"]},"code":"control 'ESXI-80-000161' do\n  title 'The ESXi host must maintain the confidentiality and integrity of information during transmission by exclusively enabling Transport Layer Security (TLS) 1.2.'\n  desc  \"\n    TLS 1.0 and 1.1 are deprecated protocols with well-published shortcomings and vulnerabilities. TLS 1.2 should be enabled on all interfaces and SSLv3, TL 1.1, and 1.0 disabled, where supported.\n\n    Mandating TLS 1.2 may break third-party integrations and add-ons to vSphere. Test these integrations carefully after implementing TLS 1.2 and roll back where appropriate.\n\n    On interfaces where required functionality is broken with TLS 1.2, this finding is not applicable until such time as the third-party software supports TLS 1.2.\n\n    Modify TLS settings in the following order:\n    1. vCenter.\n    2. ESXi.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiVPsDisabledProtocols\\\" value and verify it is set to \\\"sslv3,tlsv1,tlsv1.1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols\n\n    If the \\\"UserVars.ESXiVPsDisabledProtocols\\\" setting is set to a value other than \\\"sslv3,tlsv1,tlsv1.1\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.ESXiVPsDisabledProtocols\\\" value and configure it to \\\"sslv3,tlsv1,tlsv1.1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Set-AdvancedSetting -Value \\\"sslv3,tlsv1,tlsv1.1\\\"\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000425-VMM-001710'\n  tag satisfies: ['SRG-OS-000426-VMM-001720']\n  tag gid: 'V-ESXI-80-000161'\n  tag rid: 'SV-ESXI-80-000161'\n  tag stig_id: 'ESXI-80-000161'\n  tag cci: ['CCI-002420', 'CCI-002422']\n  tag nist: ['SC-8 (2)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'sslv3,tlsv1,tlsv1.1' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000161.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"sslv3,tlsv1,tlsv1.1\"","run_time":0.5876098,"start_time":"2023-06-07T08:28:42-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiVPsDisabledProtocols | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000187","title":"The ESXi host Secure Shell (SSH) daemon must be configured to only use FIPS 140-2 validated ciphers.","desc":"Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. ESXi must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated.","descriptions":[{"label":"default","data":"Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. ESXi must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep ciphers\n\nExpected result:\n\nciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nCiphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\nNote: The ciphers line must be after the FipsMode setting."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000478-VMM-001980","gid":"V-ESXI-80-000187","rid":"SV-ESXI-80-000187","stig_id":"ESXI-80-000187","cci":["CCI-002450"],"nist":["SC-13"]},"code":"control 'ESXI-80-000187' do\n  title 'The ESXi host Secure Shell (SSH) daemon must be configured to only use FIPS 140-2 validated ciphers.'\n  desc  'Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. ESXi must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep ciphers\n\n    Expected result:\n\n    ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n\n    Note: The ciphers line must be after the FipsMode setting.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000478-VMM-001980'\n  tag gid: 'V-ESXI-80-000187'\n  tag rid: 'SV-ESXI-80-000187'\n  tag stig_id: 'ESXI-80-000187'\n  tag cci: ['CCI-002450']\n  tag nist: ['SC-13']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000187.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.18e-05,"start_time":"2023-06-07T08:28:43-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000189","title":"The ESXi host DCUI.Access list must be verified.","desc":"Lockdown mode disables direct host access, requiring that administrators manage hosts from vCenter Server. However, if a host becomes isolated from vCenter, the administrator is locked out and can no longer manage the host.\n\nThe \"DCUI.Access\" advanced setting allows specified users to exit lockdown mode in such a scenario. If the Direct Console User Interface (DCUI) is running in strict lockdown mode, this setting is ineffective.","descriptions":[{"label":"default","data":"Lockdown mode disables direct host access, requiring that administrators manage hosts from vCenter Server. However, if a host becomes isolated from vCenter, the administrator is locked out and can no longer manage the host.\n\nThe \"DCUI.Access\" advanced setting allows specified users to exit lockdown mode in such a scenario. If the Direct Console User Interface (DCUI) is running in strict lockdown mode, this setting is ineffective."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"DCUI.Access\" value and verify only the root user is listed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name DCUI.Access and verify it is set to root.\n\nIf the \"DCUI.Access\" is not restricted to \"root\", this is a finding.\n\nNote: This list is only for local user accounts and should only contain the root user."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"DCUI.Access\" value and configure it to \"root\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name DCUI.Access | Set-AdvancedSetting -Value \"root\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000189","rid":"SV-ESXI-80-000189","stig_id":"ESXI-80-000189","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000189' do\n  title 'The ESXi host DCUI.Access list must be verified.'\n  desc  \"\n    Lockdown mode disables direct host access, requiring that administrators manage hosts from vCenter Server. However, if a host becomes isolated from vCenter, the administrator is locked out and can no longer manage the host.\n\n    The \\\"DCUI.Access\\\" advanced setting allows specified users to exit lockdown mode in such a scenario. If the Direct Console User Interface (DCUI) is running in strict lockdown mode, this setting is ineffective.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"DCUI.Access\\\" value and verify only the root user is listed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access and verify it is set to root.\n\n    If the \\\"DCUI.Access\\\" is not restricted to \\\"root\\\", this is a finding.\n\n    Note: This list is only for local user accounts and should only contain the root user.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"DCUI.Access\\\" value and configure it to \\\"root\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name DCUI.Access | Set-AdvancedSetting -Value \\\"root\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000189'\n  tag rid: 'SV-ESXI-80-000189'\n  tag stig_id: 'ESXI-80-000189'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name DCUI.Access | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'root' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000189.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name DCUI.Access | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"root\"","run_time":0.5751131,"start_time":"2023-06-07T08:28:43-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name DCUI.Access | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000191","title":"The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via Secure Shell (SSH).","desc":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.Etc.issue\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.Etc.issue\n\nIf the \"Config.Etc.issue\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.Etc.issue\" value and set it to the following:\n\n\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions: -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations. -At any time, the USG may inspect and seize data stored on this IS. -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose. -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy. -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.Etc.issue | Set-AdvancedSetting -Value \"<Banner text above>\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000023-VMM-000060","gid":"V-ESXI-80-000191","rid":"SV-ESXI-80-000191","stig_id":"ESXI-80-000191","cci":["CCI-000048"],"nist":["AC-8 a"]},"code":"control 'ESXI-80-000191' do\n  title 'The ESXi host must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system via Secure Shell (SSH).'\n  desc  \"\n    Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.Etc.issue\\\" value and verify it contains the standard mandatory DOD notice and consent banner.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue\n\n    If the \\\"Config.Etc.issue\\\" setting does not contain the standard mandatory DOD notice and consent banner, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.Etc.issue\\\" value and set it to the following:\n\n    \\\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions: -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations. -At any time, the USG may inspect and seize data stored on this IS. -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose. -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy. -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.Etc.issue | Set-AdvancedSetting -Value \\\"<Banner text above>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag gid: 'V-ESXI-80-000191'\n  tag rid: 'SV-ESXI-80-000191'\n  tag stig_id: 'ESXI-80-000191'\n  tag cci: ['CCI-000048']\n  tag nist: ['AC-8 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      result = powercli_command(\"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.Etc.issue | Select-Object -ExpandProperty Value\")\n      describe.one do\n        describe result do\n          its('stdout.strip') { should match 'You are accessing a U.S. Government' }\n        end\n        describe result do\n          its('stdout.strip') { should match \"I've read & consent to terms in IS user agreem't\" }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000191.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.Etc.issue | Select-Object -ExpandProperty Value stdout.strip is expected to match \"You are accessing a U.S. Government\"","run_time":0.0004146,"start_time":"2023-06-07T08:28:43-06:00","message":"expected \"\" to match \"You are accessing a U.S. Government\"","exception":"RSpec::Core::MultipleExceptionError","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.Etc.issue | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.Etc.issue | Select-Object -ExpandProperty Value stdout.strip is expected to match \"I've read & consent to terms in IS user agreem't\"","run_time":0.0002882,"start_time":"2023-06-07T08:28:43-06:00","message":"expected \"\" to match \"I've read & consent to terms in IS user agreem't\"","exception":"RSpec::Core::MultipleExceptionError","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.Etc.issue | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000192","title":"The ESXi host Secure Shell (SSH) daemon must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system.","desc":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep banner\n\nExpected result:\n\nbanner /etc/issue\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, navigate to and open:\n\n/etc/ssh/sshd_config\n\nEnsure that the \"Banner\" line is uncommented and set to the following:\n\nBanner /etc/issue\n\nRestart SSH from the UI or run the following command:\n\n# /etc/init.d/SSH restart"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000023-VMM-000060","gid":"V-ESXI-80-000192","rid":"SV-ESXI-80-000192","stig_id":"ESXI-80-000192","cci":["CCI-000048"],"nist":["AC-8 a"]},"code":"control 'ESXI-80-000192' do\n  title 'The ESXi host Secure Shell (SSH) daemon must display the Standard Mandatory DOD Notice and Consent Banner before granting access to the system.'\n  desc  \"\n    Display of a standardized and approved use notification before granting access to the host ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via logon interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with applicable DOD policy. Use the following verbiage for a host that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) VMM (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for VMMs that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep banner\n\n    Expected result:\n\n    banner /etc/issue\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, navigate to and open:\n\n    /etc/ssh/sshd_config\n\n    Ensure that the \\\"Banner\\\" line is uncommented and set to the following:\n\n    Banner /etc/issue\n\n    Restart SSH from the UI or run the following command:\n\n    # /etc/init.d/SSH restart\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000023-VMM-000060'\n  tag gid: 'V-ESXI-80-000192'\n  tag rid: 'SV-ESXI-80-000192'\n  tag stig_id: 'ESXI-80-000192'\n  tag cci: ['CCI-000048']\n  tag nist: ['AC-8 a']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000192.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":9.8e-06,"start_time":"2023-06-07T08:28:43-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000193","title":"The ESXi host must be configured to disable nonessential capabilities by disabling Secure Shell (SSH).","desc":"The ESXi Shell is an interactive command line interface (CLI) available at the ESXi server console. The ESXi shell provides temporary access to commands essential for server maintenance. Intended primarily for use in break-fix scenarios, the ESXi shell is well suited for checking and modifying configuration details, which are not always generally accessible, using the vSphere Client.\n\nThe ESXi shell is accessible remotely using SSH by users with the Administrator role. Under normal operating conditions, SSH access to the host must be disabled as is the default. As with the ESXi shell, SSH is also intended only for temporary use during break-fix scenarios. SSH must therefore be disabled under normal operating conditions and must only be enabled for diagnostics or troubleshooting. Remote access to the host must therefore be limited to the vSphere Client or Host Client at all other times.","descriptions":[{"label":"default","data":"The ESXi Shell is an interactive command line interface (CLI) available at the ESXi server console. The ESXi shell provides temporary access to commands essential for server maintenance. Intended primarily for use in break-fix scenarios, the ESXi shell is well suited for checking and modifying configuration details, which are not always generally accessible, using the vSphere Client.\n\nThe ESXi shell is accessible remotely using SSH by users with the Administrator role. Under normal operating conditions, SSH access to the host must be disabled as is the default. As with the ESXi shell, SSH is also intended only for temporary use during break-fix scenarios. SSH must therefore be disabled under normal operating conditions and must only be enabled for diagnostics or troubleshooting. Remote access to the host must therefore be limited to the vSphere Client or Host Client at all other times."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder Services, locate the \"SSH\" service and verify it is \"Stopped\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"}\n\nIf the SSH service is \"Running\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", select the \"SSH\" service and click the \"Stop\" button.\n\nClick the \"Edit Startup policy...\" button.\n\nSelect the \"Start and stop manually\" radio button.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"SSH\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000095-VMM-000480","satisfies":["SRG-OS-000297-VMM-001040","SRG-OS-000298-VMM-001050"],"gid":"V-ESXI-80-000193","rid":"SV-ESXI-80-000193","stig_id":"ESXI-80-000193","cci":["CCI-000381","CCI-002314","CCI-002322"],"nist":["AC-17 (1)","AC-17 (9)","CM-7 a"]},"code":"control 'ESXI-80-000193' do\n  title 'The ESXi host must be configured to disable nonessential capabilities by disabling Secure Shell (SSH).'\n  desc  \"\n    The ESXi Shell is an interactive command line interface (CLI) available at the ESXi server console. The ESXi shell provides temporary access to commands essential for server maintenance. Intended primarily for use in break-fix scenarios, the ESXi shell is well suited for checking and modifying configuration details, which are not always generally accessible, using the vSphere Client.\n\n    The ESXi shell is accessible remotely using SSH by users with the Administrator role. Under normal operating conditions, SSH access to the host must be disabled as is the default. As with the ESXi shell, SSH is also intended only for temporary use during break-fix scenarios. SSH must therefore be disabled under normal operating conditions and must only be enabled for diagnostics or troubleshooting. Remote access to the host must therefore be limited to the vSphere Client or Host Client at all other times.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under Services, locate the \\\"SSH\\\" service and verify it is \\\"Stopped\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"}\n\n    If the SSH service is \\\"Running\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", select the \\\"SSH\\\" service and click the \\\"Stop\\\" button.\n\n    Click the \\\"Edit Startup policy...\\\" button.\n\n    Select the \\\"Start and stop manually\\\" radio button.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"SSH\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag satisfies: ['SRG-OS-000297-VMM-001040', 'SRG-OS-000298-VMM-001050']\n  tag gid: 'V-ESXI-80-000193'\n  tag rid: 'SV-ESXI-80-000193'\n  tag stig_id: 'ESXI-80-000193'\n  tag cci: ['CCI-000381', 'CCI-002314', 'CCI-002322']\n  tag nist: ['AC-17 (1)', 'AC-17 (9)', 'CM-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000193.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Policy stdout.strip is expected to cmp == \"off\"","run_time":0.3652447,"start_time":"2023-06-07T08:28:43-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Policy\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Running stdout.strip is expected to cmp == \"false\"","run_time":0.4405619,"start_time":"2023-06-07T08:28:44-06:00","message":"\nexpected: false\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'SSH'} | Select-Object -ExpandProperty Running\"]","resource_id":""}]},{"id":"ESXI-80-000194","title":"The ESXi host must be configured to disable nonessential capabilities by disabling the ESXi shell.","desc":"The ESXi Shell is an interactive command line environment available locally from the Direct Console User Interface (DCUI) or remotely via SSH. Activities performed from the ESXi Shell bypass vCenter role-based access control (RBAC) and audit controls.\n\nThe ESXi shell must only be turned on when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere client.","descriptions":[{"label":"default","data":"The ESXi Shell is an interactive command line environment available locally from the Direct Console User Interface (DCUI) or remotely via SSH. Activities performed from the ESXi Shell bypass vCenter role-based access control (RBAC) and audit controls.\n\nThe ESXi shell must only be turned on when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere client."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder Services, locate the \"ESXi Shell\" service and verify it is \"Stopped\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"}\n\nIf the ESXi Shell service is \"Running\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", select the \"ESXi Shell\" service and click the \"Stop\" button.\n\nClick the \"Edit Startup policy...\" button.\n\nSelect the \"Start and stop manually\" radio button.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"ESXi Shell\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000095-VMM-000480","gid":"V-ESXI-80-000194","rid":"SV-ESXI-80-000194","stig_id":"ESXI-80-000194","cci":["CCI-000381"],"nist":["CM-7 a"]},"code":"control 'ESXI-80-000194' do\n  title 'The ESXi host must be configured to disable nonessential capabilities by disabling the ESXi shell.'\n  desc  \"\n    The ESXi Shell is an interactive command line environment available locally from the Direct Console User Interface (DCUI) or remotely via SSH. Activities performed from the ESXi Shell bypass vCenter role-based access control (RBAC) and audit controls.\n\n    The ESXi shell must only be turned on when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere client.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under Services, locate the \\\"ESXi Shell\\\" service and verify it is \\\"Stopped\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"}\n\n    If the ESXi Shell service is \\\"Running\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", select the \\\"ESXi Shell\\\" service and click the \\\"Stop\\\" button.\n\n    Click the \\\"Edit Startup policy...\\\" button.\n\n    Select the \\\"Start and stop manually\\\" radio button.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"ESXi Shell\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000095-VMM-000480'\n  tag gid: 'V-ESXI-80-000194'\n  tag rid: 'SV-ESXI-80-000194'\n  tag stig_id: 'ESXI-80-000194'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000194.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Policy stdout.strip is expected to cmp == \"off\"","run_time":0.3740105,"start_time":"2023-06-07T08:28:44-06:00","message":"\nexpected: off\n     got: on\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Policy\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Running stdout.strip is expected to cmp == \"false\"","run_time":0.3756545,"start_time":"2023-06-07T08:28:44-06:00","message":"\nexpected: false\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'ESXi Shell'} | Select-Object -ExpandProperty Running\"]","resource_id":""}]},{"id":"ESXI-80-000195","title":"The ESXi host must automatically stop shell services after ten minutes.","desc":"When the ESXi Shell or Secure Shell (SSH) services are enabled on a host, they will run indefinitely. To avoid having these services left running, set the \"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after which the ESXi Shell and SSH services will be stopped automatically.","descriptions":[{"label":"default","data":"When the ESXi Shell or Secure Shell (SSH) services are enabled on a host, they will run indefinitely. To avoid having these services left running, set the \"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after which the ESXi Shell and SSH services will be stopped automatically."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.ESXiShellTimeOut\" value and verify it is set to less than \"600\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut\n\nIf the \"UserVars.ESXiShellTimeOut\" setting is set to a value greater than \"600\" or \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.ESXiShellTimeOut\" value and configure it to \"600\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Set-AdvancedSetting -Value 600"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000163-VMM-000700","gid":"V-ESXI-80-000195","rid":"SV-ESXI-80-000195","stig_id":"ESXI-80-000195","cci":["CCI-001133"],"nist":["SC-10"]},"code":"control 'ESXI-80-000195' do\n  title 'The ESXi host must automatically stop shell services after ten minutes.'\n  desc  'When the ESXi Shell or Secure Shell (SSH) services are enabled on a host, they will run indefinitely. To avoid having these services left running, set the \"ESXiShellTimeOut\". The \"ESXiShellTimeOut\" defines a window of time after which the ESXi Shell and SSH services will be stopped automatically.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.ESXiShellTimeOut\\\" value and verify it is set to less than \\\"600\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut\n\n    If the \\\"UserVars.ESXiShellTimeOut\\\" setting is set to a value greater than \\\"600\\\" or \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.ESXiShellTimeOut\\\" value and configure it to \\\"600\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Set-AdvancedSetting -Value 600\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag gid: 'V-ESXI-80-000195'\n  tag rid: 'SV-ESXI-80-000195'\n  tag stig_id: 'ESXI-80-000195'\n  tag cci: ['CCI-001133']\n  tag nist: ['SC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 600 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000195.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Select-Object -ExpandProperty Value stdout.strip is expected to cmp <= 600","run_time":0.599973,"start_time":"2023-06-07T08:28:45-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Select-Object -ExpandProperty Value stdout.strip is expected not to cmp == 0","run_time":0.0003577,"start_time":"2023-06-07T08:28:45-06:00","message":"\nexpected: 0\n     got: 0\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.ESXiShellTimeOut | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000196","title":"The ESXi host must set a timeout to automatically end idle DCUI sessions after ten minutes.","desc":"When the Direct Console User Interface (DCUI) is enabled and logged in, it should be automatically logged out if left logged on to avoid access by unauthorized persons. The \"DcuiTimeOut\" setting defines a window of time after which the DCUI will be logged out.","descriptions":[{"label":"default","data":"When the Direct Console User Interface (DCUI) is enabled and logged in, it should be automatically logged out if left logged on to avoid access by unauthorized persons. The \"DcuiTimeOut\" setting defines a window of time after which the DCUI will be logged out."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.DcuiTimeOut\" value and verify it is set to less than \"600\" and not \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut\n\nIf the \"UserVars.DcuiTimeOut\" setting is set to a value greater than \"600\" or \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.DcuiTimeOut\" value and configure it to \"600\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Set-AdvancedSetting -Value 600"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000163-VMM-000700","gid":"V-ESXI-80-000196","rid":"SV-ESXI-80-000196","stig_id":"ESXI-80-000196","cci":["CCI-001133"],"nist":["SC-10"]},"code":"control 'ESXI-80-000196' do\n  title 'The ESXi host must set a timeout to automatically end idle DCUI sessions after ten minutes.'\n  desc  'When the Direct Console User Interface (DCUI) is enabled and logged in, it should be automatically logged out if left logged on to avoid access by unauthorized persons. The \"DcuiTimeOut\" setting defines a window of time after which the DCUI will be logged out.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.DcuiTimeOut\\\" value and verify it is set to less than \\\"600\\\" and not \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut\n\n    If the \\\"UserVars.DcuiTimeOut\\\" setting is set to a value greater than \\\"600\\\" or \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.DcuiTimeOut\\\" value and configure it to \\\"600\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Set-AdvancedSetting -Value 600\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000163-VMM-000700'\n  tag gid: 'V-ESXI-80-000196'\n  tag rid: 'SV-ESXI-80-000196'\n  tag stig_id: 'ESXI-80-000196'\n  tag cci: ['CCI-001133']\n  tag nist: ['SC-10']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp <= 600 }\n        its('stdout.strip') { should_not cmp 0 }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000196.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Select-Object -ExpandProperty Value stdout.strip is expected to cmp <= 600","run_time":0.5613789,"start_time":"2023-06-07T08:28:45-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Select-Object -ExpandProperty Value stdout.strip is expected not to cmp == 0","run_time":0.000369,"start_time":"2023-06-07T08:28:46-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.DcuiTimeOut | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000198","title":"The ESXi host must protect the confidentiality and integrity of transmitted information by isolating ESXi management traffic.","desc":"The vSphere management network provides access to the vSphere management interface on each component. Services running on the management interface provide an opportunity for an attacker to gain privileged access to the systems. Any remote attack most likely would begin with gaining entry to this network.\n\nThe Management VMkernel port group can be on a standard or distributed virtual switch but must be on a dedicated VLAN. The Management VLAN must not be shared by any other function and must not be accessible to anything other than management-related functions such as vCenter.","descriptions":[{"label":"default","data":"The vSphere management network provides access to the vSphere management interface on each component. Services running on the management interface provide an opportunity for an attacker to gain privileged access to the systems. Any remote attack most likely would begin with gaining entry to this network.\n\nThe Management VMkernel port group can be on a standard or distributed virtual switch but must be on a dedicated VLAN. The Management VLAN must not be shared by any other function and must not be accessible to anything other than management-related functions such as vCenter."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nReview each VMkernel adapter that is used for management traffic and view the \"Enabled services\".\n\nReview the VLAN associated with each VMkernel that is used for management traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\nIf any services are enabled on any Management VMkernel adapter, this is a finding.\n\nIf the network segment is accessible, except to networks where other management-related entities are located such as vCenter, this is a finding.\n\nIf there are any other systems or devices such as VMs on the ESXi management segment, this is a finding."},{"label":"fix","data":"Configuration of the management VMkernel will be unique to each environment.\n\nAs an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nSelect the Management VMkernel and click \"Edit\". On the Port properties tab, uncheck all services except for \"Management\". Click \"OK\".\n\nFrom the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\" and select VLAN.\n\nChange the \"VLAN Type\" to \"VLAN\" and change the \"VLAN ID\" to a network allocated and dedicated to management traffic exclusively. Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000423-VMM-001700","gid":"V-ESXI-80-000198","rid":"SV-ESXI-80-000198","stig_id":"ESXI-80-000198","cci":["CCI-002418"],"nist":["SC-8"]},"code":"control 'ESXI-80-000198' do\n  title 'The ESXi host must protect the confidentiality and integrity of transmitted information by isolating ESXi management traffic.'\n  desc  \"\n    The vSphere management network provides access to the vSphere management interface on each component. Services running on the management interface provide an opportunity for an attacker to gain privileged access to the systems. Any remote attack most likely would begin with gaining entry to this network.\n\n    The Management VMkernel port group can be on a standard or distributed virtual switch but must be on a dedicated VLAN. The Management VLAN must not be shared by any other function and must not be accessible to anything other than management-related functions such as vCenter.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Review each VMkernel adapter that is used for management traffic and view the \\\"Enabled services\\\".\n\n    Review the VLAN associated with each VMkernel that is used for management traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\n    If any services are enabled on any Management VMkernel adapter, this is a finding.\n\n    If the network segment is accessible, except to networks where other management-related entities are located such as vCenter, this is a finding.\n\n    If there are any other systems or devices such as VMs on the ESXi management segment, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of the management VMkernel will be unique to each environment.\n\n    As an example, to modify the IP address and VLAN information to the correct network on a distributed switch do the following:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Select the Management VMkernel and click \\\"Edit\\\". On the Port properties tab, uncheck all services except for \\\"Management\\\". Click \\\"OK\\\".\n\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\" and select VLAN.\n\n    Change the \\\"VLAN Type\\\" to \\\"VLAN\\\" and change the \\\"VLAN ID\\\" to a network allocated and dedicated to management traffic exclusively. Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-ESXI-80-000198'\n  tag rid: 'SV-ESXI-80-000198'\n  tag stig_id: 'ESXI-80-000198'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -VMKernel | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n      vmks = powercli_command(command).stdout\n\n      vmks.split.each do |vmk|\n        # Check to see if Management and any other services are enabled on the same VMkernel adapter\n        command2 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Where-Object {$_.VMotionEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VsanTrafficEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n        describe powercli_command(command2) do\n          its('stdout.strip') { should be_empty }\n        end\n        # Get Management Port Group Name\n        command3 = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Select-Object -ExpandProperty PortGroupName\"\n        pgname = powercli_command(command3).stdout.strip\n        # Test standard port groups\n        command4 = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup -Name \\\"#{pgname}\\\" | Select-Object -ExpandProperty VlanId\"\n        stdpgs = powercli_command(command4).stdout.strip\n        unless stdpgs.empty?\n          describe 'Checking standand port group VLAN ID' do\n            subject { stdpgs }\n            it { should cmp \"#{input('mgtVlanId')}\" }\n          end\n        end\n        describe 'SA Interview' do\n          skip 'SA also needs to confirm this VLAN is dedicated to Management and not shared with VMs or other services.'\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000198.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostNetworkAdapter -Name vmk0 | Where-Object {$_.VMotionEnabled -eq \"True\" -or $_.FaultToleranceLoggingEnabled -eq \"True\" -or $_.VsanTrafficEnabled -eq \"True\" -or $_.VSphereReplicationEnabled -eq \"True\" -or $_.VSphereReplicationNFCEnabled -eq \"True\" -or $_.VSphereBackupNFCEnabled -eq \"True\"} | Select-Object -ExpandProperty DeviceName stdout.strip is expected to be empty","run_time":0.5869111,"start_time":"2023-06-07T08:28:46-06:00","message":"expected `\"vmk0\".empty?` to be truthy, got false","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostNetworkAdapter -Name vmk0 | Where-Object {$_.VMotionEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VsanTrafficEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"]","resource_id":""},{"status":"failed","code_desc":"Checking standand port group VLAN ID is expected to cmp == \"101\"","run_time":0.0002865,"start_time":"2023-06-07T08:28:47-06:00","message":"\nexpected: 101\n     got: 0\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"Checking standand port group VLAN ID"},{"status":"skipped","code_desc":"SA Interview","run_time":6.2e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"SA also needs to confirm this VLAN is dedicated to Management and not shared with VMs or other services.","resource_class":"Object","resource_params":"[]","resource_id":"SA Interview"}]},{"id":"ESXI-80-000199","title":"The ESXi host must protect the confidentiality and integrity of transmitted information by isolating IP-based storage traffic.","desc":"Virtual machines (VMs) might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes vSAN, iSCSI, and NFS. This configuration might expose IP-based storage traffic to unauthorized VM users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from any other traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and VMs will limit unauthorized users from viewing the traffic.","descriptions":[{"label":"default","data":"Virtual machines (VMs) might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes vSAN, iSCSI, and NFS. This configuration might expose IP-based storage traffic to unauthorized VM users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from any other traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and VMs will limit unauthorized users from viewing the traffic."},{"label":"rationale","data":""},{"label":"check","data":"If IP-based storage is not used, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nReview each VMkernel adapter that is used for IP-based storage traffic and view the \"Enabled services\".\n\nReview the VLAN associated with each VMkernel that is used for IP-based storage traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\nIf any services are enabled on an NFS or iSCSI IP-based storage VMkernel adapter, this is a finding.\n\nIf any services are enabled on a vSAN VMkernel adapter other than vSAN, this is a finding.\n\nIf any IP-based storage networks are not isolated from other traffic types, this is a finding."},{"label":"fix","data":"Configuration of an IP-Based VMkernel will be unique to each environment.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\nSelect the VMkernel used for IP-based storage and click \"Edit\". On the \"Port\" properties tab, uncheck all services. Click \"OK\".\n\nNote: For VMkernels used for vSAN leave the vSAN service enabled and uncheck all others.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual switches.\n\nFind the port group that is dedicated to IP-based storage and click the '...' button next to the name. Click \"Edit Settings\".\n\nOn the \"Properties\" tab, change the \"VLAN ID\" to one dedicated for IP-based storage traffic. Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000423-VMM-001700","gid":"V-ESXI-80-000199","rid":"SV-ESXI-80-000199","stig_id":"ESXI-80-000199","cci":["CCI-002418"],"nist":["SC-8"]},"code":"control 'ESXI-80-000199' do\n  title 'The ESXi host must protect the confidentiality and integrity of transmitted information by isolating IP-based storage traffic.'\n  desc  \"\n    Virtual machines (VMs) might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes vSAN, iSCSI, and NFS. This configuration might expose IP-based storage traffic to unauthorized VM users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\n    To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from any other traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and VMs will limit unauthorized users from viewing the traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If IP-based storage is not used, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Review each VMkernel adapter that is used for IP-based storage traffic and view the \\\"Enabled services\\\".\n\n    Review the VLAN associated with each VMkernel that is used for IP-based storage traffic. Verify with the system administrator that they are dedicated for that purpose and are logically separated from other functions.\n\n    If any services are enabled on an NFS or iSCSI IP-based storage VMkernel adapter, this is a finding.\n\n    If any services are enabled on a vSAN VMkernel adapter other than vSAN, this is a finding.\n\n    If any IP-based storage networks are not isolated from other traffic types, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of an IP-Based VMkernel will be unique to each environment.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> VMkernel adapters.\n\n    Select the VMkernel used for IP-based storage and click \\\"Edit\\\". On the \\\"Port\\\" properties tab, uncheck all services. Click \\\"OK\\\".\n\n    Note: For VMkernels used for vSAN leave the vSAN service enabled and uncheck all others.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual switches.\n\n    Find the port group that is dedicated to IP-based storage and click the '...' button next to the name. Click \\\"Edit Settings\\\".\n\n    On the \\\"Properties\\\" tab, change the \\\"VLAN ID\\\" to one dedicated for IP-based storage traffic. Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000423-VMM-001700'\n  tag gid: 'V-ESXI-80-000199'\n  tag rid: 'SV-ESXI-80-000199'\n  tag stig_id: 'ESXI-80-000199'\n  tag cci: ['CCI-002418']\n  tag nist: ['SC-8']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      # Check for iSCSI HBAs\n      commandiscsihbas = \"Get-VMHost -Name #{vmhost} | Get-VMHostHba | Where {$_.Type -eq 'iscsi'}\"\n      iscsi_hbas = powercli_command(commandiscsihbas).stdout\n\n      # Check for vSAN VMkernels\n      commandvsanvmks = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -VMKernel | Where-Object {$_.VsanTrafficEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n      vsanvmks = powercli_command(commandvsanvmks).stdout\n\n      # Check for NFS Datastores\n      commandnfs = \"Get-VMHost -Name #{vmhost} | Get-Datastore | Where {$_.Type -eq 'NFS'} | Select-Object -ExpandProperty Name\"\n      nfsds = powercli_command(commandnfs).stdout\n\n      if iscsi_hbas.empty? && vsanvmks.empty? && nfsds.empty?\n        describe '' do\n          skip \"The ESXi host #{vmhost} is not using IP-based storage, so this control is N/A.\"\n        end\n      else\n        # Do any iSCSI VMKs have any services enabled?\n        commandivmks = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.iscsi.networkportal.list.Invoke() | Select-Object -ExpandProperty Vmknic\"\n        ivmks = powercli_command(commandivmks).stdout\n        ivmks.split.each do |ivmk|\n          commandvsck = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{ivmk} | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\" -or $_.VsanTrafficEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VMotionEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n          describe powercli_command(commandvsck) do\n            its('stdout.strip') { should be_empty }\n          end\n        end\n        # Does the vSAN VMK have any other services enabled?\n        vsanvmks.split.each do |vmk|\n          commandvsck = \"Get-VMHost -Name #{vmhost} | Get-VMHostNetworkAdapter -Name #{vmk} | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VMotionEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"\n          describe powercli_command(commandvsck) do\n            its('stdout.strip') { should be_empty }\n          end\n        end\n        # Do any VMKs used for NFS storage have any services enabled?\n        unless nfsds.empty?\n          describe '' do\n            skip \"The ESXi host #{vmhost} has NFS datastores and requires manual validation.\"\n          end\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000199.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostNetworkAdapter -Name vmk0 | Where-Object {$_.ManagementTrafficEnabled -eq \"True\" -or $_.FaultToleranceLoggingEnabled -eq \"True\" -or $_.VMotionEnabled -eq \"True\" -or $_.VSphereReplicationEnabled -eq \"True\" -or $_.VSphereReplicationNFCEnabled -eq \"True\" -or $_.VSphereBackupNFCEnabled -eq \"True\"} | Select-Object -ExpandProperty DeviceName stdout.strip is expected to be empty","run_time":0.5757657,"start_time":"2023-06-07T08:28:47-06:00","message":"expected `\"vmk0\".empty?` to be truthy, got false","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostNetworkAdapter -Name vmk0 | Where-Object {$_.ManagementTrafficEnabled -eq \\\"True\\\" -or $_.FaultToleranceLoggingEnabled -eq \\\"True\\\" -or $_.VMotionEnabled -eq \\\"True\\\" -or $_.VSphereReplicationEnabled -eq \\\"True\\\" -or $_.VSphereReplicationNFCEnabled -eq \\\"True\\\" -or $_.VSphereBackupNFCEnabled -eq \\\"True\\\"} | Select-Object -ExpandProperty DeviceName\"]","resource_id":""}]},{"id":"ESXI-80-000201","title":"The ESXi host lockdown mode exception users list must be verified.","desc":"While a host is in lockdown mode (strict or normal), only users on the \"Exception Users\" list are allowed access. These users do not lose their permissions when the host enters lockdown mode.\n\nThe organization may want to add service accounts such as a backup agent to the Exception Users list. Verify the list of users exempted from losing permissions is legitimate and as needed per the environment. Adding unnecessary users to the exception list defeats the purpose of lockdown mode.","descriptions":[{"label":"default","data":"While a host is in lockdown mode (strict or normal), only users on the \"Exception Users\" list are allowed access. These users do not lose their permissions when the host enters lockdown mode.\n\nThe organization may want to add service accounts such as a backup agent to the Exception Users list. Verify the list of users exempted from losing permissions is legitimate and as needed per the environment. Adding unnecessary users to the exception list defeats the purpose of lockdown mode."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Lockdown Mode\", review the Exception Users list.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following script:\n\n$vmhost = Get-VMHost | Get-View\n$lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n$lockdown.QueryLockdownExceptions()\n\nIf the Exception Users list contains accounts that do not require special permissions, this is a finding.\n\nNote: The Exception Users list is empty by default and should remain that way except under site-specific circumstances."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Security Profile.\n\nUnder \"Lockdown Mode\", click \"Edit\" and remove unnecessary users from the Exception Users list."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000201","rid":"SV-ESXI-80-000201","stig_id":"ESXI-80-000201","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000201' do\n  title 'The ESXi host lockdown mode exception users list must be verified.'\n  desc  \"\n    While a host is in lockdown mode (strict or normal), only users on the \\\"Exception Users\\\" list are allowed access. These users do not lose their permissions when the host enters lockdown mode.\n\n    The organization may want to add service accounts such as a backup agent to the Exception Users list. Verify the list of users exempted from losing permissions is legitimate and as needed per the environment. Adding unnecessary users to the exception list defeats the purpose of lockdown mode.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Lockdown Mode\\\", review the Exception Users list.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following script:\n\n    $vmhost = Get-VMHost | Get-View\n    $lockdown = Get-View $vmhost.ConfigManager.HostAccessManager\n    $lockdown.QueryLockdownExceptions()\n\n    If the Exception Users list contains accounts that do not require special permissions, this is a finding.\n\n    Note: The Exception Users list is empty by default and should remain that way except under site-specific circumstances.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Security Profile.\n\n    Under \\\"Lockdown Mode\\\", click \\\"Edit\\\" and remove unnecessary users from the Exception Users list.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000201'\n  tag rid: 'SV-ESXI-80-000201'\n  tag stig_id: 'ESXI-80-000201'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost} | Get-View; (Get-View $vmhost.ConfigManager.HostAccessManager).QueryLockdownExceptions()\"\n      results = powercli_command(command).stdout\n      if !results.empty?\n        results.split.each do |exceptionUser|\n          describe \"Exception user: #{exceptionUser} on host: #{vmhost}\" do\n            subject { exceptionUser }\n            it { should be_in \"#{input('exceptionUsers')}\" }\n          end\n        end\n      else\n        describe \"Exception users for host: #{vmhost}\" do\n          subject { results }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000201.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Exception users for host: 10.186.25.26 is expected to be empty","run_time":0.0102396,"start_time":"2023-06-07T08:28:47-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Exception users for host: 10.186.25.26"}]},{"id":"ESXI-80-000202","title":"The ESXi host Secure Shell (SSH) daemon must not allow host-based authentication.","desc":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH's cryptographic host-based authentication is more secure than \".rhosts\" authentication, since hosts are cryptographically authenticated. However, it is not recommended that hosts unilaterally trust one another, even within an organization.","descriptions":[{"label":"default","data":"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH's cryptographic host-based authentication is more secure than \".rhosts\" authentication, since hosts are cryptographically authenticated. However, it is not recommended that hosts unilaterally trust one another, even within an organization."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep hostbasedauthentication\n\nExpected result:\n\nhostbasedauthentication no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nHostbasedAuthentication no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000202","rid":"SV-ESXI-80-000202","stig_id":"ESXI-80-000202","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000202' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not allow host-based authentication.'\n  desc  \"SSH trust relationships mean a compromise on one host can allow an attacker to move trivially to other hosts. SSH's cryptographic host-based authentication is more secure than \\\".rhosts\\\" authentication, since hosts are cryptographically authenticated. However, it is not recommended that hosts unilaterally trust one another, even within an organization.\"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep hostbasedauthentication\n\n    Expected result:\n\n    hostbasedauthentication no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    HostbasedAuthentication no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000202'\n  tag rid: 'SV-ESXI-80-000202'\n  tag stig_id: 'ESXI-80-000202'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000202.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":5.0e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000203","title":"The ESXi host Secure Shell (SSH) daemon must not allow authentication using an empty password.","desc":"Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.","descriptions":[{"label":"default","data":"Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep permitemptypasswords\n\nExpected result:\n\npermitemptypasswords no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nPermitEmptyPasswords no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000203","rid":"SV-ESXI-80-000203","stig_id":"ESXI-80-000203","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000203' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not allow authentication using an empty password.'\n  desc  'Configuring this setting for the SSH daemon provides additional assurance that remote logon via SSH will require a password, even in the event of misconfiguration elsewhere.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep permitemptypasswords\n\n    Expected result:\n\n    permitemptypasswords no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitEmptyPasswords no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000203'\n  tag rid: 'SV-ESXI-80-000203'\n  tag stig_id: 'ESXI-80-000203'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000203.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":3.4e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000204","title":"The ESXi host Secure Shell (SSH) daemon must not permit user environment settings.","desc":"SSH environment options potentially allow users to bypass access restriction in some configurations. Users must not be able to present environment options to the SSH daemon.","descriptions":[{"label":"default","data":"SSH environment options potentially allow users to bypass access restriction in some configurations. Users must not be able to present environment options to the SSH daemon."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep permituserenvironment\n\nExpected result:\n\npermituserenvironment no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nPermitUserEnvironment no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000204","rid":"SV-ESXI-80-000204","stig_id":"ESXI-80-000204","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000204' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not permit user environment settings.'\n  desc  'SSH environment options potentially allow users to bypass access restriction in some configurations. Users must not be able to present environment options to the SSH daemon.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep permituserenvironment\n\n    Expected result:\n\n    permituserenvironment no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitUserEnvironment no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000204'\n  tag rid: 'SV-ESXI-80-000204'\n  tag stig_id: 'ESXI-80-000204'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000204.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":3.5e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000205","title":"The ESXi host Secure Shell (SSH) daemon must perform strict mode checking of home directory configuration files.","desc":"If other users have access to modify user-specific SSH configuration files, they may be able to log on the system as another user.","descriptions":[{"label":"default","data":"If other users have access to modify user-specific SSH configuration files, they may be able to log on the system as another user."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep strictmodes\n\nExpected result:\n\nstrictmodes yes\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nStrictModes yes"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000205","rid":"SV-ESXI-80-000205","stig_id":"ESXI-80-000205","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000205' do\n  title 'The ESXi host Secure Shell (SSH) daemon must perform strict mode checking of home directory configuration files.'\n  desc  'If other users have access to modify user-specific SSH configuration files, they may be able to log on the system as another user.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep strictmodes\n\n    Expected result:\n\n    strictmodes yes\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    StrictModes yes\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000205'\n  tag rid: 'SV-ESXI-80-000205'\n  tag stig_id: 'ESXI-80-000205'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000205.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":3.8e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000206","title":"The ESXi host Secure Shell (SSH) daemon must not allow compression.","desc":"If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges.","descriptions":[{"label":"default","data":"If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep compression\n\nExpected result:\n\ncompression no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nCompression no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000206","rid":"SV-ESXI-80-000206","stig_id":"ESXI-80-000206","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000206' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not allow compression.'\n  desc  'If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep compression\n\n    Expected result:\n\n    compression no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    Compression no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000206'\n  tag rid: 'SV-ESXI-80-000206'\n  tag stig_id: 'ESXI-80-000206'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000206.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":3.7e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000207","title":"The ESXi host Secure Shell (SSH) daemon must be configured to not allow gateway ports.","desc":"SSH Transmission Control Protocol (TCP) connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide convenience similar to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs). Gateway ports allow remote forwarded ports to bind to nonloopback addresses on the server.","descriptions":[{"label":"default","data":"SSH Transmission Control Protocol (TCP) connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide convenience similar to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs). Gateway ports allow remote forwarded ports to bind to nonloopback addresses on the server."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep gatewayports\n\nExpected result:\n\ngatewayports no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nGatewayPorts no"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000207","rid":"SV-ESXI-80-000207","stig_id":"ESXI-80-000207","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000207' do\n  title 'The ESXi host Secure Shell (SSH) daemon must be configured to not allow gateway ports.'\n  desc  'SSH Transmission Control Protocol (TCP) connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide convenience similar to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs). Gateway ports allow remote forwarded ports to bind to nonloopback addresses on the server.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep gatewayports\n\n    Expected result:\n\n    gatewayports no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    GatewayPorts no\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000207'\n  tag rid: 'SV-ESXI-80-000207'\n  tag stig_id: 'ESXI-80-000207'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000207.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":2.9e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000208","title":"The ESXi host Secure Shell (SSH) daemon must be configured to not allow X11 forwarding.","desc":"X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection.","descriptions":[{"label":"default","data":"X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep x11forwarding\n\nExpected result:\n\nx11forwarding no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nX11Forwarding no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000208","rid":"SV-ESXI-80-000208","stig_id":"ESXI-80-000208","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000208' do\n  title 'The ESXi host Secure Shell (SSH) daemon must be configured to not allow X11 forwarding.'\n  desc  'X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep x11forwarding\n\n    Expected result:\n\n    x11forwarding no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    X11Forwarding no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000208'\n  tag rid: 'SV-ESXI-80-000208'\n  tag stig_id: 'ESXI-80-000208'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000208.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":2.3e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000209","title":"The ESXi host Secure Shell (SSH) daemon must not permit tunnels.","desc":"OpenSSH has the ability to create network tunnels (layer 2 and layer 3) over an SSH connection. This function can provide similar convenience to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs).","descriptions":[{"label":"default","data":"OpenSSH has the ability to create network tunnels (layer 2 and layer 3) over an SSH connection. This function can provide similar convenience to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs)."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep permittunnel\n\nExpected result:\n\npermittunnel no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nPermitTunnel no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000209","rid":"SV-ESXI-80-000209","stig_id":"ESXI-80-000209","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000209' do\n  title 'The ESXi host Secure Shell (SSH) daemon must not permit tunnels.'\n  desc  'OpenSSH has the ability to create network tunnels (layer 2 and layer 3) over an SSH connection. This function can provide similar convenience to a virtual private network (VPN) with the similar risk of providing a path to circumvent firewalls and network Access Control Lists (ACLs).'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep permittunnel\n\n    Expected result:\n\n    permittunnel no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    PermitTunnel no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000209'\n  tag rid: 'SV-ESXI-80-000209'\n  tag stig_id: 'ESXI-80-000209'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000209.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":2.3e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000210","title":"The ESXi host Secure Shell (SSH) daemon must set a timeout count on idle sessions.","desc":"Setting a timeout ensures that a user login will be terminated as soon as the \"ClientAliveCountMax\" is reached.","descriptions":[{"label":"default","data":"Setting a timeout ensures that a user login will be terminated as soon as the \"ClientAliveCountMax\" is reached."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep clientalivecountmax\n\nExpected result:\n\nclientalivecountmax 3\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nClientAliveCountMax 3"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000210","rid":"SV-ESXI-80-000210","stig_id":"ESXI-80-000210","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000210' do\n  title 'The ESXi host Secure Shell (SSH) daemon must set a timeout count on idle sessions.'\n  desc  'Setting a timeout ensures that a user login will be terminated as soon as the \"ClientAliveCountMax\" is reached.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep clientalivecountmax\n\n    Expected result:\n\n    clientalivecountmax 3\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    ClientAliveCountMax 3\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000210'\n  tag rid: 'SV-ESXI-80-000210'\n  tag stig_id: 'ESXI-80-000210'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000210.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":2.3e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000211","title":"The ESXi host Secure Shell (SSH) daemon must set a timeout interval on idle sessions.","desc":"Automatically logging out idle users guards against compromises via hijacked administrative sessions.","descriptions":[{"label":"default","data":"Automatically logging out idle users guards against compromises via hijacked administrative sessions."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep clientaliveinterval\n\nExpected result:\n\nclientaliveinterval 200\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nClientAliveInterval 200"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000211","rid":"SV-ESXI-80-000211","stig_id":"ESXI-80-000211","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000211' do\n  title 'The ESXi host Secure Shell (SSH) daemon must set a timeout interval on idle sessions.'\n  desc  'Automatically logging out idle users guards against compromises via hijacked administrative sessions.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep clientaliveinterval\n\n    Expected result:\n\n    clientaliveinterval 200\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    ClientAliveInterval 200\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000211'\n  tag rid: 'SV-ESXI-80-000211'\n  tag stig_id: 'ESXI-80-000211'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000211.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":2.4e-06,"start_time":"2023-06-07T08:28:47-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000212","title":"The ESXi host must disable Simple Network Management Protocol (SNMP) v1 and v2c.","desc":"If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can use this information to plan an attack.","descriptions":[{"label":"default","data":"If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can use this information to plan an attack."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli system snmp get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHostSnmp | Select *\n\nIf SNMP is not in use and is enabled, this is a finding.\n\nIf SNMP is enabled and is not using v3 targets with authentication, this is a finding.\n\nNote: SNMP v3 targets can only be viewed and configured via the \"esxcli\" command."},{"label":"fix","data":"To disable SNMP from an ESXi shell, run the following command:\n\n# esxcli system snmp set -e no\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi Host:\n\nGet-VMHostSnmp | Set-VMHostSnmp -Enabled $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000212","rid":"SV-ESXI-80-000212","stig_id":"ESXI-80-000212","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000212' do\n  title 'The ESXi host must disable Simple Network Management Protocol (SNMP) v1 and v2c.'\n  desc  'If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can use this information to plan an attack.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system snmp get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHostSnmp | Select *\n\n    If SNMP is not in use and is enabled, this is a finding.\n\n    If SNMP is enabled and is not using v3 targets with authentication, this is a finding.\n\n    Note: SNMP v3 targets can only be viewed and configured via the \\\"esxcli\\\" command.\n  \"\n  desc 'fix', \"\n    To disable SNMP from an ESXi shell, run the following command:\n\n    # esxcli system snmp set -e no\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi Host:\n\n    Get-VMHostSnmp | Set-VMHostSnmp -Enabled $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000212'\n  tag rid: 'SV-ESXI-80-000212'\n  tag stig_id: 'ESXI-80-000212'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    if \"#{input('snmpEnabled')}\" == 'false'\n      vmhosts.each do |vmhost|\n        command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.snmp.get.Invoke() | Select-Object -ExpandProperty enable\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp 'false' }\n        end\n      end\n    else\n      describe 'SNMP Enabled' do\n        skip 'Manually verify SNMP v3 is configured correctly and v2 is not used.'\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000212.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.snmp.get.Invoke() | Select-Object -ExpandProperty enable stdout.strip is expected to cmp == \"false\"","run_time":0.4428232,"start_time":"2023-06-07T08:28:47-06:00","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.snmp.get.Invoke() | Select-Object -ExpandProperty enable\"]","resource_id":""}]},{"id":"ESXI-80-000213","title":"The ESXi host must disable Inter-Virtual Machine (VM) Transparent Page Sharing.","desc":"Published academic papers have demonstrated that by forcing a flush and reload of cache memory, it is possible to measure memory timings to try to determine an Advanced Encryption Standard (AES) encryption key in use on another virtual machine running on the same physical processor of the host server if Transparent Page Sharing (TPS) is enabled between the two VMs. This technique works only in a highly controlled system configured in a nonstandard way that VMware believes would not be recreated in a production environment.\n\nAlthough VMware believes information being disclosed in real-world conditions is unrealistic, out of an abundance of caution, upcoming ESXi Update releases will no longer enable TPS between VMs by default (TPS will still be used within individual VMs).","descriptions":[{"label":"default","data":"Published academic papers have demonstrated that by forcing a flush and reload of cache memory, it is possible to measure memory timings to try to determine an Advanced Encryption Standard (AES) encryption key in use on another virtual machine running on the same physical processor of the host server if Transparent Page Sharing (TPS) is enabled between the two VMs. This technique works only in a highly controlled system configured in a nonstandard way that VMware believes would not be recreated in a production environment.\n\nAlthough VMware believes information being disclosed in real-world conditions is unrealistic, out of an abundance of caution, upcoming ESXi Update releases will no longer enable TPS between VMs by default (TPS will still be used within individual VMs)."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Mem.ShareForceSalting\" value and verify it is set to \"2\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting\n\nIf the \"Mem.ShareForceSalting\" setting is not set to 2, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Mem.ShareForceSalting\" value and set it to \"2\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting | Set-AdvancedSetting -Value 2"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000213","rid":"SV-ESXI-80-000213","stig_id":"ESXI-80-000213","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000213' do\n  title 'The ESXi host must disable Inter-Virtual Machine (VM) Transparent Page Sharing.'\n  desc  \"\n    Published academic papers have demonstrated that by forcing a flush and reload of cache memory, it is possible to measure memory timings to try to determine an Advanced Encryption Standard (AES) encryption key in use on another virtual machine running on the same physical processor of the host server if Transparent Page Sharing (TPS) is enabled between the two VMs. This technique works only in a highly controlled system configured in a nonstandard way that VMware believes would not be recreated in a production environment.\n\n    Although VMware believes information being disclosed in real-world conditions is unrealistic, out of an abundance of caution, upcoming ESXi Update releases will no longer enable TPS between VMs by default (TPS will still be used within individual VMs).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Mem.ShareForceSalting\\\" value and verify it is set to \\\"2\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting\n\n    If the \\\"Mem.ShareForceSalting\\\" setting is not set to 2, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Mem.ShareForceSalting\\\" value and set it to \\\"2\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.ShareForceSalting | Set-AdvancedSetting -Value 2\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000213'\n  tag rid: 'SV-ESXI-80-000213'\n  tag stig_id: 'ESXI-80-000213'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Mem.ShareForceSalting | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '2' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000213.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Mem.ShareForceSalting | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"2\"","run_time":0.5384431,"start_time":"2023-06-07T08:28:48-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Mem.ShareForceSalting | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000214","title":"The ESXi host must configure the firewall to block network traffic by default.","desc":"In addition to service-specific firewall rules, ESXi has a default firewall rule policy to allow or deny incoming and outgoing traffic. Reduce the risk of attack by ensuring this is set to deny incoming and outgoing traffic.","descriptions":[{"label":"default","data":"In addition to service-specific firewall rules, ESXi has a default firewall rule policy to allow or deny incoming and outgoing traffic. Reduce the risk of attack by ensuring this is set to deny incoming and outgoing traffic."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli network firewall get\n\nIf the \"Default Action\" does not equal \"DROP\", this is a finding.\nIf \"Enabled\" does not equal \"true\", this is a finding.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHostFirewallDefaultPolicy\n\nIf the Incoming or Outgoing policies are \"True\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# esxcli network firewall set --default-action=false\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHostFirewallDefaultPolicy | Set-VMHostFirewallDefaultPolicy -AllowIncoming $false -AllowOutgoing $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000214","rid":"SV-ESXI-80-000214","stig_id":"ESXI-80-000214","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000214' do\n  title 'The ESXi host must configure the firewall to block network traffic by default.'\n  desc  'In addition to service-specific firewall rules, ESXi has a default firewall rule policy to allow or deny incoming and outgoing traffic. Reduce the risk of attack by ensuring this is set to deny incoming and outgoing traffic.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli network firewall get\n\n    If the \\\"Default Action\\\" does not equal \\\"DROP\\\", this is a finding.\n    If \\\"Enabled\\\" does not equal \\\"true\\\", this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHostFirewallDefaultPolicy\n\n    If the Incoming or Outgoing policies are \\\"True\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli network firewall set --default-action=false\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHostFirewallDefaultPolicy | Set-VMHostFirewallDefaultPolicy -AllowIncoming $false -AllowOutgoing $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000214'\n  tag rid: 'SV-ESXI-80-000214'\n  tag stig_id: 'ESXI-80-000214'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostFirewallDefaultPolicy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000214.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostFirewallDefaultPolicy stdout.strip is expected not to match \"True\"","run_time":0.6888148,"start_time":"2023-06-07T08:28:48-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostFirewallDefaultPolicy\"]","resource_id":""}]},{"id":"ESXI-80-000215","title":"The ESXi host must enable Bridge Protocol Data Units (BPDU) filter on the host to prevent being locked out of physical switch ports with Portfast and BPDU Guard enabled.","desc":"BPDU Guard and Portfast are commonly enabled on the physical switch to which the ESXi host is directly connected to reduce the Spanning Tree Protocol (STP) convergence delay.\n\nIf a BPDU packet is sent from a virtual machine (VM) on the ESXi host to the physical switch configured as stated above, a cascading lockout of all the uplink interfaces from the ESXi host can occur. To prevent this type of lockout, BPDU Filter can be enabled on the ESXi host to drop any BPDU packets being sent to the physical switch.\n\nThe caveat is that certain Secure Socket Layer (SSL) virtual private networks that use Windows bridging capability can legitimately generate BPDU packets. The administrator should verify no legitimate BPDU packets are generated by VMs on the ESXi host prior to enabling BPDU Filter. If BPDU Filter is enabled in this situation, enabling Reject Forged Transmits on the virtual switch port group adds protection against Spanning Tree loops.","descriptions":[{"label":"default","data":"BPDU Guard and Portfast are commonly enabled on the physical switch to which the ESXi host is directly connected to reduce the Spanning Tree Protocol (STP) convergence delay.\n\nIf a BPDU packet is sent from a virtual machine (VM) on the ESXi host to the physical switch configured as stated above, a cascading lockout of all the uplink interfaces from the ESXi host can occur. To prevent this type of lockout, BPDU Filter can be enabled on the ESXi host to drop any BPDU packets being sent to the physical switch.\n\nThe caveat is that certain Secure Socket Layer (SSL) virtual private networks that use Windows bridging capability can legitimately generate BPDU packets. The administrator should verify no legitimate BPDU packets are generated by VMs on the ESXi host prior to enabling BPDU Filter. If BPDU Filter is enabled in this situation, enabling Reject Forged Transmits on the virtual switch port group adds protection against Spanning Tree loops."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Net.BlockGuestBPDU\" value and verify it is set to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU\n\nIf the \"Net.BlockGuestBPDU\" setting is not set to \"1\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Net.BlockGuestBPDU\" value and configure it to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Set-AdvancedSetting -Value 1"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000215","rid":"SV-ESXI-80-000215","stig_id":"ESXI-80-000215","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000215' do\n  title 'The ESXi host must enable Bridge Protocol Data Units (BPDU) filter on the host to prevent being locked out of physical switch ports with Portfast and BPDU Guard enabled.'\n  desc  \"\n    BPDU Guard and Portfast are commonly enabled on the physical switch to which the ESXi host is directly connected to reduce the Spanning Tree Protocol (STP) convergence delay.\n\n    If a BPDU packet is sent from a virtual machine (VM) on the ESXi host to the physical switch configured as stated above, a cascading lockout of all the uplink interfaces from the ESXi host can occur. To prevent this type of lockout, BPDU Filter can be enabled on the ESXi host to drop any BPDU packets being sent to the physical switch.\n\n    The caveat is that certain Secure Socket Layer (SSL) virtual private networks that use Windows bridging capability can legitimately generate BPDU packets. The administrator should verify no legitimate BPDU packets are generated by VMs on the ESXi host prior to enabling BPDU Filter. If BPDU Filter is enabled in this situation, enabling Reject Forged Transmits on the virtual switch port group adds protection against Spanning Tree loops.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Net.BlockGuestBPDU\\\" value and verify it is set to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU\n\n    If the \\\"Net.BlockGuestBPDU\\\" setting is not set to \\\"1\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Net.BlockGuestBPDU\\\" value and configure it to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Set-AdvancedSetting -Value 1\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000215'\n  tag rid: 'SV-ESXI-80-000215'\n  tag stig_id: 'ESXI-80-000215'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '1' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000215.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"1\"","run_time":0.594187,"start_time":"2023-06-07T08:28:49-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Net.BlockGuestBPDU | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000216","title":"The ESXi host must configure virtual switch security policies to reject forged transmits.","desc":"If the virtual machine (VM) operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis means the virtual switch does not compare the source and effective MAC addresses.\n\nTo protect against MAC address impersonation, all virtual switches must have forged transmissions set to reject. Reject Forged Transmit can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.","descriptions":[{"label":"default","data":"If the virtual machine (VM) operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis means the virtual switch does not compare the source and effective MAC addresses.\n\nTo protect against MAC address impersonation, all virtual switches must have forged transmissions set to reject. Reject Forged Transmit can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level."},{"label":"rationale","data":""},{"label":"check","data":"Note: This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click the '...' button next to each port group and select \"Edit Settings\".\n\nClick the \"Security\" tab. Verify that \"Forged transmits\" is set to \"Reject\" and that \"Override\" is not checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy\nGet-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\nIf the \"Forged Transmits\" policy is set to \"Accept\" (or \"true\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click \"Edit\" and select Security.\n\nSet \"Forged transmits\" to \"Reject\". Click \"OK\".\n\nFor each port group, click the '...' button and select \"Edit Settings\" then Security.\n\nSet \"Forged transmits\" to \"Reject\" and uncheck the \"Override\" box. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmits $false\nGet-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmitsInherited $true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000216","rid":"SV-ESXI-80-000216","stig_id":"ESXI-80-000216","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000216' do\n  title 'The ESXi host must configure virtual switch security policies to reject forged transmits.'\n  desc  \"\n    If the virtual machine (VM) operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    This means the virtual switch does not compare the source and effective MAC addresses.\n\n    To protect against MAC address impersonation, all virtual switches must have forged transmissions set to reject. Reject Forged Transmit can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Note: This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click the '...' button next to each port group and select \\\"Edit Settings\\\".\n\n    Click the \\\"Security\\\" tab. Verify that \\\"Forged transmits\\\" is set to \\\"Reject\\\" and that \\\"Override\\\" is not checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\n    If the \\\"Forged Transmits\\\" policy is set to \\\"Accept\\\" (or \\\"true\\\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click \\\"Edit\\\" and select Security.\n\n    Set \\\"Forged transmits\\\" to \\\"Reject\\\". Click \\\"OK\\\".\n\n    For each port group, click the '...' button and select \\\"Edit Settings\\\" then Security.\n\n    Set \\\"Forged transmits\\\" to \\\"Reject\\\" and uncheck the \\\"Override\\\" box. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmits $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmitsInherited $true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000216'\n  tag rid: 'SV-ESXI-80-000216'\n  tag stig_id: 'ESXI-80-000216'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000216.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected not to match \"True\"","run_time":0.8077617,"start_time":"2023-06-07T08:28:49-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected not to match \"True\"","run_time":0.7788918,"start_time":"2023-06-07T08:28:50-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""}]},{"id":"ESXI-80-000217","title":"The ESXi host must configure virtual switch security policies to reject Media Access Control (MAC) address changes.","desc":"If the virtual machine (VM) operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent VMs from changing their effective MAC address, which will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing. \"Reject MAC Changes\" can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.","descriptions":[{"label":"default","data":"If the virtual machine (VM) operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent VMs from changing their effective MAC address, which will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing. \"Reject MAC Changes\" can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level."},{"label":"rationale","data":""},{"label":"check","data":"This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click the '...' button next to each port group and select \"Edit Settings\".\n\nClick the \"Security\" tab. Verify that \"MAC Address Changes\" is set to \"Reject\" and that \"Override\" is not checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy\nGet-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\nIf the \"MAC Address Changes\" policy is set to \"Accept\" (or \"true\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click \"Edit\" and select Security.\n\nSet \"MAC Address Changes\" to \"Reject\". Click \"OK\".\n\nFor each port group, click the '...' button and select \"Edit Settings\" then Security.\n\nSet \"MAC Address Changes\" to \"Reject\" and uncheck the \"Override\" box. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -MacChanges $false\nGet-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -MacChangesInherited $true"}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000217","rid":"SV-ESXI-80-000217","stig_id":"ESXI-80-000217","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000217' do\n  title 'The ESXi host must configure virtual switch security policies to reject Media Access Control (MAC) address changes.'\n  desc  \"\n    If the virtual machine (VM) operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    This will prevent VMs from changing their effective MAC address, which will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing. \\\"Reject MAC Changes\\\" can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click the '...' button next to each port group and select \\\"Edit Settings\\\".\n\n    Click the \\\"Security\\\" tab. Verify that \\\"MAC Address Changes\\\" is set to \\\"Reject\\\" and that \\\"Override\\\" is not checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\n    If the \\\"MAC Address Changes\\\" policy is set to \\\"Accept\\\" (or \\\"true\\\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click \\\"Edit\\\" and select Security.\n\n    Set \\\"MAC Address Changes\\\" to \\\"Reject\\\". Click \\\"OK\\\".\n\n    For each port group, click the '...' button and select \\\"Edit Settings\\\" then Security.\n\n    Set \\\"MAC Address Changes\\\" to \\\"Reject\\\" and uncheck the \\\"Override\\\" box. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -MacChanges $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -MacChangesInherited $true\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000217'\n  tag rid: 'SV-ESXI-80-000217'\n  tag stig_id: 'ESXI-80-000217'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000217.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected not to match \"True\"","run_time":0.7277847,"start_time":"2023-06-07T08:28:51-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected not to match \"True\"","run_time":0.7991175,"start_time":"2023-06-07T08:28:52-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""}]},{"id":"ESXI-80-000218","title":"The ESXi host must configure virtual switch security policies to reject promiscuous mode requests.","desc":"When promiscuous mode is enabled for a virtual switch, all virtual machines (VMs) connected to the Portgroup have the potential to read all packets across that network (only the virtual machines connected to that Portgroup).\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting. Promiscuous mode can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.","descriptions":[{"label":"default","data":"When promiscuous mode is enabled for a virtual switch, all virtual machines (VMs) connected to the Portgroup have the potential to read all packets across that network (only the virtual machines connected to that Portgroup).\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting. Promiscuous mode can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level."},{"label":"rationale","data":""},{"label":"check","data":"This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click the '...' button next to each port group and select \"Edit Settings\".\n\nClick the \"Security\" tab. Verify that \"Promiscuous Mode\" is set to \"Reject\" and that \"Override\" is not checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy\nGet-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\nIf the \"Promiscuous Mode\" policy is set to \"Accept\" (or \"true\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nOn each standard switch, click \"Edit\" and select Security.\n\nSet \"Promiscuous Mode\" to \"Reject\". Click \"OK\".\n\nFor each port group, click the '...' button and select \"Edit Settings\" then Security.\n\nSet \"Promiscuous Mode\" to \"Reject\" and uncheck the \"Override\" box. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuous $false\nGet-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuousInherited $true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000218","rid":"SV-ESXI-80-000218","stig_id":"ESXI-80-000218","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000218' do\n  title 'The ESXi host must configure virtual switch security policies to reject promiscuous mode requests.'\n  desc  \"\n    When promiscuous mode is enabled for a virtual switch, all virtual machines (VMs) connected to the Portgroup have the potential to read all packets across that network (only the virtual machines connected to that Portgroup).\n\n    Promiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting. Promiscuous mode can be set at the vSwitch and/or the Portgroup level. Switch-level settings can be overridden at the Portgroup level.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click the '...' button next to each port group and select \\\"Edit Settings\\\".\n\n    Click the \\\"Security\\\" tab. Verify that \\\"Promiscuous Mode\\\" is set to \\\"Reject\\\" and that \\\"Override\\\" is not checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy\n    Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object *\n\n    If the \\\"Promiscuous Mode\\\" policy is set to \\\"Accept\\\" (or \\\"true\\\", via PowerCLI) or the security policy inherited from the virtual switch is overridden, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    On each standard switch, click \\\"Edit\\\" and select Security.\n\n    Set \\\"Promiscuous Mode\\\" to \\\"Reject\\\". Click \\\"OK\\\".\n\n    For each port group, click the '...' button and select \\\"Edit Settings\\\" then Security.\n\n    Set \\\"Promiscuous Mode\\\" to \\\"Reject\\\" and uncheck the \\\"Override\\\" box. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VirtualSwitch | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuous $false\n    Get-VirtualPortGroup | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuousInherited $true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000218'\n  tag rid: 'SV-ESXI-80-000218'\n  tag stig_id: 'ESXI-80-000218'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match 'True' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000218.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected not to match \"True\"","run_time":0.7038049,"start_time":"2023-06-07T08:28:53-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VirtualSwitch | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected not to match \"True\"","run_time":0.7996008,"start_time":"2023-06-07T08:28:53-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Get-SecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""}]},{"id":"ESXI-80-000219","title":"The ESXi host must restrict use of the dvFilter network application programming interface (API).","desc":"If the organization is not using products that use the dvfilter network API, the host should not be configured to send network information to a virtual machine (VM).\n\nIf the API is enabled, an attacker might attempt to connect a virtual machine to it, potentially providing access to the network of other VMs on the host.\n\nIf using a product that makes use of this API, verify the host has been configured correctly. If not using such a product, ensure the setting is blank.","descriptions":[{"label":"default","data":"If the organization is not using products that use the dvfilter network API, the host should not be configured to send network information to a virtual machine (VM).\n\nIf the API is enabled, an attacker might attempt to connect a virtual machine to it, potentially providing access to the network of other VMs on the host.\n\nIf using a product that makes use of this API, verify the host has been configured correctly. If not using such a product, ensure the setting is blank."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Net.DVFilterBindIpAddress\" value and verify the value is blank or the correct IP address of a security appliance if in use.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress\n\nIf the \"Net.DVFilterBindIpAddress\" setting is not blank and security appliances are not in use on the host, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Net.DVFilterBindIpAddress\" value and remove any incorrect addresses.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Set-AdvancedSetting -Value \"\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000219","rid":"SV-ESXI-80-000219","stig_id":"ESXI-80-000219","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000219' do\n  title 'The ESXi host must restrict use of the dvFilter network application programming interface (API).'\n  desc  \"\n    If the organization is not using products that use the dvfilter network API, the host should not be configured to send network information to a virtual machine (VM).\n\n    If the API is enabled, an attacker might attempt to connect a virtual machine to it, potentially providing access to the network of other VMs on the host.\n\n    If using a product that makes use of this API, verify the host has been configured correctly. If not using such a product, ensure the setting is blank.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Net.DVFilterBindIpAddress\\\" value and verify the value is blank or the correct IP address of a security appliance if in use.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress\n\n    If the \\\"Net.DVFilterBindIpAddress\\\" setting is not blank and security appliances are not in use on the host, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Net.DVFilterBindIpAddress\\\" value and remove any incorrect addresses.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Set-AdvancedSetting -Value \\\"\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000219'\n  tag rid: 'SV-ESXI-80-000219'\n  tag stig_id: 'ESXI-80-000219'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000219.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"\"","run_time":0.5625754,"start_time":"2023-06-07T08:28:54-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Net.DVFilterBindIpAddress | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000220","title":"The ESXi host must restrict the use of Virtual Guest Tagging (VGT) on standard switches.","desc":"When a port group is set to VLAN 4095, the vSwitch passes all network frames to the attached virtual machines (VMs) without modifying the VLAN tags. In vSphere, this is referred to as VGT. The VM must process the VLAN information itself via an 802.1Q driver in the operating system.\n\nVLAN 4095 must only be implemented if the attached VMs have been specifically authorized and are capable of managing VLAN tags themselves. If VLAN 4095 is enabled inappropriately, it may cause denial of service or allow a VM to interact with traffic on an unauthorized VLAN.","descriptions":[{"label":"default","data":"When a port group is set to VLAN 4095, the vSwitch passes all network frames to the attached virtual machines (VMs) without modifying the VLAN tags. In vSphere, this is referred to as VGT. The VM must process the VLAN information itself via an 802.1Q driver in the operating system.\n\nVLAN 4095 must only be implemented if the attached VMs have been specifically authorized and are capable of managing VLAN tags themselves. If VLAN 4095 is enabled inappropriately, it may cause denial of service or allow a VM to interact with traffic on an unauthorized VLAN."},{"label":"rationale","data":""},{"label":"check","data":"This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nFor each standard switch, review the \"VLAN ID\" on each port group and verify it is not set to \"4095\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VirtualPortGroup | Select Name, VLanID\n\nIf any port group is configured with VLAN 4095 and is not documented as a needed exception, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\nFor each port group on a standard switch that is configured to a native VLAN, click the '...' button next to the port group.\n\nClick \"Edit Settings\". On the \"Properties\" tab, change the \"VLAN ID\" to an appropriate VLAN ID. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VirtualPortGroup -Name \"portgroup name\" | Set-VirtualPortGroup -VLanId \"New VLAN#\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000220","rid":"SV-ESXI-80-000220","stig_id":"ESXI-80-000220","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000220' do\n  title 'The ESXi host must restrict the use of Virtual Guest Tagging (VGT) on standard switches.'\n  desc  \"\n    When a port group is set to VLAN 4095, the vSwitch passes all network frames to the attached virtual machines (VMs) without modifying the VLAN tags. In vSphere, this is referred to as VGT. The VM must process the VLAN information itself via an 802.1Q driver in the operating system.\n\n    VLAN 4095 must only be implemented if the attached VMs have been specifically authorized and are capable of managing VLAN tags themselves. If VLAN 4095 is enabled inappropriately, it may cause denial of service or allow a VM to interact with traffic on an unauthorized VLAN.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    This control addresses ESXi standard switches. Distributed switches are addressed in the vCenter STIG. If there is no standard switch on the ESXi host, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    For each standard switch, review the \\\"VLAN ID\\\" on each port group and verify it is not set to \\\"4095\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VirtualPortGroup | Select Name, VLanID\n\n    If any port group is configured with VLAN 4095 and is not documented as a needed exception, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> Networking >> Virtual Switches.\n\n    For each port group on a standard switch that is configured to a native VLAN, click the '...' button next to the port group.\n\n    Click \\\"Edit Settings\\\". On the \\\"Properties\\\" tab, change the \\\"VLAN ID\\\" to an appropriate VLAN ID. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VirtualPortGroup -Name \\\"portgroup name\\\" | Set-VirtualPortGroup -VLanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000220'\n  tag rid: 'SV-ESXI-80-000220'\n  tag stig_id: 'ESXI-80-000220'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VirtualPortGroup | Select-Object -ExpandProperty VlanId\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not match '4095' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000220.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Select-Object -ExpandProperty VlanId stdout.strip is expected not to match \"4095\"","run_time":0.6204252,"start_time":"2023-06-07T08:28:55-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VirtualPortGroup | Select-Object -ExpandProperty VlanId\"]","resource_id":""}]},{"id":"ESXI-80-000221","title":"The ESXi host must have all security patches and updates installed.","desc":"Installing software updates is a fundamental mitigation against the exploitation of publicly known vulnerabilities.","descriptions":[{"label":"default","data":"Installing software updates is a fundamental mitigation against the exploitation of publicly known vulnerabilities."},{"label":"rationale","data":""},{"label":"check","data":"Determine the current version and build:\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Summary. Note the version string next to \"Hypervisor:\".\n\nor\n\nFrom a Secure Shell (SSH) session connected to the ESXi host, or from the ESXi shell, run the following command:\n\n# vmware -v\n\nIf the ESXi host does not have the latest patches, this is a finding.\n\nIf the ESXi host is not on a supported release, this is a finding.\n\nThe latest ESXi versions and their build numbers can be found here: https://kb.vmware.com/s/article/2143832\n\nVMware also publishes Advisories on security patches and offers a way to subscribe to email alerts for them.\n\nGo to: https://www.vmware.com/support/policies/security_response"},{"label":"fix","data":"ESXi can be patched in multiple ways, and this fix text does not cover all methods.\n\nManual patching when image profiles are not used:\n\n- Download the latest \"offline bundle\" .zip update from vmware.com. Verify the hash.\n\n- Transfer the file to a datastore accessible by the ESXi host, local or remote.\n\n- Put the ESXi host into maintenance mode.\n\n- From an ESXi shell, run the following command:\n\nesxcli software vib update -d <path to offline patch bundle.zip>\n\nManual patching when image profiles are used:\n\nFrom an ESXi shell, run the following command:\n\n# esxcli software sources profile list -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\nNote the available profiles. The organization will usually want the one ending in \"-standard\".\n\n# esxcli software profile update -p <selected profile> -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\nThere will be little output during the update. Once complete, reboot the host for changes to take effect."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000221","rid":"SV-ESXI-80-000221","stig_id":"ESXI-80-000221","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000221' do\n  title 'The ESXi host must have all security patches and updates installed.'\n  desc  'Installing software updates is a fundamental mitigation against the exploitation of publicly known vulnerabilities.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Determine the current version and build:\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Summary. Note the version string next to \\\"Hypervisor:\\\".\n\n    or\n\n    From a Secure Shell (SSH) session connected to the ESXi host, or from the ESXi shell, run the following command:\n\n    # vmware -v\n\n    If the ESXi host does not have the latest patches, this is a finding.\n\n    If the ESXi host is not on a supported release, this is a finding.\n\n    The latest ESXi versions and their build numbers can be found here: https://kb.vmware.com/s/article/2143832\n\n    VMware also publishes Advisories on security patches and offers a way to subscribe to email alerts for them.\n\n    Go to: https://www.vmware.com/support/policies/security_response\n  \"\n  desc 'fix', \"\n    ESXi can be patched in multiple ways, and this fix text does not cover all methods.\n\n    Manual patching when image profiles are not used:\n\n    - Download the latest \\\"offline bundle\\\" .zip update from vmware.com. Verify the hash.\n\n    - Transfer the file to a datastore accessible by the ESXi host, local or remote.\n\n    - Put the ESXi host into maintenance mode.\n\n    - From an ESXi shell, run the following command:\n\n    esxcli software vib update -d <path to offline patch bundle.zip>\n\n    Manual patching when image profiles are used:\n\n    From an ESXi shell, run the following command:\n\n    # esxcli software sources profile list -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\n    Note the available profiles. The organization will usually want the one ending in \\\"-standard\\\".\n\n    # esxcli software profile update -p <selected profile> -d /vmfs/volumes/<your datastore>/<bundle name.zip>\n\n    There will be little output during the update. Once complete, reboot the host for changes to take effect.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000221'\n  tag rid: 'SV-ESXI-80-000221'\n  tag stig_id: 'ESXI-80-000221'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"(Get-VMHost -Name #{vmhost}).ExtensionData.Config.Product.build\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp \"#{input('esxiBuildNumber')}\" }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000221.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VMHost -Name 10.186.25.26).ExtensionData.Config.Product.build stdout.strip is expected to cmp == \"21813344\"","run_time":1.4606667,"start_time":"2023-06-07T08:28:55-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VMHost -Name 10.186.25.26).ExtensionData.Config.Product.build\"]","resource_id":""}]},{"id":"ESXI-80-000222","title":"The ESXi host must not suppress warnings that the local or remote shell sessions are enabled.","desc":"Warnings that local or remote shell sessions are enabled alert administrators to activity they may not be aware of and need to investigate.","descriptions":[{"label":"default","data":"Warnings that local or remote shell sessions are enabled alert administrators to activity they may not be aware of and need to investigate."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.SuppressShellWarning\" value and verify it is set to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning\n\nIf the \"UserVars.SuppressShellWarning\" setting is not set to \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.SuppressShellWarning\" value and configure it to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Set-AdvancedSetting -Value 0"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000222","rid":"SV-ESXI-80-000222","stig_id":"ESXI-80-000222","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000222' do\n  title 'The ESXi host must not suppress warnings that the local or remote shell sessions are enabled.'\n  desc  'Warnings that local or remote shell sessions are enabled alert administrators to activity they may not be aware of and need to investigate.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.SuppressShellWarning\\\" value and verify it is set to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning\n\n    If the \\\"UserVars.SuppressShellWarning\\\" setting is not set to \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.SuppressShellWarning\\\" value and configure it to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Set-AdvancedSetting -Value 0\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000222'\n  tag rid: 'SV-ESXI-80-000222'\n  tag stig_id: 'ESXI-80-000222'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '0' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000222.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"0\"","run_time":0.5773797,"start_time":"2023-06-07T08:28:57-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.SuppressShellWarning | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000223","title":"The ESXi host must not suppress warnings about unmitigated hyperthreading vulnerabilities.","desc":"The L1 Terminal Fault (L1TF) CPU vulnerabilities published in 2018 have patches and mitigations available in vSphere. However, there are performance impacts to these mitigations that require careful thought and planning from the system administrator before implementation. Until a mitigation is implemented, the UI warning about the lack of a mitigation must not be dismissed so the system administrator does not assume the vulnerability has been addressed.","descriptions":[{"label":"default","data":"The L1 Terminal Fault (L1TF) CPU vulnerabilities published in 2018 have patches and mitigations available in vSphere. However, there are performance impacts to these mitigations that require careful thought and planning from the system administrator before implementation. Until a mitigation is implemented, the UI warning about the lack of a mitigation must not be dismissed so the system administrator does not assume the vulnerability has been addressed."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"UserVars.SuppressHyperthreadWarning\" value and verify it is set to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning\n\nIf the \"UserVars.SuppressHyperthreadWarning\" setting is not set to \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"UserVars.SuppressHyperthreadWarning\" value and configure it to \"0\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Set-AdvancedSetting -Value 0"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000223","rid":"SV-ESXI-80-000223","stig_id":"ESXI-80-000223","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000223' do\n  title 'The ESXi host must not suppress warnings about unmitigated hyperthreading vulnerabilities.'\n  desc  'The L1 Terminal Fault (L1TF) CPU vulnerabilities published in 2018 have patches and mitigations available in vSphere. However, there are performance impacts to these mitigations that require careful thought and planning from the system administrator before implementation. Until a mitigation is implemented, the UI warning about the lack of a mitigation must not be dismissed so the system administrator does not assume the vulnerability has been addressed.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"UserVars.SuppressHyperthreadWarning\\\" value and verify it is set to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning\n\n    If the \\\"UserVars.SuppressHyperthreadWarning\\\" setting is not set to \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"UserVars.SuppressHyperthreadWarning\\\" value and configure it to \\\"0\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Set-AdvancedSetting -Value 0\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000223'\n  tag rid: 'SV-ESXI-80-000223'\n  tag stig_id: 'ESXI-80-000223'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '0' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000223.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"0\"","run_time":0.7549351,"start_time":"2023-06-07T08:28:57-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name UserVars.SuppressHyperthreadWarning | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000224","title":"The ESXi host must verify certificates for SSL syslog endpoints.","desc":"When sending syslog data to a remote host, ESXi can be configured to use any combination of TCP, UDP and SSL transports. When using SSL, the server certificate must be validated to ensure that the host is connecting to a valid syslog server.","descriptions":[{"label":"default","data":"When sending syslog data to a remote host, ESXi can be configured to use any combination of TCP, UDP and SSL transports. When using SSL, the server certificate must be validated to ensure that the host is connecting to a valid syslog server."},{"label":"rationale","data":""},{"label":"check","data":"If SSL is not used for a syslog target, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logCheckSSLCerts\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts\n\nIf the \"Syslog.global.logCheckSSLCerts\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"To configure SSL syslog endpoint certificate checking it must be turned on and also the trusted certificate chain must be added to ESXi's trusted store.\n\nFrom the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logCheckSSLCerts\" value and configure it to \"true\".\n\nCopy the PEM formatted trusted CA certificate so that is accessible to the host and append the contents to /etc/vmware/ssl/castore.pem by running the follow command:\n\n# <path/to/cacert> >> /etc/vmware/ssl/castore.pem\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts | Set-AdvancedSetting -Value \"true\"\n\nCopy the PEM formatted trusted CA certificate so that is accessible to the host.\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.security.certificatestore.add.CreateArgs()\n$arguments.filename = <path/to/cacert>\n$esxcli.system.security.certificatestore.add.Invoke($arguments)"}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000224","rid":"SV-ESXI-80-000224","stig_id":"ESXI-80-000224","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000224' do\n  title 'The ESXi host must verify certificates for SSL syslog endpoints.'\n  desc  'When sending syslog data to a remote host, ESXi can be configured to use any combination of TCP, UDP and SSL transports. When using SSL, the server certificate must be validated to ensure that the host is connecting to a valid syslog server.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If SSL is not used for a syslog target, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logCheckSSLCerts\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts\n\n    If the \\\"Syslog.global.logCheckSSLCerts\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    To configure SSL syslog endpoint certificate checking it must be turned on and also the trusted certificate chain must be added to ESXi's trusted store.\n\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logCheckSSLCerts\\\" value and configure it to \\\"true\\\".\n\n    Copy the PEM formatted trusted CA certificate so that is accessible to the host and append the contents to /etc/vmware/ssl/castore.pem by running the follow command:\n\n    # <path/to/cacert> >> /etc/vmware/ssl/castore.pem\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts | Set-AdvancedSetting -Value \\\"true\\\"\n\n    Copy the PEM formatted trusted CA certificate so that is accessible to the host.\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.security.certificatestore.add.CreateArgs()\n    $arguments.filename = <path/to/cacert>\n    $esxcli.system.security.certificatestore.add.Invoke($arguments)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000224'\n  tag rid: 'SV-ESXI-80-000224'\n  tag stig_id: 'ESXI-80-000224'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logHost | Where {$_.Value -match \\\"ssl\\\"} | Select-Object -ExpandProperty Value\"\n      syslogservers = powercli_command(command).stdout\n\n      if !syslogservers.empty?\n        command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logCheckSSLCerts | Select-Object -ExpandProperty Value\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp 'true' }\n        end\n      else\n        impact 0.0\n        describe '' do\n          skip 'No SSL syslog targets found, this check is not applicable.'\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000224.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"","run_time":1.11e-05,"start_time":"2023-06-07T08:28:58-06:00","resource":"","skip_message":"No SSL syslog targets found, this check is not applicable.","resource_class":"Object","resource_params":"[]","resource_id":""}]},{"id":"ESXI-80-000225","title":"The ESXi host must enable volatile key destruction.","desc":"By default, pages allocated for virtual machines (VMs), userspace applications, and kernel threads are zeroed out at allocation time. ESXi will always ensure that no nonzero pages are exposed to VMs or userspace applications. While this prevents exposing cryptographic keys from VMs or userworlds to other clients, these keys can stay present in host memory for a long time if the memory is not reused.\n\nThe NIAP Virtualization Protection Profile and Server Virtualization Extended Package require that memory that may contain cryptographic keys be zeroed upon process exit.\n\nTo this end, a new configuration option, MemEagerZero, can be configured to enforce zeroing out userworld and guest memory pages when a userworld process or guest exits. For kernel threads, memory spaces holding keys are zeroed out as soon as the secret is no longer needed.","descriptions":[{"label":"default","data":"By default, pages allocated for virtual machines (VMs), userspace applications, and kernel threads are zeroed out at allocation time. ESXi will always ensure that no nonzero pages are exposed to VMs or userspace applications. While this prevents exposing cryptographic keys from VMs or userworlds to other clients, these keys can stay present in host memory for a long time if the memory is not reused.\n\nThe NIAP Virtualization Protection Profile and Server Virtualization Extended Package require that memory that may contain cryptographic keys be zeroed upon process exit.\n\nTo this end, a new configuration option, MemEagerZero, can be configured to enforce zeroing out userworld and guest memory pages when a userworld process or guest exits. For kernel threads, memory spaces holding keys are zeroed out as soon as the secret is no longer needed."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Mem.MemEagerZero\" value and verify it is set to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero\n\nIf the \"Mem.MemEagerZero\" setting is not set to \"1\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Mem.MemEagerZero\" value and configure it to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero | Set-AdvancedSetting -Value 1"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000225","rid":"SV-ESXI-80-000225","stig_id":"ESXI-80-000225","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000225' do\n  title 'The ESXi host must enable volatile key destruction.'\n  desc  \"\n    By default, pages allocated for virtual machines (VMs), userspace applications, and kernel threads are zeroed out at allocation time. ESXi will always ensure that no nonzero pages are exposed to VMs or userspace applications. While this prevents exposing cryptographic keys from VMs or userworlds to other clients, these keys can stay present in host memory for a long time if the memory is not reused.\n\n    The NIAP Virtualization Protection Profile and Server Virtualization Extended Package require that memory that may contain cryptographic keys be zeroed upon process exit.\n\n    To this end, a new configuration option, MemEagerZero, can be configured to enforce zeroing out userworld and guest memory pages when a userworld process or guest exits. For kernel threads, memory spaces holding keys are zeroed out as soon as the secret is no longer needed.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Mem.MemEagerZero\\\" value and verify it is set to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero\n\n    If the \\\"Mem.MemEagerZero\\\" setting is not set to \\\"1\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Mem.MemEagerZero\\\" value and configure it to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Mem.MemEagerZero | Set-AdvancedSetting -Value 1\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000225'\n  tag rid: 'SV-ESXI-80-000225'\n  tag stig_id: 'ESXI-80-000225'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Mem.MemEagerZero | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '1' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000225.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Mem.MemEagerZero | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"1\"","run_time":0.5971065,"start_time":"2023-06-07T08:28:58-06:00","message":"\nexpected: 1\n     got: 0\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Mem.MemEagerZero | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000226","title":"The ESXi host must configure a session timeout for the vSphere API.","desc":"The vSphere API (VIM) allows for remote, programmatic administration of the ESXi host. Authenticated API sessions are no different from a risk perspective than authenticated UI sessions and they need similar protections.\n\nOne of these protections is a basic inactivity timeout, after which the session will be invalidated and reauthentication will be required by the application accessing the API. This is set to 30 seconds by default but can be disabled, thus leaving API sessions open indefinitely. The 30 second default must be verified and maintained.","descriptions":[{"label":"default","data":"The vSphere API (VIM) allows for remote, programmatic administration of the ESXi host. Authenticated API sessions are no different from a risk perspective than authenticated UI sessions and they need similar protections.\n\nOne of these protections is a basic inactivity timeout, after which the session will be invalidated and reauthentication will be required by the application accessing the API. This is set to 30 seconds by default but can be disabled, thus leaving API sessions open indefinitely. The 30 second default must be verified and maintained."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.vmacore.soap.sessionTimeout\" value and verify it is set to \"30\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout\n\nIf the \"Config.HostAgent.vmacore.soap.sessionTimeout\" setting is not set to \"30\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.vmacore.soap.sessionTimeout\" value and configure it to \"30\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Set-AdvancedSetting -Value 30"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000226","rid":"SV-ESXI-80-000226","stig_id":"ESXI-80-000226","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000226' do\n  title 'The ESXi host must configure a session timeout for the vSphere API.'\n  desc  \"\n    The vSphere API (VIM) allows for remote, programmatic administration of the ESXi host. Authenticated API sessions are no different from a risk perspective than authenticated UI sessions and they need similar protections.\n\n    One of these protections is a basic inactivity timeout, after which the session will be invalidated and reauthentication will be required by the application accessing the API. This is set to 30 seconds by default but can be disabled, thus leaving API sessions open indefinitely. The 30 second default must be verified and maintained.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.vmacore.soap.sessionTimeout\\\" value and verify it is set to \\\"30\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout\n\n    If the \\\"Config.HostAgent.vmacore.soap.sessionTimeout\\\" setting is not set to \\\"30\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.vmacore.soap.sessionTimeout\\\" value and configure it to \\\"30\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Set-AdvancedSetting -Value 30\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000226'\n  tag rid: 'SV-ESXI-80-000226'\n  tag stig_id: 'ESXI-80-000226'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '30' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000226.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"30\"","run_time":0.5987083,"start_time":"2023-06-07T08:28:59-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Config.HostAgent.vmacore.soap.sessionTimeout | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000227","title":"The ESXi host must be configured with an appropriate maximum password age.","desc":"The older an ESXi local account password is, the larger the opportunity window is for attackers to guess, crack or re-use a previously cracked password. Rotating passwords on a regular basis is a fundamental security practice and one that ESXi supports.","descriptions":[{"label":"default","data":"The older an ESXi local account password is, the larger the opportunity window is for attackers to guess, crack or re-use a previously cracked password. Rotating passwords on a regular basis is a fundamental security practice and one that ESXi supports."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Security.PasswordMaxDays\" value and verify it is set to \"90\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays\n\nIf the \"Security.PasswordMaxDays\" setting is not set to \"90\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Security.PasswordMaxDays\" value and configure it to \"90\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays | Set-AdvancedSetting -Value 90"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000227","rid":"SV-ESXI-80-000227","stig_id":"ESXI-80-000227","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000227' do\n  title 'The ESXi host must be configured with an appropriate maximum password age.'\n  desc  'The older an ESXi local account password is, the larger the opportunity window is for attackers to guess, crack or re-use a previously cracked password. Rotating passwords on a regular basis is a fundamental security practice and one that ESXi supports.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Security.PasswordMaxDays\\\" value and verify it is set to \\\"90\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays\n\n    If the \\\"Security.PasswordMaxDays\\\" setting is not set to \\\"90\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Security.PasswordMaxDays\\\" value and configure it to \\\"90\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Security.PasswordMaxDays | Set-AdvancedSetting -Value 90\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000227'\n  tag rid: 'SV-ESXI-80-000227'\n  tag stig_id: 'ESXI-80-000227'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Security.PasswordMaxDays | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '90' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000227.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.PasswordMaxDays | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"90\"","run_time":0.5963298,"start_time":"2023-06-07T08:28:59-06:00","message":"\nexpected: 90\n     got: 99999\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Security.PasswordMaxDays | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000228","title":"The ESXi Common Information Model (CIM) service must be disabled.","desc":"The CIM system provides an interface that enables hardware-level management from remote applications via a set of standard application programming interfaces (APIs). These APIs are consumed by external applications such as HP SIM or Dell OpenManage for agentless, remote hardware monitoring of the ESXi host.\n\nTo reduce attack surface area and following the minimum functionality principal, the CIM service must be disabled unless explicitly needed and approved.","descriptions":[{"label":"default","data":"The CIM system provides an interface that enables hardware-level management from remote applications via a set of standard application programming interfaces (APIs). These APIs are consumed by external applications such as HP SIM or Dell OpenManage for agentless, remote hardware monitoring of the ESXi host.\n\nTo reduce attack surface area and following the minimum functionality principal, the CIM service must be disabled unless explicitly needed and approved."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", locate the \"CIM Server\" service and verify it is \"Stopped\" and the \"Startup Policy\" is set to \"Start and stop manually\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"CIM Server\"}\n\nIf the \"CIM Server\" service does not have a \"Policy\" of \"off\" or is running, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\" select the \"CIM Server\" service and click the \"Stop\" button.\n\nClick \"Edit Startup policy...\" and select the \"Start and stop manually\" radio button. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"CIM Server\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"CIM Server\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000228","rid":"SV-ESXI-80-000228","stig_id":"ESXI-80-000228","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000228' do\n  title 'The ESXi Common Information Model (CIM) service must be disabled.'\n  desc  \"\n    The CIM system provides an interface that enables hardware-level management from remote applications via a set of standard application programming interfaces (APIs). These APIs are consumed by external applications such as HP SIM or Dell OpenManage for agentless, remote hardware monitoring of the ESXi host.\n\n    To reduce attack surface area and following the minimum functionality principal, the CIM service must be disabled unless explicitly needed and approved.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", locate the \\\"CIM Server\\\" service and verify it is \\\"Stopped\\\" and the \\\"Startup Policy\\\" is set to \\\"Start and stop manually\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"CIM Server\\\"}\n\n    If the \\\"CIM Server\\\" service does not have a \\\"Policy\\\" of \\\"off\\\" or is running, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\" select the \\\"CIM Server\\\" service and click the \\\"Stop\\\" button.\n\n    Click \\\"Edit Startup policy...\\\" and select the \\\"Start and stop manually\\\" radio button. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"CIM Server\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"CIM Server\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000228'\n  tag rid: 'SV-ESXI-80-000228'\n  tag stig_id: 'ESXI-80-000228'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000228.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Policy stdout.strip is expected to cmp == \"off\"","run_time":0.3844118,"start_time":"2023-06-07T08:29:00-06:00","message":"\nexpected: off\n     got: on\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Policy\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Running stdout.strip is expected to cmp == \"false\"","run_time":0.3953809,"start_time":"2023-06-07T08:29:00-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'CIM Server'} | Select-Object -ExpandProperty Running\"]","resource_id":""}]},{"id":"ESXI-80-000229","title":"The ESXi host must use DOD-approved certificates.","desc":"The default self-signed host certificate issued by the VMware Certificate Authority (VMCA) must be replaced with a DOD-approved certificate when the host will be accessed directly, such as during a virtual machine (VM) console connection.\n\nThe use of a DOD certificate on the host assures clients the service they are connecting to is legitimate and properly secured.","descriptions":[{"label":"default","data":"The default self-signed host certificate issued by the VMware Certificate Authority (VMCA) must be replaced with a DOD-approved certificate when the host will be accessed directly, such as during a virtual machine (VM) console connection.\n\nThe use of a DOD certificate on the host assures clients the service they are connecting to is legitimate and properly secured."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Certificate.\n\nIf the issuer is not a DOD-approved certificate authority, this is a finding.\n\nIf the host will never be accessed directly (virtual machine console connections bypass vCenter), this is not a finding."},{"label":"fix","data":"Join the ESXi host to vCenter before replacing the certificate.\n\nObtain a DOD-issued certificate and private key for the host following the requirements below:\n\nKey size: 2048 bits or more (PEM encoded)\n\nKey format: PEM\nVMware supports PKCS8 and PKCS1 (RSA keys)\nx509 version 3\n\nSubjectAltName must contain DNS Name=<machine_FQDN>\n\nCRT (Base-64) format\n\nContains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\nStart time of one day before the current time\n\nCN (and SubjectAltName) set to the host name (or IP address) that the ESXi host has in the vCenter Server inventory\n\nFrom the vSphere Web Client, select the ESXi host's vCenter Server >> Configure >> System >> Advanced Settings.\n\nSelect the \"vpxd.certmgmt.mode\" value and ensure it is set to \"custom\".\n\nPut the host into maintenance mode.\n\nTemporarily enable Secure Shell (SSH) on the host. Use Secure Copy Protocol (SCP) to transfer the new certificate and key to /tmp. SSH to the host. Back up the existing certificate and key:\n\n# mv /etc/vmware/ssl/rui.crt /etc/vmware/ssl/rui.crt.bak\n# mv /etc/vmware/ssl/rui.key /etc/vmware/ssl/rui.key.bak\n\nCopy the new certificate and key to \"/etc/vmware/ssl/\" and rename them to \"rui.crt\" and \"rui.key\" respectively.\n\nRestart management agents to implement the new certificate:\n\n# services.sh restart"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000229","rid":"SV-ESXI-80-000229","stig_id":"ESXI-80-000229","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000229' do\n  title 'The ESXi host must use DOD-approved certificates.'\n  desc  \"\n    The default self-signed host certificate issued by the VMware Certificate Authority (VMCA) must be replaced with a DOD-approved certificate when the host will be accessed directly, such as during a virtual machine (VM) console connection.\n\n    The use of a DOD certificate on the host assures clients the service they are connecting to is legitimate and properly secured.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Certificate.\n\n    If the issuer is not a DOD-approved certificate authority, this is a finding.\n\n    If the host will never be accessed directly (virtual machine console connections bypass vCenter), this is not a finding.\n  \"\n  desc 'fix', \"\n    Join the ESXi host to vCenter before replacing the certificate.\n\n    Obtain a DOD-issued certificate and private key for the host following the requirements below:\n\n    Key size: 2048 bits or more (PEM encoded)\n\n    Key format: PEM\n    VMware supports PKCS8 and PKCS1 (RSA keys)\n    x509 version 3\n\n    SubjectAltName must contain DNS Name=<machine_FQDN>\n\n    CRT (Base-64) format\n\n    Contains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\n    Start time of one day before the current time\n\n    CN (and SubjectAltName) set to the host name (or IP address) that the ESXi host has in the vCenter Server inventory\n\n    From the vSphere Web Client, select the ESXi host's vCenter Server >> Configure >> System >> Advanced Settings.\n\n    Select the \\\"vpxd.certmgmt.mode\\\" value and ensure it is set to \\\"custom\\\".\n\n    Put the host into maintenance mode.\n\n    Temporarily enable Secure Shell (SSH) on the host. Use Secure Copy Protocol (SCP) to transfer the new certificate and key to /tmp. SSH to the host. Back up the existing certificate and key:\n\n    # mv /etc/vmware/ssl/rui.crt /etc/vmware/ssl/rui.crt.bak\n    # mv /etc/vmware/ssl/rui.key /etc/vmware/ssl/rui.key.bak\n\n    Copy the new certificate and key to \\\"/etc/vmware/ssl/\\\" and rename them to \\\"rui.crt\\\" and \\\"rui.key\\\" respectively.\n\n    Restart management agents to implement the new certificate:\n\n    # services.sh restart\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000229'\n  tag rid: 'SV-ESXI-80-000229'\n  tag stig_id: 'ESXI-80-000229'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      describe ssl_certificate(host: \"#{vmhost}\", port: 443) do\n        its('issuer_organization') { should cmp 'U.S. Government' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000229.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"ssl_certificate for '10.186.25.26' issuer_organization is expected to cmp == \"U.S. Government\"","run_time":1.5361507,"start_time":"2023-06-07T08:29:01-06:00","message":"\nexpected: U.S. Government\n     got: sc2-10-186-30-81.eng.vmware.com\n\n(compared using `cmp` matcher)\n","resource_class":"ssl_certificate","resource_params":"[{:host=>\"10.186.25.26\", :port=>443}]","resource_id":""}]},{"id":"ESXI-80-000230","title":"The ESXi host Secure Shell (SSH) daemon must disable port forwarding.","desc":"While enabling Transmission Control Protocol (TCP) tunnels is a valuable function of sshd, this feature is not appropriate for use on the ESXi hypervisor.","descriptions":[{"label":"default","data":"While enabling Transmission Control Protocol (TCP) tunnels is a valuable function of sshd, this feature is not appropriate for use on the ESXi hypervisor."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# /usr/lib/vmware/openssh/bin/sshd -T | grep allowtcpforwarding\n\nExpected result:\n\nallowtcpforwarding no\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, add or update the following line in \"/etc/ssh/sshd_config\":\n\nAllowTcpForwarding no"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000230","rid":"SV-ESXI-80-000230","stig_id":"ESXI-80-000230","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000230' do\n  title 'The ESXi host Secure Shell (SSH) daemon must disable port forwarding.'\n  desc  'While enabling Transmission Control Protocol (TCP) tunnels is a valuable function of sshd, this feature is not appropriate for use on the ESXi hypervisor.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # /usr/lib/vmware/openssh/bin/sshd -T | grep allowtcpforwarding\n\n    Expected result:\n\n    allowtcpforwarding no\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, add or update the following line in \\\"/etc/ssh/sshd_config\\\":\n\n    AllowTcpForwarding no\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000230'\n  tag rid: 'SV-ESXI-80-000230'\n  tag stig_id: 'ESXI-80-000230'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000230.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.44e-05,"start_time":"2023-06-07T08:29:02-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000231","title":"The ESXi host OpenSLP service must be disabled.","desc":"OpenSLP implements the Service Location Protocol to help CIM clients discover CIM servers over TCP 427. This service is not widely needed and has had vulnerabilities exposed in the past. To reduce attack surface area and following the minimum functionality principal, the OpenSLP service must be disabled unless explicitly needed and approved.\n\nNote: Disabling the OpenSLP service may affect monitoring and third-party systems that use the WBEM DTMF protocols.","descriptions":[{"label":"default","data":"OpenSLP implements the Service Location Protocol to help CIM clients discover CIM servers over TCP 427. This service is not widely needed and has had vulnerabilities exposed in the past. To reduce attack surface area and following the minimum functionality principal, the OpenSLP service must be disabled unless explicitly needed and approved.\n\nNote: Disabling the OpenSLP service may affect monitoring and third-party systems that use the WBEM DTMF protocols."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\", locate the \"slpd\" service and verify it is \"Stopped\" and the \"Startup Policy\" is set to \"Start and stop manually\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"slpd\"}\n\nIf the slpd service does not have a \"Policy\" of \"off\" or is running, this is a finding."},{"label":"fix","data":"From the vSphere Client go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Services.\n\nUnder \"Services\" select the \"slpd\" service and click the \"Stop\" button.\n\nClick \"Edit Startup policy...\" and select the \"Start and stop manually\" radio button. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"slpd\"} | Set-VMHostService -Policy Off\nGet-VMHost | Get-VMHostService | Where {$_.Label -eq \"slpd\"} | Stop-VMHostService"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000231","rid":"SV-ESXI-80-000231","stig_id":"ESXI-80-000231","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000231' do\n  title 'The ESXi host OpenSLP service must be disabled.'\n  desc  \"\n    OpenSLP implements the Service Location Protocol to help CIM clients discover CIM servers over TCP 427. This service is not widely needed and has had vulnerabilities exposed in the past. To reduce attack surface area and following the minimum functionality principal, the OpenSLP service must be disabled unless explicitly needed and approved.\n\n    Note: Disabling the OpenSLP service may affect monitoring and third-party systems that use the WBEM DTMF protocols.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\", locate the \\\"slpd\\\" service and verify it is \\\"Stopped\\\" and the \\\"Startup Policy\\\" is set to \\\"Start and stop manually\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"slpd\\\"}\n\n    If the slpd service does not have a \\\"Policy\\\" of \\\"off\\\" or is running, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Services.\n\n    Under \\\"Services\\\" select the \\\"slpd\\\" service and click the \\\"Stop\\\" button.\n\n    Click \\\"Edit Startup policy...\\\" and select the \\\"Start and stop manually\\\" radio button. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"slpd\\\"} | Set-VMHostService -Policy Off\n    Get-VMHost | Get-VMHostService | Where {$_.Label -eq \\\"slpd\\\"} | Stop-VMHostService\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000231'\n  tag rid: 'SV-ESXI-80-000231'\n  tag stig_id: 'ESXI-80-000231'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Policy\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'off' }\n      end\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Running\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000231.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Policy stdout.strip is expected to cmp == \"off\"","run_time":0.3768606,"start_time":"2023-06-07T08:29:02-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Policy\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Running stdout.strip is expected to cmp == \"false\"","run_time":0.3629255,"start_time":"2023-06-07T08:29:03-06:00","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-VMHostService | Where {$_.Label -eq 'slpd'} | Select-Object -ExpandProperty Running\"]","resource_id":""}]},{"id":"ESXI-80-000232","title":"The ESXi host must enable audit logging.","desc":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell.","descriptions":[{"label":"default","data":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.auditRecord.storageEnable\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable\n\nIf the \"Syslog.global.auditRecord.storageEnable\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.auditRecord.storageEnable\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Set-AdvancedSetting -Value \"true\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000232","rid":"SV-ESXI-80-000232","stig_id":"ESXI-80-000232","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000232' do\n  title 'The ESXi host must enable audit logging.'\n  desc  \"\n    ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\n    To operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\n    Note: Audit records can be viewed locally via the \\\"/bin/viewAudit\\\" utility over SSH or at the ESXi shell.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.auditRecord.storageEnable\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable\n\n    If the \\\"Syslog.global.auditRecord.storageEnable\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.auditRecord.storageEnable\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Set-AdvancedSetting -Value \\\"true\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000232'\n  tag rid: 'SV-ESXI-80-000232'\n  tag stig_id: 'ESXI-80-000232'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000232.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"true\"","run_time":0.4643674,"start_time":"2023-06-07T08:29:03-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.auditRecord.storageEnable | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000233","title":"The ESXi host must off-load audit records via syslog.","desc":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell.","descriptions":[{"label":"default","data":"ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\nTo operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\nNote: Audit records can be viewed locally via the \"/bin/viewAudit\" utility over SSH or at the ESXi shell."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.auditRecord.remoteEnable\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable\n\nIf the \"Syslog.global.auditRecord.remoteEnable\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.auditRecord.remoteEnable\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Set-AdvancedSetting -Value \"true\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000342-VMM-001230","gid":"V-ESXI-80-000233","rid":"SV-ESXI-80-000233","stig_id":"ESXI-80-000233","cci":["CCI-001851"],"nist":["AU-4 (1)"]},"code":"control 'ESXI-80-000233' do\n  title 'The ESXi host must off-load audit records via syslog.'\n  desc  \"\n    ESXi offers both local and remote audit recordkeeping to meet the requirements of the NIAP Virtualization Protection Profile and Server Virtualization Extended Package. Local records are stored on any accessible local or VMFS path. Remote records are sent to the global syslog servers configured elsewhere.\n\n    To operate in the NIAP validated state, ESXi must enable and properly configure this audit system. This system is disabled by default.\n\n    Note: Audit records can be viewed locally via the \\\"/bin/viewAudit\\\" utility over SSH or at the ESXi shell.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.auditRecord.remoteEnable\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable\n\n    If the \\\"Syslog.global.auditRecord.remoteEnable\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.auditRecord.remoteEnable\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Set-AdvancedSetting -Value \\\"true\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000342-VMM-001230'\n  tag gid: 'V-ESXI-80-000233'\n  tag rid: 'SV-ESXI-80-000233'\n  tag stig_id: 'ESXI-80-000233'\n  tag cci: ['CCI-001851']\n  tag nist: ['AU-4 (1)']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000233.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"true\"","run_time":0.5971407,"start_time":"2023-06-07T08:29:03-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.auditRecord.remoteEnable | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000234","title":"The ESXi host must enable strict x509 verification for SSL syslog endpoints.","desc":"When sending syslog data to a remote host via SSL, the ESXi host is presented with the endpoint's SSL server certificate. In addition to trust verification, configured elsewhere, this \"x509-strict\" option performs additional validity checks on CA root certificates during verification.\n\nThese checks are generally not performed (CA roots are inherently trusted) and might cause incompatibilities with existing, misconfigured CA roots. The NIAP requirements in the Virtualization Protection Profile and Server Virtualization Extended Package, however, require even CA roots to pass validations.","descriptions":[{"label":"default","data":"When sending syslog data to a remote host via SSL, the ESXi host is presented with the endpoint's SSL server certificate. In addition to trust verification, configured elsewhere, this \"x509-strict\" option performs additional validity checks on CA root certificates during verification.\n\nThese checks are generally not performed (CA roots are inherently trusted) and might cause incompatibilities with existing, misconfigured CA roots. The NIAP requirements in the Virtualization Protection Profile and Server Virtualization Extended Package, however, require even CA roots to pass validations."},{"label":"rationale","data":""},{"label":"check","data":"If SSL is not used for a syslog target, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.certificate.strictX509Compliance\" value and verify it is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance\n\nIf the \"Syslog.global.certificate.strictX509Compliance\" setting is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.certificate.strictX509Compliance\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Set-AdvancedSetting -Value \"true\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000234","rid":"SV-ESXI-80-000234","stig_id":"ESXI-80-000234","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000234' do\n  title 'The ESXi host must enable strict x509 verification for SSL syslog endpoints.'\n  desc  \"\n    When sending syslog data to a remote host via SSL, the ESXi host is presented with the endpoint's SSL server certificate. In addition to trust verification, configured elsewhere, this \\\"x509-strict\\\" option performs additional validity checks on CA root certificates during verification.\n\n    These checks are generally not performed (CA roots are inherently trusted) and might cause incompatibilities with existing, misconfigured CA roots. The NIAP requirements in the Virtualization Protection Profile and Server Virtualization Extended Package, however, require even CA roots to pass validations.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If SSL is not used for a syslog target, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.certificate.strictX509Compliance\\\" value and verify it is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance\n\n    If the \\\"Syslog.global.certificate.strictX509Compliance\\\" setting is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.certificate.strictX509Compliance\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Set-AdvancedSetting -Value \\\"true\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000234'\n  tag rid: 'SV-ESXI-80-000234'\n  tag stig_id: 'ESXI-80-000234'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000234.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"true\"","run_time":0.526914,"start_time":"2023-06-07T08:29:04-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.certificate.strictX509Compliance | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000235","title":"The ESXi host must forward audit records containing information to establish what type of events occurred.","desc":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.\n\nAudit record content that may be necessary to satisfy this requirement includes, for example, time stamps, source and destination addresses, user/process/VM identifiers, event descriptions, success/fail indications, filenames involved, and access control or flow control rules invoked.\n\nAssociating event types with detected events in the ESXi audit logs provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured host.","descriptions":[{"label":"default","data":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.\n\nAudit record content that may be necessary to satisfy this requirement includes, for example, time stamps, source and destination addresses, user/process/VM identifiers, event descriptions, success/fail indications, filenames involved, and access control or flow control rules invoked.\n\nAssociating event types with detected events in the ESXi audit logs provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured host."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logLevel\" value and verify it is set to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel\n\nIf the \"Syslog.global.logLevel\" setting is not set to \"info\", this is a finding.\n\nNote: Verbose logging level is acceptable for troubleshooting purposes."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logLevel\" value and configure it to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel | Set-AdvancedSetting -Value \"info\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000037-VMM-000150","gid":"V-ESXI-80-000235","rid":"SV-ESXI-80-000235","stig_id":"ESXI-80-000235","cci":["CCI-000130"],"nist":["AU-3"]},"code":"control 'ESXI-80-000235' do\n  title 'The ESXi host must forward audit records containing information to establish what type of events occurred.'\n  desc  \"\n    Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.\n\n    Audit record content that may be necessary to satisfy this requirement includes, for example, time stamps, source and destination addresses, user/process/VM identifiers, event descriptions, success/fail indications, filenames involved, and access control or flow control rules invoked.\n\n    Associating event types with detected events in the ESXi audit logs provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured host.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logLevel\\\" value and verify it is set to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel\n\n    If the \\\"Syslog.global.logLevel\\\" setting is not set to \\\"info\\\", this is a finding.\n\n    Note: Verbose logging level is acceptable for troubleshooting purposes.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logLevel\\\" value and configure it to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logLevel | Set-AdvancedSetting -Value \\\"info\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000037-VMM-000150'\n  tag gid: 'V-ESXI-80-000235'\n  tag rid: 'SV-ESXI-80-000235'\n  tag stig_id: 'ESXI-80-000235'\n  tag cci: ['CCI-000130']\n  tag nist: ['AU-3']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Syslog.global.logLevel | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'info' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000235.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.logLevel | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"info\"","run_time":0.5426163,"start_time":"2023-06-07T08:29:04-06:00","message":"\nexpected: info\n     got: error\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name Syslog.global.logLevel | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000236","title":"The ESXi host must not be configured to override virtual machine (VM) configurations.","desc":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.","descriptions":[{"label":"default","data":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# stat -c \"%s\" /etc/vmware/settings\n\nExpected result:\n\n0\n\nIf the output does not match the expected result, this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# echo -n >/etc/vmware/settings"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000236","rid":"SV-ESXI-80-000236","stig_id":"ESXI-80-000236","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000236' do\n  title 'The ESXi host must not be configured to override virtual machine (VM) configurations.'\n  desc  \"\n    Each VM on an ESXi host runs in its own \\\"vmx\\\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\n    This can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # stat -c \\\"%s\\\" /etc/vmware/settings\n\n    Expected result:\n\n    0\n\n    If the output does not match the expected result, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # echo -n >/etc/vmware/settings\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000236'\n  tag rid: 'SV-ESXI-80-000236'\n  tag stig_id: 'ESXI-80-000236'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000236.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.12e-05,"start_time":"2023-06-07T08:29:05-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000237","title":"The ESXi host must not be configured to override virtual machine (VM) logger settings.","desc":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.","descriptions":[{"label":"default","data":"Each VM on an ESXi host runs in its own \"vmx\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\nThis can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# grep \"^vmx\\.log\" /etc/vmware/config\n\nIf the command produces any output, this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following commands:\n\n# cp /etc/vmware/config /etc/vmware/config.bak\n# grep -v \"^vmx\\.log\" /etc/vmware/config.bak>/etc/vmware/config"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000237","rid":"SV-ESXI-80-000237","stig_id":"ESXI-80-000237","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000237' do\n  title 'The ESXi host must not be configured to override virtual machine (VM) logger settings.'\n  desc  \"\n    Each VM on an ESXi host runs in its own \\\"vmx\\\" process. Upon creation, a vmx process will look in two locations for configuration items, the ESXi host itself and the per-vm *.vmx file in the VM storage path on the datastore. The settings on the ESXi host are read first and take precedence over settings in the *.vmx file.\n\n    This can be a convenient way to set a setting in one place and have it apply to all VMs running on that host. The difficulty is in managing those settings and determining the effective state. Since managing per-VM vmx settings can be fully automated and customized while the ESXi setting cannot be easily queried, the ESXi configuration must not be used.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # grep \\\"^vmx\\\\.log\\\" /etc/vmware/config\n\n    If the command produces any output, this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following commands:\n\n    # cp /etc/vmware/config /etc/vmware/config.bak\n    # grep -v \\\"^vmx\\\\.log\\\" /etc/vmware/config.bak>/etc/vmware/config\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000237'\n  tag rid: 'SV-ESXI-80-000237'\n  tag stig_id: 'ESXI-80-000237'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000237.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.04e-05,"start_time":"2023-06-07T08:29:05-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"ESXI-80-000238","title":"The ESXi host must require TPM-based configuration encryption.","desc":"An ESXi host's configuration consists of configuration files for each service that runs on the host. The configuration files typically reside in the /etc/ directory, but they can also reside in other namespaces. The configuration files contain run-time information about the state of the services. Over time, the default values in the configuration files might change, for example, when settings on the ESXi host are changed.\n\nA cron job backs up the ESXi configuration files periodically, when ESXi shuts down gracefully or on demand, and creates an archived configuration file in the boot bank. When ESXi reboots, it reads the archived configuration file and recreates the state that ESXi was in when the backup was taken.\n\nBefore vSphere 7.0 Update 2, the archived ESXi configuration file is not encrypted. In vSphere 7.0 Update 2 and later, the archived configuration file is encrypted. When the ESXi host is configured with a Trusted Platform Module (TPM), the TPM is used to \"seal\" the configuration to the host, providing a strong security guarantee and additional protection from offline attacks.\n\nConfiguration encryption uses the physical TPM when it is available and supported at install or upgrade time. If the TPM was added or enabled later, the ESXi host must be told to reconfigure to use the newly available TPM. Once the TPM configuration encryption is enabled, it cannot be disabled.","descriptions":[{"label":"default","data":"An ESXi host's configuration consists of configuration files for each service that runs on the host. The configuration files typically reside in the /etc/ directory, but they can also reside in other namespaces. The configuration files contain run-time information about the state of the services. Over time, the default values in the configuration files might change, for example, when settings on the ESXi host are changed.\n\nA cron job backs up the ESXi configuration files periodically, when ESXi shuts down gracefully or on demand, and creates an archived configuration file in the boot bank. When ESXi reboots, it reads the archived configuration file and recreates the state that ESXi was in when the backup was taken.\n\nBefore vSphere 7.0 Update 2, the archived ESXi configuration file is not encrypted. In vSphere 7.0 Update 2 and later, the archived configuration file is encrypted. When the ESXi host is configured with a Trusted Platform Module (TPM), the TPM is used to \"seal\" the configuration to the host, providing a strong security guarantee and additional protection from offline attacks.\n\nConfiguration encryption uses the physical TPM when it is available and supported at install or upgrade time. If the TPM was added or enabled later, the ESXi host must be told to reconfigure to use the newly available TPM. Once the TPM configuration encryption is enabled, it cannot be disabled."},{"label":"rationale","data":""},{"label":"check","data":"If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\nFrom an ESXi shell, run the following command:\n\n# esxcli system settings encryption get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.settings.encryption.get.invoke() | Select Mode\n\nExpected result:\n\nMode: TPM\n\nIf the \"Mode\" is not set to \"TPM\", this is a finding."},{"label":"fix","data":"Ensure the TPM 2.0 chip is enabled in the BIOS and the ESX UI does not show any errors about a present but unavailable TPM.\n\nThis setting cannot be configured until the TPM is properly enabled in firmware.\n\nFrom an ESXi shell, run the following command:\n\n# esxcli system settings encryption set --mode=TPM\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n$arguments.mode = \"TPM\"\n$esxcli.system.settings.encryption.set.Invoke($arguments)\n\nEvacuate the host and gracefully reboot for changes to take effect."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000238","rid":"SV-ESXI-80-000238","stig_id":"ESXI-80-000238","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000238' do\n  title 'The ESXi host must require TPM-based configuration encryption.'\n  desc  \"\n    An ESXi host's configuration consists of configuration files for each service that runs on the host. The configuration files typically reside in the /etc/ directory, but they can also reside in other namespaces. The configuration files contain run-time information about the state of the services. Over time, the default values in the configuration files might change, for example, when settings on the ESXi host are changed.\n\n    A cron job backs up the ESXi configuration files periodically, when ESXi shuts down gracefully or on demand, and creates an archived configuration file in the boot bank. When ESXi reboots, it reads the archived configuration file and recreates the state that ESXi was in when the backup was taken.\n\n    Before vSphere 7.0 Update 2, the archived ESXi configuration file is not encrypted. In vSphere 7.0 Update 2 and later, the archived configuration file is encrypted. When the ESXi host is configured with a Trusted Platform Module (TPM), the TPM is used to \\\"seal\\\" the configuration to the host, providing a strong security guarantee and additional protection from offline attacks.\n\n    Configuration encryption uses the physical TPM when it is available and supported at install or upgrade time. If the TPM was added or enabled later, the ESXi host must be told to reconfigure to use the newly available TPM. Once the TPM configuration encryption is enabled, it cannot be disabled.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\n    From an ESXi shell, run the following command:\n\n    # esxcli system settings encryption get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.settings.encryption.get.invoke() | Select Mode\n\n    Expected result:\n\n    Mode: TPM\n\n    If the \\\"Mode\\\" is not set to \\\"TPM\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Ensure the TPM 2.0 chip is enabled in the BIOS and the ESX UI does not show any errors about a present but unavailable TPM.\n\n    This setting cannot be configured until the TPM is properly enabled in firmware.\n\n    From an ESXi shell, run the following command:\n\n    # esxcli system settings encryption set --mode=TPM\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.settings.encryption.set.CreateArgs()\n    $arguments.mode = \\\"TPM\\\"\n    $esxcli.system.settings.encryption.set.Invoke($arguments)\n\n    Evacuate the host and gracefully reboot for changes to take effect.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000238'\n  tag rid: 'SV-ESXI-80-000238'\n  tag stig_id: 'ESXI-80-000238'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty Mode\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'TPM' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000238.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty Mode stdout.strip is expected to cmp == \"TPM\"","run_time":0.3454204,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: TPM\n     got: NONE\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.encryption.get.invoke() | Select-Object -ExpandProperty Mode\"]","resource_id":""}]},{"id":"ESXI-80-000239","title":"The ESXi host must configure the firewall to restrict access to services running on the host.","desc":"Unrestricted access to services running on an ESXi host can expose a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to only allow access from authorized networks.","descriptions":[{"label":"default","data":"Unrestricted access to services running on an ESXi host can expose a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to only allow access from authorized networks."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Firewall.\n\nUnder the \"Allowed IP addresses\" column, review the allowed IPs for each service.\n\nCheck this for \"Incoming\" and \"Outgoing\" sections.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-VMHostFirewallException | Where {$_.Enabled -eq $true} | Select Name,Enabled,@{N=\"AllIPEnabled\";E={$_.ExtensionData.AllowedHosts.AllIP}}\n\nIf for an enabled service \"Allow connections from any IP address\" is selected, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Firewall.\n\nClick \"Edit...\". For each enabled service, uncheck the check box to \"Allow connections from any IP address\" and input the site-specific network(s) required.\n\nThe following example formats are acceptable:\n\n192.168.0.0/24\n192.168.1.2, 2001::1/64\nfd3e:29a6:0a81:e478::/64\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n#This disables the allow all rule for the target service. We are targeting the sshServer service in this example.\n$arguments = $esxcli.network.firewall.ruleset.set.CreateArgs()\n$arguments.rulesetid = \"sshServer\"\n$arguments.allowedall = $false\n$esxcli.network.firewall.ruleset.set.Invoke($arguments)\n\n#Next add the allowed IPs for the service. Note doing the \"vSphere Web Client\" service this way may disable access but may be done through vCenter or through the console.\n$arguments = $esxcli.network.firewall.ruleset.allowedip.add.CreateArgs()\n$arguments.rulesetid = \"sshServer\"\n$arguments.ipaddress = \"10.0.0.0/8\"\n$esxcli.network.firewall.ruleset.allowedip.add.Invoke($arguments)\n\nThis must be done for each enabled service."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000239","rid":"SV-ESXI-80-000239","stig_id":"ESXI-80-000239","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000239' do\n  title 'The ESXi host must configure the firewall to restrict access to services running on the host.'\n  desc  'Unrestricted access to services running on an ESXi host can expose a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to only allow access from authorized networks.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Firewall.\n\n    Under the \\\"Allowed IP addresses\\\" column, review the allowed IPs for each service.\n\n    Check this for \\\"Incoming\\\" and \\\"Outgoing\\\" sections.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-VMHostFirewallException | Where {$_.Enabled -eq $true} | Select Name,Enabled,@{N=\\\"AllIPEnabled\\\";E={$_.ExtensionData.AllowedHosts.AllIP}}\n\n    If for an enabled service \\\"Allow connections from any IP address\\\" is selected, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Firewall.\n\n    Click \\\"Edit...\\\". For each enabled service, uncheck the check box to \\\"Allow connections from any IP address\\\" and input the site-specific network(s) required.\n\n    The following example formats are acceptable:\n\n    192.168.0.0/24\n    192.168.1.2, 2001::1/64\n    fd3e:29a6:0a81:e478::/64\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    #This disables the allow all rule for the target service. We are targeting the sshServer service in this example.\n    $arguments = $esxcli.network.firewall.ruleset.set.CreateArgs()\n    $arguments.rulesetid = \\\"sshServer\\\"\n    $arguments.allowedall = $false\n    $esxcli.network.firewall.ruleset.set.Invoke($arguments)\n\n    #Next add the allowed IPs for the service. Note doing the \\\"vSphere Web Client\\\" service this way may disable access but may be done through vCenter or through the console.\n    $arguments = $esxcli.network.firewall.ruleset.allowedip.add.CreateArgs()\n    $arguments.rulesetid = \\\"sshServer\\\"\n    $arguments.ipaddress = \\\"10.0.0.0/8\\\"\n    $esxcli.network.firewall.ruleset.allowedip.add.Invoke($arguments)\n\n    This must be done for each enabled service.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000239'\n  tag rid: 'SV-ESXI-80-000239'\n  tag stig_id: 'ESXI-80-000239'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"(Get-VMHost -Name #{vmhost} | Get-VMHostFirewallException | Where {$_.Enabled -eq $true}).ExtensionData.AllowedHosts.AllIP\"\n      powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |result|\n        describe result do\n          it { should_not cmp 'True' }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000239.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0003021,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002896,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002555,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002369,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.000227,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002281,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002254,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001976,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001664,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001555,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001385,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002854,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001461,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001868,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001578,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002161,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"passed","code_desc":"False is expected not to cmp == \"True\"","run_time":0.0003521,"start_time":"2023-06-07T08:29:05-06:00","resource_class":"Object","resource_params":"[]","resource_id":"False"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001832,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001629,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.000148,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0001509,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"},{"status":"failed","code_desc":"True is expected not to cmp == \"True\"","run_time":0.0002841,"start_time":"2023-06-07T08:29:05-06:00","message":"\nexpected: True\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"}]},{"id":"ESXI-80-000240","title":"The ESXi host when using Host Profiles and/or Auto Deploy must use the vSphere Authentication Proxy to protect passwords when adding themselves to Active Directory.","desc":"If a host is configured to join an Active Directory domain using Host Profiles and/or Auto Deploy, the Active Directory credentials are saved in the profile and are transmitted over the network.\n\nTo avoid having to save Active Directory credentials in the Host Profile and to avoid transmitting Active Directory credentials over the network, use the vSphere Authentication Proxy.","descriptions":[{"label":"default","data":"If a host is configured to join an Active Directory domain using Host Profiles and/or Auto Deploy, the Active Directory credentials are saved in the profile and are transmitted over the network.\n\nTo avoid having to save Active Directory credentials in the Host Profile and to avoid transmitting Active Directory credentials over the network, use the vSphere Authentication Proxy."},{"label":"rationale","data":""},{"label":"check","data":"For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\nIf the organization is not using Host Profiles to join Active Directory, this is not applicable.\n\nFrom the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\nClick a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration >> Join Domain Method.\n\nIf the method used to join hosts to a domain is not set to \"Use vSphere Authentication Proxy to add the host to domain\", this is a finding.\n\nor\n\nFrom a PowerCLI command prompt while connected to vCenter, run the following command:\n\nGet-VMHost | Select Name, ` @{N=\"HostProfile\";E={$_ | Get-VMHostProfile}}, ` @{N=\"JoinADEnabled\";E={($_ | Get-VmHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled}}, ` @{N=\"JoinDomainMethod\";E={(($_ | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory | Select -ExpandProperty Policy | Where {$_.Id -eq \"JoinDomainMethodPolicy\"}).Policyoption.Id}}\n\nIf \"JoinADEnabled\" is \"True\" and \"JoinDomainMethod\" is not \"FixedCAMConfigOption\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\nClick a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration.\n\nClick \"Edit Host Profile...\". Set the \"Join Domain Method\" to \"Use vSphere Authentication Proxy to add the host to domain\" and provide the IP address of the vSphere Authentication Proxy server.\n\nClick \"Save\"."}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000240","rid":"SV-ESXI-80-000240","stig_id":"ESXI-80-000240","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000240' do\n  title 'The ESXi host when using Host Profiles and/or Auto Deploy must use the vSphere Authentication Proxy to protect passwords when adding themselves to Active Directory.'\n  desc  \"\n    If a host is configured to join an Active Directory domain using Host Profiles and/or Auto Deploy, the Active Directory credentials are saved in the profile and are transmitted over the network.\n\n    To avoid having to save Active Directory credentials in the Host Profile and to avoid transmitting Active Directory credentials over the network, use the vSphere Authentication Proxy.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For environments that do not use vCenter server to manage ESXi, this is not applicable.\n\n    If the organization is not using Host Profiles to join Active Directory, this is not applicable.\n\n    From the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\n    Click a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration >> Join Domain Method.\n\n    If the method used to join hosts to a domain is not set to \\\"Use vSphere Authentication Proxy to add the host to domain\\\", this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to vCenter, run the following command:\n\n    Get-VMHost | Select Name, ` @{N=\\\"HostProfile\\\";E={$_ | Get-VMHostProfile}}, ` @{N=\\\"JoinADEnabled\\\";E={($_ | Get-VmHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled}}, ` @{N=\\\"JoinDomainMethod\\\";E={(($_ | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory | Select -ExpandProperty Policy | Where {$_.Id -eq \\\"JoinDomainMethodPolicy\\\"}).Policyoption.Id}}\n\n    If \\\"JoinADEnabled\\\" is \\\"True\\\" and \\\"JoinDomainMethod\\\" is not \\\"FixedCAMConfigOption\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Home >> Policies and Profiles >> Host Profiles.\n\n    Click a Host Profile >> Configure >> Security and Services >> Security Settings >> Authentication Configuration >> Active Directory Configuration.\n\n    Click \\\"Edit Host Profile...\\\". Set the \\\"Join Domain Method\\\" to \\\"Use vSphere Authentication Proxy to add the host to domain\\\" and provide the IP address of the vSphere Authentication Proxy server.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000240'\n  tag rid: 'SV-ESXI-80-000240'\n  tag stig_id: 'ESXI-80-000240'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    setimpact = true\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostProfile\"\n      hostprofile = powercli_command(command).stdout\n\n      if hostprofile.empty?\n        describe \"There are no attached host profiles host: #{vmhost}. This control is not applicable.\" do\n          skip \"There are no attached host profiles host: #{vmhost}. This control is not applicable.\"\n        end\n      else\n        command1 = \"(Get-VMHost -Name #{vmhost} | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory.Enabled\"\n        adEnabled = powercli_command(command1).stdout.strip\n\n        if adEnabled.match?('True')\n          command2 = \"(Get-VMHost -Name #{vmhost} | Get-VMHostProfile).ExtensionData.Config.ApplyProfile.Authentication.ActiveDirectory | Select-Object -ExpandProperty Policy | Where {$_.Id -eq 'JoinDomainMethodPolicy'} | Select-Object -ExpandProperty PolicyOption | Select-Object -ExpandProperty Id\"\n          describe powercli_command(command2) do\n            its('stdout.strip') { should cmp 'FixedCAMConfigOption' }\n          end\n          setimpact = false\n        else\n          describe \"Active Directory is not enabled on host: #{vmhost}. This control is not applicable.\" do\n            skip \"Active Directory is not enabled on host: #{vmhost}. This control is not applicable.\"\n          end\n        end\n      end\n    end\n  else\n    describe 'No ESXi hosts found. Review inputs provided for errors and rerun profile.' do\n      skip 'No ESXi hosts found. Review inputs provided for errors and rerun profile.'\n    end\n    setimpact = false\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000240.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"There are no attached host profiles host: 10.186.25.26. This control is not applicable.","run_time":6.0e-06,"start_time":"2023-06-07T08:29:05-06:00","resource":"","skip_message":"There are no attached host profiles host: 10.186.25.26. This control is not applicable.","resource_class":"Object","resource_params":"[]","resource_id":"There are no attached host profiles host: 10.186.25.26. This control is not applicable."}]},{"id":"ESXI-80-000241","title":"The ESXi host must not use the default Active Directory ESX Admin group.","desc":"When adding ESXi hosts to Active Directory, all user/group accounts assigned to the Active Directory group \"ESX Admins\" will have full administrative access to the host.\n\nIf this group is not controlled or known to the system administrators, it may be used for inappropriate access to the host. Therefore, the default group must be changed to a site-specific Active Directory group and membership must be severely restricted.","descriptions":[{"label":"default","data":"When adding ESXi hosts to Active Directory, all user/group accounts assigned to the Active Directory group \"ESX Admins\" will have full administrative access to the host.\n\nIf this group is not controlled or known to the system administrators, it may be used for inappropriate access to the host. Therefore, the default group must be changed to a site-specific Active Directory group and membership must be severely restricted."},{"label":"rationale","data":""},{"label":"check","data":"For systems that do not use Active Directory, this is not applicable.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" value and verify it is not set to \"ESX Admins\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup\n\nIf the \"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" setting is set to \"ESX Admins\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\" key and configure its value to an appropriate Active Directory group other than \"ESX Admins\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup | Set-AdvancedSetting -Value \"<site specific AD group>\"\n\nNote: Changing the group name does not remove the permissions of the previous group."}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000241","rid":"SV-ESXI-80-000241","stig_id":"ESXI-80-000241","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000241' do\n  title 'The ESXi host must not use the default Active Directory ESX Admin group.'\n  desc  \"\n    When adding ESXi hosts to Active Directory, all user/group accounts assigned to the Active Directory group \\\"ESX Admins\\\" will have full administrative access to the host.\n\n    If this group is not controlled or known to the system administrators, it may be used for inappropriate access to the host. Therefore, the default group must be changed to a site-specific Active Directory group and membership must be severely restricted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For systems that do not use Active Directory, this is not applicable.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" value and verify it is not set to \\\"ESX Admins\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup\n\n    If the \\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" setting is set to \\\"ESX Admins\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Config.HostAgent.plugins.hostsvc.esxAdminsGroup\\\" key and configure its value to an appropriate Active Directory group other than \\\"ESX Admins\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup | Set-AdvancedSetting -Value \\\"<site specific AD group>\\\"\n\n    Note: Changing the group name does not remove the permissions of the previous group.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000241'\n  tag rid: 'SV-ESXI-80-000241'\n  tag stig_id: 'ESXI-80-000241'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-VMHostAuthentication | Select-Object -ExpandProperty DomainMembershipStatus\"\n      domainstatus = powercli_command(command).stdout\n      if domainstatus.empty?\n        impact 0.0\n        describe '' do\n          skip \"The ESXi host #{vmhost} is not joined to AD, so this control is not applicable.\"\n        end\n      else\n        command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name Config.HostAgent.plugins.hostsvc.esxAdminsGroup | Select-Object -ExpandProperty Value\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should_not cmp 'ESX Admins' }\n          its('stdout.strip') { should cmp \"#{input('adAdminGroup')}\" }\n        end\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000241.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"","run_time":4.6e-06,"start_time":"2023-06-07T08:29:05-06:00","resource":"","skip_message":"The ESXi host 10.186.25.26 is not joined to AD, so this control is not applicable.","resource_class":"Object","resource_params":"[]","resource_id":""}]},{"id":"ESXI-80-000243","title":"The ESXi host must configure a persistent log location for all locally stored logs.","desc":"ESXi can be configured to store log files on an in-memory file system. This occurs when the host's \"/scratch\" directory is linked to \"/tmp/scratch\". When this is done, only a single day's worth of logs are stored at any time. In addition, log files will be reinitialized upon each reboot.\n\nThis presents a security risk as user activity logged on the host is only stored temporarily and will not persist across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.\n\nNote: Scratch space is configured automatically during installation or first boot of an ESXi host and does not usually need to be configured manually.\n\nIf ESXi is installed on an SD card or USB device, a persistent log location may not be configured upon install as normal.","descriptions":[{"label":"default","data":"ESXi can be configured to store log files on an in-memory file system. This occurs when the host's \"/scratch\" directory is linked to \"/tmp/scratch\". When this is done, only a single day's worth of logs are stored at any time. In addition, log files will be reinitialized upon each reboot.\n\nThis presents a security risk as user activity logged on the host is only stored temporarily and will not persist across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.\n\nNote: Scratch space is configured automatically during installation or first boot of an ESXi host and does not usually need to be configured manually.\n\nIf ESXi is installed on an SD card or USB device, a persistent log location may not be configured upon install as normal."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"Syslog.global.logDir\" value and verify it is set to a persistent location.\n\nIf the value of the setting is \"[] /scratch/logs\", verify the advanced setting \"ScratchConfig.CurrentScratchLocation\" is not set to \"/tmp/scratch\". This is a nonpersistent location.\n\nIf \"Syslog.global.logDir\" is not configured to a persistent location, this is a finding.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.syslog.config.get.Invoke() | Select LocalLogOutput,LocalLogOutputIsPersistent\n\nIf the \"LocalLogOutputIsPersistent\" value is not true, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"Syslog.global.logDir\" value and set it to a known persistent location.\n\nAn example is shown below, where 51dda02d-fade5016-8a08-005056171889 is the UUID of the target datastore:\n\n/vmfs/volumes/51dda02d-fade5016-8a08-005056171889\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name Syslog.global.logDir | Set-AdvancedSetting -Value \"New Log Location\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000341-VMM-001220","gid":"V-ESXI-80-000243","rid":"SV-ESXI-80-000243","stig_id":"ESXI-80-000243","cci":["CCI-001849"],"nist":["AU-4"]},"code":"control 'ESXI-80-000243' do\n  title 'The ESXi host must configure a persistent log location for all locally stored logs.'\n  desc  \"\n    ESXi can be configured to store log files on an in-memory file system. This occurs when the host's \\\"/scratch\\\" directory is linked to \\\"/tmp/scratch\\\". When this is done, only a single day's worth of logs are stored at any time. In addition, log files will be reinitialized upon each reboot.\n\n    This presents a security risk as user activity logged on the host is only stored temporarily and will not persist across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.\n\n    Note: Scratch space is configured automatically during installation or first boot of an ESXi host and does not usually need to be configured manually.\n\n    If ESXi is installed on an SD card or USB device, a persistent log location may not be configured upon install as normal.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"Syslog.global.logDir\\\" value and verify it is set to a persistent location.\n\n    If the value of the setting is \\\"[] /scratch/logs\\\", verify the advanced setting \\\"ScratchConfig.CurrentScratchLocation\\\" is not set to \\\"/tmp/scratch\\\". This is a nonpersistent location.\n\n    If \\\"Syslog.global.logDir\\\" is not configured to a persistent location, this is a finding.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.syslog.config.get.Invoke() | Select LocalLogOutput,LocalLogOutputIsPersistent\n\n    If the \\\"LocalLogOutputIsPersistent\\\" value is not true, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"Syslog.global.logDir\\\" value and set it to a known persistent location.\n\n    An example is shown below, where 51dda02d-fade5016-8a08-005056171889 is the UUID of the target datastore:\n\n    /vmfs/volumes/51dda02d-fade5016-8a08-005056171889\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logDir | Set-AdvancedSetting -Value \\\"New Log Location\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000341-VMM-001220'\n  tag gid: 'V-ESXI-80-000243'\n  tag rid: 'SV-ESXI-80-000243'\n  tag stig_id: 'ESXI-80-000243'\n  tag cci: ['CCI-001849']\n  tag nist: ['AU-4']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.get.Invoke() | Select-Object -ExpandProperty LocalLogOutputIsPersistent\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000243.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.get.Invoke() | Select-Object -ExpandProperty LocalLogOutputIsPersistent stdout.strip is expected to cmp == \"true\"","run_time":0.3779242,"start_time":"2023-06-07T08:29:05-06:00","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.get.Invoke() | Select-Object -ExpandProperty LocalLogOutputIsPersistent\"]","resource_id":""}]},{"id":"ESXI-80-000244","title":"The ESXi host must enforce the exclusive running of executables from approved VIBs.","desc":"The \"execInstalledOnly\" advanced ESXi boot option, when set to TRUE, guarantees that the VMkernel executes only those binaries that have been packaged as part of a signed VIB. While this option is effective on its own, it can be further enhanced by telling the Secure Boot to check with the TPM to make sure that the boot process does not proceed unless this setting is enabled. This further protects against malicious offline changes to ESXi configuration to disable the \"execInstalledOnly\" option.","descriptions":[{"label":"default","data":"The \"execInstalledOnly\" advanced ESXi boot option, when set to TRUE, guarantees that the VMkernel executes only those binaries that have been packaged as part of a signed VIB. While this option is effective on its own, it can be further enhanced by telling the Secure Boot to check with the TPM to make sure that the boot process does not proceed unless this setting is enabled. This further protects against malicious offline changes to ESXi configuration to disable the \"execInstalledOnly\" option."},{"label":"rationale","data":""},{"label":"check","data":"If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\nFrom the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nSelect the \"VMkernel.Boot.execInstalledOnly\" value and verify that it is \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly\n\nIf the \"VMkernel.Boot.execInstalledOnly\" setting is not \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Hosts and Clusters.\n\nSelect the ESXi Host >> Configure >> System >> Advanced System Settings.\n\nClick \"Edit\". Select the \"VMkernel.Boot.execInstalledOnly\" value and configure it to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\nGet-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Set-AdvancedSetting -Value True"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000244","rid":"SV-ESXI-80-000244","stig_id":"ESXI-80-000244","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000244' do\n  title 'The ESXi host must enforce the exclusive running of executables from approved VIBs.'\n  desc  'The \"execInstalledOnly\" advanced ESXi boot option, when set to TRUE, guarantees that the VMkernel executes only those binaries that have been packaged as part of a signed VIB. While this option is effective on its own, it can be further enhanced by telling the Secure Boot to check with the TPM to make sure that the boot process does not proceed unless this setting is enabled. This further protects against malicious offline changes to ESXi configuration to disable the \"execInstalledOnly\" option.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If the ESXi host does not have a compatible TPM, this finding is downgraded to a CAT III.\n\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Select the \\\"VMkernel.Boot.execInstalledOnly\\\" value and verify that it is \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly\n\n    If the \\\"VMkernel.Boot.execInstalledOnly\\\" setting is not \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Hosts and Clusters.\n\n    Select the ESXi Host >> Configure >> System >> Advanced System Settings.\n\n    Click \\\"Edit\\\". Select the \\\"VMkernel.Boot.execInstalledOnly\\\" value and configure it to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following command:\n\n    Get-VMHost | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Set-AdvancedSetting -Value True\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000244'\n  tag rid: 'SV-ESXI-80-000244'\n  tag stig_id: 'ESXI-80-000244'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"Get-VMHost -Name #{vmhost} | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Select-Object -ExpandProperty Value\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000244.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"true\"","run_time":0.6361998,"start_time":"2023-06-07T08:29:06-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VMHost -Name 10.186.25.26 | Get-AdvancedSetting -Name VMkernel.Boot.execInstalledOnly | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"ESXI-80-000245","title":"The ESXi host must use sufficient entropy for cryptographic operations.","desc":"Starting in vSphere 8.0, the ESXi Entropy implementation supports the FIPS 140-3 and EAL4 certifications. Kernel boot options control which entropy sources to activate on an ESXi host.\n\nIn computing, the term \"entropy\" refers to random characters and data that are collected for use in cryptography, such as generating encryption keys to secure data transmitted over a network. Entropy is required by security for generating keys and communicating securely over the network. Entropy is often collected from a variety of sources on a system.\n\nFIPS entropy handling is the default behavior if the following conditions are true:\n\n-The hardware supports RDSEED.\n-The disableHwrng VMkernel boot option isn't present or is FALSE.\n-The entropySources VMkernel boot option isn't present or is 0 (zero).","descriptions":[{"label":"default","data":"Starting in vSphere 8.0, the ESXi Entropy implementation supports the FIPS 140-3 and EAL4 certifications. Kernel boot options control which entropy sources to activate on an ESXi host.\n\nIn computing, the term \"entropy\" refers to random characters and data that are collected for use in cryptography, such as generating encryption keys to secure data transmitted over a network. Entropy is required by security for generating keys and communicating securely over the network. Entropy is often collected from a variety of sources on a system.\n\nFIPS entropy handling is the default behavior if the following conditions are true:\n\n-The hardware supports RDSEED.\n-The disableHwrng VMkernel boot option isn't present or is FALSE.\n-The entropySources VMkernel boot option isn't present or is 0 (zero)."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following commands:\n\n# esxcli system settings kernel list -o disableHwrng\n# esxcli system settings kernel list -o entropySources\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.settings.kernel.list.invoke() | Where {$_.Name -eq \"disableHwrng\" -or $_.Name -eq \"entropySources\"}\n\nIf \"disableHwrng\" is not set to \"false\", this is a finding.\nIf \"entropySources\" is not set to \"0\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following commands:\n\n# esxcli system settings kernel set -s disableHwrng -v FALSE\n# esxcli system settings kernel set -s entropySources -v 0\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.settings.kernel.set.CreateArgs()\n$arguments.setting = \"disableHwrng\"\n$arguments.value = \"FALSE\"\n$esxcli.system.settings.kernel.set.invoke($arguments)\n$arguments.setting = \"entropySources\"\n$arguments.value = \"0\"\n$esxcli.system.settings.kernel.set.invoke($arguments)\n\nReboot the ESXi host after updating entropy settings."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000245","rid":"SV-ESXI-80-000245","stig_id":"ESXI-80-000245","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000245' do\n  title 'The ESXi host must use sufficient entropy for cryptographic operations.'\n  desc  \"\n    Starting in vSphere 8.0, the ESXi Entropy implementation supports the FIPS 140-3 and EAL4 certifications. Kernel boot options control which entropy sources to activate on an ESXi host.\n\n    In computing, the term \\\"entropy\\\" refers to random characters and data that are collected for use in cryptography, such as generating encryption keys to secure data transmitted over a network. Entropy is required by security for generating keys and communicating securely over the network. Entropy is often collected from a variety of sources on a system.\n\n    FIPS entropy handling is the default behavior if the following conditions are true:\n\n    -The hardware supports RDSEED.\n    -The disableHwrng VMkernel boot option isn't present or is FALSE.\n    -The entropySources VMkernel boot option isn't present or is 0 (zero).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following commands:\n\n    # esxcli system settings kernel list -o disableHwrng\n    # esxcli system settings kernel list -o entropySources\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.settings.kernel.list.invoke() | Where {$_.Name -eq \\\"disableHwrng\\\" -or $_.Name -eq \\\"entropySources\\\"}\n\n    If \\\"disableHwrng\\\" is not set to \\\"false\\\", this is a finding.\n    If \\\"entropySources\\\" is not set to \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following commands:\n\n    # esxcli system settings kernel set -s disableHwrng -v FALSE\n    # esxcli system settings kernel set -s entropySources -v 0\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.settings.kernel.set.CreateArgs()\n    $arguments.setting = \\\"disableHwrng\\\"\n    $arguments.value = \\\"FALSE\\\"\n    $esxcli.system.settings.kernel.set.invoke($arguments)\n    $arguments.setting = \\\"entropySources\\\"\n    $arguments.value = \\\"0\\\"\n    $esxcli.system.settings.kernel.set.invoke($arguments)\n\n    Reboot the ESXi host after updating entropy settings.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000245'\n  tag rid: 'SV-ESXI-80-000245'\n  tag stig_id: 'ESXI-80-000245'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \\\"disableHwrng\\\"} | Select-Object -ExpandProperty Configured\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'FALSE' }\n      end\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \\\"entropySources\\\"} | Select-Object -ExpandProperty Configured\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '0' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000245.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \"disableHwrng\"} | Select-Object -ExpandProperty Configured stdout.strip is expected to cmp == \"FALSE\"","run_time":0.800001,"start_time":"2023-06-07T08:29:06-06:00","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \\\"disableHwrng\\\"} | Select-Object -ExpandProperty Configured\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \"entropySources\"} | Select-Object -ExpandProperty Configured stdout.strip is expected to cmp == \"0\"","run_time":0.8091229,"start_time":"2023-06-07T08:29:07-06:00","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.settings.kernel.list.invoke()| Where {$_.Name -eq \\\"entropySources\\\"} | Select-Object -ExpandProperty Configured\"]","resource_id":""}]},{"id":"ESXI-80-000246","title":"The ESXi host must not enable log filtering.","desc":"The log filtering capability lets you modify the logging policy of the syslog service that is running on an ESXi host. You can create log filters to reduce the number of repetitive entries in the ESXi logs and to deny specific log events entirely.\n\nSetting a limit to the amount of logging information restricts the ability to detect and respond to potential security issues or system failures properly.","descriptions":[{"label":"default","data":"The log filtering capability lets you modify the logging policy of the syslog service that is running on an ESXi host. You can create log filters to reduce the number of repetitive entries in the ESXi logs and to deny specific log events entirely.\n\nSetting a limit to the amount of logging information restricts the ability to detect and respond to potential security issues or system failures properly."},{"label":"rationale","data":""},{"label":"check","data":"From an ESXi shell, run the following command:\n\n# esxcli system syslog config logfilter get\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$esxcli.system.syslog.config.logfilter.get.invoke()\n\nIf \"LogFilteringEnabled\" is not set to \"false\", this is a finding."},{"label":"fix","data":"From an ESXi shell, run the following command:\n\n# esxcli system syslog config logfilter set --log-filtering-enabled=false\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n$esxcli = Get-EsxCli -v2\n$arguments = $esxcli.system.syslog.config.logfilter.set.CreateArgs()\n$arguments.logfilteringenabled = $false\n$esxcli.system.syslog.config.logfilter.set.invoke($arguments)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-ESXI-80-000246","rid":"SV-ESXI-80-000246","stig_id":"ESXI-80-000246","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'ESXI-80-000246' do\n  title 'The ESXi host must not enable log filtering.'\n  desc  \"\n    The log filtering capability lets you modify the logging policy of the syslog service that is running on an ESXi host. You can create log filters to reduce the number of repetitive entries in the ESXi logs and to deny specific log events entirely.\n\n    Setting a limit to the amount of logging information restricts the ability to detect and respond to potential security issues or system failures properly.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system syslog config logfilter get\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $esxcli.system.syslog.config.logfilter.get.invoke()\n\n    If \\\"LogFilteringEnabled\\\" is not set to \\\"false\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From an ESXi shell, run the following command:\n\n    # esxcli system syslog config logfilter set --log-filtering-enabled=false\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host, run the following commands:\n\n    $esxcli = Get-EsxCli -v2\n    $arguments = $esxcli.system.syslog.config.logfilter.set.CreateArgs()\n    $arguments.logfilteringenabled = $false\n    $esxcli.system.syslog.config.logfilter.set.invoke($arguments)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-ESXI-80-000246'\n  tag rid: 'SV-ESXI-80-000246'\n  tag stig_id: 'ESXI-80-000246'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmhostName = input('vmhostName')\n  cluster = input('cluster')\n  allhosts = input('allesxi')\n  vmhosts = []\n\n  unless vmhostName.empty?\n    vmhosts = powercli_command(\"Get-VMHost -Name #{vmhostName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless cluster.empty?\n    vmhosts = powercli_command(\"Get-Cluster -Name '#{cluster}' | Get-VMHost | Sort-Object Name | Select -ExpandProperty Name\").stdout.split\n  end\n  unless allhosts == false\n    vmhosts = powercli_command('Get-VMHost | Sort-Object Name | Select -ExpandProperty Name').stdout.split\n  end\n\n  if !vmhosts.empty?\n    vmhosts.each do |vmhost|\n      command = \"$vmhost = Get-VMHost -Name #{vmhost}; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.logfilter.get.invoke() | Select-Object -ExpandProperty LogFilteringEnabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No hosts found!' do\n      skip 'No hosts found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/580ceed641893dd00175c2e1c5d112de5d50ae0b8cbb2819ec8a087021429b0f/controls/ESXI-80-000246.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: $vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.logfilter.get.invoke() | Select-Object -ExpandProperty LogFilteringEnabled stdout.strip is expected to cmp == \"false\"","run_time":0.3665214,"start_time":"2023-06-07T08:29:08-06:00","resource_class":"powercli_command","resource_params":"[\"$vmhost = Get-VMHost -Name 10.186.25.26; $esxcli = Get-EsxCli -VMHost $vmhost -V2; $esxcli.system.syslog.config.logfilter.get.invoke() | Select-Object -ExpandProperty LogFilteringEnabled\"]","resource_id":""}]}],"status":"loaded","status_message":""},{"name":"VMware vSphere 8.0 vCenter STIG Readiness Guide","version":"1.0.1","sha256":"8f9266052570c0249001c60d77de53eda9da5e60c4151c3472380f744e384add","title":"VMware vSphere 8.0 vCenter STIG Readiness Guide","maintainer":"The Authors","summary":"An InSpec Compliance Profile","license":"Apache-2.0","copyright":"The Authors","supports":[],"attributes":[],"parent_profile":"vmware-vsphere-8.0-stig-baseline","groups":[{"id":"controls/VCSA-80-000009.rb","controls":["VCSA-80-000009"]},{"id":"controls/VCSA-80-000023.rb","controls":["VCSA-80-000023"]},{"id":"controls/VCSA-80-000024.rb","controls":["VCSA-80-000024"]},{"id":"controls/VCSA-80-000034.rb","controls":["VCSA-80-000034"]},{"id":"controls/VCSA-80-000057.rb","controls":["VCSA-80-000057"]},{"id":"controls/VCSA-80-000059.rb","controls":["VCSA-80-000059"]},{"id":"controls/VCSA-80-000060.rb","controls":["VCSA-80-000060"]},{"id":"controls/VCSA-80-000069.rb","controls":["VCSA-80-000069"]},{"id":"controls/VCSA-80-000070.rb","controls":["VCSA-80-000070"]},{"id":"controls/VCSA-80-000071.rb","controls":["VCSA-80-000071"]},{"id":"controls/VCSA-80-000072.rb","controls":["VCSA-80-000072"]},{"id":"controls/VCSA-80-000073.rb","controls":["VCSA-80-000073"]},{"id":"controls/VCSA-80-000074.rb","controls":["VCSA-80-000074"]},{"id":"controls/VCSA-80-000077.rb","controls":["VCSA-80-000077"]},{"id":"controls/VCSA-80-000079.rb","controls":["VCSA-80-000079"]},{"id":"controls/VCSA-80-000080.rb","controls":["VCSA-80-000080"]},{"id":"controls/VCSA-80-000089.rb","controls":["VCSA-80-000089"]},{"id":"controls/VCSA-80-000095.rb","controls":["VCSA-80-000095"]},{"id":"controls/VCSA-80-000110.rb","controls":["VCSA-80-000110"]},{"id":"controls/VCSA-80-000123.rb","controls":["VCSA-80-000123"]},{"id":"controls/VCSA-80-000145.rb","controls":["VCSA-80-000145"]},{"id":"controls/VCSA-80-000148.rb","controls":["VCSA-80-000148"]},{"id":"controls/VCSA-80-000150.rb","controls":["VCSA-80-000150"]},{"id":"controls/VCSA-80-000158.rb","controls":["VCSA-80-000158"]},{"id":"controls/VCSA-80-000195.rb","controls":["VCSA-80-000195"]},{"id":"controls/VCSA-80-000196.rb","controls":["VCSA-80-000196"]},{"id":"controls/VCSA-80-000248.rb","controls":["VCSA-80-000248"]},{"id":"controls/VCSA-80-000253.rb","controls":["VCSA-80-000253"]},{"id":"controls/VCSA-80-000265.rb","controls":["VCSA-80-000265"]},{"id":"controls/VCSA-80-000266.rb","controls":["VCSA-80-000266"]},{"id":"controls/VCSA-80-000267.rb","controls":["VCSA-80-000267"]},{"id":"controls/VCSA-80-000268.rb","controls":["VCSA-80-000268"]},{"id":"controls/VCSA-80-000269.rb","controls":["VCSA-80-000269"]},{"id":"controls/VCSA-80-000270.rb","controls":["VCSA-80-000270"]},{"id":"controls/VCSA-80-000271.rb","controls":["VCSA-80-000271"]},{"id":"controls/VCSA-80-000272.rb","controls":["VCSA-80-000272"]},{"id":"controls/VCSA-80-000273.rb","controls":["VCSA-80-000273"]},{"id":"controls/VCSA-80-000274.rb","controls":["VCSA-80-000274"]},{"id":"controls/VCSA-80-000275.rb","controls":["VCSA-80-000275"]},{"id":"controls/VCSA-80-000276.rb","controls":["VCSA-80-000276"]},{"id":"controls/VCSA-80-000277.rb","controls":["VCSA-80-000277"]},{"id":"controls/VCSA-80-000278.rb","controls":["VCSA-80-000278"]},{"id":"controls/VCSA-80-000279.rb","controls":["VCSA-80-000279"]},{"id":"controls/VCSA-80-000280.rb","controls":["VCSA-80-000280"]},{"id":"controls/VCSA-80-000281.rb","controls":["VCSA-80-000281"]},{"id":"controls/VCSA-80-000282.rb","controls":["VCSA-80-000282"]},{"id":"controls/VCSA-80-000283.rb","controls":["VCSA-80-000283"]},{"id":"controls/VCSA-80-000284.rb","controls":["VCSA-80-000284"]},{"id":"controls/VCSA-80-000285.rb","controls":["VCSA-80-000285"]},{"id":"controls/VCSA-80-000286.rb","controls":["VCSA-80-000286"]},{"id":"controls/VCSA-80-000287.rb","controls":["VCSA-80-000287"]},{"id":"controls/VCSA-80-000288.rb","controls":["VCSA-80-000288"]},{"id":"controls/VCSA-80-000290.rb","controls":["VCSA-80-000290"]},{"id":"controls/VCSA-80-000291.rb","controls":["VCSA-80-000291"]},{"id":"controls/VCSA-80-000292.rb","controls":["VCSA-80-000292"]},{"id":"controls/VCSA-80-000293.rb","controls":["VCSA-80-000293"]},{"id":"controls/VCSA-80-000294.rb","controls":["VCSA-80-000294"]},{"id":"controls/VCSA-80-000295.rb","controls":["VCSA-80-000295"]},{"id":"controls/VCSA-80-000296.rb","controls":["VCSA-80-000296"]},{"id":"controls/VCSA-80-000298.rb","controls":["VCSA-80-000298"]},{"id":"controls/VCSA-80-000299.rb","controls":["VCSA-80-000299"]},{"id":"controls/VCSA-80-000300.rb","controls":["VCSA-80-000300"]},{"id":"controls/VCSA-80-000301.rb","controls":["VCSA-80-000301"]},{"id":"controls/VCSA-80-000302.rb","controls":["VCSA-80-000302"]},{"id":"controls/VCSA-80-000303.rb","controls":["VCSA-80-000303"]},{"id":"controls/VCSA-80-000304.rb","controls":["VCSA-80-000304"]}],"controls":[{"id":"VCSA-80-000009","title":"The vCenter Server must use TLS 1.2, at a minimum, to protect the confidentiality of sensitive data during electronic dissemination using remote access.","desc":"Using older unauthorized versions or incorrectly configuring protocol negotiation makes the gateway vulnerable to known and unknown attacks that exploit vulnerabilities in this protocol.","descriptions":[{"label":"default","data":"Using older unauthorized versions or incorrectly configuring protocol negotiation makes the gateway vulnerable to known and unknown attacks that exploit vulnerabilities in this protocol."},{"label":"rationale","data":""},{"label":"check","data":"At the command prompt on the vCenter Server Appliance, run the following command:\n\n# /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc scan\n\nIf the output indicates versions of TLS other than 1.2 are enabled, this is a finding."},{"label":"fix","data":"At the command prompt on the vCenter Server Appliance, run the following command:\n\n# /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc update -p TLSv1.2\n\nvCenter services will be restarted as part of the reconfiguration. The operating system will not be restarted.\n\nThe \"--no-restart\" flag can be added to restart services at a later time.\n\nChanges will not take effect until all services are restarted or the appliance is rebooted."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-APP-000014","satisfies":["SRG-APP-000156","SRG-APP-000157","SRG-APP-000219","SRG-APP-000439","SRG-APP-000440","SRG-APP-000441","SRG-APP-000442","SRG-APP-000560","SRG-APP-000565","SRG-APP-000625","SRG-APP-000645"],"gid":"V-VCSA-80-000009","rid":"SV-VCSA-80-000009","stig_id":"VCSA-80-000009","cci":["CCI-000068","CCI-000382","CCI-001184","CCI-001453","CCI-001941","CCI-001942","CCI-002418","CCI-002420","CCI-002421","CCI-002422","CCI-002450"],"nist":["AC-17 (2)","CM-7 b","IA-2 (8)","IA-2 (9)","SC-13","SC-23","SC-8","SC-8 (1)","SC-8 (2)"]},"code":"control 'VCSA-80-000009' do\n  title 'The vCenter Server must use TLS 1.2, at a minimum, to protect the confidentiality of sensitive data during electronic dissemination using remote access.'\n  desc  'Using older unauthorized versions or incorrectly configuring protocol negotiation makes the gateway vulnerable to known and unknown attacks that exploit vulnerabilities in this protocol.'\n  desc  'rationale', ''\n  desc  'check', \"\n    At the command prompt on the vCenter Server Appliance, run the following command:\n\n    # /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc scan\n\n    If the output indicates versions of TLS other than 1.2 are enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    At the command prompt on the vCenter Server Appliance, run the following command:\n\n    # /usr/lib/vmware-TlsReconfigurator/VcTlsReconfigurator/reconfigureVc update -p TLSv1.2\n\n    vCenter services will be restarted as part of the reconfiguration. The operating system will not be restarted.\n\n    The \\\"--no-restart\\\" flag can be added to restart services at a later time.\n\n    Changes will not take effect until all services are restarted or the appliance is rebooted.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-APP-000014'\n  tag satisfies: ['SRG-APP-000156', 'SRG-APP-000157', 'SRG-APP-000219', 'SRG-APP-000439', 'SRG-APP-000440', 'SRG-APP-000441', 'SRG-APP-000442', 'SRG-APP-000560', 'SRG-APP-000565', 'SRG-APP-000625', 'SRG-APP-000645']\n  tag gid: 'V-VCSA-80-000009'\n  tag rid: 'SV-VCSA-80-000009'\n  tag stig_id: 'VCSA-80-000009'\n  tag cci: ['CCI-000068', 'CCI-000382', 'CCI-001184', 'CCI-001453', 'CCI-001941', 'CCI-001942', 'CCI-002418', 'CCI-002420', 'CCI-002421', 'CCI-002422', 'CCI-002450']\n  tag nist: ['AC-17 (2)', 'CM-7 b', 'IA-2 (8)', 'IA-2 (9)', 'SC-13', 'SC-23', 'SC-8', 'SC-8 (1)', 'SC-8 (2)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000009.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.43e-05,"start_time":"2023-06-07T08:29:08-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000023","title":"The vCenter Server must enforce the limit of three consecutive invalid login attempts by a user.","desc":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account.","descriptions":[{"label":"default","data":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nThe following lockout policy should be set as follows:\n\nMaximum number of failed login attempts: 3\n\nIf this account lockout policy is not configured as stated, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nClick \"Edit\".\n\nSet the \"Maximum number of failed login attempts\" to \"3\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000065","gid":"V-VCSA-80-000023","rid":"SV-VCSA-80-000023","stig_id":"VCSA-80-000023","cci":["CCI-000044"],"nist":["AC-7 a"]},"code":"control 'VCSA-80-000023' do\n  title 'The vCenter Server must enforce the limit of three consecutive invalid login attempts by a user.'\n  desc  'By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account. '\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    The following lockout policy should be set as follows:\n\n    Maximum number of failed login attempts: 3\n\n    If this account lockout policy is not configured as stated, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Maximum number of failed login attempts\\\" to \\\"3\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000065'\n  tag gid: 'V-VCSA-80-000023'\n  tag rid: 'SV-VCSA-80-000023'\n  tag stig_id: 'VCSA-80-000023'\n  tag cci: ['CCI-000044']\n  tag nist: ['AC-7 a']\n\n  command = '(Get-SsoLockoutPolicy).MaxFailedAttempts'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp '3' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000023.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoLockoutPolicy).MaxFailedAttempts stdout.strip is expected to cmp == \"3\"","run_time":0.244666,"start_time":"2023-06-07T08:29:08-06:00","message":"\nexpected: 3\n     got: 5\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoLockoutPolicy).MaxFailedAttempts\"]","resource_id":""}]},{"id":"VCSA-80-000024","title":"The vCenter Server must display the Standard Mandatory DOD Notice and Consent Banner before logon.","desc":"Display of the DOD-approved use notification before granting access to the application ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with DTM-08-060. Use the following verbiage for applications that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for operating systems that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\"","descriptions":[{"label":"default","data":"Display of the DOD-approved use notification before granting access to the application ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.\n\nThe banner must be formatted in accordance with DTM-08-060. Use the following verbiage for applications that can accommodate banners of 1300 characters:\n\n\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\"\n\nUse the following verbiage for operating systems that have severe limitations on the number of characters that can be displayed in the banner:\n\n\"I've read (literal ampersand) consent to terms in IS user agreem't.\""},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\nIf the selection box next to \"Show login message\" is disabled, \"Details of login message\" is not configured to the standard DOD User Agreement, or the \"Consent checkbox\" is disabled, this is a finding.\n\nNote: Refer to vulnerability discussion for user agreement language."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\nClick \"Edit\".\n\nClick the \"Show login message\" slider to enable.\n\nConfigure the \"Login message\" to \"DOD User Agreement\".\n\nClick the \"Consent checkbox\" slider to enable.\n\nSet the \"Details of login message\" to the Standard Mandatory DOD Notice and Consent Banner text.\n\nClick \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000068","satisfies":["SRG-APP-000069","SRG-APP-000070"],"gid":"V-VCSA-80-000024","rid":"SV-VCSA-80-000024","stig_id":"VCSA-80-000024","cci":["CCI-000048","CCI-000050","CCI-001384"],"nist":["AC-8 a","AC-8 b","AC-8 c 1"]},"code":"control 'VCSA-80-000024' do\n  title 'The vCenter Server must display the Standard Mandatory DOD Notice and Consent Banner before logon.'\n  desc  \"\n    Display of the DOD-approved use notification before granting access to the application ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\n    System use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.\n\n    The banner must be formatted in accordance with DTM-08-060. Use the following verbiage for applications that can accommodate banners of 1300 characters:\n\n    \\\"You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.\n\n    By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n    -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n    -At any time, the USG may inspect and seize data stored on this IS.\n\n    -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.\n\n    -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.\n\n    -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\\\"\n\n    Use the following verbiage for operating systems that have severe limitations on the number of characters that can be displayed in the banner:\n\n    \\\"I've read (literal ampersand) consent to terms in IS user agreem't.\\\"\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\n    If the selection box next to \\\"Show login message\\\" is disabled, \\\"Details of login message\\\" is not configured to the standard DOD User Agreement, or the \\\"Consent checkbox\\\" is disabled, this is a finding.\n\n    Note: Refer to vulnerability discussion for user agreement language.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Login Message.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Show login message\\\" slider to enable.\n\n    Configure the \\\"Login message\\\" to \\\"DOD User Agreement\\\".\n\n    Click the \\\"Consent checkbox\\\" slider to enable.\n\n    Set the \\\"Details of login message\\\" to the Standard Mandatory DOD Notice and Consent Banner text.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000068'\n  tag satisfies: ['SRG-APP-000069', 'SRG-APP-000070']\n  tag gid: 'V-VCSA-80-000024'\n  tag rid: 'SV-VCSA-80-000024'\n  tag stig_id: 'VCSA-80-000024'\n  tag cci: ['CCI-000048', 'CCI-000050', 'CCI-001384']\n  tag nist: ['AC-8 a', 'AC-8 b', 'AC-8 c 1']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000024.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.18e-05,"start_time":"2023-06-07T08:29:09-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000034","title":"The vCenter Server must produce audit records containing information to establish what type of events occurred.","desc":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.","descriptions":[{"label":"default","data":"Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify the \"config.log.level\" value is set to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.log.level and verify it is set to \"info\".\n\nIf the \"config.log.level\" value is not set to \"info\" or does not exist, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"config.log.level\" setting to \"info\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.log.level | Set-AdvancedSetting -Value info"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000095","gid":"V-VCSA-80-000034","rid":"SV-VCSA-80-000034","stig_id":"VCSA-80-000034","cci":["CCI-000130"],"nist":["AU-3"]},"code":"control 'VCSA-80-000034' do\n  title 'The vCenter Server must produce audit records containing information to establish what type of events occurred.'\n  desc  'Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify the \\\"config.log.level\\\" value is set to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.log.level and verify it is set to \\\"info\\\".\n\n    If the \\\"config.log.level\\\" value is not set to \\\"info\\\" or does not exist, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"config.log.level\\\" setting to \\\"info\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.log.level | Set-AdvancedSetting -Value info\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000095'\n  tag gid: 'V-VCSA-80-000034'\n  tag rid: 'SV-VCSA-80-000034'\n  tag stig_id: 'VCSA-80-000034'\n  tag cci: ['CCI-000130']\n  tag nist: ['AU-3']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.log.level | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'info' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000034.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.log.level | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"info\"","run_time":0.6675981,"start_time":"2023-06-07T08:29:09-06:00","resource_class":"powercli_command","resource_params":"[\"Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.log.level | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"VCSA-80-000057","title":"vCenter Server plugins must be verified.","desc":"The vCenter Server includes a vSphere Client extensibility framework, which provides the ability to extend the vSphere Client with menu selections or toolbar icons that provide access to vCenter Server add-on components or external, web-based functionality.\n\nvSphere Client plugins or extensions run at the same privilege level as the user. Malicious extensions might masquerade as useful add-ons while compromising the system by stealing credentials or incorrectly configuring the system.\n\nAdditionally, vCenter comes with a number of plugins preinstalled that may or may not be necessary for proper operation.","descriptions":[{"label":"default","data":"The vCenter Server includes a vSphere Client extensibility framework, which provides the ability to extend the vSphere Client with menu selections or toolbar icons that provide access to vCenter Server add-on components or external, web-based functionality.\n\nvSphere Client plugins or extensions run at the same privilege level as the user. Malicious extensions might masquerade as useful add-ons while compromising the system by stealing credentials or incorrectly configuring the system.\n\nAdditionally, vCenter comes with a number of plugins preinstalled that may or may not be necessary for proper operation."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins.\n\nView the Installed/Available Plug-ins list and verify they are all identified as authorized VMware, third-party (partner), and/or site-specific approved plug-ins.\n\nIf any installed/available plug-ins in the viewable list cannot be verified as allowed vSphere Client plug-ins from trusted sources or are not in active use, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins, click the radio button next to the unknown plug-in, and click \"Disable\".\n\nIf the plugin will not be needed in the future, proceed to uninstall the plug-in.\n\nTo uninstall plug-ins, do the following:\n\nIf vCenter Server is in linked mode, perform this procedure on the vCenter Server that is used to install the plug-in initially and then restart the vCenter Server services on the linked vCenter Server:\n\nIn a web browser, navigate to \"http://vCenter_Server_name_or_IP/mob\", where \"vCenter_Server_name_or_IP/mob\" is the name of the vCenter Server or its IP address.\n\nClick \"Content\".\n\nClick \"ExtensionManager\".\n\nSelect and copy the name of the plug-in to be removed from the list of values under \"Properties\".\n\nClick \"UnregisterExtension\". A new window appears.\n\nPaste the name of the plug-in and click \"Invoke Method\". This removes the plug-in.\n\nClose the window.\n\nRefresh the Managed Object Type:ManagedObjectReference:ExtensionManager window to verify the plug-in is removed successfully.\n\nNote: If the plug-in still appears, restart the vSphere Client.\n\nNote: The Managed Object Browser (MOB) may have to be enabled temporarily if it was disabled previously."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000141","gid":"V-VCSA-80-000057","rid":"SV-VCSA-80-000057","stig_id":"VCSA-80-000057","cci":["CCI-000381"],"nist":["CM-7 a"]},"code":"control 'VCSA-80-000057' do\n  title 'vCenter Server plugins must be verified.'\n  desc  \"\n    The vCenter Server includes a vSphere Client extensibility framework, which provides the ability to extend the vSphere Client with menu selections or toolbar icons that provide access to vCenter Server add-on components or external, web-based functionality.\n\n    vSphere Client plugins or extensions run at the same privilege level as the user. Malicious extensions might masquerade as useful add-ons while compromising the system by stealing credentials or incorrectly configuring the system.\n\n    Additionally, vCenter comes with a number of plugins preinstalled that may or may not be necessary for proper operation.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins.\n\n    View the Installed/Available Plug-ins list and verify they are all identified as authorized VMware, third-party (partner), and/or site-specific approved plug-ins.\n\n    If any installed/available plug-ins in the viewable list cannot be verified as allowed vSphere Client plug-ins from trusted sources or are not in active use, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Solutions >> Client Plug-Ins, click the radio button next to the unknown plug-in, and click \\\"Disable\\\".\n\n    If the plugin will not be needed in the future, proceed to uninstall the plug-in.\n\n    To uninstall plug-ins, do the following:\n\n    If vCenter Server is in linked mode, perform this procedure on the vCenter Server that is used to install the plug-in initially and then restart the vCenter Server services on the linked vCenter Server:\n\n    In a web browser, navigate to \\\"http://vCenter_Server_name_or_IP/mob\\\", where \\\"vCenter_Server_name_or_IP/mob\\\" is the name of the vCenter Server or its IP address.\n\n    Click \\\"Content\\\".\n\n    Click \\\"ExtensionManager\\\".\n\n    Select and copy the name of the plug-in to be removed from the list of values under \\\"Properties\\\".\n\n    Click \\\"UnregisterExtension\\\". A new window appears.\n\n    Paste the name of the plug-in and click \\\"Invoke Method\\\". This removes the plug-in.\n\n    Close the window.\n\n    Refresh the Managed Object Type:ManagedObjectReference:ExtensionManager window to verify the plug-in is removed successfully.\n\n    Note: If the plug-in still appears, restart the vSphere Client.\n\n    Note: The Managed Object Browser (MOB) may have to be enabled temporarily if it was disabled previously.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000141'\n  tag gid: 'V-VCSA-80-000057'\n  tag rid: 'SV-VCSA-80-000057'\n  tag stig_id: 'VCSA-80-000057'\n  tag cci: ['CCI-000381']\n  tag nist: ['CM-7 a']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000057.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":5.8e-06,"start_time":"2023-06-07T08:29:09-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000059","title":"The vCenter Server must uniquely identify and authenticate users or processes acting on behalf of users.","desc":"To ensure accountability and prevent unauthenticated access, organizational users must be identified and authenticated to prevent potential misuse and compromise of the system.\n\nOrganizational users include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors). Organizational users (and any processes acting on behalf of users) must be uniquely identified and authenticated for all accesses except the following.\n\n(i) Accesses explicitly identified and documented by the organization. Organizations document specific user actions that can be performed on the information system without identification or authentication; and\n(ii) Accesses that occur through authorized use of group authenticators without individual authentication. Organizations may require unique identification of individuals in group accounts (e.g., shared privilege accounts) or for detailed accountability of individual activity.\n\nUsing Active Directory or an identity provider for authentication provides more robust account management capabilities and accountability.","descriptions":[{"label":"default","data":"To ensure accountability and prevent unauthenticated access, organizational users must be identified and authenticated to prevent potential misuse and compromise of the system.\n\nOrganizational users include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors). Organizational users (and any processes acting on behalf of users) must be uniquely identified and authenticated for all accesses except the following.\n\n(i) Accesses explicitly identified and documented by the organization. Organizations document specific user actions that can be performed on the information system without identification or authentication; and\n(ii) Accesses that occur through authorized use of group authenticators without individual authentication. Organizations may require unique identification of individuals in group accounts (e.g., shared privilege accounts) or for detailed accountability of individual activity.\n\nUsing Active Directory or an identity provider for authentication provides more robust account management capabilities and accountability."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nIf the identity provider type is \"embedded\" and there is no identity source of type \"Active Directory\" (either Windows Integrated Authentication or LDAP), this is a finding.\n\nIf the identity provider type is \"Microsoft ADFS\" or another supported identity provider, this is NOT a finding."},{"label":"fix","data":"When using the embedded identity provider type, perform the following:\n\nFrom the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Identity Sources.\n\nClick \"Add\".\n\nSelect either \"Active Directory over LDAP\" or \"Active Directory (Windows Integrated Authentication)\" and configure appropriately.\n\nNote: Windows Integrated Authentication requires that the vCenter server be joined to Active Directory before configuration via Administration >> Single Sign On >> Configuration >> Identity Provider >> Active Directory Domain.\n\nOR\n\nTo change the identity provider type to a third-party identity provider such as Microsoft ADFS, perform the following:\n\nFrom the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nClick \"Change Identity Provider\".\n\nSelect \"Microsoft ADFS\" and click \"Next\".\n\nEnter the ADFS server information and User and Group details and click \"Finish\".\n\nFor additional information on configuring ADFS for use with vCenter, refer to the vSphere documentation."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000148","satisfies":["SRG-APP-000153","SRG-APP-000163","SRG-APP-000180","SRG-APP-000234"],"gid":"V-VCSA-80-000059","rid":"SV-VCSA-80-000059","stig_id":"VCSA-80-000059","cci":["CCI-000764","CCI-000770","CCI-000795","CCI-000804","CCI-001682"],"nist":["AC-2 (2)","IA-2","IA-2 (5)","IA-4 e","IA-8"]},"code":"control 'VCSA-80-000059' do\n  title 'The vCenter Server must uniquely identify and authenticate users or processes acting on behalf of users.'\n  desc  \"\n    To ensure accountability and prevent unauthenticated access, organizational users must be identified and authenticated to prevent potential misuse and compromise of the system.\n\n    Organizational users include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors). Organizational users (and any processes acting on behalf of users) must be uniquely identified and authenticated for all accesses except the following.\n\n    (i) Accesses explicitly identified and documented by the organization. Organizations document specific user actions that can be performed on the information system without identification or authentication; and\n    (ii) Accesses that occur through authorized use of group authenticators without individual authentication. Organizations may require unique identification of individuals in group accounts (e.g., shared privilege accounts) or for detailed accountability of individual activity.\n\n    Using Active Directory or an identity provider for authentication provides more robust account management capabilities and accountability.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    If the identity provider type is \\\"embedded\\\" and there is no identity source of type \\\"Active Directory\\\" (either Windows Integrated Authentication or LDAP), this is a finding.\n\n    If the identity provider type is \\\"Microsoft ADFS\\\" or another supported identity provider, this is NOT a finding.\n  \"\n  desc 'fix', \"\n    When using the embedded identity provider type, perform the following:\n\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Identity Sources.\n\n    Click \\\"Add\\\".\n\n    Select either \\\"Active Directory over LDAP\\\" or \\\"Active Directory (Windows Integrated Authentication)\\\" and configure appropriately.\n\n    Note: Windows Integrated Authentication requires that the vCenter server be joined to Active Directory before configuration via Administration >> Single Sign On >> Configuration >> Identity Provider >> Active Directory Domain.\n\n    OR\n\n    To change the identity provider type to a third-party identity provider such as Microsoft ADFS, perform the following:\n\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    Click \\\"Change Identity Provider\\\".\n\n    Select \\\"Microsoft ADFS\\\" and click \\\"Next\\\".\n\n    Enter the ADFS server information and User and Group details and click \\\"Finish\\\".\n\n    For additional information on configuring ADFS for use with vCenter, refer to the vSphere documentation.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000148'\n  tag satisfies: ['SRG-APP-000153', 'SRG-APP-000163', 'SRG-APP-000180', 'SRG-APP-000234']\n  tag gid: 'V-VCSA-80-000059'\n  tag rid: 'SV-VCSA-80-000059'\n  tag stig_id: 'VCSA-80-000059'\n  tag cci: ['CCI-000764', 'CCI-000770', 'CCI-000795', 'CCI-000804', 'CCI-001682']\n  tag nist: ['AC-2 (2)', 'IA-2', 'IA-2 (5)', 'IA-4 e', 'IA-8']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000059.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":3.9e-06,"start_time":"2023-06-07T08:29:09-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000060","title":"The vCenter Server must require multifactor authentication.","desc":"Without the use of multifactor authentication, the ease of access to privileged functions is greatly increased.\n\nMultifactor authentication requires using two or more factors to achieve authentication.\n\nFactors include:\n(i) something a user knows (e.g., password/PIN);\n(ii) something a user has (e.g., cryptographic identification device, token); or\n(iii) something a user is (e.g., biometric).","descriptions":[{"label":"default","data":"Without the use of multifactor authentication, the ease of access to privileged functions is greatly increased.\n\nMultifactor authentication requires using two or more factors to achieve authentication.\n\nFactors include:\n(i) something a user knows (e.g., password/PIN);\n(ii) something a user has (e.g., cryptographic identification device, token); or\n(iii) something a user is (e.g., biometric)."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nIf the embedded identity provider is used, click on \"Smart Card Authentication\".\n\nIf the embedded identity provider is used and \"Smart Card Authentication\" is not enabled, this is a finding.\n\nIf a third-party identity provider is used, such as Microsoft ADFS, and it does not require multifactor authentication to log on to vCenter, this is a finding."},{"label":"fix","data":"To configure smart card authentication for vCenter when using the embedded identity provider, refer to the vSphere documentation.\n\nFor vCenter Servers using a third-party identity provider, consult the product's documentation for enabling multifactor authentication."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000149","satisfies":["SRG-APP-000080","SRG-APP-000150","SRG-APP-000391","SRG-APP-000402"],"gid":"V-VCSA-80-000060","rid":"SV-VCSA-80-000060","stig_id":"VCSA-80-000060","cci":["CCI-000166","CCI-000765","CCI-000766","CCI-001953","CCI-002009"],"nist":["AU-10","IA-2 (1)","IA-2 (12)","IA-2 (2)","IA-8 (1)"]},"code":"control 'VCSA-80-000060' do\n  title 'The vCenter Server must require multifactor authentication.'\n  desc  \"\n    Without the use of multifactor authentication, the ease of access to privileged functions is greatly increased.\n\n    Multifactor authentication requires using two or more factors to achieve authentication.\n\n    Factors include:\n    (i) something a user knows (e.g., password/PIN);\n    (ii) something a user has (e.g., cryptographic identification device, token); or\n    (iii) something a user is (e.g., biometric).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    If the embedded identity provider is used, click on \\\"Smart Card Authentication\\\".\n\n    If the embedded identity provider is used and \\\"Smart Card Authentication\\\" is not enabled, this is a finding.\n\n    If a third-party identity provider is used, such as Microsoft ADFS, and it does not require multifactor authentication to log on to vCenter, this is a finding.\n  \"\n  desc 'fix', \"\n    To configure smart card authentication for vCenter when using the embedded identity provider, refer to the vSphere documentation.\n\n    For vCenter Servers using a third-party identity provider, consult the product's documentation for enabling multifactor authentication.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000149'\n  tag satisfies: ['SRG-APP-000080', 'SRG-APP-000150', 'SRG-APP-000391', 'SRG-APP-000402']\n  tag gid: 'V-VCSA-80-000060'\n  tag rid: 'SV-VCSA-80-000060'\n  tag stig_id: 'VCSA-80-000060'\n  tag cci: ['CCI-000166', 'CCI-000765', 'CCI-000766', 'CCI-001953', 'CCI-002009']\n  tag nist: ['AU-10', 'IA-2 (1)', 'IA-2 (12)', 'IA-2 (2)', 'IA-8 (1)']\n\n  if input('embeddedIdp')\n    command = '(Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled'\n    describe powercli_command(command) do\n      its('stdout.strip') { should cmp 'true' }\n    end\n  else\n    describe 'This check is a manual or policy based check and must be reviewed manually.' do\n      skip 'This check is a manual or policy based check and must be reviewed manually.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000060.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled stdout.strip is expected to cmp == \"true\"","run_time":0.1935403,"start_time":"2023-06-07T08:29:09-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled\"]","resource_id":""}]},{"id":"VCSA-80-000069","title":"The vCenter Server passwords must be at least 15 characters in length.","desc":"The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nPassword complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password. The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nUse of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password.","descriptions":[{"label":"default","data":"The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nPassword complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password. The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\nUse of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Minimum Length\" setting.\n\nMinimum Length: 15\n\nIf the password policy is not configured with a \"Minimum Length\" policy of \"15\" or more, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet the \"Minimum Length\" to \"15\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000164","gid":"V-VCSA-80-000069","rid":"SV-VCSA-80-000069","stig_id":"VCSA-80-000069","cci":["CCI-000205"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000069' do\n  title 'The vCenter Server passwords must be at least 15 characters in length.'\n  desc  \"\n    The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\n    Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password. The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.\n\n    Use of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Minimum Length\\\" setting.\n\n    Minimum Length: 15\n\n    If the password policy is not configured with a \\\"Minimum Length\\\" policy of \\\"15\\\" or more, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Minimum Length\\\" to \\\"15\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000164'\n  tag gid: 'V-VCSA-80-000069'\n  tag rid: 'SV-VCSA-80-000069'\n  tag stig_id: 'VCSA-80-000069'\n  tag cci: ['CCI-000205']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinLength'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 15 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000069.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoPasswordPolicy).MinLength stdout.strip is expected to cmp >= 15","run_time":0.2033722,"start_time":"2023-06-07T08:29:10-06:00","message":"\nexpected it to be >= 15\n     got: 8\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoPasswordPolicy).MinLength\"]","resource_id":""}]},{"id":"VCSA-80-000070","title":"The vCenter Server must prohibit password reuse for a minimum of five generations.","desc":"Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nTo meet password policy requirements, passwords must be changed at specific policy-based intervals.\n\nIf the information system or application allows the user to consecutively reuse their password when that password has exceeded its defined lifetime, the result is a password that is not changed per policy requirements.","descriptions":[{"label":"default","data":"Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nTo meet password policy requirements, passwords must be changed at specific policy-based intervals.\n\nIf the information system or application allows the user to consecutively reuse their password when that password has exceeded its defined lifetime, the result is a password that is not changed per policy requirements."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Restrict reuse\" setting.\n\nRestrict reuse: Users cannot reuse any previous 5 passwords\n\nIf the password policy is not configured with a \"Restrict reuse\" policy of \"5\" or more, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet the \"Restrict reuse\" to \"5\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000165","gid":"V-VCSA-80-000070","rid":"SV-VCSA-80-000070","stig_id":"VCSA-80-000070","cci":["CCI-000200"],"nist":["IA-5 (1) (e)"]},"code":"control 'VCSA-80-000070' do\n  title 'The vCenter Server must prohibit password reuse for a minimum of five generations.'\n  desc  \"\n    Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    To meet password policy requirements, passwords must be changed at specific policy-based intervals.\n\n    If the information system or application allows the user to consecutively reuse their password when that password has exceeded its defined lifetime, the result is a password that is not changed per policy requirements.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Restrict reuse\\\" setting.\n\n    Restrict reuse: Users cannot reuse any previous 5 passwords\n\n    If the password policy is not configured with a \\\"Restrict reuse\\\" policy of \\\"5\\\" or more, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Restrict reuse\\\" to \\\"5\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000165'\n  tag gid: 'V-VCSA-80-000070'\n  tag rid: 'SV-VCSA-80-000070'\n  tag stig_id: 'VCSA-80-000070'\n  tag cci: ['CCI-000200']\n  tag nist: ['IA-5 (1) (e)']\n\n  command = '(Get-SsoPasswordPolicy).ProhibitedPreviousPasswordsCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 5 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000070.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-SsoPasswordPolicy).ProhibitedPreviousPasswordsCount stdout.strip is expected to cmp >= 5","run_time":0.2031329,"start_time":"2023-06-07T08:29:10-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-SsoPasswordPolicy).ProhibitedPreviousPasswordsCount\"]","resource_id":""}]},{"id":"VCSA-80-000071","title":"The vCenter Server passwords must contain at least one uppercase character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password is, the greater the number of possible combinations that need to be tested before the password is compromised.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password is, the greater the number of possible combinations that need to be tested before the password is compromised."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 uppercase characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more uppercase characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"uppercase characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000166","gid":"V-VCSA-80-000071","rid":"SV-VCSA-80-000071","stig_id":"VCSA-80-000071","cci":["CCI-000192"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000071' do\n  title 'The vCenter Server passwords must contain at least one uppercase character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password is, the greater the number of possible combinations that need to be tested before the password is compromised.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 uppercase characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more uppercase characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"uppercase characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000166'\n  tag gid: 'V-VCSA-80-000071'\n  tag rid: 'SV-VCSA-80-000071'\n  tag stig_id: 'VCSA-80-000071'\n  tag cci: ['CCI-000192']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinUppercaseCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000071.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-SsoPasswordPolicy).MinUppercaseCount stdout.strip is expected to cmp >= 1","run_time":0.2463944,"start_time":"2023-06-07T08:29:10-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-SsoPasswordPolicy).MinUppercaseCount\"]","resource_id":""}]},{"id":"VCSA-80-000072","title":"The vCenter Server passwords must contain at least one lowercase character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 lowercase characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more lowercase characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"lowercase characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000167","gid":"V-VCSA-80-000072","rid":"SV-VCSA-80-000072","stig_id":"VCSA-80-000072","cci":["CCI-000193"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000072' do\n  title 'The vCenter Server passwords must contain at least one lowercase character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 lowercase characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more lowercase characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"lowercase characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000167'\n  tag gid: 'V-VCSA-80-000072'\n  tag rid: 'SV-VCSA-80-000072'\n  tag stig_id: 'VCSA-80-000072'\n  tag cci: ['CCI-000193']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinLowercaseCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000072.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-SsoPasswordPolicy).MinLowercaseCount stdout.strip is expected to cmp >= 1","run_time":0.2471527,"start_time":"2023-06-07T08:29:10-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-SsoPasswordPolicy).MinLowercaseCount\"]","resource_id":""}]},{"id":"VCSA-80-000073","title":"The vCenter Server passwords must contain at least one numeric character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 numeric characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more numeric characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"numeric characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000168","gid":"V-VCSA-80-000073","rid":"SV-VCSA-80-000073","stig_id":"VCSA-80-000073","cci":["CCI-000194"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000073' do\n  title 'The vCenter Server passwords must contain at least one numeric character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 numeric characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more numeric characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"numeric characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000168'\n  tag gid: 'V-VCSA-80-000073'\n  tag rid: 'SV-VCSA-80-000073'\n  tag stig_id: 'VCSA-80-000073'\n  tag cci: ['CCI-000194']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinNumericCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000073.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-SsoPasswordPolicy).MinNumericCount stdout.strip is expected to cmp >= 1","run_time":0.190235,"start_time":"2023-06-07T08:29:10-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-SsoPasswordPolicy).MinNumericCount\"]","resource_id":""}]},{"id":"VCSA-80-000074","title":"The vCenter Server passwords must contain at least one special character.","desc":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor in determining how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n\nSpecial characters are not alphanumeric. Examples include: ~ ! @ # $ % ^ *.","descriptions":[{"label":"default","data":"Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\nPassword complexity is one factor in determining how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n\nSpecial characters are not alphanumeric. Examples include: ~ ! @ # $ % ^ *."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Character requirements\" setting.\n\nCharacter requirements: At least 1 special characters\n\nIf the password policy is not configured with \"Character requirements\" policy requiring \"1\" or more special characters, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"special characters\" to at least \"1\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000169","gid":"V-VCSA-80-000074","rid":"SV-VCSA-80-000074","stig_id":"VCSA-80-000074","cci":["CCI-001619"],"nist":["IA-5 (1) (a)"]},"code":"control 'VCSA-80-000074' do\n  title 'The vCenter Server passwords must contain at least one special character.'\n  desc  \"\n    Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.\n\n    Password complexity is one factor in determining how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.\n\n    Special characters are not alphanumeric. Examples include: ~ ! @ # $ % ^ *.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Character requirements\\\" setting.\n\n    Character requirements: At least 1 special characters\n\n    If the password policy is not configured with \\\"Character requirements\\\" policy requiring \\\"1\\\" or more special characters, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"special characters\\\" to at least \\\"1\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000169'\n  tag gid: 'V-VCSA-80-000074'\n  tag rid: 'SV-VCSA-80-000074'\n  tag stig_id: 'VCSA-80-000074'\n  tag cci: ['CCI-001619']\n  tag nist: ['IA-5 (1) (a)']\n\n  command = '(Get-SsoPasswordPolicy).MinSpecialCharCount'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 1 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000074.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-SsoPasswordPolicy).MinSpecialCharCount stdout.strip is expected to cmp >= 1","run_time":0.2155519,"start_time":"2023-06-07T08:29:11-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-SsoPasswordPolicy).MinSpecialCharCount\"]","resource_id":""}]},{"id":"VCSA-80-000077","title":"The vCenter Server must enable FIPS-validated cryptography.","desc":"FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules use authentication that meets DOD requirements.\n\nIn vSphere 6.7 and later, ESXi and vCenter Server use FIPS-validated cryptography to protect management interfaces and the VMware Certificate Authority (VMCA).\n\nvSphere 7.0 Update 2 and later adds additional FIPS-validated cryptography to vCenter Server Appliance. By default, this FIPS validation option is disabled and must be enabled.","descriptions":[{"label":"default","data":"FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules use authentication that meets DOD requirements.\n\nIn vSphere 6.7 and later, ESXi and vCenter Server use FIPS-validated cryptography to protect management interfaces and the VMware Certificate Authority (VMCA).\n\nvSphere 7.0 Update 2 and later adds additional FIPS-validated cryptography to vCenter Server Appliance. By default, this FIPS validation option is disabled and must be enabled."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Web Client, go to Developer Center >> API Explorer.\n\nFrom the \"Select API\" drop-down menu, select appliance.\n\nExpand system/security/global_fips >> GET.\n\nClick \"Execute\" and then \"Copy Response\" to view the results.\n\nExample response:\n\n{\n    \"enabled\": true\n}\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nInvoke-GetSystemGlobalFips\n\nIf global FIPS mode is not enabled, this is a finding."},{"label":"fix","data":"From the vSphere Web Client go to Developer Center >> API Explorer.\n\nFrom the \"Select API\" drop-down menu, select appliance.\n\nExpand system/security/global_fips >> PUT.\n\nIn the response body under \"Try it out\" paste the following:\n\n{\n    \"enabled\": true\n}\n\nClick \"Execute\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n$spec = Initialize-SystemSecurityGlobalFipsUpdateSpec -Enabled $true; Invoke-SetSystemGlobalFips -SystemSecurityGlobalFipsUpdateSpec $spec\n\nNote: The vCenter server reboots after FIPS is enabled or disabled."}],"impact":0.7,"refs":[],"tags":{"severity":"high","gtitle":"SRG-APP-000172","satisfies":["SRG-APP-000179","SRG-APP-000224","SRG-APP-000231","SRG-APP-000412","SRG-APP-000514","SRG-APP-000555","SRG-APP-000600","SRG-APP-000610","SRG-APP-000620","SRG-APP-000630","SRG-APP-000635"],"gid":"V-VCSA-80-000077","rid":"SV-VCSA-80-000077","stig_id":"VCSA-80-000077","cci":["CCI-000197","CCI-000803","CCI-001188","CCI-001199","CCI-001967","CCI-002450","CCI-003123"],"nist":["IA-3 (1)","IA-5 (1) (c)","IA-7","MA-4 (6)","SC-13","SC-23 (3)","SC-28"]},"code":"control 'VCSA-80-000077' do\n  title 'The vCenter Server must enable FIPS-validated cryptography.'\n  desc  \"\n    FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules use authentication that meets DOD requirements.\n\n    In vSphere 6.7 and later, ESXi and vCenter Server use FIPS-validated cryptography to protect management interfaces and the VMware Certificate Authority (VMCA).\n\n    vSphere 7.0 Update 2 and later adds additional FIPS-validated cryptography to vCenter Server Appliance. By default, this FIPS validation option is disabled and must be enabled.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Web Client, go to Developer Center >> API Explorer.\n\n    From the \\\"Select API\\\" drop-down menu, select appliance.\n\n    Expand system/security/global_fips >> GET.\n\n    Click \\\"Execute\\\" and then \\\"Copy Response\\\" to view the results.\n\n    Example response:\n\n    {\n        \\\"enabled\\\": true\n    }\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Invoke-GetSystemGlobalFips\n\n    If global FIPS mode is not enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Web Client go to Developer Center >> API Explorer.\n\n    From the \\\"Select API\\\" drop-down menu, select appliance.\n\n    Expand system/security/global_fips >> PUT.\n\n    In the response body under \\\"Try it out\\\" paste the following:\n\n    {\n        \\\"enabled\\\": true\n    }\n\n    Click \\\"Execute\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    $spec = Initialize-SystemSecurityGlobalFipsUpdateSpec -Enabled $true; Invoke-SetSystemGlobalFips -SystemSecurityGlobalFipsUpdateSpec $spec\n\n    Note: The vCenter server reboots after FIPS is enabled or disabled.\n  \"\n  impact 0.7\n  tag severity: 'high'\n  tag gtitle: 'SRG-APP-000172'\n  tag satisfies: ['SRG-APP-000179', 'SRG-APP-000224', 'SRG-APP-000231', 'SRG-APP-000412', 'SRG-APP-000514', 'SRG-APP-000555', 'SRG-APP-000600', 'SRG-APP-000610', 'SRG-APP-000620', 'SRG-APP-000630', 'SRG-APP-000635']\n  tag gid: 'V-VCSA-80-000077'\n  tag rid: 'SV-VCSA-80-000077'\n  tag stig_id: 'VCSA-80-000077'\n  tag cci: ['CCI-000197', 'CCI-000803', 'CCI-001188', 'CCI-001199', 'CCI-001967', 'CCI-002450', 'CCI-003123']\n  tag nist: ['IA-3 (1)', 'IA-5 (1) (c)', 'IA-7', 'MA-4 (6)', 'SC-13', 'SC-23 (3)', 'SC-28']\n\n  command = 'Invoke-GetSystemGlobalFips | Select-Object -ExpandProperty enabled'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'True' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000077.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Invoke-GetSystemGlobalFips | Select-Object -ExpandProperty enabled stdout.strip is expected to cmp == \"True\"","run_time":0.3184635,"start_time":"2023-06-07T08:29:11-06:00","message":"\nexpected: True\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Invoke-GetSystemGlobalFips | Select-Object -ExpandProperty enabled\"]","resource_id":""}]},{"id":"VCSA-80-000079","title":"The vCenter Server must enforce a 90-day maximum password lifetime restriction.","desc":"Any password, no matter how complex, can eventually be cracked. Therefore, passwords must be changed at specific intervals.\n\nOne method of minimizing this risk is to use complex passwords and periodically change them. If the application does not limit the lifetime of passwords and force users to change their passwords, there is the risk that the system and/or application passwords could be compromised.\n\nThis requirement does not include emergency administration accounts, which are meant for access to the application in case of failure. These accounts are not required to have maximum password lifetime restrictions.","descriptions":[{"label":"default","data":"Any password, no matter how complex, can eventually be cracked. Therefore, passwords must be changed at specific intervals.\n\nOne method of minimizing this risk is to use complex passwords and periodically change them. If the application does not limit the lifetime of passwords and force users to change their passwords, there is the risk that the system and/or application passwords could be compromised.\n\nThis requirement does not include emergency administration accounts, which are meant for access to the application in case of failure. These accounts are not required to have maximum password lifetime restrictions."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nView the value of the \"Maximum lifetime\" setting.\n\nMaximum lifetime: Password must be changed every 90 days\n\nIf the password policy is not configured with \"Maximum lifetime\" policy of \"90\" or less, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\nClick \"Edit\".\n\nSet \"Maximum lifetime\" to \"90\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000174","gid":"V-VCSA-80-000079","rid":"SV-VCSA-80-000079","stig_id":"VCSA-80-000079","cci":["CCI-000199"],"nist":["IA-5 (1) (d)"]},"code":"control 'VCSA-80-000079' do\n  title 'The vCenter Server must enforce a 90-day maximum password lifetime restriction.'\n  desc  \"\n    Any password, no matter how complex, can eventually be cracked. Therefore, passwords must be changed at specific intervals.\n\n    One method of minimizing this risk is to use complex passwords and periodically change them. If the application does not limit the lifetime of passwords and force users to change their passwords, there is the risk that the system and/or application passwords could be compromised.\n\n    This requirement does not include emergency administration accounts, which are meant for access to the application in case of failure. These accounts are not required to have maximum password lifetime restrictions.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    View the value of the \\\"Maximum lifetime\\\" setting.\n\n    Maximum lifetime: Password must be changed every 90 days\n\n    If the password policy is not configured with \\\"Maximum lifetime\\\" policy of \\\"90\\\" or less, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Password Policy.\n\n    Click \\\"Edit\\\".\n\n    Set \\\"Maximum lifetime\\\" to \\\"90\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000174'\n  tag gid: 'V-VCSA-80-000079'\n  tag rid: 'SV-VCSA-80-000079'\n  tag stig_id: 'VCSA-80-000079'\n  tag cci: ['CCI-000199']\n  tag nist: ['IA-5 (1) (d)']\n\n  command = '(Get-SsoPasswordPolicy).PasswordLifetimeDays'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp <= 90 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000079.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-SsoPasswordPolicy).PasswordLifetimeDays stdout.strip is expected to cmp <= 90","run_time":0.1746309,"start_time":"2023-06-07T08:29:11-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-SsoPasswordPolicy).PasswordLifetimeDays\"]","resource_id":""}]},{"id":"VCSA-80-000080","title":"The vCenter Server must enable revocation checking for certificate-based authentication.","desc":"The system must establish the validity of the user-supplied identity certificate using Online Certificate Status Protocol (OCSP) and/or Certificate Revocation List (CRL) revocation checking.","descriptions":[{"label":"default","data":"The system must establish the validity of the user-supplied identity certificate using Online Certificate Status Protocol (OCSP) and/or Certificate Revocation List (CRL) revocation checking."},{"label":"rationale","data":""},{"label":"check","data":"If a federated identity provider is configured and used for an identity source and supports Smartcard authentication, this is not applicable.\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nUnder Smart card authentication settings >> Certificate revocation, verify \"Revocation check\" does not show as disabled.\n\nIf \"Revocation check\" shows as disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nUnder Smart card authentication settings >> Certificate revocation, click the \"Edit\" button.\n\nConfigure revocation checking per site requirements. OCSP with CRL failover is recommended.\n\nBy default, both locations are pulled from the cert. CRL location can be overridden in this screen, and local responders can be specified via the sso-config command line tool. See the vSphere documentation for more information."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000175","satisfies":["SRG-APP-000392","SRG-APP-000401","SRG-APP-000403"],"gid":"V-VCSA-80-000080","rid":"SV-VCSA-80-000080","stig_id":"VCSA-80-000080","cci":["CCI-000185","CCI-001954","CCI-001991","CCI-002010"],"nist":["IA-2 (12)","IA-5 (2) (a)","IA-5 (2) (d)","IA-8 (1)"]},"code":"control 'VCSA-80-000080' do\n  title 'The vCenter Server must enable revocation checking for certificate-based authentication.'\n  desc  'The system must establish the validity of the user-supplied identity certificate using Online Certificate Status Protocol (OCSP) and/or Certificate Revocation List (CRL) revocation checking.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If a federated identity provider is configured and used for an identity source and supports Smartcard authentication, this is not applicable.\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Under Smart card authentication settings >> Certificate revocation, verify \\\"Revocation check\\\" does not show as disabled.\n\n    If \\\"Revocation check\\\" shows as disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Under Smart card authentication settings >> Certificate revocation, click the \\\"Edit\\\" button.\n\n    Configure revocation checking per site requirements. OCSP with CRL failover is recommended.\n\n    By default, both locations are pulled from the cert. CRL location can be overridden in this screen, and local responders can be specified via the sso-config command line tool. See the vSphere documentation for more information.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000175'\n  tag satisfies: ['SRG-APP-000392', 'SRG-APP-000401', 'SRG-APP-000403']\n  tag gid: 'V-VCSA-80-000080'\n  tag rid: 'SV-VCSA-80-000080'\n  tag stig_id: 'VCSA-80-000080'\n  tag cci: ['CCI-000185', 'CCI-001954', 'CCI-001991', 'CCI-002010']\n  tag nist: ['IA-2 (12)', 'IA-5 (2) (a)', 'IA-5 (2) (d)', 'IA-8 (1)']\n\n  if input('embeddedIdp')\n    describe.one do\n      describe powercli_command('(Get-SsoAuthenticationPolicy).OCSPEnabled') do\n        its('stdout.strip') { should cmp 'true' }\n      end\n      describe powercli_command('(Get-SsoAuthenticationPolicy).UseInCertCRL') do\n        its('stdout.strip') { should cmp 'true' }\n      end\n      describe powercli_command('(Get-SsoAuthenticationPolicy).CRLUrl') do\n        its('stdout.strip') { should_not cmp '' }\n      end\n    end\n  else\n    describe 'This check is a manual or policy based check and must be reviewed manually.' do\n      skip 'This check is a manual or policy based check and must be reviewed manually.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000080.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-SsoAuthenticationPolicy).UseInCertCRL stdout.strip is expected to cmp == \"true\"","run_time":0.000273,"start_time":"2023-06-07T08:29:11-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-SsoAuthenticationPolicy).UseInCertCRL\"]","resource_id":""}]},{"id":"VCSA-80-000089","title":"The vCenter Server must terminate vSphere Client sessions after 15 minutes of inactivity.","desc":"Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free resources committed by the managed network element.","descriptions":[{"label":"default","data":"Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free resources committed by the managed network element."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\nView the value of the \"Session timeout\" setting.\n\nIf the \"Session timeout\" is not set to \"15 minute(s)\" or less this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\nClick \"Edit\" and enter \"15\" minutes into the \"Session timeout\" setting. Click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000190","satisfies":["SRG-APP-000295","SRG-APP-000389"],"gid":"V-VCSA-80-000089","rid":"SV-VCSA-80-000089","stig_id":"VCSA-80-000089","cci":["CCI-001133","CCI-002038","CCI-002361"],"nist":["AC-12","IA-11","SC-10"]},"code":"control 'VCSA-80-000089' do\n  title 'The vCenter Server must terminate vSphere Client sessions after 15 minutes of inactivity.'\n  desc  'Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free resources committed by the managed network element.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\n    View the value of the \\\"Session timeout\\\" setting.\n\n    If the \\\"Session timeout\\\" is not set to \\\"15 minute(s)\\\" or less this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Deployment >> Client Configuration.\n\n    Click \\\"Edit\\\" and enter \\\"15\\\" minutes into the \\\"Session timeout\\\" setting. Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000190'\n  tag satisfies: ['SRG-APP-000295', 'SRG-APP-000389']\n  tag gid: 'V-VCSA-80-000089'\n  tag rid: 'SV-VCSA-80-000089'\n  tag stig_id: 'VCSA-80-000089'\n  tag cci: ['CCI-001133', 'CCI-002038', 'CCI-002361']\n  tag nist: ['AC-12', 'IA-11', 'SC-10']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000089.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":7.1e-06,"start_time":"2023-06-07T08:29:11-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000095","title":"The vCenter Server user roles must be verified.","desc":"Users and service accounts must only be assigned privileges they require. Least privilege requires that these privileges must only be assigned if needed to reduce risk of confidentiality, availability, or integrity loss.","descriptions":[{"label":"default","data":"Users and service accounts must only be assigned privileges they require. Least privilege requires that these privileges must only be assigned if needed to reduce risk of confidentiality, availability, or integrity loss."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nView each role and verify the users and/or groups assigned to it by clicking on \"Usage\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\nApplication service account and user required privileges should be documented.\n\nIf any user or service account has more privileges than required, this is a finding."},{"label":"fix","data":"To update a user's or group's permissions to an existing role with reduced permissions, do the following:\n\nFrom the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\nSelect the user or group, click the pencil button, change the assigned role, and click \"OK\".\n\nNote: If permissions are assigned on a specific object, the role must be updated where it is assigned (for example, at the cluster level).\n\nTo create a new role with reduced permissions, do the following:\n\nFrom the vSphere Client, go to Administration >> Access Control >> Roles.\n\nClick the green plus sign and enter a name for the role and select only the specific permissions required.\n\nUsers can then be assigned to the newly created role."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000211","satisfies":["SRG-APP-000233","SRG-APP-000380"],"gid":"V-VCSA-80-000095","rid":"SV-VCSA-80-000095","stig_id":"VCSA-80-000095","cci":["CCI-001082","CCI-001084","CCI-001813"],"nist":["CM-5 (1)","SC-2","SC-3"]},"code":"control 'VCSA-80-000095' do\n  title 'The vCenter Server user roles must be verified.'\n  desc  'Users and service accounts must only be assigned privileges they require. Least privilege requires that these privileges must only be assigned if needed to reduce risk of confidentiality, availability, or integrity loss.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    View each role and verify the users and/or groups assigned to it by clicking on \\\"Usage\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\n    Application service account and user required privileges should be documented.\n\n    If any user or service account has more privileges than required, this is a finding.\n  \"\n  desc 'fix', \"\n    To update a user's or group's permissions to an existing role with reduced permissions, do the following:\n\n    From the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\n    Select the user or group, click the pencil button, change the assigned role, and click \\\"OK\\\".\n\n    Note: If permissions are assigned on a specific object, the role must be updated where it is assigned (for example, at the cluster level).\n\n    To create a new role with reduced permissions, do the following:\n\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Click the green plus sign and enter a name for the role and select only the specific permissions required.\n\n    Users can then be assigned to the newly created role.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000211'\n  tag satisfies: ['SRG-APP-000233', 'SRG-APP-000380']\n  tag gid: 'V-VCSA-80-000095'\n  tag rid: 'SV-VCSA-80-000095'\n  tag stig_id: 'VCSA-80-000095'\n  tag cci: ['CCI-001082', 'CCI-001084', 'CCI-001813']\n  tag nist: ['CM-5 (1)', 'SC-2', 'SC-3']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000095.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":5.0e-06,"start_time":"2023-06-07T08:29:11-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000110","title":"The vCenter Server must manage excess capacity, bandwidth, or other redundancy to limit the effects of information flooding types of denial-of-service (DoS) attacks by enabling Network I/O Control (NIOC).","desc":"DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.\n\nManaging excess capacity ensures sufficient capacity is available to counter flooding attacks. Employing increased capacity and service redundancy may reduce the susceptibility to some DoS attacks. Managing excess capacity may include, for example, establishing selected usage priorities, quotas, or partitioning.","descriptions":[{"label":"default","data":"DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.\n\nManaging excess capacity ensures sufficient capacity is available to counter flooding attacks. Employing increased capacity and service redundancy may reduce the susceptibility to some DoS attacks. Managing excess capacity may include, for example, establishing selected usage priorities, quotas, or partitioning."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nView the \"Properties\" pane and verify \"Network I/O Control\" is \"Enabled\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | select Name,@{N=\"NIOC Enabled\";E={$_.ExtensionData.config.NetworkResourceManagementEnabled}}\n\nIf \"Network I/O Control\" is disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Networking.\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nIn the \"Properties\" pane, click \"Edit\". Change \"Network I/O Control\" to \"Enabled\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n(Get-VDSwitch \"VDSwitch Name\" | Get-View).EnableNetworkResourceManagement($true)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000247","gid":"V-VCSA-80-000110","rid":"SV-VCSA-80-000110","stig_id":"VCSA-80-000110","cci":["CCI-001095"],"nist":["SC-5 (2)"]},"code":"control 'VCSA-80-000110' do\n  title 'The vCenter Server must manage excess capacity, bandwidth, or other redundancy to limit the effects of information flooding types of denial-of-service (DoS) attacks by enabling Network I/O Control (NIOC).'\n  desc  \"\n    DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.\n\n    Managing excess capacity ensures sufficient capacity is available to counter flooding attacks. Employing increased capacity and service redundancy may reduce the susceptibility to some DoS attacks. Managing excess capacity may include, for example, establishing selected usage priorities, quotas, or partitioning.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    View the \\\"Properties\\\" pane and verify \\\"Network I/O Control\\\" is \\\"Enabled\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | select Name,@{N=\\\"NIOC Enabled\\\";E={$_.ExtensionData.config.NetworkResourceManagementEnabled}}\n\n    If \\\"Network I/O Control\\\" is disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Networking.\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    In the \\\"Properties\\\" pane, click \\\"Edit\\\". Change \\\"Network I/O Control\\\" to \\\"Enabled\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    (Get-VDSwitch \\\"VDSwitch Name\\\" | Get-View).EnableNetworkResourceManagement($true)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000247'\n  tag gid: 'V-VCSA-80-000110'\n  tag rid: 'SV-VCSA-80-000110'\n  tag stig_id: 'VCSA-80-000110'\n  tag cci: ['CCI-001095']\n  tag nist: ['SC-5 (2)']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.NetworkResourceManagementEnabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000110.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 1\").ExtensionData.Config.NetworkResourceManagementEnabled stdout.strip is expected to cmp == \"true\"","run_time":0.5353332,"start_time":"2023-06-07T08:29:11-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 1\\\").ExtensionData.Config.NetworkResourceManagementEnabled\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 2\").ExtensionData.Config.NetworkResourceManagementEnabled stdout.strip is expected to cmp == \"true\"","run_time":0.2552794,"start_time":"2023-06-07T08:29:12-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 2\\\").ExtensionData.Config.NetworkResourceManagementEnabled\"]","resource_id":""}]},{"id":"VCSA-80-000123","title":"The vCenter Server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, on every Single Sign-On (SSO) account action.","desc":"Once an attacker establishes initial access to a system, they often attempt to create a persistent method of reestablishing access. One way to accomplish this is for the attacker to create a new account. They may also try to hijack an existing account by changing a password or enabling a previously disabled account. Therefore, all actions performed on accounts in the SSO domain much be alerted on in vCenter at a minimum and ideally on a Security Information and Event Management (SIEM) system as well.\n\nTo ensure the appropriate personnel are alerted about SSO account actions, create a new vCenter alarm for the \"com.vmware.sso.PrincipalManagement\" event ID and configure the alert mechanisms appropriately.","descriptions":[{"label":"default","data":"Once an attacker establishes initial access to a system, they often attempt to create a persistent method of reestablishing access. One way to accomplish this is for the attacker to create a new account. They may also try to hijack an existing account by changing a password or enabling a previously disabled account. Therefore, all actions performed on accounts in the SSO domain much be alerted on in vCenter at a minimum and ideally on a Security Information and Event Management (SIEM) system as well.\n\nTo ensure the appropriate personnel are alerted about SSO account actions, create a new vCenter alarm for the \"com.vmware.sso.PrincipalManagement\" event ID and configure the alert mechanisms appropriately."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\nVerify there is an alarm created to alert upon all SSO account actions.\n\nThe alarm name may vary, but it is suggested to name it \"SSO account actions - com.vmware.sso.PrincipalManagement\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AlarmDefinition | Where {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \"com.vmware.sso.PrincipalManagement\"} | Select Name,Enabled,@{N=\"EventTypeId\";E={$_.ExtensionData.Info.Expression.Expression.EventTypeId}}\n\nIf an alarm is not created to alert on SSO account actions, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\nClick \"Add\".\n\nProvide the alarm name of \"SSO account actions - com.vmware.sso.PrincipalManagement\" and an optional description.\n\nFrom the \"Target type\" dropdown menu, select \"vCenter Server\".\n\nClick \"Next\".\n\nPaste \"com.vmware.sso.PrincipalManagement\" (without quotes) in the line after \"IF\" and press \"Enter\".\n\nNext to \"Trigger the alarm and\", select \"Show as Warning\".\n\nConfigure the desired notification actions that will inform the SA and ISSO of the event.\n\nClick \"Next\". Click \"Next\" again. Click \"Create\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000291","satisfies":["SRG-APP-000292","SRG-APP-000293","SRG-APP-000294","SRG-APP-000320"],"gid":"V-VCSA-80-000123","rid":"SV-VCSA-80-000123","stig_id":"VCSA-80-000123","cci":["CCI-001683","CCI-001684","CCI-001685","CCI-001686","CCI-002132"],"nist":["AC-2 (4)"]},"code":"control 'VCSA-80-000123' do\n  title 'The vCenter Server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, on every Single Sign-On (SSO) account action.'\n  desc  \"\n    Once an attacker establishes initial access to a system, they often attempt to create a persistent method of reestablishing access. One way to accomplish this is for the attacker to create a new account. They may also try to hijack an existing account by changing a password or enabling a previously disabled account. Therefore, all actions performed on accounts in the SSO domain much be alerted on in vCenter at a minimum and ideally on a Security Information and Event Management (SIEM) system as well.\n\n    To ensure the appropriate personnel are alerted about SSO account actions, create a new vCenter alarm for the \\\"com.vmware.sso.PrincipalManagement\\\" event ID and configure the alert mechanisms appropriately.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\n    Verify there is an alarm created to alert upon all SSO account actions.\n\n    The alarm name may vary, but it is suggested to name it \\\"SSO account actions - com.vmware.sso.PrincipalManagement\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AlarmDefinition | Where {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \\\"com.vmware.sso.PrincipalManagement\\\"} | Select Name,Enabled,@{N=\\\"EventTypeId\\\";E={$_.ExtensionData.Info.Expression.Expression.EventTypeId}}\n\n    If an alarm is not created to alert on SSO account actions, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Security >> Alarm Definitions.\n\n    Click \\\"Add\\\".\n\n    Provide the alarm name of \\\"SSO account actions - com.vmware.sso.PrincipalManagement\\\" and an optional description.\n\n    From the \\\"Target type\\\" dropdown menu, select \\\"vCenter Server\\\".\n\n    Click \\\"Next\\\".\n\n    Paste \\\"com.vmware.sso.PrincipalManagement\\\" (without quotes) in the line after \\\"IF\\\" and press \\\"Enter\\\".\n\n    Next to \\\"Trigger the alarm and\\\", select \\\"Show as Warning\\\".\n\n    Configure the desired notification actions that will inform the SA and ISSO of the event.\n\n    Click \\\"Next\\\". Click \\\"Next\\\" again. Click \\\"Create\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000291'\n  tag satisfies: ['SRG-APP-000292', 'SRG-APP-000293', 'SRG-APP-000294', 'SRG-APP-000320']\n  tag gid: 'V-VCSA-80-000123'\n  tag rid: 'SV-VCSA-80-000123'\n  tag stig_id: 'VCSA-80-000123'\n  tag cci: ['CCI-001683', 'CCI-001684', 'CCI-001685', 'CCI-001686', 'CCI-002132']\n  tag nist: ['AC-2 (4)']\n\n  command = 'Get-AlarmDefinition | Where-Object {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \"com.vmware.sso.PrincipalManagement\"} | Select-Object -ExpandProperty Enabled'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'true' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000123.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-AlarmDefinition | Where-Object {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \"com.vmware.sso.PrincipalManagement\"} | Select-Object -ExpandProperty Enabled stdout.strip is expected to cmp == \"true\"","run_time":0.9179929,"start_time":"2023-06-07T08:29:12-06:00","message":"\nexpected: true\n     got: \n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-AlarmDefinition | Where-Object {$_.ExtensionData.Info.Expression.Expression.EventTypeId -eq \\\"com.vmware.sso.PrincipalManagement\\\"} | Select-Object -ExpandProperty Enabled\"]","resource_id":""}]},{"id":"VCSA-80-000145","title":"The vCenter Server must set the interval for counting failed login attempts to at least 15 minutes.","desc":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account.","descriptions":[{"label":"default","data":"By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nView the value of the \"Time interval between failures\" setting.\n\nTime interval between failures: 900 seconds\n\nIf the lockout policy is not configured with \"Time interval between failures\" policy of \"900\" or more, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nClick \"Edit\".\n\nSet the \"Time interval between failures\" to \"900\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000345","gid":"V-VCSA-80-000145","rid":"SV-VCSA-80-000145","stig_id":"VCSA-80-000145","cci":["CCI-002238"],"nist":["AC-7 b"]},"code":"control 'VCSA-80-000145' do\n  title 'The vCenter Server must set the interval for counting failed login attempts to at least 15 minutes.'\n  desc  'By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    View the value of the \\\"Time interval between failures\\\" setting.\n\n    Time interval between failures: 900 seconds\n\n    If the lockout policy is not configured with \\\"Time interval between failures\\\" policy of \\\"900\\\" or more, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Time interval between failures\\\" to \\\"900\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000345'\n  tag gid: 'V-VCSA-80-000145'\n  tag rid: 'SV-VCSA-80-000145'\n  tag stig_id: 'VCSA-80-000145'\n  tag cci: ['CCI-002238']\n  tag nist: ['AC-7 b']\n\n  command = '(Get-SsoLockoutPolicy).FailedAttemptIntervalSec'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= 900 }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000145.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoLockoutPolicy).FailedAttemptIntervalSec stdout.strip is expected to cmp >= 900","run_time":0.2629529,"start_time":"2023-06-07T08:29:13-06:00","message":"\nexpected it to be >= 900\n     got: 180\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoLockoutPolicy).FailedAttemptIntervalSec\"]","resource_id":""}]},{"id":"VCSA-80-000148","title":"The vCenter Server must be configured to send logs to a central log server.","desc":"vCenter must be configured to send near real-time log data to syslog collectors so information will be available to investigators in the case of a security incident or to assist in troubleshooting.","descriptions":[{"label":"default","data":"vCenter must be configured to send near real-time log data to syslog collectors so information will be available to investigators in the case of a security incident or to assist in troubleshooting."},{"label":"rationale","data":""},{"label":"check","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Syslog\" on the left navigation pane.\n\nOn the resulting pane on the right, verify at least one site-specific syslog receiver is configured and is listed as \"Reachable\".\n\nIf no valid syslog collector is configured or if the collector is not listed as \"Reachable\", this is a finding."},{"label":"fix","data":"Open the VAMI by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with an SSO account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Syslog\" on the left navigation pane.\n\nOn the resulting pane on the right, click \"Edit\" or \"Configure\".\n\nEdit or add the address and port of a site-specific syslog aggregator or Security Information Event Management (SIEM) system with the appropriate protocol.\n\nUser Datagram Protocol (UDP) is discouraged due to its stateless and unencrypted nature. Transport Layer Security (TLS) is preferred.\n\nClick \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000358","gid":"V-VCSA-80-000148","rid":"SV-VCSA-80-000148","stig_id":"VCSA-80-000148","cci":["CCI-001851"],"nist":["AU-4 (1)"]},"code":"control 'VCSA-80-000148' do\n  title 'The vCenter Server must be configured to send logs to a central log server.'\n  desc  'vCenter must be configured to send near real-time log data to syslog collectors so information will be available to investigators in the case of a security incident or to assist in troubleshooting.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Syslog\\\" on the left navigation pane.\n\n    On the resulting pane on the right, verify at least one site-specific syslog receiver is configured and is listed as \\\"Reachable\\\".\n\n    If no valid syslog collector is configured or if the collector is not listed as \\\"Reachable\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Open the VAMI by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with an SSO account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Syslog\\\" on the left navigation pane.\n\n    On the resulting pane on the right, click \\\"Edit\\\" or \\\"Configure\\\".\n\n    Edit or add the address and port of a site-specific syslog aggregator or Security Information Event Management (SIEM) system with the appropriate protocol.\n\n    User Datagram Protocol (UDP) is discouraged due to its stateless and unencrypted nature. Transport Layer Security (TLS) is preferred.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000358'\n  tag gid: 'V-VCSA-80-000148'\n  tag rid: 'SV-VCSA-80-000148'\n  tag stig_id: 'VCSA-80-000148'\n  tag cci: ['CCI-001851']\n  tag nist: ['AU-4 (1)']\n\n  command = 'Invoke-GetLoggingForwarding | Select-Object -ExpandProperty hostname'\n  logservers = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if logservers.empty?\n    describe \"No log servers configured: #{logservers}\" do\n      subject { logservers }\n      it { should_not be_empty }\n    end\n  else\n    logservers.each do |server|\n      describe server do\n        subject { server }\n        it { should be_in input('syslogServers') }\n      end\n    end\n    logserverstatuscommand = 'Invoke-TestLoggingForwarding | Select-Object -ExpandProperty state'\n    logserverstatus = powercli_command(logserverstatuscommand).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n    logserverstatus.each do |status|\n      describe status do\n        subject { status }\n        it { should cmp 'UP' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000148.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"No log servers configured: [] is expected not to be empty","run_time":0.0154104,"start_time":"2023-06-07T08:29:13-06:00","message":"expected `[].empty?` to be falsey, got true","resource_class":"Object","resource_params":"[]","resource_id":"No log servers configured: []"}]},{"id":"VCSA-80-000150","title":"The vCenter server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, of all audit failure events requiring real-time alerts.","desc":"It is critical for the appropriate personnel to be aware if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability and system operation may be adversely affected.\n\nAlerts provide organizations with urgent messages. Real-time alerts provide these messages immediately (i.e., the time from event detection to alert occurs in seconds or less).","descriptions":[{"label":"default","data":"It is critical for the appropriate personnel to be aware if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability and system operation may be adversely affected.\n\nAlerts provide organizations with urgent messages. Real-time alerts provide these messages immediately (i.e., the time from event detection to alert occurs in seconds or less)."},{"label":"rationale","data":""},{"label":"check","data":"Review the Central Logging Server being used to verify it is configured to alert the SA and ISSO, at a minimum, on any AO-defined events. Otherwise, this is a finding.\n\nIf there are no AO-defined events, this is not a finding."},{"label":"fix","data":"Configure the Central Logging Server being used to alert the SA and ISSO, at a minimum, on any AO-defined events."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000360","satisfies":["SRG-APP-000379","SRG-APP-000510"],"gid":"V-VCSA-80-000150","rid":"SV-VCSA-80-000150","stig_id":"VCSA-80-000150","cci":["CCI-000172","CCI-001744","CCI-001858"],"nist":["AU-12 c","AU-5 (2)","CM-3 (5)"]},"code":"control 'VCSA-80-000150' do\n  title 'The vCenter server must provide an immediate real-time alert to the system administrator (SA) and information system security officer (ISSO), at a minimum, of all audit failure events requiring real-time alerts.'\n  desc  \"\n    It is critical for the appropriate personnel to be aware if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability and system operation may be adversely affected.\n\n    Alerts provide organizations with urgent messages. Real-time alerts provide these messages immediately (i.e., the time from event detection to alert occurs in seconds or less).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Review the Central Logging Server being used to verify it is configured to alert the SA and ISSO, at a minimum, on any AO-defined events. Otherwise, this is a finding.\n\n    If there are no AO-defined events, this is not a finding.\n  \"\n  desc 'fix', 'Configure the Central Logging Server being used to alert the SA and ISSO, at a minimum, on any AO-defined events.'\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000360'\n  tag satisfies: ['SRG-APP-000379', 'SRG-APP-000510']\n  tag gid: 'V-VCSA-80-000150'\n  tag rid: 'SV-VCSA-80-000150'\n  tag stig_id: 'VCSA-80-000150'\n  tag cci: ['CCI-000172', 'CCI-001744', 'CCI-001858']\n  tag nist: ['AU-12 c', 'AU-5 (2)', 'CM-3 (5)']\n\n  describe 'This check is a manual or policy based check' do\n    skip 'This must be reviewed manually'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000150.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check","run_time":4.8e-06,"start_time":"2023-06-07T08:29:13-06:00","resource":"","skip_message":"This must be reviewed manually","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check"}]},{"id":"VCSA-80-000158","title":"The vCenter Server must compare internal information system clocks at least every 24 hours with an authoritative time server.","desc":"Inaccurate time stamps make it more difficult to correlate events and can lead to an inaccurate analysis. Determining the correct time a particular event occurred on a system is critical when conducting forensic analysis and investigating system events. Sources outside of the configured acceptable allowance (drift) may be inaccurate. Additionally, unnecessary synchronization may have an adverse impact on system performance and may indicate malicious activity.\n\nSynchronizing internal information system clocks to an authoritative time server provides uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.","descriptions":[{"label":"default","data":"Inaccurate time stamps make it more difficult to correlate events and can lead to an inaccurate analysis. Determining the correct time a particular event occurred on a system is critical when conducting forensic analysis and investigating system events. Sources outside of the configured acceptable allowance (drift) may be inaccurate. Additionally, unnecessary synchronization may have an adverse impact on system performance and may indicate malicious activity.\n\nSynchronizing internal information system clocks to an authoritative time server provides uniformity of time stamps for information systems with multiple system clocks and systems connected over a network."},{"label":"rationale","data":""},{"label":"check","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Time\" on the left navigation pane.\n\nOn the resulting pane on the right, verify at least one authorized time server is configured and is listed as \"Reachable\".\n\nIf \"NTP\" is not enabled and at least one authorized time server configured, this is a finding."},{"label":"fix","data":"Open the VAMI by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with an SSO account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Time\" on the left navigation pane.\n\nOn the resulting pane on the right, click \"Edit\" under \"Time Synchronization\".\n\nSelect \"NTP\" for \"Mode\" and enter a list of authorized time servers separated by commas. Click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000371","gid":"V-VCSA-80-000158","rid":"SV-VCSA-80-000158","stig_id":"VCSA-80-000158","cci":["CCI-001891"],"nist":["AU-8 (1) (a)"]},"code":"control 'VCSA-80-000158' do\n  title 'The vCenter Server must compare internal information system clocks at least every 24 hours with an authoritative time server.'\n  desc  \"\n    Inaccurate time stamps make it more difficult to correlate events and can lead to an inaccurate analysis. Determining the correct time a particular event occurred on a system is critical when conducting forensic analysis and investigating system events. Sources outside of the configured acceptable allowance (drift) may be inaccurate. Additionally, unnecessary synchronization may have an adverse impact on system performance and may indicate malicious activity.\n\n    Synchronizing internal information system clocks to an authoritative time server provides uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Time\\\" on the left navigation pane.\n\n    On the resulting pane on the right, verify at least one authorized time server is configured and is listed as \\\"Reachable\\\".\n\n    If \\\"NTP\\\" is not enabled and at least one authorized time server configured, this is a finding.\n  \"\n  desc 'fix', \"\n    Open the VAMI by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with an SSO account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Time\\\" on the left navigation pane.\n\n    On the resulting pane on the right, click \\\"Edit\\\" under \\\"Time Synchronization\\\".\n\n    Select \\\"NTP\\\" for \\\"Mode\\\" and enter a list of authorized time servers separated by commas. Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000371'\n  tag gid: 'V-VCSA-80-000158'\n  tag rid: 'SV-VCSA-80-000158'\n  tag stig_id: 'VCSA-80-000158'\n  tag cci: ['CCI-001891']\n  tag nist: ['AU-8 (1) (a)']\n\n  command = 'Invoke-GetTimesync'\n  timesync = powercli_command(command).stdout.strip\n\n  if timesync == 'NTP'\n    ntpserverscommand = 'Invoke-GetNtp'\n    ntpservers = powercli_command(ntpserverscommand).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n    ntpservers.each do |server|\n      describe server do\n        subject { server }\n        it { should be_in input('ntpServers') }\n      end\n      ntpstatuscommand = \"Initialize-NtpTestRequestBody -Servers #{server} | Invoke-TestNtp | Select-Object -ExpandProperty status\"\n      ntpstatus = powercli_command(ntpstatuscommand).stdout.strip\n      describe ntpstatus do\n        subject { ntpstatus }\n        it { should cmp 'SERVER_REACHABLE' }\n      end\n    end\n  else\n    describe \"Timesync Configuration: #{timesync}\" do\n      subject { timesync }\n      it { should cmp 'NTP' }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000158.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Timesync Configuration: HOST is expected to cmp == \"NTP\"","run_time":0.0021716,"start_time":"2023-06-07T08:29:13-06:00","message":"\nexpected: NTP\n     got: HOST\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"Timesync Configuration: HOST"}]},{"id":"VCSA-80-000195","title":"The vCenter Server Machine Secure Sockets Layer (SSL) certificate must be issued by a DOD certificate authority.","desc":"Untrusted certificate authorities (CA) can issue certificates, but they may be issued by organizations or individuals that seek to compromise DOD systems or by organizations with insufficient security controls. If the CA used for verifying the certificate is not a DOD-approved CA, trust of this CA has not been established.\n\nThe DOD will only accept public key infrastructure (PKI) certificates obtained from a DOD-approved internal or external certificate authority. Reliance on CAs for the establishment of secure sessions includes, for example, the use of Transport Layer Security (TLS) certificates.\n\nThe default self-signed, VMware Certificate Authority (VMCA)-issued vCenter reverse proxy certificate must be replaced with a DOD-approved certificate. The use of a DOD certificate on the vCenter reverse proxy and other services assures clients that the service they are connecting to is legitimate and trusted.","descriptions":[{"label":"default","data":"Untrusted certificate authorities (CA) can issue certificates, but they may be issued by organizations or individuals that seek to compromise DOD systems or by organizations with insufficient security controls. If the CA used for verifying the certificate is not a DOD-approved CA, trust of this CA has not been established.\n\nThe DOD will only accept public key infrastructure (PKI) certificates obtained from a DOD-approved internal or external certificate authority. Reliance on CAs for the establishment of secure sessions includes, for example, the use of Transport Layer Security (TLS) certificates.\n\nThe default self-signed, VMware Certificate Authority (VMCA)-issued vCenter reverse proxy certificate must be replaced with a DOD-approved certificate. The use of a DOD certificate on the vCenter reverse proxy and other services assures clients that the service they are connecting to is legitimate and trusted."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\nClick \"View Details\" and examine the \"Issuer Information\" block.\n\nIf the issuer specified is not a DOD approved certificate authority, this is a finding."},{"label":"fix","data":"Obtain a DOD-issued certificate and private key for each vCenter in the system following the requirements below:\n\nKey size: 2048 bits or more (PEM encoded)\nCRT format (Base-64)\nx509 version 3\nSubjectAltName must contain DNS Name=<machine_FQDN>\nContains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\nExport the entire certificate issuing chain up to the root in Base-64 format. Concatenate the individual certificates into one file with the \".cer\" extension.\n\nFrom the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\nClick Actions >> Import and Replace Certificate.\n\nSelect the \"Replace with external CA certificate\" radio button and click \"Next\".\n\nSupply the CA-issued certificate , the exported roots file, and the private key.\n\nClick \"Replace\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000427","gid":"V-VCSA-80-000195","rid":"SV-VCSA-80-000195","stig_id":"VCSA-80-000195","cci":["CCI-002470"],"nist":["SC-23 (5)"]},"code":"control 'VCSA-80-000195' do\n  title 'The vCenter Server Machine Secure Sockets Layer (SSL) certificate must be issued by a DOD certificate authority.'\n  desc  \"\n    Untrusted certificate authorities (CA) can issue certificates, but they may be issued by organizations or individuals that seek to compromise DOD systems or by organizations with insufficient security controls. If the CA used for verifying the certificate is not a DOD-approved CA, trust of this CA has not been established.\n\n    The DOD will only accept public key infrastructure (PKI) certificates obtained from a DOD-approved internal or external certificate authority. Reliance on CAs for the establishment of secure sessions includes, for example, the use of Transport Layer Security (TLS) certificates.\n\n    The default self-signed, VMware Certificate Authority (VMCA)-issued vCenter reverse proxy certificate must be replaced with a DOD-approved certificate. The use of a DOD certificate on the vCenter reverse proxy and other services assures clients that the service they are connecting to is legitimate and trusted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\n    Click \\\"View Details\\\" and examine the \\\"Issuer Information\\\" block.\n\n    If the issuer specified is not a DOD approved certificate authority, this is a finding.\n  \"\n  desc 'fix', \"\n    Obtain a DOD-issued certificate and private key for each vCenter in the system following the requirements below:\n\n    Key size: 2048 bits or more (PEM encoded)\n    CRT format (Base-64)\n    x509 version 3\n    SubjectAltName must contain DNS Name=<machine_FQDN>\n    Contains the following Key Usages: Digital Signature, Non Repudiation, Key Encipherment\n\n    Export the entire certificate issuing chain up to the root in Base-64 format. Concatenate the individual certificates into one file with the \\\".cer\\\" extension.\n\n    From the vSphere Client, go to Administration >> Certificates >> Certificate Management >> Machine SSL Certificate.\n\n    Click Actions >> Import and Replace Certificate.\n\n    Select the \\\"Replace with external CA certificate\\\" radio button and click \\\"Next\\\".\n\n    Supply the CA-issued certificate , the exported roots file, and the private key.\n\n    Click \\\"Replace\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000427'\n  tag gid: 'V-VCSA-80-000195'\n  tag rid: 'SV-VCSA-80-000195'\n  tag stig_id: 'VCSA-80-000195'\n  tag cci: ['CCI-002470']\n  tag nist: ['SC-23 (5)']\n\n  vcenter = powercli_command('$global:DefaultViServers.Name').stdout.strip\n  describe ssl_certificate(host: \"#{vcenter}\", port: 443) do\n    its('issuer_organization') { should cmp 'U.S. Government' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000195.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"ssl_certificate for '10.186.30.81' issuer_organization is expected to cmp == \"U.S. Government\"","run_time":0.3951961,"start_time":"2023-06-07T08:29:13-06:00","message":"\nexpected: U.S. Government\n     got: sc2-10-186-30-81.eng.vmware.com\n\n(compared using `cmp` matcher)\n","resource_class":"ssl_certificate","resource_params":"[{:host=>\"10.186.30.81\", :port=>443}]","resource_id":""}]},{"id":"VCSA-80-000196","title":"The vCenter Server must enable data at rest encryption for vSAN.","desc":"Applications handling data requiring \"data at rest\" protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest.\n\nData encryption is a common technique used in environments that require additional levels of security.  It consists of a process to ensure that data can only be consumed by systems that have appropriate levels of access.  Approved systems must have and use the appropriate cryptographic keys to encrypt and decrypt the data.  Systems that do not have the keys will not be able to consume the data in any meaningful way, as it will remain encrypted in accordance to the commonly used Advanced Encryption Standard (AES) from the National Institute of Standards and Technology, or NIST.\n\nvSAN supports Data-At-Rest Encryption and Data-in-Transit Encryption and uses an AES 256 cipher. Data is encrypted after all other processing, such as deduplication, is performed. Data at rest encryption protects data on storage devices, in case a device is removed from the cluster.","descriptions":[{"label":"default","data":"Applications handling data requiring \"data at rest\" protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest.\n\nData encryption is a common technique used in environments that require additional levels of security.  It consists of a process to ensure that data can only be consumed by systems that have appropriate levels of access.  Approved systems must have and use the appropriate cryptographic keys to encrypt and decrypt the data.  Systems that do not have the keys will not be able to consume the data in any meaningful way, as it will remain encrypted in accordance to the commonly used Advanced Encryption Standard (AES) from the National Institute of Standards and Technology, or NIST.\n\nvSAN supports Data-At-Rest Encryption and Data-in-Transit Encryption and uses an AES 256 cipher. Data is encrypted after all other processing, such as deduplication, is performed. Data at rest encryption protects data on storage devices, in case a device is removed from the cluster."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\nReview the \"Data-at-rest encryption\" status.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Get-VsanClusterConfiguration | Select-Object Name,EncryptionEnabled\n\nIf \"Data-At-Rest encryption\" is not enabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\nClick \"Edit\".\n\nEnable \"Data-At-Rest encryption\" and select a pre-configured key provider from the drop down. Click \"Apply\".\n\nNote: Before enabling, read and understand the operational implications of enabling data at rest encryption in vSAN and how it effects capacity, performance, and recovery scenarios."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000428","gid":"V-VCSA-80-000196","rid":"SV-VCSA-80-000196","stig_id":"VCSA-80-000196","cci":["CCI-002475"],"nist":["SC-28 (1)"]},"code":"control 'VCSA-80-000196' do\n  title 'The vCenter Server must enable data at rest encryption for vSAN.'\n  desc  \"\n    Applications handling data requiring \\\"data at rest\\\" protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest.\n\n    Data encryption is a common technique used in environments that require additional levels of security.  It consists of a process to ensure that data can only be consumed by systems that have appropriate levels of access.  Approved systems must have and use the appropriate cryptographic keys to encrypt and decrypt the data.  Systems that do not have the keys will not be able to consume the data in any meaningful way, as it will remain encrypted in accordance to the commonly used Advanced Encryption Standard (AES) from the National Institute of Standards and Technology, or NIST.\n\n    vSAN supports Data-At-Rest Encryption and Data-in-Transit Encryption and uses an AES 256 cipher. Data is encrypted after all other processing, such as deduplication, is performed. Data at rest encryption protects data on storage devices, in case a device is removed from the cluster.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Review the \\\"Data-at-rest encryption\\\" status.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Get-VsanClusterConfiguration | Select-Object Name,EncryptionEnabled\n\n    If \\\"Data-At-Rest encryption\\\" is not enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Click \\\"Edit\\\".\n\n    Enable \\\"Data-At-Rest encryption\\\" and select a pre-configured key provider from the drop down. Click \\\"Apply\\\".\n\n    Note: Before enabling, read and understand the operational implications of enabling data at rest encryption in vSAN and how it effects capacity, performance, and recovery scenarios.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000428'\n  tag gid: 'V-VCSA-80-000196'\n  tag rid: 'SV-VCSA-80-000196'\n  tag stig_id: 'VCSA-80-000196'\n  tag cci: ['CCI-002475']\n  tag nist: ['SC-28 (1)']\n\n  # Get all clusters with vSAN enabled\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object | Select-Object -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !clusters.empty?\n    clusters.each do |cluster|\n      command = \"Get-Cluster -Name #{cluster} | Get-VsanClusterConfiguration | Select-Object -ExpandProperty EncryptionEnabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No clusters with vSAN enabled found...skipping tests' do\n      skip 'No clusters with vSAN enabled found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000196.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-Cluster -Name cluster0 | Get-VsanClusterConfiguration | Select-Object -ExpandProperty EncryptionEnabled stdout.strip is expected to cmp == \"true\"","run_time":1.4792283,"start_time":"2023-06-07T08:29:14-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-Cluster -Name cluster0 | Get-VsanClusterConfiguration | Select-Object -ExpandProperty EncryptionEnabled\"]","resource_id":""}]},{"id":"VCSA-80-000248","title":"The vCenter Server must disable the Customer Experience Improvement Program (CEIP).","desc":"The VMware CEIP sends VMware anonymized system information that is used to improve the quality, reliability, and functionality of VMware products and services. For confidentiality purposes this feature must be disabled.","descriptions":[{"label":"default","data":"The VMware CEIP sends VMware anonymized system information that is used to improve the quality, reliability, and functionality of VMware products and services. For confidentiality purposes this feature must be disabled."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\nIf Customer Experience Improvement \"Program Status\" is \"Joined\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\nClick \"Leave Program\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000248","rid":"SV-VCSA-80-000248","stig_id":"VCSA-80-000248","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000248' do\n  title 'The vCenter Server must disable the Customer Experience Improvement Program (CEIP).'\n  desc  'The VMware CEIP sends VMware anonymized system information that is used to improve the quality, reliability, and functionality of VMware products and services. For confidentiality purposes this feature must be disabled.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\n    If Customer Experience Improvement \\\"Program Status\\\" is \\\"Joined\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Deployment >> Customer Experience Improvement Program.\n\n    Click \\\"Leave Program\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000248'\n  tag rid: 'SV-VCSA-80-000248'\n  tag stig_id: 'VCSA-80-000248'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000248.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.13e-05,"start_time":"2023-06-07T08:29:15-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000253","title":"The vCenter server must enforce SNMPv3 security features where SNMP is required.","desc":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. SNMPv3 can be configured for identification and cryptographically based authentication.\n\nSNMPv3 defines a user-based security model (USM) and a view-based access control model (VACM). SNMPv3 USM provides data integrity, data origin authentication, message replay protection, and protection against disclosure of the message payload. SNMPv3 VACM provides access control to determine whether a specific type of access (read or write) to the management information is allowed. Implement both VACM and USM for full protection.\n\nSNMPv3 must be disabled by default and enabled only if used. SNMP v3 provides security feature enhancements to SNMP, including encryption and message authentication.","descriptions":[{"label":"default","data":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. SNMPv3 can be configured for identification and cryptographically based authentication.\n\nSNMPv3 defines a user-based security model (USM) and a view-based access control model (VACM). SNMPv3 USM provides data integrity, data origin authentication, message replay protection, and protection against disclosure of the message payload. SNMPv3 VACM provides access control to determine whether a specific type of access (read or write) to the management information is allowed. Implement both VACM and USM for full protection.\n\nSNMPv3 must be disabled by default and enabled only if used. SNMP v3 provides security feature enhancements to SNMP, including encryption and message authentication."},{"label":"rationale","data":""},{"label":"check","data":"At the command prompt on the vCenter Server Appliance, run the following commands:\n\n# appliancesh\n# snmp.get\n\nNote: The \"appliancesh\" command is not needed if the default shell has not been changed for root.\n\nIf \"Enable\" is set to \"False\", this is not a finding.\n\nIf \"Enable\" is set to \"True\" and \"Authentication\" is not set to \"SHA1\", this is a finding.\n\nIf \"Enable\" is set to \"True\" and \"Privacy\" is not set to \"AES128\", this is a finding.\n\nIf any \"Users\" are configured with a \"Sec_level\" that does not equal \"priv\", this is a finding."},{"label":"fix","data":"At the command prompt on the vCenter Server Appliance, run the following commands:\n\n# appliancesh\n# snmp.set --authentication SHA1\n# snmp.set --privacy AES128\n\nTo change the security level of a user, run the following command:\n\n# snmp.set --users <username>/<auth_password> <priv_password>/priv"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000575","gid":"V-VCSA-80-000253","rid":"SV-VCSA-80-000253","stig_id":"VCSA-80-000253","cci":["CCI-001967"],"nist":["IA-3 (1)"]},"code":"control 'VCSA-80-000253' do\n  title 'The vCenter server must enforce SNMPv3 security features where SNMP is required.'\n  desc  \"\n    SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. SNMPv3 can be configured for identification and cryptographically based authentication.\n\n    SNMPv3 defines a user-based security model (USM) and a view-based access control model (VACM). SNMPv3 USM provides data integrity, data origin authentication, message replay protection, and protection against disclosure of the message payload. SNMPv3 VACM provides access control to determine whether a specific type of access (read or write) to the management information is allowed. Implement both VACM and USM for full protection.\n\n    SNMPv3 must be disabled by default and enabled only if used. SNMP v3 provides security feature enhancements to SNMP, including encryption and message authentication.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    At the command prompt on the vCenter Server Appliance, run the following commands:\n\n    # appliancesh\n    # snmp.get\n\n    Note: The \\\"appliancesh\\\" command is not needed if the default shell has not been changed for root.\n\n    If \\\"Enable\\\" is set to \\\"False\\\", this is not a finding.\n\n    If \\\"Enable\\\" is set to \\\"True\\\" and \\\"Authentication\\\" is not set to \\\"SHA1\\\", this is a finding.\n\n    If \\\"Enable\\\" is set to \\\"True\\\" and \\\"Privacy\\\" is not set to \\\"AES128\\\", this is a finding.\n\n    If any \\\"Users\\\" are configured with a \\\"Sec_level\\\" that does not equal \\\"priv\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    At the command prompt on the vCenter Server Appliance, run the following commands:\n\n    # appliancesh\n    # snmp.set --authentication SHA1\n    # snmp.set --privacy AES128\n\n    To change the security level of a user, run the following command:\n\n    # snmp.set --users <username>/<auth_password> <priv_password>/priv\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000575'\n  tag gid: 'V-VCSA-80-000253'\n  tag rid: 'SV-VCSA-80-000253'\n  tag stig_id: 'VCSA-80-000253'\n  tag cci: ['CCI-001967']\n  tag nist: ['IA-3 (1)']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000253.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":8.6e-06,"start_time":"2023-06-07T08:29:15-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000265","title":"The vCenter server must disable SNMPv1/2 receivers.","desc":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. Therefore, SNMPv1/2 receivers must be disabled, while SNMPv3 is configured in another control. vCenter exposes SNMP v1/2 in the UI and SNMPv3 in the CLI.","descriptions":[{"label":"default","data":"SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. Therefore, SNMPv1/2 receivers must be disabled, while SNMPv3 is configured in another control. vCenter exposes SNMP v1/2 in the UI and SNMPv3 in the CLI."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick \"Edit\".\n\nOn the \"SNMP receivers\" tab, note the presence of any enabled receiver.\n\nIf there are any enabled receivers, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick \"Edit\".\n\nOn the \"SNMP receivers\" tab, ensure all receivers are disabled."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000575","gid":"V-VCSA-80-000265","rid":"SV-VCSA-80-000265","stig_id":"VCSA-80-000265","cci":["CCI-001967"],"nist":["IA-3 (1)"]},"code":"control 'VCSA-80-000265' do\n  title 'The vCenter server must disable SNMPv1/2 receivers.'\n  desc  'SNMPv3 supports commercial-grade security, including authentication, authorization, access control, and privacy. Previous versions of the protocol contained well-known security weaknesses that were easily exploited. Therefore, SNMPv1/2 receivers must be disabled, while SNMPv3 is configured in another control. vCenter exposes SNMP v1/2 in the UI and SNMPv3 in the CLI.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click \\\"Edit\\\".\n\n    On the \\\"SNMP receivers\\\" tab, note the presence of any enabled receiver.\n\n    If there are any enabled receivers, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click \\\"Edit\\\".\n\n    On the \\\"SNMP receivers\\\" tab, ensure all receivers are disabled.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000575'\n  tag gid: 'V-VCSA-80-000265'\n  tag rid: 'SV-VCSA-80-000265'\n  tag stig_id: 'VCSA-80-000265'\n  tag cci: ['CCI-001967']\n  tag nist: ['IA-3 (1)']\n\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.1.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.2.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.3.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\n  command = \"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.4.enabled'} | Select-Object -ExpandProperty Value\"\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'False' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000265.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.1.enabled'} | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"False\"","run_time":0.3624992,"start_time":"2023-06-07T08:29:15-06:00","message":"\nexpected: False\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.1.enabled'} | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.2.enabled'} | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"False\"","run_time":0.1768221,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.2.enabled'} | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.3.enabled'} | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"False\"","run_time":0.1930579,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.3.enabled'} | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.4.enabled'} | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"False\"","run_time":0.1628827,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-View -Id 'OptionManager-VpxSettings').setting | Where-Object {$_.key -match 'snmp.receiver.4.enabled'} | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"VCSA-80-000266","title":"The vCenter Server must require an administrator to unlock an account locked due to excessive login failures.","desc":"By requiring that Single Sign-On (SSO) accounts be unlocked manually, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. When the account unlock time is set to zero, once an account is locked it can only be unlocked manually by an administrator.","descriptions":[{"label":"default","data":"By requiring that Single Sign-On (SSO) accounts be unlocked manually, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. When the account unlock time is set to zero, once an account is locked it can only be unlocked manually by an administrator."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nView the value of the \"Unlock time\" setting.\n\nUnlock time: 0 seconds\n\nIf the lockout policy is not configured with \"Unlock time\" policy of \"0\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\nClick \"Edit\".\n\nSet the \"Unlock time\" to \"0\" and click \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000345","gid":"V-VCSA-80-000266","rid":"SV-VCSA-80-000266","stig_id":"VCSA-80-000266","cci":["CCI-002238"],"nist":["AC-7 b"]},"code":"control 'VCSA-80-000266' do\n  title 'The vCenter Server must require an administrator to unlock an account locked due to excessive login failures.'\n  desc  'By requiring that Single Sign-On (SSO) accounts be unlocked manually, the risk of unauthorized access via user password guessing, otherwise known as brute forcing, is reduced. When the account unlock time is set to zero, once an account is locked it can only be unlocked manually by an administrator.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    View the value of the \\\"Unlock time\\\" setting.\n\n    Unlock time: 0 seconds\n\n    If the lockout policy is not configured with \\\"Unlock time\\\" policy of \\\"0\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Local Accounts >> Lockout Policy.\n\n    Click \\\"Edit\\\".\n\n    Set the \\\"Unlock time\\\" to \\\"0\\\" and click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000345'\n  tag gid: 'V-VCSA-80-000266'\n  tag rid: 'SV-VCSA-80-000266'\n  tag stig_id: 'VCSA-80-000266'\n  tag cci: ['CCI-002238']\n  tag nist: ['AC-7 b']\n\n  command = '(Get-SsoLockoutPolicy).AutoUnlockIntervalSec'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp '0' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000266.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoLockoutPolicy).AutoUnlockIntervalSec stdout.strip is expected to cmp == \"0\"","run_time":0.2036261,"start_time":"2023-06-07T08:29:16-06:00","message":"\nexpected: 0\n     got: 300\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoLockoutPolicy).AutoUnlockIntervalSec\"]","resource_id":""}]},{"id":"VCSA-80-000267","title":"The vCenter Server must disable the distributed virtual switch health check.","desc":"Network health check is disabled by default. Once enabled, the health check packets contain information on host#, vds#, and port#, which an attacker would find useful. It is recommended that network health check be used for troubleshooting and turned off when troubleshooting is finished.","descriptions":[{"label":"default","data":"Network health check is disabled by default. Once enabled, the health check packets contain information on host#, vds#, and port#, which an attacker would find useful. It is recommended that network health check be used for troubleshooting and turned off when troubleshooting is finished."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Health Check.\n\nView the health check pane and verify the \"VLAN and MTU\" and \"Teaming and failover\" checks are \"Disabled\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$vds = Get-VDSwitch\n$vds.ExtensionData.Config.HealthCheckConfig\n\nIf the health check feature is enabled on distributed switches and is not on temporarily for troubleshooting purposes, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Health Check.\n\nClick \"Edit\".\n\nDisable the \"VLAN and MTU\" and \"Teaming and failover\" checks.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-View -ViewType DistributedVirtualSwitch | ?{($_.config.HealthCheckConfig | ?{$_.enable -notmatch \"False\"})}| %{$_.UpdateDVSHealthCheckConfig(@((New-Object Vmware.Vim.VMwareDVSVlanMtuHealthCheckConfig -property @{enable=0}),(New-Object Vmware.Vim.VMwareDVSTeamingHealthCheckConfig -property @{enable=0})))}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000267","rid":"SV-VCSA-80-000267","stig_id":"VCSA-80-000267","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000267' do\n  title 'The vCenter Server must disable the distributed virtual switch health check.'\n  desc  'Network health check is disabled by default. Once enabled, the health check packets contain information on host#, vds#, and port#, which an attacker would find useful. It is recommended that network health check be used for troubleshooting and turned off when troubleshooting is finished.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Health Check.\n\n    View the health check pane and verify the \\\"VLAN and MTU\\\" and \\\"Teaming and failover\\\" checks are \\\"Disabled\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $vds = Get-VDSwitch\n    $vds.ExtensionData.Config.HealthCheckConfig\n\n    If the health check feature is enabled on distributed switches and is not on temporarily for troubleshooting purposes, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Health Check.\n\n    Click \\\"Edit\\\".\n\n    Disable the \\\"VLAN and MTU\\\" and \\\"Teaming and failover\\\" checks.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-View -ViewType DistributedVirtualSwitch | ?{($_.config.HealthCheckConfig | ?{$_.enable -notmatch \\\"False\\\"})}| %{$_.UpdateDVSHealthCheckConfig(@((New-Object Vmware.Vim.VMwareDVSVlanMtuHealthCheckConfig -property @{enable=0}),(New-Object Vmware.Vim.VMwareDVSTeamingHealthCheckConfig -property @{enable=0})))}\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000267'\n  tag rid: 'SV-VCSA-80-000267'\n  tag stig_id: 'VCSA-80-000267'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.HealthCheckConfig | Select-Object -ExpandProperty Enable\"\n      checks = powercli_command(command)\n      checks.stdout.split.each do |hc|\n        describe \"Health check for #{vds}\" do\n          subject { hc }\n          it { should cmp 'false' }\n        end\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000267.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Health check for VDSwitch STIG 1 is expected to cmp == \"false\"","run_time":0.0072569,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Health check for VDSwitch STIG 1"},{"status":"passed","code_desc":"Health check for VDSwitch STIG 1 is expected to cmp == \"false\"","run_time":0.0002122,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Health check for VDSwitch STIG 1"},{"status":"passed","code_desc":"Health check for VDSwitch STIG 2 is expected to cmp == \"false\"","run_time":0.0001312,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Health check for VDSwitch STIG 2"},{"status":"passed","code_desc":"Health check for VDSwitch STIG 2 is expected to cmp == \"false\"","run_time":0.0001188,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Health check for VDSwitch STIG 2"}]},{"id":"VCSA-80-000268","title":"The vCenter Server must set the distributed port group Forged Transmits policy to \"Reject\".","desc":"If the virtual machine operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nWhen the \"Forged Transmits\" option is set to \"Accept\", ESXi does not compare source and effective MAC addresses.\n\nTo protect against MAC impersonation, set the \"Forged Transmits\" option to \"Reject\". The host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to determine if they match. If the addresses do not match, the ESXi host drops the packet.","descriptions":[{"label":"default","data":"If the virtual machine operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nWhen the \"Forged Transmits\" option is set to \"Accept\", ESXi does not compare source and effective MAC addresses.\n\nTo protect against MAC impersonation, set the \"Forged Transmits\" option to \"Reject\". The host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to determine if they match. If the addresses do not match, the ESXi host drops the packet."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nVerify \"Forged Transmits\" is set to \"Reject\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\nIf the \"Forged Transmits\" policy is set to accept for a non-uplink port, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Security\" tab.\n\nSet \"Forged Transmits\" to \"Reject\".\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000268","rid":"SV-VCSA-80-000268","stig_id":"VCSA-80-000268","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000268' do\n  title 'The vCenter Server must set the distributed port group Forged Transmits policy to \"Reject\".'\n  desc  \"\n    If the virtual machine operating system changes the Media Access Control (MAC) address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    When the \\\"Forged Transmits\\\" option is set to \\\"Accept\\\", ESXi does not compare source and effective MAC addresses.\n\n    To protect against MAC impersonation, set the \\\"Forged Transmits\\\" option to \\\"Reject\\\". The host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to determine if they match. If the addresses do not match, the ESXi host drops the packet.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Verify \\\"Forged Transmits\\\" is set to \\\"Reject\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\n    If the \\\"Forged Transmits\\\" policy is set to accept for a non-uplink port, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Security\\\" tab.\n\n    Set \\\"Forged Transmits\\\" to \\\"Reject\\\".\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000268'\n  tag rid: 'SV-VCSA-80-000268'\n  tag stig_id: 'VCSA-80-000268'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000268.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 1\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected to cmp == \"false\"","run_time":0.4559017,"start_time":"2023-06-07T08:29:16-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 1\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 2\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected to cmp == \"false\"","run_time":0.3428624,"start_time":"2023-06-07T08:29:17-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 2\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected to cmp == \"false\"","run_time":0.4364241,"start_time":"2023-06-07T08:29:17-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected to cmp == \"false\"","run_time":0.6254497,"start_time":"2023-06-07T08:29:18-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected to cmp == \"false\"","run_time":0.4285295,"start_time":"2023-06-07T08:29:18-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits stdout.strip is expected to cmp == \"false\"","run_time":0.8635859,"start_time":"2023-06-07T08:29:19-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty ForgedTransmits\"]","resource_id":""}]},{"id":"VCSA-80-000269","title":"The vCenter Server must set the distributed port group Media Access Control (MAC) Address Change policy to \"Reject\".","desc":"If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent virtual machines from changing their effective MAC address and will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing.","descriptions":[{"label":"default","data":"If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\nThis will prevent virtual machines from changing their effective MAC address and will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nVerify \"MAC Address Changes\" is set to \"Reject\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\nIf the \"MAC Address Changes\" policy is set to accept, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Security\" tab.\n\nSet \"MAC Address Changes\" to \"Reject\".\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000269","rid":"SV-VCSA-80-000269","stig_id":"VCSA-80-000269","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000269' do\n  title 'The vCenter Server must set the distributed port group Media Access Control (MAC) Address Change policy to \"Reject\".'\n  desc  \"\n    If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.\n\n    This will prevent virtual machines from changing their effective MAC address and will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate and will affect applications that require a specific MAC address for licensing.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Verify \\\"MAC Address Changes\\\" is set to \\\"Reject\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\n    If the \\\"MAC Address Changes\\\" policy is set to accept, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Security\\\" tab.\n\n    Set \\\"MAC Address Changes\\\" to \\\"Reject\\\".\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000269'\n  tag rid: 'SV-VCSA-80-000269'\n  tag stig_id: 'VCSA-80-000269'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000269.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 1\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected to cmp == \"false\"","run_time":0.3020193,"start_time":"2023-06-07T08:29:20-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 1\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 2\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected to cmp == \"false\"","run_time":0.350858,"start_time":"2023-06-07T08:29:20-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 2\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected to cmp == \"false\"","run_time":0.7810286,"start_time":"2023-06-07T08:29:20-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected to cmp == \"false\"","run_time":0.4751133,"start_time":"2023-06-07T08:29:21-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected to cmp == \"false\"","run_time":0.404362,"start_time":"2023-06-07T08:29:21-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges stdout.strip is expected to cmp == \"false\"","run_time":0.4408188,"start_time":"2023-06-07T08:29:22-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty MacChanges\"]","resource_id":""}]},{"id":"VCSA-80-000270","title":"The vCenter Server must set the distributed port group Promiscuous Mode policy to \"Reject\".","desc":"When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the port group have the potential of reading all packets across that network, meaning only the virtual machines connected to that port group.\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting.","descriptions":[{"label":"default","data":"When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the port group have the potential of reading all packets across that network, meaning only the virtual machines connected to that port group.\n\nPromiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nVerify \"Promiscuous Mode\" is set to \"Reject\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\nIf the \"Promiscuous Mode\" policy is set to accept, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Security\" tab.\n\nSet \"Promiscuous Mode\" to \"Reject\".\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nGet-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false\nGet-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000270","rid":"SV-VCSA-80-000270","stig_id":"VCSA-80-000270","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000270' do\n  title 'The vCenter Server must set the distributed port group Promiscuous Mode policy to \"Reject\".'\n  desc  \"\n    When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the port group have the potential of reading all packets across that network, meaning only the virtual machines connected to that port group.\n\n    Promiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Verify \\\"Promiscuous Mode\\\" is set to \\\"Reject\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy\n\n    If the \\\"Promiscuous Mode\\\" policy is set to accept, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Security\\\" tab.\n\n    Set \\\"Promiscuous Mode\\\" to \\\"Reject\\\".\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false\n    Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000270'\n  tag rid: 'SV-VCSA-80-000270'\n  tag stig_id: 'VCSA-80-000270'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'false' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000270.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 1\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected to cmp == \"false\"","run_time":0.3311334,"start_time":"2023-06-07T08:29:22-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 1\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 2\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected to cmp == \"false\"","run_time":0.5081735,"start_time":"2023-06-07T08:29:23-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 2\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected to cmp == \"false\"","run_time":0.447688,"start_time":"2023-06-07T08:29:23-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected to cmp == \"false\"","run_time":0.5091141,"start_time":"2023-06-07T08:29:24-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected to cmp == \"false\"","run_time":0.9601561,"start_time":"2023-06-07T08:29:24-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous stdout.strip is expected to cmp == \"false\"","run_time":0.4214615,"start_time":"2023-06-07T08:29:25-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\") | Get-VDSecurityPolicy | Select-Object -ExpandProperty AllowPromiscuous\"]","resource_id":""}]},{"id":"VCSA-80-000271","title":"The vCenter Server must only send NetFlow traffic to authorized collectors.","desc":"The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network, making it easier for a man-in-the-middle attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target Internet Protocols (IPs) are correct.","descriptions":[{"label":"default","data":"The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network, making it easier for a man-in-the-middle attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target Internet Protocols (IPs) are correct."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nTo view NetFlow Collector IPs configured on distributed switches:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> NetFlow.\n\nView the NetFlow pane and verify any collector IP addresses are valid and in use for troubleshooting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | select Name,@{N=\"NetFlowCollectorIPs\";E={$_.ExtensionData.config.IpfixConfig.CollectorIpAddress}}\n\nTo view if NetFlow is enabled on any distributed port groups:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed port group >> Manage >> Settings >> Policies.\n\nGo to \"Monitoring\" and view the NetFlow status.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | Select Name,VirtualSwitch,@{N=\"NetFlowEnabled\";E={$_.Extensiondata.Config.defaultPortConfig.ipfixEnabled.Value}}\n\nIf NetFlow is configured and the collector IP is not known and documented, this is a finding."},{"label":"fix","data":"To remove collector IPs, do the following:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> NetFlow.\n\nClick \"Edit\".\n\nRemove any unknown collector IPs.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$dvs = Get-VDSwitch dvswitch | Get-View\nForEach($vs in $dvs){\n$spec = New-Object VMware.Vim.VMwareDVSConfigSpec\n$spec.configversion = $vs.Config.ConfigVersion\n$spec.IpfixConfig = New-Object VMware.Vim.VMwareIpfixConfig\n$spec.IpfixConfig.CollectorIpAddress = \"\"\n$spec.IpfixConfig.CollectorPort = \"0\"\n$spec.IpfixConfig.ActiveFlowTimeout = \"60\"\n$spec.IpfixConfig.IdleFlowTimeout = \"15\"\n$spec.IpfixConfig.SamplingRate = \"0\"\n$spec.IpfixConfig.InternalFlowsOnly = $False\n$vs.ReconfigureDvs_Task($spec)\n}\n\nNote: This will reset the NetFlow collector configuration back to the defaults.\n\nTo disable NetFlow on a distributed port group, do the following:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"Monitoring\" tab.\n\nChange \"NetFlow\" to \"Disabled\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$pgs = Get-VDPortgroup | Get-View\nForEach($pg in $pgs){\n$spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n$spec.configversion = $pg.Config.ConfigVersion\n$spec.defaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting\n$spec.defaultPortConfig.ipfixEnabled = New-Object VMware.Vim.BoolPolicy\n$spec.defaultPortConfig.ipfixEnabled.inherited = $false\n$spec.defaultPortConfig.ipfixEnabled.value = $false\n$pg.ReconfigureDVPortgroup_Task($spec)\n}"}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000271","rid":"SV-VCSA-80-000271","stig_id":"VCSA-80-000271","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000271' do\n  title 'The vCenter Server must only send NetFlow traffic to authorized collectors.'\n  desc  'The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network, making it easier for a man-in-the-middle attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target Internet Protocols (IPs) are correct.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    To view NetFlow Collector IPs configured on distributed switches:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> NetFlow.\n\n    View the NetFlow pane and verify any collector IP addresses are valid and in use for troubleshooting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | select Name,@{N=\\\"NetFlowCollectorIPs\\\";E={$_.ExtensionData.config.IpfixConfig.CollectorIpAddress}}\n\n    To view if NetFlow is enabled on any distributed port groups:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed port group >> Manage >> Settings >> Policies.\n\n    Go to \\\"Monitoring\\\" and view the NetFlow status.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | Select Name,VirtualSwitch,@{N=\\\"NetFlowEnabled\\\";E={$_.Extensiondata.Config.defaultPortConfig.ipfixEnabled.Value}}\n\n    If NetFlow is configured and the collector IP is not known and documented, this is a finding.\n  \"\n  desc 'fix', \"\n    To remove collector IPs, do the following:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> NetFlow.\n\n    Click \\\"Edit\\\".\n\n    Remove any unknown collector IPs.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $dvs = Get-VDSwitch dvswitch | Get-View\n    ForEach($vs in $dvs){\n    $spec = New-Object VMware.Vim.VMwareDVSConfigSpec\n    $spec.configversion = $vs.Config.ConfigVersion\n    $spec.IpfixConfig = New-Object VMware.Vim.VMwareIpfixConfig\n    $spec.IpfixConfig.CollectorIpAddress = \\\"\\\"\n    $spec.IpfixConfig.CollectorPort = \\\"0\\\"\n    $spec.IpfixConfig.ActiveFlowTimeout = \\\"60\\\"\n    $spec.IpfixConfig.IdleFlowTimeout = \\\"15\\\"\n    $spec.IpfixConfig.SamplingRate = \\\"0\\\"\n    $spec.IpfixConfig.InternalFlowsOnly = $False\n    $vs.ReconfigureDvs_Task($spec)\n    }\n\n    Note: This will reset the NetFlow collector configuration back to the defaults.\n\n    To disable NetFlow on a distributed port group, do the following:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"Monitoring\\\" tab.\n\n    Change \\\"NetFlow\\\" to \\\"Disabled\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $pgs = Get-VDPortgroup | Get-View\n    ForEach($pg in $pgs){\n    $spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n    $spec.configversion = $pg.Config.ConfigVersion\n    $spec.defaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting\n    $spec.defaultPortConfig.ipfixEnabled = New-Object VMware.Vim.BoolPolicy\n    $spec.defaultPortConfig.ipfixEnabled.inherited = $false\n    $spec.defaultPortConfig.ipfixEnabled.value = $false\n    $pg.ReconfigureDVPortgroup_Task($spec)\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000271'\n  tag rid: 'SV-VCSA-80-000271'\n  tag stig_id: 'VCSA-80-000271'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.strip.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  if vdswitches.empty?\n    impact 0.0\n    describe '' do\n      skip 'No distributed switches found to check. This is not applicable.'\n    end\n  else\n    setimpact = true\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.IpfixConfig.CollectorIpAddress\"\n      result = powercli_command(command).stdout.strip\n      if !result.empty?\n        describe '' do\n          subject { result }\n          it { should cmp \"#{input('ipfixCollectorAddress')}\" }\n        end\n        setimpact = false\n      else\n        describe '' do\n          skip \"Ipfix CollectorIpAddress not configured...skipping #{vds}.\"\n        end\n      end\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000271.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"","run_time":1.26e-05,"start_time":"2023-06-07T08:29:25-06:00","resource":"","skip_message":"Ipfix CollectorIpAddress not configured...skipping VDSwitch STIG 1.","resource_class":"Object","resource_params":"[]","resource_id":""},{"status":"skipped","code_desc":"","run_time":9.1e-06,"start_time":"2023-06-07T08:29:25-06:00","resource":"","skip_message":"Ipfix CollectorIpAddress not configured...skipping VDSwitch STIG 2.","resource_class":"Object","resource_params":"[]","resource_id":""}]},{"id":"VCSA-80-000272","title":"The vCenter Server must configure all port groups to a value other than that of the native virtual local area network (VLAN).","desc":"ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up belonging to native VLAN of the physical switch.\n\nFor example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a \"1\"; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a \"1\" instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged).\n\nIf the ESXi virtual switch port group uses the native VLAN ID, traffic from those virtual machines will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic.","descriptions":[{"label":"default","data":"ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up belonging to native VLAN of the physical switch.\n\nFor example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a \"1\"; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a \"1\" instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged).\n\nIf the ESXi virtual switch port group uses the native VLAN ID, traffic from those virtual machines will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nReview the port group VLAN tags and verify they are not set to the native VLAN ID of the attached physical switch.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | select Name, VlanConfiguration\n\nIf any port group is configured with the native VLAN of the ESXi hosts attached physical switch, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab.\n\nChange the VLAN ID to a non-native VLAN.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup \"portgroup name\" | Set-VDVlanConfiguration -VlanId \"New VLAN#\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000272","rid":"SV-VCSA-80-000272","stig_id":"VCSA-80-000272","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000272' do\n  title 'The vCenter Server must configure all port groups to a value other than that of the native virtual local area network (VLAN).'\n  desc  \"\n    ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up belonging to native VLAN of the physical switch.\n\n    For example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a \\\"1\\\"; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a \\\"1\\\" instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged).\n\n    If the ESXi virtual switch port group uses the native VLAN ID, traffic from those virtual machines will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Review the port group VLAN tags and verify they are not set to the native VLAN ID of the attached physical switch.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | select Name, VlanConfiguration\n\n    If any port group is configured with the native VLAN of the ESXi hosts attached physical switch, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab.\n\n    Change the VLAN ID to a non-native VLAN.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup \\\"portgroup name\\\" | Set-VDVlanConfiguration -VlanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000272'\n  tag rid: 'SV-VCSA-80-000272'\n  tag stig_id: 'VCSA-80-000272'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not cmp '1' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000272.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to cmp == \"1\"","run_time":0.2220219,"start_time":"2023-06-07T08:29:25-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to cmp == \"1\"","run_time":0.2193449,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to cmp == \"1\"","run_time":0.2591679,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to cmp == \"1\"","run_time":0.2532139,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""}]},{"id":"VCSA-80-000273","title":"The vCenter Server must not configure VLAN Trunking unless Virtual Guest Tagging (VGT) is required and authorized.","desc":"When a port group is set to VLAN Trunking, the vSwitch passes all network frames in the specified range to the attached virtual machines without modifying the virtual local area network (VLAN) tags. In vSphere, this is referred to as VGT.\n\nThe virtual machine must process the VLAN information itself via an 802.1Q driver in the operating system. VLAN Trunking must only be implemented if the attached virtual machines have been specifically authorized and are capable of managing VLAN tags themselves.\n\nIf VLAN Trunking is enabled inappropriately, it may cause a denial of service or allow a virtual machine to interact with traffic on an unauthorized VLAN.","descriptions":[{"label":"default","data":"When a port group is set to VLAN Trunking, the vSwitch passes all network frames in the specified range to the attached virtual machines without modifying the virtual local area network (VLAN) tags. In vSphere, this is referred to as VGT.\n\nThe virtual machine must process the VLAN information itself via an 802.1Q driver in the operating system. VLAN Trunking must only be implemented if the attached virtual machines have been specifically authorized and are capable of managing VLAN tags themselves.\n\nIf VLAN Trunking is enabled inappropriately, it may cause a denial of service or allow a virtual machine to interact with traffic on an unauthorized VLAN."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nReview the port group \"VLAN Type\" and \"VLAN trunk range\", if present.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | Where {$_.ExtensionData.Config.Uplink -ne \"True\"} | Select Name,VlanConfiguration\n\nIf any port group is configured with \"VLAN trunking\" and is not documented as a needed exception (such as NSX appliances), this is a finding.\n\nIf any port group is authorized to be configured with \"VLAN trunking\" but is not configured with the most limited range necessary, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab.\n\nIf \"VLAN trunking\" is not authorized, remove it by setting \"VLAN type\" to \"VLAN\" and configure an appropriate VLAN ID. Click \"OK\".\n\nIf \"VLAN trunking\" is authorized but the range is too broad, modify the range in the \"VLAN trunk range\" field to the minimum necessary and authorized range. An example range would be \"1,3-5,8\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command to configure trunking:\n\nGet-VDPortgroup \"Portgroup Name\" | Set-VDVlanConfiguration -VlanTrunkRange \"<VLAN Range(s) comma separated>\"\n\nor\n\nRun this command to configure a single VLAN ID:\n\nGet-VDPortgroup \"Portgroup Name\" | Set-VDVlanConfiguration -VlanId \"<New VLAN#>\""}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000273","rid":"SV-VCSA-80-000273","stig_id":"VCSA-80-000273","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000273' do\n  title 'The vCenter Server must not configure VLAN Trunking unless Virtual Guest Tagging (VGT) is required and authorized.'\n  desc  \"\n    When a port group is set to VLAN Trunking, the vSwitch passes all network frames in the specified range to the attached virtual machines without modifying the virtual local area network (VLAN) tags. In vSphere, this is referred to as VGT.\n\n    The virtual machine must process the VLAN information itself via an 802.1Q driver in the operating system. VLAN Trunking must only be implemented if the attached virtual machines have been specifically authorized and are capable of managing VLAN tags themselves.\n\n    If VLAN Trunking is enabled inappropriately, it may cause a denial of service or allow a virtual machine to interact with traffic on an unauthorized VLAN.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Review the port group \\\"VLAN Type\\\" and \\\"VLAN trunk range\\\", if present.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | Where {$_.ExtensionData.Config.Uplink -ne \\\"True\\\"} | Select Name,VlanConfiguration\n\n    If any port group is configured with \\\"VLAN trunking\\\" and is not documented as a needed exception (such as NSX appliances), this is a finding.\n\n    If any port group is authorized to be configured with \\\"VLAN trunking\\\" but is not configured with the most limited range necessary, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab.\n\n    If \\\"VLAN trunking\\\" is not authorized, remove it by setting \\\"VLAN type\\\" to \\\"VLAN\\\" and configure an appropriate VLAN ID. Click \\\"OK\\\".\n\n    If \\\"VLAN trunking\\\" is authorized but the range is too broad, modify the range in the \\\"VLAN trunk range\\\" field to the minimum necessary and authorized range. An example range would be \\\"1,3-5,8\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command to configure trunking:\n\n    Get-VDPortgroup \\\"Portgroup Name\\\" | Set-VDVlanConfiguration -VlanTrunkRange \\\"<VLAN Range(s) comma separated>\\\"\n\n    or\n\n    Run this command to configure a single VLAN ID:\n\n    Get-VDPortgroup \\\"Portgroup Name\\\" | Set-VDVlanConfiguration -VlanId \\\"<New VLAN#>\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000273'\n  tag rid: 'SV-VCSA-80-000273'\n  tag stig_id: 'VCSA-80-000273'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Where-Object {(($_.IsUplink -eq $false) -and ($_.VlanConfiguration -match \"Trunk\"))} | Select-Object -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    impact 0.0\n    describe '' do\n      skip 'No distributed port groups found to check. This is not applicable.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId.Start\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not cmp '0' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId.End\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not cmp '4094' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000273.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"","run_time":6.9e-06,"start_time":"2023-06-07T08:29:26-06:00","resource":"","skip_message":"No distributed port groups found to check. This is not applicable.","resource_class":"Object","resource_params":"[]","resource_id":""}]},{"id":"VCSA-80-000274","title":"The vCenter Server must not configure all port groups to virtual local area network (VLAN) values reserved by upstream physical switches.","desc":"Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001 to 1024 and 4094, while Nexus switches typically reserve 3968 to 4094.\n\nCheck with the documentation for the organization's specific switch. Using a reserved VLAN might result in a denial of service on the network.","descriptions":[{"label":"default","data":"Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001 to 1024 and 4094, while Nexus switches typically reserve 3968 to 4094.\n\nCheck with the documentation for the organization's specific switch. Using a reserved VLAN might result in a denial of service on the network."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nReview the port group VLAN tags and verify that they are not set to a reserved VLAN ID.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup | select Name, VlanConfiguration\n\nIf any port group is configured with a reserved VLAN ID, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab. Change the VLAN ID to an unreserved VLAN ID.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDPortgroup \"portgroup name\" | Set-VDVlanConfiguration -VlanId \"New VLAN#\""}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000274","rid":"SV-VCSA-80-000274","stig_id":"VCSA-80-000274","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000274' do\n  title 'The vCenter Server must not configure all port groups to virtual local area network (VLAN) values reserved by upstream physical switches.'\n  desc  \"\n    Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001 to 1024 and 4094, while Nexus switches typically reserve 3968 to 4094.\n\n    Check with the documentation for the organization's specific switch. Using a reserved VLAN might result in a denial of service on the network.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Review the port group VLAN tags and verify that they are not set to a reserved VLAN ID.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup | select Name, VlanConfiguration\n\n    If any port group is configured with a reserved VLAN ID, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Policies.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab. Change the VLAN ID to an unreserved VLAN ID.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDPortgroup \\\"portgroup name\\\" | Set-VDVlanConfiguration -VlanId \\\"New VLAN#\\\"\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000274'\n  tag rid: 'SV-VCSA-80-000274'\n  tag stig_id: 'VCSA-80-000274'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Where-Object {$_.IsUplink -eq $false} | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vlanlist = ['1001', '1024', '3968', '4047', '4094']\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should_not be_in vlanlist }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000274.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to be in \"1001\", \"1024\", \"3968\", \"4047\", and \"4094\"","run_time":0.0002922,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to be in \"1001\", \"1024\", \"3968\", \"4047\", and \"4094\"","run_time":0.0002454,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to be in \"1001\", \"1024\", \"3968\", \"4047\", and \"4094\"","run_time":0.0002127,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId stdout.strip is expected not to be in \"1001\", \"1024\", \"3968\", \"4047\", and \"4094\"","run_time":0.0004291,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.DefaultPortConfig.Vlan.VlanId\"]","resource_id":""}]},{"id":"VCSA-80-000275","title":"The vCenter Server must configure the \"vpxuser\" auto-password to be changed every 30 days.","desc":"By default, vCenter will change the \"vpxuser\" password automatically every 30 days. Ensure this setting meets site policies. If it does not, configure it to meet password aging policies.\n\nNote: It is very important the password aging policy is not shorter than the default interval that is set to automatically change the \"vpxuser\" password to preclude the possibility that vCenter might be locked out of an ESXi host.","descriptions":[{"label":"default","data":"By default, vCenter will change the \"vpxuser\" password automatically every 30 days. Ensure this setting meets site policies. If it does not, configure it to meet password aging policies.\n\nNote: It is very important the password aging policy is not shorter than the default interval that is set to automatically change the \"vpxuser\" password to preclude the possibility that vCenter might be locked out of an ESXi host."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify that \"VirtualCenter.VimPasswordExpirationInDays\" is set to \"30\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays\n\nIf the \"VirtualCenter.VimPasswordExpirationInDays\" is set to a value other than \"30\" or does not exist, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"VirtualCenter.VimPasswordExpirationInDays\" value to \"30\" or if the value does not exist create it by entering the values in the \"Key\" and \"Value\" fields and clicking \"Add\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nIf the setting already exists:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays | Set-AdvancedSetting -Value 30\n\nIf the setting does not exist:\n\nNew-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays -Value 30"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000275","rid":"SV-VCSA-80-000275","stig_id":"VCSA-80-000275","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000275' do\n  title 'The vCenter Server must configure the \"vpxuser\" auto-password to be changed every 30 days.'\n  desc  \"\n    By default, vCenter will change the \\\"vpxuser\\\" password automatically every 30 days. Ensure this setting meets site policies. If it does not, configure it to meet password aging policies.\n\n    Note: It is very important the password aging policy is not shorter than the default interval that is set to automatically change the \\\"vpxuser\\\" password to preclude the possibility that vCenter might be locked out of an ESXi host.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify that \\\"VirtualCenter.VimPasswordExpirationInDays\\\" is set to \\\"30\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays\n\n    If the \\\"VirtualCenter.VimPasswordExpirationInDays\\\" is set to a value other than \\\"30\\\" or does not exist, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"VirtualCenter.VimPasswordExpirationInDays\\\" value to \\\"30\\\" or if the value does not exist create it by entering the values in the \\\"Key\\\" and \\\"Value\\\" fields and clicking \\\"Add\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    If the setting already exists:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays | Set-AdvancedSetting -Value 30\n\n    If the setting does not exist:\n\n    New-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays -Value 30\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000275'\n  tag rid: 'SV-VCSA-80-000275'\n  tag stig_id: 'VCSA-80-000275'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name VirtualCenter.VimPasswordExpirationInDays | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp '30' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000275.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name VirtualCenter.VimPasswordExpirationInDays | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"30\"","run_time":0.6119271,"start_time":"2023-06-07T08:29:26-06:00","resource_class":"powercli_command","resource_params":"[\"Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name VirtualCenter.VimPasswordExpirationInDays | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"VCSA-80-000276","title":"The vCenter Server must configure the \"vpxuser\" password to meet length policy.","desc":"The \"vpxuser\" password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies.\n\nLonger passwords make brute-force password attacks more difficult. The \"vpxuser\" password is added by vCenter, meaning no manual intervention is normally required. The \"vpxuser\" password length must never be modified to less than the default length of 32 characters.","descriptions":[{"label":"default","data":"The \"vpxuser\" password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies.\n\nLonger passwords make brute-force password attacks more difficult. The \"vpxuser\" password is added by vCenter, meaning no manual intervention is normally required. The \"vpxuser\" password length must never be modified to less than the default length of 32 characters."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify that \"config.vpxd.hostPasswordLength\" is set to \"32\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength and verify it is set to 32.\n\nIf the \"config.vpxd.hostPasswordLength\" is set to a value other than \"32, this is a finding.\n\nIf the setting does not exist, this is not a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"config.vpxd.hostPasswordLength\" value to \"32\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength | Set-AdvancedSetting -Value 32"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000276","rid":"SV-VCSA-80-000276","stig_id":"VCSA-80-000276","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000276' do\n  title 'The vCenter Server must configure the \"vpxuser\" password to meet length policy.'\n  desc  \"\n    The \\\"vpxuser\\\" password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies.\n\n    Longer passwords make brute-force password attacks more difficult. The \\\"vpxuser\\\" password is added by vCenter, meaning no manual intervention is normally required. The \\\"vpxuser\\\" password length must never be modified to less than the default length of 32 characters.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify that \\\"config.vpxd.hostPasswordLength\\\" is set to \\\"32\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength and verify it is set to 32.\n\n    If the \\\"config.vpxd.hostPasswordLength\\\" is set to a value other than \\\"32, this is a finding.\n\n    If the setting does not exist, this is not a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"config.vpxd.hostPasswordLength\\\" value to \\\"32\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength | Set-AdvancedSetting -Value 32\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000276'\n  tag rid: 'SV-VCSA-80-000276'\n  tag stig_id: 'VCSA-80-000276'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.vpxd.hostPasswordLength | Select-Object -ExpandProperty Value'\n  describe.one do\n    describe powercli_command(command) do\n      its('stdout.strip') { should cmp '32' }\n    end\n    describe powercli_command(command) do\n      its('stdout.strip') { should be_empty }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000276.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.vpxd.hostPasswordLength | Select-Object -ExpandProperty Value stdout.strip is expected to be empty","run_time":0.0002715,"start_time":"2023-06-07T08:29:27-06:00","resource_class":"powercli_command","resource_params":"[\"Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name config.vpxd.hostPasswordLength | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"VCSA-80-000277","title":"The vCenter Server must be isolated from the public internet but must still allow for patch notification and delivery.","desc":"vCenter and the embedded Lifecycle Manager system must never have a direct route to the internet. Despite this, updates and patches sourced from VMware on the internet must be delivered in a timely manner.\n\nThere are two methods to accomplish this: a proxy server and the Update Manager Download Service (UMDS). UMDS is an optional module for Lifecycle Manager that fetches upgrades for virtual appliances, patch metadata, patch binaries, and notifications that would not otherwise be available to an isolated Lifecycle Manager directly.\n\nAlternatively, a proxy for Lifecycle Manager can be configured to allow controlled, limited access to the public internet for the sole purpose of patch gathering. Either solution mitigates the risk of internet connectivity by limiting its scope and use.","descriptions":[{"label":"default","data":"vCenter and the embedded Lifecycle Manager system must never have a direct route to the internet. Despite this, updates and patches sourced from VMware on the internet must be delivered in a timely manner.\n\nThere are two methods to accomplish this: a proxy server and the Update Manager Download Service (UMDS). UMDS is an optional module for Lifecycle Manager that fetches upgrades for virtual appliances, patch metadata, patch binaries, and notifications that would not otherwise be available to an isolated Lifecycle Manager directly.\n\nAlternatively, a proxy for Lifecycle Manager can be configured to allow controlled, limited access to the public internet for the sole purpose of patch gathering. Either solution mitigates the risk of internet connectivity by limiting its scope and use."},{"label":"rationale","data":""},{"label":"check","data":"Check the following conditions:\n\n1. Lifecycle Manager must be configured to use the UMDS.\n\nOR\n\n2. Lifecycle Manager must be configured to use a proxy server for access to VMware patch repositories.\n\nOR\n\n3. Lifecycle Manager must disable internet patch repositories and any patches must be manually validated and imported as needed.\n\nOption 1:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nVerify the \"Download patches from a UMDS shared repository\" radio button is selected and that a valid UMDS repository is supplied.\n\nClick \"Cancel\".\n\nIf this is not set, this is a finding.\n\nOption 2:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nVerify the \"Download patches directly from the internet\" radio button is selected.\n\nClick \"Cancel\".\n\nNavigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\nVerify that \"HTTPS\" is \"Enabled\".\n\nClick the \"HTTPS\" row.\n\nVerify the proxy server configuration is accurate.\n\nIf this is not set, this is a finding.\n\nOption 3:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\nVerify the \"Automatic downloads\" option is disabled.\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nVerify any download sources are disabled.\n\nIf this is not set, this is a finding."},{"label":"fix","data":"Option 1:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nSelect the \"Download patches from a UMDS shared repository\" radio button and supply a valid UMDS repository.\n\nClick \"Save\".\n\nOption 2:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\nClick the \"Change Download Source\" button.\n\nSelect the \"Download patches directly from the internet\" radio button.\n\nClick \"Save\".\n\nNavigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\nClick \"Edit\".\n\nSlide \"HTTPS\" to \"Enabled\".\n\nSupply the appropriate proxy server configuration.\n\nClick \"Save\".\n\nOption 3:\n\nFrom the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\nClick \"Edit\" and uncheck \"Download patches\".\n\nUnder \"Patch Setup\" select each download source and click Disable."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000277","rid":"SV-VCSA-80-000277","stig_id":"VCSA-80-000277","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000277' do\n  title 'The vCenter Server must be isolated from the public internet but must still allow for patch notification and delivery.'\n  desc  \"\n    vCenter and the embedded Lifecycle Manager system must never have a direct route to the internet. Despite this, updates and patches sourced from VMware on the internet must be delivered in a timely manner.\n\n    There are two methods to accomplish this: a proxy server and the Update Manager Download Service (UMDS). UMDS is an optional module for Lifecycle Manager that fetches upgrades for virtual appliances, patch metadata, patch binaries, and notifications that would not otherwise be available to an isolated Lifecycle Manager directly.\n\n    Alternatively, a proxy for Lifecycle Manager can be configured to allow controlled, limited access to the public internet for the sole purpose of patch gathering. Either solution mitigates the risk of internet connectivity by limiting its scope and use.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Check the following conditions:\n\n    1. Lifecycle Manager must be configured to use the UMDS.\n\n    OR\n\n    2. Lifecycle Manager must be configured to use a proxy server for access to VMware patch repositories.\n\n    OR\n\n    3. Lifecycle Manager must disable internet patch repositories and any patches must be manually validated and imported as needed.\n\n    Option 1:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Verify the \\\"Download patches from a UMDS shared repository\\\" radio button is selected and that a valid UMDS repository is supplied.\n\n    Click \\\"Cancel\\\".\n\n    If this is not set, this is a finding.\n\n    Option 2:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Verify the \\\"Download patches directly from the internet\\\" radio button is selected.\n\n    Click \\\"Cancel\\\".\n\n    Navigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\n    Verify that \\\"HTTPS\\\" is \\\"Enabled\\\".\n\n    Click the \\\"HTTPS\\\" row.\n\n    Verify the proxy server configuration is accurate.\n\n    If this is not set, this is a finding.\n\n    Option 3:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\n    Verify the \\\"Automatic downloads\\\" option is disabled.\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Verify any download sources are disabled.\n\n    If this is not set, this is a finding.\n  \"\n  desc 'fix', \"\n    Option 1:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Select the \\\"Download patches from a UMDS shared repository\\\" radio button and supply a valid UMDS repository.\n\n    Click \\\"Save\\\".\n\n    Option 2:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Setup.\n\n    Click the \\\"Change Download Source\\\" button.\n\n    Select the \\\"Download patches directly from the internet\\\" radio button.\n\n    Click \\\"Save\\\".\n\n    Navigate to the vCenter Server Management interface at https://<vcenter dns>:5480 >> Networking >> Proxy Settings.\n\n    Click \\\"Edit\\\".\n\n    Slide \\\"HTTPS\\\" to \\\"Enabled\\\".\n\n    Supply the appropriate proxy server configuration.\n\n    Click \\\"Save\\\".\n\n    Option 3:\n\n    From the vSphere Client, go to Lifecycle Manager >> Settings >> Patch Downloads.\n\n    Click \\\"Edit\\\" and uncheck \\\"Download patches\\\".\n\n    Under \\\"Patch Setup\\\" select each download source and click Disable.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000277'\n  tag rid: 'SV-VCSA-80-000277'\n  tag stig_id: 'VCSA-80-000277'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000277.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":1.02e-05,"start_time":"2023-06-07T08:29:27-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000278","title":"The vCenter Server must use unique service accounts when applications connect to vCenter.","desc":"To not violate nonrepudiation (i.e., deny the authenticity of who is connecting to vCenter), when applications need to connect to vCenter they must use unique service accounts.","descriptions":[{"label":"default","data":"To not violate nonrepudiation (i.e., deny the authenticity of who is connecting to vCenter), when applications need to connect to vCenter they must use unique service accounts."},{"label":"rationale","data":""},{"label":"check","data":"Verify each external application that connects to vCenter has a unique service account dedicated to that application.\n\nFor example, there should be separate accounts for Log Insight, Operations Manager, or anything else that requires an account to access vCenter.\n\nIf any application shares a service account that is used to connect to vCenter, this is a finding."},{"label":"fix","data":"For applications sharing service accounts, create a new service account to assign to the application so that no application shares a service account with another.\n\nWhen standing up a new application that requires access to vCenter, always create a new service account prior to installation and grant only the permissions needed for that application."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000278","rid":"SV-VCSA-80-000278","stig_id":"VCSA-80-000278","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000278' do\n  title 'The vCenter Server must use unique service accounts when applications connect to vCenter.'\n  desc  'To not violate nonrepudiation (i.e., deny the authenticity of who is connecting to vCenter), when applications need to connect to vCenter they must use unique service accounts.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Verify each external application that connects to vCenter has a unique service account dedicated to that application.\n\n    For example, there should be separate accounts for Log Insight, Operations Manager, or anything else that requires an account to access vCenter.\n\n    If any application shares a service account that is used to connect to vCenter, this is a finding.\n  \"\n  desc  'fix', \"\n    For applications sharing service accounts, create a new service account to assign to the application so that no application shares a service account with another.\n\n    When standing up a new application that requires access to vCenter, always create a new service account prior to installation and grant only the permissions needed for that application.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000278'\n  tag rid: 'SV-VCSA-80-000278'\n  tag stig_id: 'VCSA-80-000278'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000278.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":8.4e-06,"start_time":"2023-06-07T08:29:27-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000279","title":"The vCenter Server must protect the confidentiality and integrity of transmitted information by isolating Internet Protocol (IP)-based storage traffic.","desc":"Virtual machines might share virtual switches and virtual local area networks (VLAN) with the IP-based storage configurations.\n\nIP-based storage includes vSAN, Internet Small Computer System Interface (iSCSI), and Network File System (NFS). This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and virtual machines will limit unauthorized users from viewing the traffic.","descriptions":[{"label":"default","data":"Virtual machines might share virtual switches and virtual local area networks (VLAN) with the IP-based storage configurations.\n\nIP-based storage includes vSAN, Internet Small Computer System Interface (iSCSI), and Network File System (NFS). This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\nTo restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and virtual machines will limit unauthorized users from viewing the traffic."},{"label":"rationale","data":""},{"label":"check","data":"If IP-based storage is not used, this is not applicable.\n\nIP-based storage (iSCSI, NFS, vSAN) VMkernel port groups must be in a dedicated VLAN that can be on a standard or distributed virtual switch that is logically separated from other traffic types.\n\nThe check for this will be unique per environment.\n\nTo check a standard switch, do the following:\n\nFrom the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and note the VLAN ID associated with each port group.\n\nVerify it is dedicated to that purpose and is logically separated from other traffic types.\n\nTo check a distributed switch, do the following,\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect and expand a distributed switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to the \"Summary\" tab.\n\nNote the VLAN ID associated with each port group and verify it is dedicated to that purpose and is logically separated from other traffic types.\n\nIf any IP-based storage networks are not isolated from other traffic types, this is a finding."},{"label":"fix","data":"Configuration of an IP-based VMkernel will be unique to each environment.\n\nTo configure VLANs and traffic types, do the following:\n\nStandard switch:\n\nFrom the vSphere Client, select the ESXi host and go to Configure >> Networking >> VMkernel adapters.\n\nSelect the Storage VMkernel (for any IP-based storage). Click \"Edit...\" and click the \"Port properties\" tab.\n\nUncheck everything (unless vSAN).\n\nClick the \"IPv4\" settings or \"IPv6\" settings tab.\n\nEnter the appropriate IP address and subnet information.\n\nClick \"OK\".\n\nFrom the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and click \"...\". Click \"Edit Settings\". On the \"Properties\" tab, enter the appropriate VLAN ID and click \"OK\".\n\nDistributed switch:\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Topology.\n\nSelect the Storage VMkernel (for any IP-based storage). Click \"...\" and click \"Edit Settings\".\n\nOn the \"Port properties\" tab, uncheck everything (unless vSAN).\n\nClick the \"IPv4\" settings or \"IPv6\" settings tab.\n\nEnter the appropriate IP address and subnet information.\n\nClick \"OK\".\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect and expand a distributed switch.\n\nFor each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nClick the \"VLAN\" tab.\n\nEnter the appropriate VLAN type and ID and click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000279","rid":"SV-VCSA-80-000279","stig_id":"VCSA-80-000279","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000279' do\n  title 'The vCenter Server must protect the confidentiality and integrity of transmitted information by isolating Internet Protocol (IP)-based storage traffic.'\n  desc  \"\n    Virtual machines might share virtual switches and virtual local area networks (VLAN) with the IP-based storage configurations.\n\n    IP-based storage includes vSAN, Internet Small Computer System Interface (iSCSI), and Network File System (NFS). This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network.\n\n    To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and virtual machines will limit unauthorized users from viewing the traffic.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If IP-based storage is not used, this is not applicable.\n\n    IP-based storage (iSCSI, NFS, vSAN) VMkernel port groups must be in a dedicated VLAN that can be on a standard or distributed virtual switch that is logically separated from other traffic types.\n\n    The check for this will be unique per environment.\n\n    To check a standard switch, do the following:\n\n    From the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and note the VLAN ID associated with each port group.\n\n    Verify it is dedicated to that purpose and is logically separated from other traffic types.\n\n    To check a distributed switch, do the following,\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select and expand a distributed switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to the \\\"Summary\\\" tab.\n\n    Note the VLAN ID associated with each port group and verify it is dedicated to that purpose and is logically separated from other traffic types.\n\n    If any IP-based storage networks are not isolated from other traffic types, this is a finding.\n  \"\n  desc 'fix', \"\n    Configuration of an IP-based VMkernel will be unique to each environment.\n\n    To configure VLANs and traffic types, do the following:\n\n    Standard switch:\n\n    From the vSphere Client, select the ESXi host and go to Configure >> Networking >> VMkernel adapters.\n\n    Select the Storage VMkernel (for any IP-based storage). Click \\\"Edit...\\\" and click the \\\"Port properties\\\" tab.\n\n    Uncheck everything (unless vSAN).\n\n    Click the \\\"IPv4\\\" settings or \\\"IPv6\\\" settings tab.\n\n    Enter the appropriate IP address and subnet information.\n\n    Click \\\"OK\\\".\n\n    From the vSphere Client, select the ESXi host and go to Configure >> Networking >> Virtual switches. Select a standard switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and click \\\"...\\\". Click \\\"Edit Settings\\\". On the \\\"Properties\\\" tab, enter the appropriate VLAN ID and click \\\"OK\\\".\n\n    Distributed switch:\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Topology.\n\n    Select the Storage VMkernel (for any IP-based storage). Click \\\"...\\\" and click \\\"Edit Settings\\\".\n\n    On the \\\"Port properties\\\" tab, uncheck everything (unless vSAN).\n\n    Click the \\\"IPv4\\\" settings or \\\"IPv6\\\" settings tab.\n\n    Enter the appropriate IP address and subnet information.\n\n    Click \\\"OK\\\".\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select and expand a distributed switch.\n\n    For each storage port group (iSCSI, NFS, vSAN), select the port group and navigate to Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Click the \\\"VLAN\\\" tab.\n\n    Enter the appropriate VLAN type and ID and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000279'\n  tag rid: 'SV-VCSA-80-000279'\n  tag stig_id: 'VCSA-80-000279'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000279.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":8.9e-06,"start_time":"2023-06-07T08:29:27-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000280","title":"The vCenter server must be configured to send events to a central log server.","desc":"vCenter server generates volumes of security-relevant application-level events. Examples include logins, system reconfigurations, system degradation warnings, and more. To ensure these events are available for forensic analysis and correlation, they must be sent to the syslog and forwarded on to the configured Security Information and Event Management (SIEM) system and/or central log server.\n\nThe vCenter server sends events to syslog by default, but this configuration must be verified and maintained.","descriptions":[{"label":"default","data":"vCenter server generates volumes of security-relevant application-level events. Examples include logins, system reconfigurations, system degradation warnings, and more. To ensure these events are available for forensic analysis and correlation, they must be sent to the syslog and forwarded on to the configured Security Information and Event Management (SIEM) system and/or central log server.\n\nThe vCenter server sends events to syslog by default, but this configuration must be verified and maintained."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nVerify that \"vpxd.event.syslog.enabled\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled\n\nIf the \"vpxd.event.syslog.enabled\" value is not set to \"true\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\nClick \"Edit Settings\" and configure the \"vpxd.event.syslog.enabled\" setting to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled | Set-AdvancedSetting -Value true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000358","gid":"V-VCSA-80-000280","rid":"SV-VCSA-80-000280","stig_id":"VCSA-80-000280","cci":["CCI-001851"],"nist":["AU-4 (1)"]},"code":"control 'VCSA-80-000280' do\n  title 'The vCenter server must be configured to send events to a central log server.'\n  desc  \"\n    vCenter server generates volumes of security-relevant application-level events. Examples include logins, system reconfigurations, system degradation warnings, and more. To ensure these events are available for forensic analysis and correlation, they must be sent to the syslog and forwarded on to the configured Security Information and Event Management (SIEM) system and/or central log server.\n\n    The vCenter server sends events to syslog by default, but this configuration must be verified and maintained.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Verify that \\\"vpxd.event.syslog.enabled\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled\n\n    If the \\\"vpxd.event.syslog.enabled\\\" value is not set to \\\"true\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Advanced Settings.\n\n    Click \\\"Edit Settings\\\" and configure the \\\"vpxd.event.syslog.enabled\\\" setting to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled | Set-AdvancedSetting -Value true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000358'\n  tag gid: 'V-VCSA-80-000280'\n  tag rid: 'SV-VCSA-80-000280'\n  tag stig_id: 'VCSA-80-000280'\n  tag cci: ['CCI-001851']\n  tag nist: ['AU-4 (1)']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name vpxd.event.syslog.enabled | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp 'true' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000280.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name vpxd.event.syslog.enabled | Select-Object -ExpandProperty Value stdout.strip is expected to cmp == \"true\"","run_time":0.6452781,"start_time":"2023-06-07T08:29:27-06:00","resource_class":"powercli_command","resource_params":"[\"Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name vpxd.event.syslog.enabled | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"VCSA-80-000281","title":"The vCenter Server must disable or restrict the connectivity between vSAN Health Check and public Hardware Compatibility List (HCL) by use of an external proxy server.","desc":"The vSAN Health Check is able to download the HCL from VMware to check compliance against the underlying vSAN Cluster hosts. To ensure the vCenter server is not directly downloading content from the internet, this functionality must be disabled. If this feature is necessary, an external proxy server must be configured.","descriptions":[{"label":"default","data":"The vSAN Health Check is able to download the HCL from VMware to check compliance against the underlying vSAN Cluster hosts. To ensure the vCenter server is not directly downloading content from the internet, this functionality must be disabled. If this feature is necessary, an external proxy server must be configured."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\nIf the HCL internet download is not required, verify \"Status\" is \"Disabled\".\n\nIf the \"Status\" is \"Enabled\", this is a finding.\n\nIf the HCL internet download is required, verify \"Status\" is \"Enabled\" and a proxy host is configured.\n\nIf \"Status\" is \"Enabled\" and a proxy is not configured, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\nClick \"Edit\".\n\nIf the HCL internet download is not required, ensure that \"Status\" is \"Disabled\".\n\nIf the HCL internet download is required, ensure that \"Status\" is \"Enabled\" and that a proxy host is appropriately configured."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000281","rid":"SV-VCSA-80-000281","stig_id":"VCSA-80-000281","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000281' do\n  title 'The vCenter Server must disable or restrict the connectivity between vSAN Health Check and public Hardware Compatibility List (HCL) by use of an external proxy server.'\n  desc  'The vSAN Health Check is able to download the HCL from VMware to check compliance against the underlying vSAN Cluster hosts. To ensure the vCenter server is not directly downloading content from the internet, this functionality must be disabled. If this feature is necessary, an external proxy server must be configured.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\n    If the HCL internet download is not required, verify \\\"Status\\\" is \\\"Disabled\\\".\n\n    If the \\\"Status\\\" is \\\"Enabled\\\", this is a finding.\n\n    If the HCL internet download is required, verify \\\"Status\\\" is \\\"Enabled\\\" and a proxy host is configured.\n\n    If \\\"Status\\\" is \\\"Enabled\\\" and a proxy is not configured, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Configure >> vSAN >> Internet Connectivity.\n\n    Click \\\"Edit\\\".\n\n    If the HCL internet download is not required, ensure that \\\"Status\\\" is \\\"Disabled\\\".\n\n    If the HCL internet download is required, ensure that \\\"Status\\\" is \\\"Enabled\\\" and that a proxy host is appropriately configured.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000281'\n  tag rid: 'SV-VCSA-80-000281'\n  tag stig_id: 'VCSA-80-000281'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  # Get all clusters with vSAN enabled\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object | Select-Object -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !clusters.empty?\n    command = '$vsanphview = Get-VsanView -Id VsanPhoneHomeSystem-vsan-phonehome-system; $vsanphview.QueryVsanCloudHealthStatus().InternetConnectivity'\n    vcinternetenabled = powercli_command(command).stdout.strip\n\n    if vcinternetenabled == 'True'\n      proxycommand = '$vsanhealthview = Get-VsanView -Id VsanVcClusterHealthSystem-vsan-cluster-health-system; $vsanhealthview.VsanHealthQueryVsanProxyConfig().Host'\n      describe powercli_command(proxycommand) do\n        its('stdout.strip') { should_not cmp '' }\n      end\n    else\n      describe 'Enable Internet access for all vSAN clusters.' do\n        subject { vcinternetenabled }\n        it { should cmp 'false' }\n      end\n    end\n  else\n    describe 'No clusters with vSAN enabled found...skipping tests' do\n      skip 'No clusters with vSAN enabled found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000281.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: $vsanhealthview = Get-VsanView -Id VsanVcClusterHealthSystem-vsan-cluster-health-system; $vsanhealthview.VsanHealthQueryVsanProxyConfig().Host stdout.strip is expected not to cmp == \"\"","run_time":0.0795031,"start_time":"2023-06-07T08:29:28-06:00","message":"\nexpected: \n     got: \n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"$vsanhealthview = Get-VsanView -Id VsanVcClusterHealthSystem-vsan-cluster-health-system; $vsanhealthview.VsanHealthQueryVsanProxyConfig().Host\"]","resource_id":""}]},{"id":"VCSA-80-000282","title":"The vCenter Server must configure the vSAN Datastore name to a unique name.","desc":"A vSAN Datastore name by default is \"vsanDatastore\". If more than one vSAN cluster is present in vCenter, both datastores will have the same name by default, potentially leading to confusion and manually misplaced workloads.","descriptions":[{"label":"default","data":"A vSAN Datastore name by default is \"vsanDatastore\". If more than one vSAN cluster is present in vCenter, both datastores will have the same name by default, potentially leading to confusion and manually misplaced workloads."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Datastores.\n\nReview the datastores and identify any datastores with \"vSAN\" as the datastore type.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nIf($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\nWrite-Host \"vSAN Enabled Cluster found\"\nGet-Cluster | where {$_.VsanEnabled} | Get-Datastore | where {$_.type -match \"vsan\"}\n}\nelse{\nWrite-Host \"vSAN is not enabled, this finding is not applicable.\"\n}\n\nIf vSAN is enabled and a datastore is named \"vsanDatastore\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Datastores.\n\nRight-click on the datastore named \"vsanDatastore\" and select \"Rename\".\n\nRename the datastore based on site-specific naming standards.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\nIf($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\nWrite-Host \"vSAN Enabled Cluster found\"\n$Clusters = Get-Cluster | where {$_.VsanEnabled}\nForeach ($clus in $clusters){\n $clus | Get-Datastore | where {$_.type -match \"vsan\"} | Set-Datastore -Name $(($clus.name) + \"_vSAN_Datastore\")\n}\n}\nelse{\nWrite-Host \"vSAN is not enabled, this finding is not applicable.\"\n}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000282","rid":"SV-VCSA-80-000282","stig_id":"VCSA-80-000282","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000282' do\n  title 'The vCenter Server must configure the vSAN Datastore name to a unique name.'\n  desc  'A vSAN Datastore name by default is \"vsanDatastore\". If more than one vSAN cluster is present in vCenter, both datastores will have the same name by default, potentially leading to confusion and manually misplaced workloads.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Datastores.\n\n    Review the datastores and identify any datastores with \\\"vSAN\\\" as the datastore type.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    If($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\n    Write-Host \\\"vSAN Enabled Cluster found\\\"\n    Get-Cluster | where {$_.VsanEnabled} | Get-Datastore | where {$_.type -match \\\"vsan\\\"}\n    }\n    else{\n    Write-Host \\\"vSAN is not enabled, this finding is not applicable.\\\"\n    }\n\n    If vSAN is enabled and a datastore is named \\\"vsanDatastore\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Datastores.\n\n    Right-click on the datastore named \\\"vsanDatastore\\\" and select \\\"Rename\\\".\n\n    Rename the datastore based on site-specific naming standards.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    If($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){\n    Write-Host \\\"vSAN Enabled Cluster found\\\"\n    $Clusters = Get-Cluster | where {$_.VsanEnabled}\n    Foreach ($clus in $clusters){\n     $clus | Get-Datastore | where {$_.type -match \\\"vsan\\\"} | Set-Datastore -Name $(($clus.name) + \\\"_vSAN_Datastore\\\")\n    }\n    }\n    else{\n    Write-Host \\\"vSAN is not enabled, this finding is not applicable.\\\"\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000282'\n  tag rid: 'SV-VCSA-80-000282'\n  tag stig_id: 'VCSA-80-000282'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-Cluster | Where-Object {$_.VsanEnabled} | Get-Datastore | Where-Object {$_.type -match \"vsan\"} | Select-Object -ExpandProperty Name'\n  vsandatastores = powercli_command(command).stdout.strip.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vsandatastores.empty?\n    describe '' do\n      skip 'No VSAN datastores found to check.'\n    end\n  else\n    vsandatastores.each do |ds|\n      describe '' do\n        subject { ds }\n        it { should_not cmp 'vsanDatastore' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000282.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"is expected not to cmp == \"vsanDatastore\"","run_time":0.0002802,"start_time":"2023-06-07T08:29:28-06:00","message":"\nexpected: vsanDatastore\n     got: vsanDatastore\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":""}]},{"id":"VCSA-80-000283","title":"The vCenter Server must disable Username/Password and Windows Integrated Authentication.","desc":"All forms of authentication other than Common Access Card (CAC) must be disabled. Password authentication can be temporarily reenabled for emergency access to the local Single Sign-On (SSO) accounts or Active Directory user/pass accounts, but it must be disabled as soon as CAC authentication is functional.","descriptions":[{"label":"default","data":"All forms of authentication other than Common Access Card (CAC) must be disabled. Password authentication can be temporarily reenabled for emergency access to the local Single Sign-On (SSO) accounts or Active Directory user/pass accounts, but it must be disabled as soon as CAC authentication is functional."},{"label":"rationale","data":""},{"label":"check","data":"If a federated identity provider is configured and used for an identity source, this is not applicable.\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nUnder \"Authentication method\", examine the allowed methods.\n\nIf \"Smart card authentication\" is not enabled and \"Password and windows session authentication\" is not disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\nNext to \"Authentication method\", click \"Edit\".\n\nSelect to radio button to \"Enable smart card authentication\".\n\nClick \"Save\".\n\nTo re-enable password authentication for troubleshooting purposes, run the following command on the vCenter Server Appliance:\n\n# /opt/vmware/bin/sso-config.sh -set_authn_policy -pwdAuthn true -winAuthn false -certAuthn false -securIDAuthn false -t vsphere.local"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000283","rid":"SV-VCSA-80-000283","stig_id":"VCSA-80-000283","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000283' do\n  title 'The vCenter Server must disable Username/Password and Windows Integrated Authentication.'\n  desc  'All forms of authentication other than Common Access Card (CAC) must be disabled. Password authentication can be temporarily reenabled for emergency access to the local Single Sign-On (SSO) accounts or Active Directory user/pass accounts, but it must be disabled as soon as CAC authentication is functional.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If a federated identity provider is configured and used for an identity source, this is not applicable.\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Under \\\"Authentication method\\\", examine the allowed methods.\n\n    If \\\"Smart card authentication\\\" is not enabled and \\\"Password and windows session authentication\\\" is not disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider >> Smart Card Authentication.\n\n    Next to \\\"Authentication method\\\", click \\\"Edit\\\".\n\n    Select to radio button to \\\"Enable smart card authentication\\\".\n\n    Click \\\"Save\\\".\n\n    To re-enable password authentication for troubleshooting purposes, run the following command on the vCenter Server Appliance:\n\n    # /opt/vmware/bin/sso-config.sh -set_authn_policy -pwdAuthn true -winAuthn false -certAuthn false -securIDAuthn false -t vsphere.local\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000283'\n  tag rid: 'SV-VCSA-80-000283'\n  tag stig_id: 'VCSA-80-000283'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  if input('embeddedIdp')\n    describe powercli_command('(Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled') do\n      its('stdout.strip') { should cmp 'true' }\n    end\n    describe powercli_command('(Get-SsoAuthenticationPolicy).PasswordAuthnEnabled') do\n      its('stdout.strip') { should cmp 'false' }\n    end\n    describe powercli_command('(Get-SsoAuthenticationPolicy).WindowsAuthnEnabled') do\n      its('stdout.strip') { should cmp 'false' }\n    end\n  else\n    describe 'A federated IDP is configured so this is Not Applicable.' do\n      skip 'A federated IDP is configured so this is Not Applicable.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000283.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled stdout.strip is expected to cmp == \"true\"","run_time":0.000345,"start_time":"2023-06-07T08:29:28-06:00","message":"\nexpected: true\n     got: False\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoAuthenticationPolicy).SmartCardAuthnEnabled\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoAuthenticationPolicy).PasswordAuthnEnabled stdout.strip is expected to cmp == \"false\"","run_time":0.1837198,"start_time":"2023-06-07T08:29:28-06:00","message":"\nexpected: false\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoAuthenticationPolicy).PasswordAuthnEnabled\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: (Get-SsoAuthenticationPolicy).WindowsAuthnEnabled stdout.strip is expected to cmp == \"false\"","run_time":0.2947417,"start_time":"2023-06-07T08:29:28-06:00","message":"\nexpected: false\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"(Get-SsoAuthenticationPolicy).WindowsAuthnEnabled\"]","resource_id":""}]},{"id":"VCSA-80-000284","title":"The vCenter Server must restrict access to the default roles with cryptographic permissions.","desc":"In vSphere, the built-in \"Administrator\" role contains permission to perform cryptographic operations such as Key Management Server (KMS) functions and encrypting and decrypting virtual machine disks. This role must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use.\n\nA new built-in role called \"No Cryptography Administrator\" exists to provide all administrative permissions except cryptographic operations. Permissions must be restricted such that normal vSphere administrators are assigned the \"No Cryptography Administrator\" role or more restrictive.\n\nThe \"Administrator\" role must be tightly controlled and must not be applied to administrators who will not be doing cryptographic work. Catastrophic data loss can result from poorly administered cryptography.","descriptions":[{"label":"default","data":"In vSphere, the built-in \"Administrator\" role contains permission to perform cryptographic operations such as Key Management Server (KMS) functions and encrypting and decrypting virtual machine disks. This role must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use.\n\nA new built-in role called \"No Cryptography Administrator\" exists to provide all administrative permissions except cryptographic operations. Permissions must be restricted such that normal vSphere administrators are assigned the \"No Cryptography Administrator\" role or more restrictive.\n\nThe \"Administrator\" role must be tightly controlled and must not be applied to administrators who will not be doing cryptographic work. Catastrophic data loss can result from poorly administered cryptography."},{"label":"rationale","data":""},{"label":"check","data":"By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\nFrom the vSphere Client, go to Administration >> Access Control >> Roles.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VIPermission | Where {$_.Role -eq \"Admin\" -or $_.Role -eq \"NoTrustedAdmin\" -or $_.Role -eq \"vCLSAdmin\" -or $_.Role -eq \"vSphereKubernetesManager\"} | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\nIf there are any users or groups assigned to the default roles with cryptographic permissions and are not explicitly designated to perform cryptographic operations, this is a finding.\n\nThe built-in solution users assigned to the administrator role are NOT a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nMove any accounts not explicitly designated for cryptographic operations, other than Solution Users, to other roles such as \"No Cryptography Administrator\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000284","rid":"SV-VCSA-80-000284","stig_id":"VCSA-80-000284","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000284' do\n  title 'The vCenter Server must restrict access to the default roles with cryptographic permissions.'\n  desc  \"\n    In vSphere, the built-in \\\"Administrator\\\" role contains permission to perform cryptographic operations such as Key Management Server (KMS) functions and encrypting and decrypting virtual machine disks. This role must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use.\n\n    A new built-in role called \\\"No Cryptography Administrator\\\" exists to provide all administrative permissions except cryptographic operations. Permissions must be restricted such that normal vSphere administrators are assigned the \\\"No Cryptography Administrator\\\" role or more restrictive.\n\n    The \\\"Administrator\\\" role must be tightly controlled and must not be applied to administrators who will not be doing cryptographic work. Catastrophic data loss can result from poorly administered cryptography.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VIPermission | Where {$_.Role -eq \\\"Admin\\\" -or $_.Role -eq \\\"NoTrustedAdmin\\\" -or $_.Role -eq \\\"vCLSAdmin\\\" -or $_.Role -eq \\\"vSphereKubernetesManager\\\"} | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\n    If there are any users or groups assigned to the default roles with cryptographic permissions and are not explicitly designated to perform cryptographic operations, this is a finding.\n\n    The built-in solution users assigned to the administrator role are NOT a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Move any accounts not explicitly designated for cryptographic operations, other than Solution Users, to other roles such as \\\"No Cryptography Administrator\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000284'\n  tag rid: 'SV-VCSA-80-000284'\n  tag stig_id: 'VCSA-80-000284'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vcCryptoAdmins = input('vcCryptoAdmins')\n\n  # Get all users/groups with Admin/Administrator role excluding vpxd- accounts\n  command = 'Get-VIPermission | Where-Object {($_.Role -eq \"Admin\" -or $_.Role -eq \"NoTrustedAdmin\" -or $_.Role -eq \"vCLSAdmin\" -or $_.Role -eq \"vSphereKubernetesManager\") -and $_.Principal -notmatch \"vpxd-\"} | Select-Object -ExpandProperty Principal'\n  cryptoadmins = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !cryptoadmins.empty?\n    cryptoadmins.each do |cryptoadmin|\n      describe cryptoadmin do\n        subject { cryptoadmin }\n        it { should be_in vcCryptoAdmins }\n      end\n    end\n  else\n    describe 'No users/groups found assigned to crypto roles...skipping tests.' do\n      skip 'No users/groups found assigned to crypto roles...skipping tests.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000284.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VSPHERE.LOCAL\\Administrator is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0003841,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\Administrator"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\Administrators is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0002994,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\Administrators"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\Administrators is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0002966,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\Administrators"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\vCLSAdmin is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0002984,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\vCLSAdmin"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\Administrators is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0004221,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\Administrators"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\vCLSAdmin is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0006365,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\vCLSAdmin"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\Administrators is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0002881,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\Administrators"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\vCLSAdmin is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0002754,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\vCLSAdmin"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\Administrators is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.000276,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\Administrators"},{"status":"passed","code_desc":"VSPHERE.LOCAL\\vCLSAdmin is expected to be in \"VSPHERE.LOCAL\\\\Administrator\", \"VSPHERE.LOCAL\\\\Administrators\", and \"VSPHERE.LOCAL\\\\vCLSAdmin\"","run_time":0.0002728,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VSPHERE.LOCAL\\vCLSAdmin"}]},{"id":"VCSA-80-000285","title":"The vCenter Server must restrict access to cryptographic permissions.","desc":"These permissions must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use. Catastrophic data loss can result from poorly administered cryptography.","descriptions":[{"label":"default","data":"These permissions must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use. Catastrophic data loss can result from poorly administered cryptography."},{"label":"rationale","data":""},{"label":"check","data":"By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\nFrom the vSphere Client, go to Administration >> Access Control >> Roles.\n\nHighlight each role and click the 'Privileges\" button in the right pane.\n\nVerify that only the Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager and any site-specific cryptographic roles have the following permissions:\n\nCryptographic Operations privileges\nGlobal.Diagnostics\nHost.Inventory.Add host to cluster\nHost.Inventory.Add standalone host\nHost.Local operations.Manage user groups\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$roles = Get-VIRole\nForEach($role in $roles){\n    $privileges = $role.PrivilegeList\n    If($privileges -match \"Crypto*\" -or $privileges -match \"Global.Diagnostics\" -or $privileges -match \"Host.Inventory.Add*\" -or $privileges -match \"Host.Local operations.Manage user groups\"){\n    Write-Host \"$role has Cryptographic privileges\"\n    }\n}\n\nIf any role other than the four default roles contain the permissions listed above and is not authorized to perform cryptographic related operations, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nHighlight the target custom role and click \"Edit\".\n\nRemove the following permissions from any custom role that is not authorized to perform cryptographic related operations:\n\nCryptographic Operations privileges\nGlobal.Diagnostics\nHost.Inventory.Add host to cluster\nHost.Inventory.Add standalone host\nHost.Local operations.Manage user groups"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000285","rid":"SV-VCSA-80-000285","stig_id":"VCSA-80-000285","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000285' do\n  title 'The vCenter Server must restrict access to cryptographic permissions.'\n  desc  'These permissions must be reserved for cryptographic administrators where virtual machine encryption and/or vSAN encryption is in use. Catastrophic data loss can result from poorly administered cryptography.'\n  desc  'rationale', ''\n  desc  'check', \"\n    By default, there are four roles that contain cryptographic related permissions: Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager.\n\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Highlight each role and click the 'Privileges\\\" button in the right pane.\n\n    Verify that only the Administrator, No Trusted Infrastructure Administrator, vCLSAdmin, and vSphere Kubernetes Manager and any site-specific cryptographic roles have the following permissions:\n\n    Cryptographic Operations privileges\n    Global.Diagnostics\n    Host.Inventory.Add host to cluster\n    Host.Inventory.Add standalone host\n    Host.Local operations.Manage user groups\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $roles = Get-VIRole\n    ForEach($role in $roles){\n        $privileges = $role.PrivilegeList\n        If($privileges -match \\\"Crypto*\\\" -or $privileges -match \\\"Global.Diagnostics\\\" -or $privileges -match \\\"Host.Inventory.Add*\\\" -or $privileges -match \\\"Host.Local operations.Manage user groups\\\"){\n        Write-Host \\\"$role has Cryptographic privileges\\\"\n        }\n    }\n\n    If any role other than the four default roles contain the permissions listed above and is not authorized to perform cryptographic related operations, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    Highlight the target custom role and click \\\"Edit\\\".\n\n    Remove the following permissions from any custom role that is not authorized to perform cryptographic related operations:\n\n    Cryptographic Operations privileges\n    Global.Diagnostics\n    Host.Inventory.Add host to cluster\n    Host.Inventory.Add standalone host\n    Host.Local operations.Manage user groups\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000285'\n  tag rid: 'SV-VCSA-80-000285'\n  tag stig_id: 'VCSA-80-000285'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vcCryptoRoles = input('vcCryptoRoles')\n\n  command = 'Get-VIRole | Where-Object {$_.PrivilegeList -match \"Crypto*\" -or $_.PrivilegeList -match \"Global.Diagnostics\" -or $_.PrivilegeList -match \"Host.Inventory.Add*\" -or $_.PrivilegeList -match \"Host.Local operations.Manage user groups\"} | Select-Object -ExpandProperty Name'\n  cryptoroles = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !cryptoroles.empty?\n    cryptoroles.each do |cryptorole|\n      describe cryptorole do\n        subject { cryptorole }\n        it { should be_in vcCryptoRoles }\n      end\n    end\n  else\n    describe 'No roles found with crypto permissions...skipping tests.' do\n      skip 'No roles found with crypto permissions...skipping tests.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000285.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"NoTrustedAdmin is expected to be in \"Admin\", \"NoTrustedAdmin\", \"vCLSAdmin\", and \"vSphereKubernetesManager\"","run_time":0.0002811,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"NoTrustedAdmin"},{"status":"passed","code_desc":"Admin is expected to be in \"Admin\", \"NoTrustedAdmin\", \"vCLSAdmin\", and \"vSphereKubernetesManager\"","run_time":0.0002912,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Admin"},{"status":"passed","code_desc":"vSphereKubernetesManager is expected to be in \"Admin\", \"NoTrustedAdmin\", \"vCLSAdmin\", and \"vSphereKubernetesManager\"","run_time":0.0006983,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"vSphereKubernetesManager"},{"status":"passed","code_desc":"vCLSAdmin is expected to be in \"Admin\", \"NoTrustedAdmin\", \"vCLSAdmin\", and \"vSphereKubernetesManager\"","run_time":0.0002581,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"vCLSAdmin"}]},{"id":"VCSA-80-000286","title":"The vCenter Server must have Mutual Challenge Handshake Authentication Protocol (CHAP) configured for vSAN Internet Small Computer System Interface (iSCSI) targets.","desc":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, the potential exists for a man-in-the-middle attack in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.","descriptions":[{"label":"default","data":"When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, the potential exists for a man-in-the-middle attack in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN or if vSAN is enabled but iSCSI is not enabled, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\nFor each iSCSI target, review the value in the \"Authentication\" column.\n\nIf the Authentication method is not set to \"CHAP_Mutual\" for any iSCSI target, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\nFor each iSCSI target, select the item and click \"Edit\".\n\nChange the \"Authentication\" field to \"Mutual CHAP\" and configure the incoming and outgoing users and secrets appropriately."}],"impact":0.0,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000286","rid":"SV-VCSA-80-000286","stig_id":"VCSA-80-000286","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000286' do\n  title 'The vCenter Server must have Mutual Challenge Handshake Authentication Protocol (CHAP) configured for vSAN Internet Small Computer System Interface (iSCSI) targets.'\n  desc  'When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. When not authenticating both the iSCSI target and host, the potential exists for a man-in-the-middle attack in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN or if vSAN is enabled but iSCSI is not enabled, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\n    For each iSCSI target, review the value in the \\\"Authentication\\\" column.\n\n    If the Authentication method is not set to \\\"CHAP_Mutual\\\" for any iSCSI target, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vSAN Enabled Cluster >> Configure >> vSAN >> iSCSI Target Service.\n\n    For each iSCSI target, select the item and click \\\"Edit\\\".\n\n    Change the \\\"Authentication\\\" field to \\\"Mutual CHAP\\\" and configure the incoming and outgoing users and secrets appropriately.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000286'\n  tag rid: 'SV-VCSA-80-000286'\n  tag stig_id: 'VCSA-80-000286'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  setimpact = true\n  if !clusters.empty?\n    clusters.each do |cluster|\n      iscsiEnabled = powercli_command(\"(Get-VsanClusterConfiguration -Cluster \\\"#{cluster}\\\").IscsiTargetServiceEnabled\").stdout.strip\n      if iscsiEnabled == 'True'\n        command = \"(Get-VsanClusterConfiguration -Cluster \\\"#{cluster}\\\").DefaultIscsiAuthenticationType\"\n        describe powercli_command(command) do\n          its('stdout.strip') { should cmp 'MutualChap' }\n        end\n        setimpact = false\n      else\n        describe \"vSAN iSCSI service not enabled on cluster: #{cluster}...this is not applicable.\" do\n          skip \"vSAN iSCSI service not enabled on cluster: #{cluster}...this is not applicable.\"\n        end\n      end\n    end\n  else\n    describe '' do\n      skip 'No vSAN enabled clusters found...this is not applicable.'\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000286.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"vSAN iSCSI service not enabled on cluster: cluster0...this is not applicable.","run_time":9.9e-06,"start_time":"2023-06-07T08:29:28-06:00","resource":"","skip_message":"vSAN iSCSI service not enabled on cluster: cluster0...this is not applicable.","resource_class":"Object","resource_params":"[]","resource_id":"vSAN iSCSI service not enabled on cluster: cluster0...this is not applicable."}]},{"id":"VCSA-80-000287","title":"The vCenter Server must have new Key Encryption Keys (KEKs) reissued at regular intervals for vSAN encrypted datastore(s).","desc":"The KEK for a vSAN encrypted datastore is generated by the Key Management Server (KMS) and serves as a wrapper and lock around the Disk Encryption Key (DEK). The DEK is generated by the host and is used to encrypt and decrypt the datastore. A shallow rekey is a procedure in which the KMS issues a new KEK to the ESXi host, which rewraps the DEK but does not change the DEK or any data on disk.\n\nThis operation must be done on a regular, site-defined interval and can be viewed as similar in criticality to changing an administrative password. If the KMS is compromised, a standing operational procedure to rekey will put a time limit on the usefulness of any stolen KMS data.","descriptions":[{"label":"default","data":"The KEK for a vSAN encrypted datastore is generated by the Key Management Server (KMS) and serves as a wrapper and lock around the Disk Encryption Key (DEK). The DEK is generated by the host and is used to encrypt and decrypt the datastore. A shallow rekey is a procedure in which the KMS issues a new KEK to the ESXi host, which rewraps the DEK but does not change the DEK or any data on disk.\n\nThis operation must be done on a regular, site-defined interval and can be viewed as similar in criticality to changing an administrative password. If the KMS is compromised, a standing operational procedure to rekey will put a time limit on the usefulness of any stolen KMS data."},{"label":"rationale","data":""},{"label":"check","data":"If vSAN is not in use, this is not applicable.\n\nInterview the system administrator (SA) to determine that a procedure has been put in place to perform a shallow rekey of all vSAN encrypted datastores at regular, site-defined intervals.\n\nVMware recommends a 60-day rekey task, but this interval must be defined by the SA and the information system security officer (ISSO).\n\nIf vSAN encryption is not in use, this is not a finding.\n\nIf vSAN encryption is in use and a regular rekey procedure is not in place, this is a finding."},{"label":"fix","data":"If vSAN encryption is in use, ensure that a regular rekey procedure is in place."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000287","rid":"SV-VCSA-80-000287","stig_id":"VCSA-80-000287","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000287' do\n  title 'The vCenter Server must have new Key Encryption Keys (KEKs) reissued at regular intervals for vSAN encrypted datastore(s).'\n  desc  \"\n    The KEK for a vSAN encrypted datastore is generated by the Key Management Server (KMS) and serves as a wrapper and lock around the Disk Encryption Key (DEK). The DEK is generated by the host and is used to encrypt and decrypt the datastore. A shallow rekey is a procedure in which the KMS issues a new KEK to the ESXi host, which rewraps the DEK but does not change the DEK or any data on disk.\n\n    This operation must be done on a regular, site-defined interval and can be viewed as similar in criticality to changing an administrative password. If the KMS is compromised, a standing operational procedure to rekey will put a time limit on the usefulness of any stolen KMS data.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If vSAN is not in use, this is not applicable.\n\n    Interview the system administrator (SA) to determine that a procedure has been put in place to perform a shallow rekey of all vSAN encrypted datastores at regular, site-defined intervals.\n\n    VMware recommends a 60-day rekey task, but this interval must be defined by the SA and the information system security officer (ISSO).\n\n    If vSAN encryption is not in use, this is not a finding.\n\n    If vSAN encryption is in use and a regular rekey procedure is not in place, this is a finding.\n  \"\n  desc 'fix', 'If vSAN encryption is in use, ensure that a regular rekey procedure is in place.'\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000287'\n  tag rid: 'SV-VCSA-80-000287'\n  tag stig_id: 'VCSA-80-000287'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000287.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":7.3e-06,"start_time":"2023-06-07T08:29:28-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000288","title":"The vCenter Server must use secure Lightweight Directory Access Protocol (LDAPS) when adding an LDAP identity source.","desc":"LDAP is an industry standard protocol for querying directory services such as Active Directory. This protocol can operate in clear text or over a Secure Sockets Layer (SSL)/Transport Layer Security (TLS) encrypted tunnel. To protect confidentiality of LDAP communications, secure LDAP (LDAPS) must be explicitly configured when adding an LDAP identity source in vSphere Single Sign-On (SSO).\n\nWhen configuring an identity source and supplying an SSL certificate, vCenter will enforce LDAPS. The server URLs do not need to be explicitly provided if an SSL certificate is uploaded.","descriptions":[{"label":"default","data":"LDAP is an industry standard protocol for querying directory services such as Active Directory. This protocol can operate in clear text or over a Secure Sockets Layer (SSL)/Transport Layer Security (TLS) encrypted tunnel. To protect confidentiality of LDAP communications, secure LDAP (LDAPS) must be explicitly configured when adding an LDAP identity source in vSphere Single Sign-On (SSO).\n\nWhen configuring an identity source and supplying an SSL certificate, vCenter will enforce LDAPS. The server URLs do not need to be explicitly provided if an SSL certificate is uploaded."},{"label":"rationale","data":""},{"label":"check","data":"If LDAP is not used as an identity provider, this is not applicable.\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nClick the \"Identity Sources\" tab.\n\nFor each identity source of type \"Active Directory over LDAP\", if the \"Server URL\" does not indicate \"ldaps://\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\nClick the \"Identity Sources\" tab.\n\nFor each identity source of type \"Active Directory over LDAP\" where LDAPS is not configured, highlight the item and click \"Edit\".\n\nEnsure the primary and secondary server URLs, if specified, are configured for \"ldaps://\".\n\nAt the bottom, click the \"Browse\" button, select the AD LDAP cert previously exported to your local computer, click \"Open\", and \"Save\" to complete modifications.\n\nNote: With LDAPS, the server must be a specific domain controller and its specific certificate or the domain alias with a certificate that is valid for that URL."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000288","rid":"SV-VCSA-80-000288","stig_id":"VCSA-80-000288","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000288' do\n  title 'The vCenter Server must use secure Lightweight Directory Access Protocol (LDAPS) when adding an LDAP identity source.'\n  desc  \"\n    LDAP is an industry standard protocol for querying directory services such as Active Directory. This protocol can operate in clear text or over a Secure Sockets Layer (SSL)/Transport Layer Security (TLS) encrypted tunnel. To protect confidentiality of LDAP communications, secure LDAP (LDAPS) must be explicitly configured when adding an LDAP identity source in vSphere Single Sign-On (SSO).\n\n    When configuring an identity source and supplying an SSL certificate, vCenter will enforce LDAPS. The server URLs do not need to be explicitly provided if an SSL certificate is uploaded.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If LDAP is not used as an identity provider, this is not applicable.\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    Click the \\\"Identity Sources\\\" tab.\n\n    For each identity source of type \\\"Active Directory over LDAP\\\", if the \\\"Server URL\\\" does not indicate \\\"ldaps://\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Configuration >> Identity Provider.\n\n    Click the \\\"Identity Sources\\\" tab.\n\n    For each identity source of type \\\"Active Directory over LDAP\\\" where LDAPS is not configured, highlight the item and click \\\"Edit\\\".\n\n    Ensure the primary and secondary server URLs, if specified, are configured for \\\"ldaps://\\\".\n\n    At the bottom, click the \\\"Browse\\\" button, select the AD LDAP cert previously exported to your local computer, click \\\"Open\\\", and \\\"Save\\\" to complete modifications.\n\n    Note: With LDAPS, the server must be a specific domain controller and its specific certificate or the domain alias with a certificate that is valid for that URL.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000288'\n  tag rid: 'SV-VCSA-80-000288'\n  tag stig_id: 'VCSA-80-000288'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000288.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":6.2e-06,"start_time":"2023-06-07T08:29:28-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000290","title":"The vCenter Server must limit membership to the \"SystemConfiguration.BashShellAdministrators\" Single Sign-On (SSO) group.","desc":"vCenter SSO integrates with PAM in the underlying Photon operating system so members of the \"SystemConfiguration.BashShellAdministrators\" SSO group can log on to the operating system without needing a separate account. However, even though unique SSO users log on, they are transparently using a group account named \"sso-user\" as far as Photon auditing is concerned. While the audit trail can still be traced back to the individual SSO user, it is a more involved process.\n\nTo force accountability and nonrepudiation, the SSO group \"SystemConfiguration.BashShellAdministrators\" must be severely restricted.","descriptions":[{"label":"default","data":"vCenter SSO integrates with PAM in the underlying Photon operating system so members of the \"SystemConfiguration.BashShellAdministrators\" SSO group can log on to the operating system without needing a separate account. However, even though unique SSO users log on, they are transparently using a group account named \"sso-user\" as far as Photon auditing is concerned. While the audit trail can still be traced back to the individual SSO user, it is a more involved process.\n\nTo force accountability and nonrepudiation, the SSO group \"SystemConfiguration.BashShellAdministrators\" must be severely restricted."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"SystemConfiguration.BashShellAdministrators\" group appears.\n\nClick \"SystemConfiguration.BashShellAdministrators\".\n\nReview the members of the group and ensure that only authorized accounts are present.\n\nNote: By default the Administrator and a unique service account similar to \"vmware-applmgmtservice-714684a4-342f-4eff-a232-cdc21def00c2\" will be in the group and should not be removed.\n\nIf there are any accounts present as members of SystemConfiguration.BashShellAdministrators that are not authorized, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"SystemConfiguration.BashShellAdministrators\" group appears.\n\nClick \"SystemConfiguration.BashShellAdministrators\".\n\nClick the three vertical dots next to the name of each unauthorized account.\n\nSelect \"Remove Member\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000290","rid":"SV-VCSA-80-000290","stig_id":"VCSA-80-000290","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000290' do\n  title 'The vCenter Server must limit membership to the \"SystemConfiguration.BashShellAdministrators\" Single Sign-On (SSO) group.'\n  desc  \"\n    vCenter SSO integrates with PAM in the underlying Photon operating system so members of the \\\"SystemConfiguration.BashShellAdministrators\\\" SSO group can log on to the operating system without needing a separate account. However, even though unique SSO users log on, they are transparently using a group account named \\\"sso-user\\\" as far as Photon auditing is concerned. While the audit trail can still be traced back to the individual SSO user, it is a more involved process.\n\n    To force accountability and nonrepudiation, the SSO group \\\"SystemConfiguration.BashShellAdministrators\\\" must be severely restricted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"SystemConfiguration.BashShellAdministrators\\\" group appears.\n\n    Click \\\"SystemConfiguration.BashShellAdministrators\\\".\n\n    Review the members of the group and ensure that only authorized accounts are present.\n\n    Note: By default the Administrator and a unique service account similar to \\\"vmware-applmgmtservice-714684a4-342f-4eff-a232-cdc21def00c2\\\" will be in the group and should not be removed.\n\n    If there are any accounts present as members of SystemConfiguration.BashShellAdministrators that are not authorized, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"SystemConfiguration.BashShellAdministrators\\\" group appears.\n\n    Click \\\"SystemConfiguration.BashShellAdministrators\\\".\n\n    Click the three vertical dots next to the name of each unauthorized account.\n\n    Select \\\"Remove Member\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000290'\n  tag rid: 'SV-VCSA-80-000290'\n  tag stig_id: 'VCSA-80-000290'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  bashShellAdminUsers = input('bashShellAdminUsers')\n  # Get appliance management user and add to list of authorized users. Unique to each vCenter.\n  applmgmtuser = powercli_command('Get-SsoGroup -Domain vsphere.local -Name applmgmtSvcUsers | Get-SsoPersonUser | Select-Object -ExpandProperty Name').stdout.strip\n  bashShellAdminUsers.push(applmgmtuser)\n  users = powercli_command('Get-SsoGroup -Domain vsphere.local -Name SystemConfiguration.BashShellAdministrators | Get-SsoPersonUser | Select-Object -ExpandProperty Name')\n  if users.stdout.empty?\n    describe 'Stderr should be empty if no users found' do\n      subject { users.stderr }\n      it { should be_empty }\n    end\n    describe 'No users found in SystemConfiguration.BashShellAdministrators' do\n      subject { users.stdout }\n      it { should be_empty }\n    end\n  else\n    users.stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |user|\n      describe user do\n        it { should be_in bashShellAdminUsers }\n      end\n    end\n  end\n  bashShellAdminGroups = input('bashShellAdminGroups')\n  groups = powercli_command('Get-SsoGroup -Domain vsphere.local -Name SystemConfiguration.BashShellAdministrators | Get-SsoGroup | Select-Object -ExpandProperty Name')\n  if groups.stdout.empty?\n    describe 'Stderr should be empty if no groups found' do\n      subject { groups.stderr }\n      it { should be_empty }\n    end\n    describe 'No groups found in SystemConfiguration.BashShellAdministrators' do\n      subject { groups.stdout }\n      it { should be_empty }\n    end\n  else\n    groups.stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\").each do |group|\n      describe group do\n        it { should be_in bashShellAdminGroups }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000290.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Administrator is expected to be in \"Administrator\" and \"vmware-applmgmtservice-7581d05c-eac0-4a70-b76c-f7b58b907e8d\"","run_time":0.0002423,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Administrator"},{"status":"passed","code_desc":"vmware-applmgmtservice-7581d05c-eac0-4a70-b76c-f7b58b907e8d is expected to be in \"Administrator\" and \"vmware-applmgmtservice-7581d05c-eac0-4a70-b76c-f7b58b907e8d\"","run_time":0.0002087,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"vmware-applmgmtservice-7581d05c-eac0-4a70-b76c-f7b58b907e8d"},{"status":"passed","code_desc":"Stderr should be empty if no groups found is expected to be empty","run_time":0.0130313,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Stderr should be empty if no groups found"},{"status":"passed","code_desc":"No groups found in SystemConfiguration.BashShellAdministrators is expected to be empty","run_time":0.0086464,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"No groups found in SystemConfiguration.BashShellAdministrators"}]},{"id":"VCSA-80-000291","title":"The vCenter Server must limit membership to the \"TrustedAdmins\" Single Sign-On (SSO) group.","desc":"The vSphere \"TrustedAdmins\" group grants additional rights to administer the vSphere Trust Authority feature.\n\nTo force accountability and nonrepudiation, the SSO group \"TrustedAdmins\" must be severely restricted.","descriptions":[{"label":"default","data":"The vSphere \"TrustedAdmins\" group grants additional rights to administer the vSphere Trust Authority feature.\n\nTo force accountability and nonrepudiation, the SSO group \"TrustedAdmins\" must be severely restricted."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"TrustedAdmins\" group appears.\n\nClick \"TrustedAdmins\".\n\nReview the members of the group and ensure that only authorized accounts are present.\n\nNote: These accounts act as root on the Photon operating system and have the ability to severely damage vCenter, inadvertently or otherwise.\n\nIf there are any accounts present as members of TrustedAdmins that are not authorized, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\nClick the next page arrow until the \"TrustedAdmins\" group appears.\n\nClick \"TrustedAdmins\".\n\nClick the three vertical dots next to the name of each unauthorized account.\n\nSelect \"Remove Member\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000291","rid":"SV-VCSA-80-000291","stig_id":"VCSA-80-000291","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000291' do\n  title 'The vCenter Server must limit membership to the \"TrustedAdmins\" Single Sign-On (SSO) group.'\n  desc  \"\n    The vSphere \\\"TrustedAdmins\\\" group grants additional rights to administer the vSphere Trust Authority feature.\n\n    To force accountability and nonrepudiation, the SSO group \\\"TrustedAdmins\\\" must be severely restricted.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"TrustedAdmins\\\" group appears.\n\n    Click \\\"TrustedAdmins\\\".\n\n    Review the members of the group and ensure that only authorized accounts are present.\n\n    Note: These accounts act as root on the Photon operating system and have the ability to severely damage vCenter, inadvertently or otherwise.\n\n    If there are any accounts present as members of TrustedAdmins that are not authorized, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Administration >> Single Sign On >> Users and Groups >> Groups.\n\n    Click the next page arrow until the \\\"TrustedAdmins\\\" group appears.\n\n    Click \\\"TrustedAdmins\\\".\n\n    Click the three vertical dots next to the name of each unauthorized account.\n\n    Select \\\"Remove Member\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000291'\n  tag rid: 'SV-VCSA-80-000291'\n  tag stig_id: 'VCSA-80-000291'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  trustedAdminUsers = input('trustedAdminUsers')\n  users = powercli_command('Get-SsoGroup -Domain vsphere.local -Name TrustedAdmins | Get-SsoPersonUser | Select-Object -ExpandProperty Name')\n  if users.stdout.empty?\n    describe 'Stderr should be empty if no users found' do\n      subject { users.stderr }\n      it { should be_empty }\n    end\n    describe 'No users found in TrustedAdmins' do\n      subject { users.stdout }\n      it { should be_empty }\n    end\n  else\n    users.stdout.split.each do |user|\n      describe user do\n        it { should be_in trustedAdminUsers }\n      end\n    end\n  end\n  trustedAdminGroups = input('trustedAdminGroups')\n  groups = powercli_command('Get-SsoGroup -Domain vsphere.local -Name TrustedAdmins | Get-SsoGroup | Select-Object -ExpandProperty Name')\n  if groups.stdout.empty?\n    describe 'Stderr should be empty if no groups found' do\n      subject { groups.stderr }\n      it { should be_empty }\n    end\n    describe 'No groups found in TrustedAdmins' do\n      subject { groups.stdout }\n      it { should be_empty }\n    end\n  else\n    groups.stdout.split.each do |group|\n      describe group do\n        it { should be_in trustedAdminGroups }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000291.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Stderr should be empty if no users found is expected to be empty","run_time":0.0089216,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Stderr should be empty if no users found"},{"status":"passed","code_desc":"No users found in TrustedAdmins is expected to be empty","run_time":0.0087271,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"No users found in TrustedAdmins"},{"status":"passed","code_desc":"Stderr should be empty if no groups found is expected to be empty","run_time":0.0087042,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Stderr should be empty if no groups found"},{"status":"passed","code_desc":"No groups found in TrustedAdmins is expected to be empty","run_time":0.0085833,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"Object","resource_params":"[]","resource_id":"No groups found in TrustedAdmins"}]},{"id":"VCSA-80-000292","title":"The vCenter server configuration must be backed up on a regular basis.","desc":"vCenter server is the control plane for the vSphere infrastructure and all the workloads it hosts. As such, vCenter is usually a highly critical system in its own right. Backups of vCenter can now be made at a data and configuration level versus traditional storage/image-based backups. This reduces recovery time by letting the system administrator (SA) spin up a new vCenter while simultaneously importing the backed-up data.\n\nFor sites that implement the Native Key Provider (NKP), introduced in 7.0 Update 2, regular vCenter backups are critical. In a recovery scenario where the virtual machine files are intact but vCenter was lost, the encrypted virtual machines will not be able to boot as their private keys were stored in vCenter after it was last backed up. When using the NKP, vCenter becomes critical to the virtual machine workloads and ceases to be just the control plane.","descriptions":[{"label":"default","data":"vCenter server is the control plane for the vSphere infrastructure and all the workloads it hosts. As such, vCenter is usually a highly critical system in its own right. Backups of vCenter can now be made at a data and configuration level versus traditional storage/image-based backups. This reduces recovery time by letting the system administrator (SA) spin up a new vCenter while simultaneously importing the backed-up data.\n\nFor sites that implement the Native Key Provider (NKP), introduced in 7.0 Update 2, regular vCenter backups are critical. In a recovery scenario where the virtual machine files are intact but vCenter was lost, the encrypted virtual machines will not be able to boot as their private keys were stored in vCenter after it was last backed up. When using the NKP, vCenter becomes critical to the virtual machine workloads and ceases to be just the control plane."},{"label":"rationale","data":""},{"label":"check","data":"Option 1:\n\nIf vCenter is backed up in a traditional manner, at the storage array level, interview the SA to determine configuration and schedule.\n\nOption 2:\n\nFor vCenter native backup functionality, open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Backup\" on the left navigation pane.\n\nOn the resulting pane on the right, verify the \"Status\" is \"Enabled\".\n\nClick \"Status\" to expand the backup details.\n\nIf vCenter server backups are not configured and there is no other vCenter backup system, this is a finding.\n\nIf the backup configuration is not set to a proper, reachable location or if the schedule is anything less frequent than \"Daily\", this is a finding."},{"label":"fix","data":"Option 1:\n\nImplement and document a VMware-supported storage/image-based backup schedule.\n\nOption 2:\n\nTo configure vCenter native backup functionality, open the VAMI by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with an SSO account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Backup\" on the left navigation pane.\n\nOn the resulting pane on the right, click \"Configure\" (or \"Edit\" for an existing configuration).\n\nEnter site-specific information for the backup job.\n\nEnsure \"Schedule\" is set to \"Daily\". Limiting the number of retained backups is recommended but not required.\n\nClick \"Create\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000292","rid":"SV-VCSA-80-000292","stig_id":"VCSA-80-000292","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000292' do\n  title 'The vCenter server configuration must be backed up on a regular basis.'\n  desc  \"\n    vCenter server is the control plane for the vSphere infrastructure and all the workloads it hosts. As such, vCenter is usually a highly critical system in its own right. Backups of vCenter can now be made at a data and configuration level versus traditional storage/image-based backups. This reduces recovery time by letting the system administrator (SA) spin up a new vCenter while simultaneously importing the backed-up data.\n\n    For sites that implement the Native Key Provider (NKP), introduced in 7.0 Update 2, regular vCenter backups are critical. In a recovery scenario where the virtual machine files are intact but vCenter was lost, the encrypted virtual machines will not be able to boot as their private keys were stored in vCenter after it was last backed up. When using the NKP, vCenter becomes critical to the virtual machine workloads and ceases to be just the control plane.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Option 1:\n\n    If vCenter is backed up in a traditional manner, at the storage array level, interview the SA to determine configuration and schedule.\n\n    Option 2:\n\n    For vCenter native backup functionality, open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Backup\\\" on the left navigation pane.\n\n    On the resulting pane on the right, verify the \\\"Status\\\" is \\\"Enabled\\\".\n\n    Click \\\"Status\\\" to expand the backup details.\n\n    If vCenter server backups are not configured and there is no other vCenter backup system, this is a finding.\n\n    If the backup configuration is not set to a proper, reachable location or if the schedule is anything less frequent than \\\"Daily\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Option 1:\n\n    Implement and document a VMware-supported storage/image-based backup schedule.\n\n    Option 2:\n\n    To configure vCenter native backup functionality, open the VAMI by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with an SSO account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Backup\\\" on the left navigation pane.\n\n    On the resulting pane on the right, click \\\"Configure\\\" (or \\\"Edit\\\" for an existing configuration).\n\n    Enter site-specific information for the backup job.\n\n    Ensure \\\"Schedule\\\" is set to \\\"Daily\\\". Limiting the number of retained backups is recommended but not required.\n\n    Click \\\"Create\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000292'\n  tag rid: 'SV-VCSA-80-000292'\n  tag stig_id: 'VCSA-80-000292'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  if input('backup3rdParty')\n    describe '3rd party backups indicated. This check is a manual or policy based check and must be reviewed manually.' do\n      skip '3rd party backups indicated. This check is a manual or policy based check and must be reviewed manually.'\n    end\n  else\n    command = '(Invoke-ListRecoveryBackupSchedules).default.enable'\n    backupsenabled = powercli_command(command).stdout.strip\n\n    describe 'File based backups should be enabled.' do\n      subject { backupsenabled }\n      it { should cmp 'true' }\n    end\n\n    if backupsenabled == 'True'\n      # check that backups are scheduled daily. if so the days configuration will be empty\n      # if a custom schedule is specified and every day is selected this will fail and that should be changed to daily\n      backupschedule = powercli_command('(Invoke-ListRecoveryBackupSchedules).default.recurrence_info.days').stdout.strip\n      describe 'Backups should be scheduled daily.' do\n        subject { backupschedule }\n        it { should cmp '' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000292.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"File based backups should be enabled. is expected to cmp == \"true\"","run_time":0.0001691,"start_time":"2023-06-07T08:29:28-06:00","message":"\nexpected: true\n     got: \n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"File based backups should be enabled."}]},{"id":"VCSA-80-000293","title":"The vCenter server must have task and event retention set to at least 30 days.","desc":"vCenter tasks and events contain valuable historical actions, useful in troubleshooting availability issues and for incident forensics. While vCenter events are sent to central log servers in real time, it is important that administrators have quick access to this information when needed.\n\nvCenter retains 30 days of tasks and events by default, and this is sufficient for most purposes. The vCenter disk partitions are also sized with this in mind. Decreasing is not recommended for operational reasons, while increasing is not recommended unless guided by VMware support due to the partition sizing concerns.","descriptions":[{"label":"default","data":"vCenter tasks and events contain valuable historical actions, useful in troubleshooting availability issues and for incident forensics. While vCenter events are sent to central log servers in real time, it is important that administrators have quick access to this information when needed.\n\nvCenter retains 30 days of tasks and events by default, and this is sufficient for most purposes. The vCenter disk partitions are also sized with this in mind. Decreasing is not recommended for operational reasons, while increasing is not recommended unless guided by VMware support due to the partition sizing concerns."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick to expand the \"Database\" section.\n\nNote the \"Task retention\" and \"Event retention\" values.\n\nIf either value is configured to less than \"30\" days, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> General.\n\nClick \"Edit\".\n\nOn the \"Database\" tab, set the value for both \"Task retention\" and \"Event retention\" to \"30\" days (default) or greater, as required by your site.\n\nClick \"Save\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000293","rid":"SV-VCSA-80-000293","stig_id":"VCSA-80-000293","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000293' do\n  title 'The vCenter server must have task and event retention set to at least 30 days.'\n  desc  \"\n    vCenter tasks and events contain valuable historical actions, useful in troubleshooting availability issues and for incident forensics. While vCenter events are sent to central log servers in real time, it is important that administrators have quick access to this information when needed.\n\n    vCenter retains 30 days of tasks and events by default, and this is sufficient for most purposes. The vCenter disk partitions are also sized with this in mind. Decreasing is not recommended for operational reasons, while increasing is not recommended unless guided by VMware support due to the partition sizing concerns.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click to expand the \\\"Database\\\" section.\n\n    Note the \\\"Task retention\\\" and \\\"Event retention\\\" values.\n\n    If either value is configured to less than \\\"30\\\" days, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> General.\n\n    Click \\\"Edit\\\".\n\n    On the \\\"Database\\\" tab, set the value for both \\\"Task retention\\\" and \\\"Event retention\\\" to \\\"30\\\" days (default) or greater, as required by your site.\n\n    Click \\\"Save\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000293'\n  tag rid: 'SV-VCSA-80-000293'\n  tag stig_id: 'VCSA-80-000293'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name event.maxAge | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= '30' }\n  end\n  command = 'Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name task.maxAge | Select-Object -ExpandProperty Value'\n  describe powercli_command(command) do\n    its('stdout.strip') { should cmp >= '30' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000293.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name event.maxAge | Select-Object -ExpandProperty Value stdout.strip is expected to cmp >= \"30\"","run_time":0.5927463,"start_time":"2023-06-07T08:29:28-06:00","resource_class":"powercli_command","resource_params":"[\"Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name event.maxAge | Select-Object -ExpandProperty Value\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name task.maxAge | Select-Object -ExpandProperty Value stdout.strip is expected to cmp >= \"30\"","run_time":0.4440832,"start_time":"2023-06-07T08:29:29-06:00","resource_class":"powercli_command","resource_params":"[\"Get-AdvancedSetting -Entity $global:DefaultViServers.Name -Name task.maxAge | Select-Object -ExpandProperty Value\"]","resource_id":""}]},{"id":"VCSA-80-000294","title":"The vCenter server Native Key Provider must be backed up with a strong password.","desc":"The vCenter Native Key Provider feature was introduced in 7.0 U2 and acts as a key provider for encryption based capabilities such as encrypted virtual machines without requiring an external KMS solution.  When enabling this feature a backup must be taken which is a PKCS#12 formatted file and if no password is provided during the backup process this presents the opportunity for this to be used maliciously and compromise the environment.","descriptions":[{"label":"default","data":"The vCenter Native Key Provider feature was introduced in 7.0 U2 and acts as a key provider for encryption based capabilities such as encrypted virtual machines without requiring an external KMS solution.  When enabling this feature a backup must be taken which is a PKCS#12 formatted file and if no password is provided during the backup process this presents the opportunity for this to be used maliciously and compromise the environment."},{"label":"rationale","data":""},{"label":"check","data":"If the vCenter Native Key Provider feature is not in use, this is not applicable.\n\nInterview the system administrator and determine if a password was provided for any backups taken of the Native Key Provider.\n\nIf backups exist for the Native Key Provider that are not password protected, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect a vCenter Server >> Configure >> Settings >> Key Providers.\n\nSelect the Native Key Provider, click \"Back-up\", and check the box \"Protect Native Key Provider data with password\".\n\nProvide a strong password and click \"Back up key provider\".\n\nDelete any previous backups that were not protected with a password."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000294","rid":"SV-VCSA-80-000294","stig_id":"VCSA-80-000294","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000294' do\n  title 'The vCenter server Native Key Provider must be backed up with a strong password.'\n  desc  'The vCenter Native Key Provider feature was introduced in 7.0 U2 and acts as a key provider for encryption based capabilities such as encrypted virtual machines without requiring an external KMS solution.  When enabling this feature a backup must be taken which is a PKCS#12 formatted file and if no password is provided during the backup process this presents the opportunity for this to be used maliciously and compromise the environment.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If the vCenter Native Key Provider feature is not in use, this is not applicable.\n\n    Interview the system administrator and determine if a password was provided for any backups taken of the Native Key Provider.\n\n    If backups exist for the Native Key Provider that are not password protected, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select a vCenter Server >> Configure >> Settings >> Key Providers.\n\n    Select the Native Key Provider, click \\\"Back-up\\\", and check the box \\\"Protect Native Key Provider data with password\\\".\n\n    Provide a strong password and click \\\"Back up key provider\\\".\n\n    Delete any previous backups that were not protected with a password.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000294'\n  tag rid: 'SV-VCSA-80-000294'\n  tag stig_id: 'VCSA-80-000294'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000294.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":6.5e-06,"start_time":"2023-06-07T08:29:29-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000295","title":"The vCenter server must require authentication for published content libraries.","desc":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale. When publishing a content library it can be protected by requiring authentication for subscribers.","descriptions":[{"label":"default","data":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale. When publishing a content library it can be protected by requiring authentication for subscribers."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Content Libraries.\n\nReview the \"Password Protected\" column.\n\nIf a content library is published and is not password protected, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Content Libraries.\n\nSelect the target content library.\n\nSelect \"Actions\" then \"Edit Settings\".\n\nClick the checkbox to \"Enable user authentication for access to this content library\".\n\nEnter and confirm a password for the content library. Click \"Ok\".\n\nNote: Any subscribed content libraries will need to be updated to enable authentication and provide the password."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000295","rid":"SV-VCSA-80-000295","stig_id":"VCSA-80-000295","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000295' do\n  title 'The vCenter server must require authentication for published content libraries.'\n  desc  'In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale. When publishing a content library it can be protected by requiring authentication for subscribers.'\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Review the \\\"Password Protected\\\" column.\n\n    If a content library is published and is not password protected, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Select the target content library.\n\n    Select \\\"Actions\\\" then \\\"Edit Settings\\\".\n\n    Click the checkbox to \\\"Enable user authentication for access to this content library\\\".\n\n    Enter and confirm a password for the content library. Click \\\"Ok\\\".\n\n    Note: Any subscribed content libraries will need to be updated to enable authentication and provide the password.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000295'\n  tag rid: 'SV-VCSA-80-000295'\n  tag stig_id: 'VCSA-80-000295'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-ContentLibrary | Select-Object -ExpandProperty Id'\n  libraries = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  setimpact = true\n  if !libraries.empty?\n    libraries.each do |library|\n      libinfo = powercli_command(\"Invoke-GetLibraryIdContent #{library} | ConvertTo-Json\").stdout\n      libinfojson = JSON.parse(libinfo)\n      if libinfojson['publish_info']['published'] == true\n        describe \"Authentication should be enabled on Content Library: #{libinfojson['name']}\" do\n          subject { libinfojson }\n          its(['publish_info', 'authentication_method']) { should cmp 'BASIC' }\n        end\n        setimpact = false\n      else\n        describe \"Publishing not enabled on Content Library: #{libinfojson['name']}. This control is not applicable.\" do\n          skip \"Publishing not enabled on Content Library: #{libinfojson['name']}. This control is not applicable.\"\n        end\n      end\n    end\n  else\n    describe '' do\n      skip 'No content libraries found. This control is not applicable.'\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000295.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Authentication should be enabled on Content Library: STIG Content Library [\"publish_info\", \"authentication_method\"] is expected to cmp == \"BASIC\"","run_time":0.0002149,"start_time":"2023-06-07T08:29:29-06:00","message":"\nexpected: BASIC\n     got: NONE\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"[\"publish_info\", \"authentication_method\"]"}]},{"id":"VCSA-80-000296","title":"The vCenter server must enable the OVF security policy for content libraries.","desc":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale.\n\nYou can protect the OVF items by applying default OVF security policy to a content library. The OVF security policy enforces strict validation on OVF items when you deploy or update the item, import items, or synchronize OVF and OVA templates. To make sure that the OVF and OVA templates are signed by a trusted certificate, you can add the OVF signing certificate from a trusted CA.","descriptions":[{"label":"default","data":"In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale.\n\nYou can protect the OVF items by applying default OVF security policy to a content library. The OVF security policy enforces strict validation on OVF items when you deploy or update the item, import items, or synchronize OVF and OVA templates. To make sure that the OVF and OVA templates are signed by a trusted certificate, you can add the OVF signing certificate from a trusted CA."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Content Libraries.\n\nReview the \"Security Policy\" column.\n\nIf a content library does not have the \"OVF default policy\" enabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Content Libraries.\n\nSelect the target content library.\n\nSelect \"Actions\" then \"Edit Settings\".\n\nClick the checkbox to \"Apply Security Policy\". Click \"OK\".\n\nNote: If you disable the security policy of a content library, you cannot reuse the existing OVF items."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000296","rid":"SV-VCSA-80-000296","stig_id":"VCSA-80-000296","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000296' do\n  title 'The vCenter server must enable the OVF security policy for content libraries.'\n  desc  \"\n    In the vSphere Client, you can create a local or a subscribed content library. By using content libraries, you can store and manage content in one vCenter Server instance. Alternatively, you can distribute content across vCenter Server instances to increase consistency and facilitate the deployment workloads at scale.\n\n    You can protect the OVF items by applying default OVF security policy to a content library. The OVF security policy enforces strict validation on OVF items when you deploy or update the item, import items, or synchronize OVF and OVA templates. To make sure that the OVF and OVA templates are signed by a trusted certificate, you can add the OVF signing certificate from a trusted CA.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Review the \\\"Security Policy\\\" column.\n\n    If a content library does not have the \\\"OVF default policy\\\" enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Content Libraries.\n\n    Select the target content library.\n\n    Select \\\"Actions\\\" then \\\"Edit Settings\\\".\n\n    Click the checkbox to \\\"Apply Security Policy\\\". Click \\\"OK\\\".\n\n    Note: If you disable the security policy of a content library, you cannot reuse the existing OVF items.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000296'\n  tag rid: 'SV-VCSA-80-000296'\n  tag stig_id: 'VCSA-80-000296'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-ContentLibrary | Select-Object -ExpandProperty Id'\n  libraries = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  setimpact = true\n  if !libraries.empty?\n    libraries.each do |library|\n      libinfo = powercli_command(\"Invoke-GetLibraryIdContent #{library} | ConvertTo-Json\").stdout\n      libinfojson = JSON.parse(libinfo)\n      describe \"OVF security policy should be enabled on Content Library: #{libinfojson['name']}\" do\n        subject { libinfojson }\n        its(['security_policy_id']) { should_not be nil }\n      end\n      setimpact = false\n    end\n  else\n    describe '' do\n      skip 'No content libraries found. This control is not applicable.'\n    end\n  end\n  unless !setimpact\n    impact 0.0\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000296.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"OVF security policy should be enabled on Content Library: STIG Content Library [\"security_policy_id\"] is expected not to equal nil","run_time":0.0068081,"start_time":"2023-06-07T08:29:29-06:00","message":"\nexpected not #<NilClass:8> => nil\n         got #<NilClass:8> => nil\n\nCompared using equal?, which compares object identity.\n\n","resource_class":"Object","resource_params":"[]","resource_id":"[\"security_policy_id\"]"}]},{"id":"VCSA-80-000298","title":"The vCenter Server must separate authentication and authorization for administrators.","desc":"Many organizations do both authentication and authorization using a centralized directory service such as Active Directory. Attackers who compromise an identity source can often add themselves to authorization groups, and simply log into systems they should not otherwise have access to. Additionally, reliance on central identity systems means that the administrators of those systems are potentially infrastructure administrators, too, as they can add themselves to infrastructure access groups at will.\n\nThe use of local SSO groups for authorization helps prevent this avenue of attack by allowing the centralized identity source to still authenticate users but moving authorization into vCenter itself.","descriptions":[{"label":"default","data":"Many organizations do both authentication and authorization using a centralized directory service such as Active Directory. Attackers who compromise an identity source can often add themselves to authorization groups, and simply log into systems they should not otherwise have access to. Additionally, reliance on central identity systems means that the administrators of those systems are potentially infrastructure administrators, too, as they can add themselves to infrastructure access groups at will.\n\nThe use of local SSO groups for authorization helps prevent this avenue of attack by allowing the centralized identity source to still authenticate users but moving authorization into vCenter itself."},{"label":"rationale","data":""},{"label":"check","data":"From the vSphere Client, go to Administration >> Access Control >> Roles.\n\nView the Administrator role and any other role providing administrative access to vCenter to verify the users and/or groups assigned to it by clicking on \"Usage\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\nIf any user or group is directly assigned a role with administrative access to vCenter that is from an identity provider, this is a finding.\n\nNote: Users and/or groups assigned to roles should be from the \"VSPHERE.LOCAL\" identity source."},{"label":"fix","data":"To add groups from an identity provider to the local SSO Administrators group, as an example, do the following:\n\nFrom the vSphere Client, go to Administration >> Single Sign On >> Groups.\n\nSelect the Administrators group and click \"Edit\".\n\nIn the \"Add Members\" section, select the identity source and type the name of the target user/group in the search bar.\n\nSelect the target user/group to add them and click \"Save\".\n\nNote: A new SSO group or groups can be created as needed and used to provide authorization to vCenter.\n\nTo remove identity provider users/groups from a role, do the following:\n\nFrom the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\nSelect the offending user/group and click \"Delete\".\n\nNote: If permissions are assigned on a specific object, then the role must be updated where it is assigned (for example, at the cluster level)."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000298","rid":"SV-VCSA-80-000298","stig_id":"VCSA-80-000298","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000298' do\n  title 'The vCenter Server must separate authentication and authorization for administrators.'\n  desc  \"\n    Many organizations do both authentication and authorization using a centralized directory service such as Active Directory. Attackers who compromise an identity source can often add themselves to authorization groups, and simply log into systems they should not otherwise have access to. Additionally, reliance on central identity systems means that the administrators of those systems are potentially infrastructure administrators, too, as they can add themselves to infrastructure access groups at will.\n\n    The use of local SSO groups for authorization helps prevent this avenue of attack by allowing the centralized identity source to still authenticate users but moving authorization into vCenter itself.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    From the vSphere Client, go to Administration >> Access Control >> Roles.\n\n    View the Administrator role and any other role providing administrative access to vCenter to verify the users and/or groups assigned to it by clicking on \\\"Usage\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VIPermission | Sort Role | Select Role,Principal,Entity,Propagate,IsGroup | FT -Auto\n\n    If any user or group is directly assigned a role with administrative access to vCenter that is from an identity provider, this is a finding.\n\n    Note: Users and/or groups assigned to roles should be from the \\\"VSPHERE.LOCAL\\\" identity source.\n  \"\n  desc 'fix', \"\n    To add groups from an identity provider to the local SSO Administrators group, as an example, do the following:\n\n    From the vSphere Client, go to Administration >> Single Sign On >> Groups.\n\n    Select the Administrators group and click \\\"Edit\\\".\n\n    In the \\\"Add Members\\\" section, select the identity source and type the name of the target user/group in the search bar.\n\n    Select the target user/group to add them and click \\\"Save\\\".\n\n    Note: A new SSO group or groups can be created as needed and used to provide authorization to vCenter.\n\n    To remove identity provider users/groups from a role, do the following:\n\n    From the vSphere Client, go to Administration >> Access Control >> Global Permissions.\n\n    Select the offending user/group and click \\\"Delete\\\".\n\n    Note: If permissions are assigned on a specific object, then the role must be updated where it is assigned (for example, at the cluster level).\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000298'\n  tag rid: 'SV-VCSA-80-000298'\n  tag stig_id: 'VCSA-80-000298'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe 'This check is a manual or policy based check and must be reviewed manually.' do\n    skip 'This check is a manual or policy based check and must be reviewed manually.'\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000298.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"This check is a manual or policy based check and must be reviewed manually.","run_time":4.9e-06,"start_time":"2023-06-07T08:29:29-06:00","resource":"","skip_message":"This check is a manual or policy based check and must be reviewed manually.","resource_class":"Object","resource_params":"[]","resource_id":"This check is a manual or policy based check and must be reviewed manually."}]},{"id":"VCSA-80-000299","title":"The vCenter Server must disable CDP/LLDP on distributed switches.","desc":"The vSphere Distributed Virtual Switch can participate in Cisco Discovery Protocol (CDP) or Link Layer Discovery Protocol (LLDP), as a listener, advertiser, or both. The information is sensitive, including IP addresses, system names, software versions, and more. It can be used by an adversary to gain a better understanding of your environment, and to impersonate devices. It is also transmitted unencrypted on the network, and as such the recommendation is to disable it.","descriptions":[{"label":"default","data":"The vSphere Distributed Virtual Switch can participate in Cisco Discovery Protocol (CDP) or Link Layer Discovery Protocol (LLDP), as a listener, advertiser, or both. The information is sensitive, including IP addresses, system names, software versions, and more. It can be used by an adversary to gain a better understanding of your environment, and to impersonate devices. It is also transmitted unencrypted on the network, and as such the recommendation is to disable it."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nReview the \"Discovery Protocol\" configuration.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | Select Name,LinkDiscoveryProtocolOperation\n\nIf any distributed switch does not have \"Discovery Protocols\" disabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nSelect the advanced tab and update the \"Type\" under \"Discovery Protocol\" to disabled and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch -Name \"DSwitch\" | Set-VDSwitch -LinkDiscoveryProtocolOperation \"Disabled\""}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000299","rid":"SV-VCSA-80-000299","stig_id":"VCSA-80-000299","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000299' do\n  title 'The vCenter Server must disable CDP/LLDP on distributed switches.'\n  desc  'The vSphere Distributed Virtual Switch can participate in Cisco Discovery Protocol (CDP) or Link Layer Discovery Protocol (LLDP), as a listener, advertiser, or both. The information is sensitive, including IP addresses, system names, software versions, and more. It can be used by an adversary to gain a better understanding of your environment, and to impersonate devices. It is also transmitted unencrypted on the network, and as such the recommendation is to disable it.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    Review the \\\"Discovery Protocol\\\" configuration.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | Select Name,LinkDiscoveryProtocolOperation\n\n    If any distributed switch does not have \\\"Discovery Protocols\\\" disabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Select the advanced tab and update the \\\"Type\\\" under \\\"Discovery Protocol\\\" to disabled and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch -Name \\\"DSwitch\\\" | Set-VDSwitch -LinkDiscoveryProtocolOperation \\\"Disabled\\\"\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000299'\n  tag rid: 'SV-VCSA-80-000299'\n  tag stig_id: 'VCSA-80-000299'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"Get-VDSwitch -Name \\\"#{vds}\\\" | Select -ExpandProperty LinkDiscoveryProtocolOperation\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'Disabled' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000299.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: Get-VDSwitch -Name \"VDSwitch STIG 1\" | Select -ExpandProperty LinkDiscoveryProtocolOperation stdout.strip is expected to cmp == \"Disabled\"","run_time":0.292216,"start_time":"2023-06-07T08:29:29-06:00","message":"\nexpected: Disabled\n     got: Listen\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VDSwitch -Name \\\"VDSwitch STIG 1\\\" | Select -ExpandProperty LinkDiscoveryProtocolOperation\"]","resource_id":""},{"status":"failed","code_desc":"PowerCLI Command: Get-VDSwitch -Name \"VDSwitch STIG 2\" | Select -ExpandProperty LinkDiscoveryProtocolOperation stdout.strip is expected to cmp == \"Disabled\"","run_time":0.2363636,"start_time":"2023-06-07T08:29:30-06:00","message":"\nexpected: Disabled\n     got: Listen\n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"Get-VDSwitch -Name \\\"VDSwitch STIG 2\\\" | Select -ExpandProperty LinkDiscoveryProtocolOperation\"]","resource_id":""}]},{"id":"VCSA-80-000300","title":"The vCenter Server must remove unauthorized port mirroring sessions on distributed switches.","desc":"The vSphere Distributed Virtual Switch can enable port mirroring sessions allowing traffic to be mirrored from one source to a destination. If port mirroring is configured unknowingly this could allow an attacker to observe network traffic of virtual machines.","descriptions":[{"label":"default","data":"The vSphere Distributed Virtual Switch can enable port mirroring sessions allowing traffic to be mirrored from one source to a destination. If port mirroring is configured unknowingly this could allow an attacker to observe network traffic of virtual machines."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Port Mirroring.\n\nReview any configured \"Port Mirroring\" sessions.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\nGet-VDSwitch | select Name,@{N=\"Port Mirroring Sessions\";E={$_.ExtensionData.Config.VspanSession.Name}}\n\nIf there are any unauthorized port mirroring sessions configured, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Configure >> Settings >> Port Mirroring.\n\nSelect the unauthorized \"Port Mirroring\" session and click \"Remove\". Click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000300","rid":"SV-VCSA-80-000300","stig_id":"VCSA-80-000300","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000300' do\n  title 'The vCenter Server must remove unauthorized port mirroring sessions on distributed switches.'\n  desc  'The vSphere Distributed Virtual Switch can enable port mirroring sessions allowing traffic to be mirrored from one source to a destination. If port mirroring is configured unknowingly this could allow an attacker to observe network traffic of virtual machines.'\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Port Mirroring.\n\n    Review any configured \\\"Port Mirroring\\\" sessions.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    Get-VDSwitch | select Name,@{N=\\\"Port Mirroring Sessions\\\";E={$_.ExtensionData.Config.VspanSession.Name}}\n\n    If there are any unauthorized port mirroring sessions configured, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Configure >> Settings >> Port Mirroring.\n\n    Select the unauthorized \\\"Port Mirroring\\\" session and click \\\"Remove\\\". Click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000300'\n  tag rid: 'SV-VCSA-80-000300'\n  tag stig_id: 'VCSA-80-000300'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDSwitch | Select -ExpandProperty Name'\n  vdswitches = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdswitches.empty?\n    describe '' do\n      skip 'No distributed switches found to check.'\n    end\n  else\n    vdswitches.each do |vds|\n      command = \"(Get-VDSwitch -Name \\\"#{vds}\\\").ExtensionData.Config.VspanSession\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp '' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000300.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 1\").ExtensionData.Config.VspanSession stdout.strip is expected to cmp == \"\"","run_time":0.233848,"start_time":"2023-06-07T08:29:30-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 1\\\").ExtensionData.Config.VspanSession\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDSwitch -Name \"VDSwitch STIG 2\").ExtensionData.Config.VspanSession stdout.strip is expected to cmp == \"\"","run_time":0.2529015,"start_time":"2023-06-07T08:29:30-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDSwitch -Name \\\"VDSwitch STIG 2\\\").ExtensionData.Config.VspanSession\"]","resource_id":""}]},{"id":"VCSA-80-000301","title":"The vCenter Server must not override port group settings at the port level on distributed switches.","desc":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf there are cases where particular VMs require unique configurations then a different port group with the required configuration should be created instead of overriding port group settings.","descriptions":[{"label":"default","data":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf there are cases where particular VMs require unique configurations then a different port group with the required configuration should be created instead of overriding port group settings."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nReview the \"Override port policies\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n(Get-VDPortgroup).ExtensionData.Config.Policy\n\nIf there are any distributed port groups that allow overridden port policies, this is a finding.\n\nNote: This does not apply to the \"Block Ports\" or \"Configure reset at disconnect\" policies."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nSelect advanced and update all port policies besides \"Block Ports\" to \"disabled\" and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n$pgs = Get-VDPortgroup | Get-View\nForEach($pg in $pgs){\n$spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n$spec.configversion = $pg.Config.ConfigVersion\n$spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n$spec.Policy.VlanOverrideAllowed = $False\n$spec.Policy.UplinkTeamingOverrideAllowed = $False\n$spec.Policy.SecurityPolicyOverrideAllowed = $False\n$spec.Policy.IpfixOverrideAllowed = $False\n$spec.Policy.BlockOverrideAllowed = $True\n$spec.Policy.ShapingOverrideAllowed = $False\n$spec.Policy.VendorConfigOverrideAllowed = $False\n$spec.Policy.TrafficFilterOverrideAllowed = $False\n$pg.ReconfigureDVPortgroup_Task($spec)\n}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000301","rid":"SV-VCSA-80-000301","stig_id":"VCSA-80-000301","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000301' do\n  title 'The vCenter Server must not override port group settings at the port level on distributed switches.'\n  desc  \"\n    Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\n    If there are cases where particular VMs require unique configurations then a different port group with the required configuration should be created instead of overriding port group settings.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Review the \\\"Override port policies\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    (Get-VDPortgroup).ExtensionData.Config.Policy\n\n    If there are any distributed port groups that allow overridden port policies, this is a finding.\n\n    Note: This does not apply to the \\\"Block Ports\\\" or \\\"Configure reset at disconnect\\\" policies.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Select advanced and update all port policies besides \\\"Block Ports\\\" to \\\"disabled\\\" and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    $pgs = Get-VDPortgroup | Get-View\n    ForEach($pg in $pgs){\n    $spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n    $spec.configversion = $pg.Config.ConfigVersion\n    $spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n    $spec.Policy.VlanOverrideAllowed = $False\n    $spec.Policy.UplinkTeamingOverrideAllowed = $False\n    $spec.Policy.SecurityPolicyOverrideAllowed = $False\n    $spec.Policy.IpfixOverrideAllowed = $False\n    $spec.Policy.BlockOverrideAllowed = $True\n    $spec.Policy.ShapingOverrideAllowed = $False\n    $spec.Policy.VendorConfigOverrideAllowed = $False\n    $spec.Policy.TrafficFilterOverrideAllowed = $False\n    $pg.ReconfigureDVPortgroup_Task($spec)\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000301'\n  tag rid: 'SV-VCSA-80-000301'\n  tag stig_id: 'VCSA-80-000301'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'False' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000301.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.VlanOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1546915,"start_time":"2023-06-07T08:29:30-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1699411,"start_time":"2023-06-07T08:29:31-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1467243,"start_time":"2023-06-07T08:29:31-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.IpfixOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1622732,"start_time":"2023-06-07T08:29:31-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.MacManagementOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1767388,"start_time":"2023-06-07T08:29:31-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.ShapingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1621705,"start_time":"2023-06-07T08:29:31-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1694858,"start_time":"2023-06-07T08:29:31-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.LivePortMovingAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1959621,"start_time":"2023-06-07T08:29:32-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1532368,"start_time":"2023-06-07T08:29:32-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1619532,"start_time":"2023-06-07T08:29:32-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.VlanOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1522068,"start_time":"2023-06-07T08:29:32-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1537002,"start_time":"2023-06-07T08:29:32-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1688627,"start_time":"2023-06-07T08:29:32-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.IpfixOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1971577,"start_time":"2023-06-07T08:29:33-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.MacManagementOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1677251,"start_time":"2023-06-07T08:29:33-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.ShapingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.144164,"start_time":"2023-06-07T08:29:33-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1940832,"start_time":"2023-06-07T08:29:33-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.LivePortMovingAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.170277,"start_time":"2023-06-07T08:29:33-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1654152,"start_time":"2023-06-07T08:29:33-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1650417,"start_time":"2023-06-07T08:29:34-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.VlanOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.160469,"start_time":"2023-06-07T08:29:34-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1806513,"start_time":"2023-06-07T08:29:34-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.2360072,"start_time":"2023-06-07T08:29:34-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.IpfixOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.3201454,"start_time":"2023-06-07T08:29:34-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.MacManagementOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.157813,"start_time":"2023-06-07T08:29:35-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.ShapingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1514803,"start_time":"2023-06-07T08:29:35-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1667832,"start_time":"2023-06-07T08:29:35-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.LivePortMovingAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1696385,"start_time":"2023-06-07T08:29:35-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.169154,"start_time":"2023-06-07T08:29:35-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1714135,"start_time":"2023-06-07T08:29:35-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.VlanOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1658078,"start_time":"2023-06-07T08:29:36-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1637918,"start_time":"2023-06-07T08:29:36-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1787153,"start_time":"2023-06-07T08:29:36-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.IpfixOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1542535,"start_time":"2023-06-07T08:29:36-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.MacManagementOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1515747,"start_time":"2023-06-07T08:29:36-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.ShapingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1589998,"start_time":"2023-06-07T08:29:36-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1604745,"start_time":"2023-06-07T08:29:37-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.LivePortMovingAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1767409,"start_time":"2023-06-07T08:29:37-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1704285,"start_time":"2023-06-07T08:29:37-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1480373,"start_time":"2023-06-07T08:29:37-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.VlanOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1682493,"start_time":"2023-06-07T08:29:37-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1519765,"start_time":"2023-06-07T08:29:37-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1709939,"start_time":"2023-06-07T08:29:38-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.IpfixOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1601971,"start_time":"2023-06-07T08:29:38-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.MacManagementOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1929793,"start_time":"2023-06-07T08:29:38-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.ShapingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1638443,"start_time":"2023-06-07T08:29:38-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.183224,"start_time":"2023-06-07T08:29:38-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.LivePortMovingAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.2113394,"start_time":"2023-06-07T08:29:38-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1782939,"start_time":"2023-06-07T08:29:39-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1560779,"start_time":"2023-06-07T08:29:39-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.VlanOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1530496,"start_time":"2023-06-07T08:29:39-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.VlanOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1652755,"start_time":"2023-06-07T08:29:39-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.UplinkTeamingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.2892084,"start_time":"2023-06-07T08:29:39-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.SecurityPolicyOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.IpfixOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.165344,"start_time":"2023-06-07T08:29:40-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.IpfixOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.MacManagementOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.165733,"start_time":"2023-06-07T08:29:40-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.MacManagementOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.ShapingOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1544808,"start_time":"2023-06-07T08:29:40-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.ShapingOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1621294,"start_time":"2023-06-07T08:29:40-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.VendorConfigOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.LivePortMovingAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.168038,"start_time":"2023-06-07T08:29:40-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.LivePortMovingAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.175641,"start_time":"2023-06-07T08:29:40-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.NetworkResourcePoolOverrideAllowed\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed stdout.strip is expected to cmp == \"False\"","run_time":0.1936875,"start_time":"2023-06-07T08:29:41-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.TrafficFilterOverrideAllowed\"]","resource_id":""}]},{"id":"VCSA-80-000302","title":"The vCenter Server must reset port configuration when virtual machines are disconnected.","desc":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf any unknown or unauthorized per-port overrides exist and are not discarded when a virtual machine is disconnected from that port then a future virtual machine connected to that port may receive a less secure port.","descriptions":[{"label":"default","data":"Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\nIf any unknown or unauthorized per-port overrides exist and are not discarded when a virtual machine is disconnected from that port then a future virtual machine connected to that port may receive a less secure port."},{"label":"rationale","data":""},{"label":"check","data":"If distributed switches are not used, this is not applicable.\n\nFrom the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nReview the \"Configure reset at disconnect\" setting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n(Get-VDPortgroup).ExtensionData.Config.Policy.PortConfigResetAtDisconnect\n\nIf there are any distributed port groups with \"Configure reset at disconnect\" configured to \"disabled\" or \"False\", this is a finding."},{"label":"fix","data":"From the vSphere Client, go to \"Networking\".\n\nSelect a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\nClick \"Edit\".\n\nSelect advanced and update \"Configure reset at disconnect\" to be enabled and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n$pgs = Get-VDPortgroup | Get-View\nForEach($pg in $pgs){\n$spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n$spec.configversion = $pg.Config.ConfigVersion\n$spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n$spec.Policy.PortConfigResetAtDisconnect = $True\n$pg.ReconfigureDVPortgroup_Task($spec)\n}"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000302","rid":"SV-VCSA-80-000302","stig_id":"VCSA-80-000302","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000302' do\n  title 'The vCenter Server must reset port configuration when virtual machines are disconnected.'\n  desc  \"\n    Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access.\n\n    If any unknown or unauthorized per-port overrides exist and are not discarded when a virtual machine is disconnected from that port then a future virtual machine connected to that port may receive a less secure port.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If distributed switches are not used, this is not applicable.\n\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Review the \\\"Configure reset at disconnect\\\" setting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    (Get-VDPortgroup).ExtensionData.Config.Policy.PortConfigResetAtDisconnect\n\n    If there are any distributed port groups with \\\"Configure reset at disconnect\\\" configured to \\\"disabled\\\" or \\\"False\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to \\\"Networking\\\".\n\n    Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.\n\n    Click \\\"Edit\\\".\n\n    Select advanced and update \\\"Configure reset at disconnect\\\" to be enabled and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following command:\n\n    $pgs = Get-VDPortgroup | Get-View\n    ForEach($pg in $pgs){\n    $spec = New-Object VMware.Vim.DVPortgroupConfigSpec\n    $spec.configversion = $pg.Config.ConfigVersion\n    $spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy\n    $spec.Policy.PortConfigResetAtDisconnect = $True\n    $pg.ReconfigureDVPortgroup_Task($spec)\n    }\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000302'\n  tag rid: 'SV-VCSA-80-000302'\n  tag stig_id: 'VCSA-80-000302'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  command = 'Get-VDPortgroup | Select -ExpandProperty Name'\n  vdportgroups = powercli_command(command).stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if vdportgroups.empty?\n    describe '' do\n      skip 'No distributed port groups found to check.'\n    end\n  else\n    vdportgroups.each do |vdpg|\n      command = \"(Get-VDPortgroup -Name \\\"#{vdpg}\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'True' }\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000302.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 1-DVUplinks-40\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect stdout.strip is expected to cmp == \"True\"","run_time":0.1707933,"start_time":"2023-06-07T08:29:41-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 1-DVUplinks-40\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 1\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect stdout.strip is expected to cmp == \"True\"","run_time":0.170781,"start_time":"2023-06-07T08:29:41-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 1\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 2\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect stdout.strip is expected to cmp == \"True\"","run_time":0.1614423,"start_time":"2023-06-07T08:29:41-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 2\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VDSwitch STIG 2-DVUplinks-44\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect stdout.strip is expected to cmp == \"True\"","run_time":0.1703843,"start_time":"2023-06-07T08:29:41-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VDSwitch STIG 2-DVUplinks-44\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 3\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect stdout.strip is expected to cmp == \"True\"","run_time":0.1428798,"start_time":"2023-06-07T08:29:41-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 3\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"]","resource_id":""},{"status":"passed","code_desc":"PowerCLI Command: (Get-VDPortgroup -Name \"VD PG 4\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect stdout.strip is expected to cmp == \"True\"","run_time":0.1550598,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"powercli_command","resource_params":"[\"(Get-VDPortgroup -Name \\\"VD PG 4\\\").ExtensionData.Config.Policy.PortConfigResetAtDisconnect\"]","resource_id":""}]},{"id":"VCSA-80-000303","title":"The vCenter Server must disable Secure Shell (SSH) access.","desc":"vCenter Server is delivered as an appliance, and intended to be managed through the VAMI, vSphere Client, and APIs. SSH is a troubleshooting and support tool and should only be enabled when necessary.\n\nvCenter Server High Availability uses SSH to coordinate the replication and failover between the nodes. Use of this feature requires SSH to remain enabled.","descriptions":[{"label":"default","data":"vCenter Server is delivered as an appliance, and intended to be managed through the VAMI, vSphere Client, and APIs. SSH is a troubleshooting and support tool and should only be enabled when necessary.\n\nvCenter Server High Availability uses SSH to coordinate the replication and failover between the nodes. Use of this feature requires SSH to remain enabled."},{"label":"rationale","data":""},{"label":"check","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Access\" on the left navigation pane.\n\nIf \"SSH Login\" is not \"Deactivated\", this is a finding."},{"label":"fix","data":"Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\nLog in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \"SystemConfiguration.BashShellAdministrator\" group.\n\nSelect \"Access\" on the left navigation pane.\n\nClick \"Edit\" then disable \"Activate SSH Login\" and click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000303","rid":"SV-VCSA-80-000303","stig_id":"VCSA-80-000303","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000303' do\n  title 'The vCenter Server must disable Secure Shell (SSH) access.'\n  desc  \"\n    vCenter Server is delivered as an appliance, and intended to be managed through the VAMI, vSphere Client, and APIs. SSH is a troubleshooting and support tool and should only be enabled when necessary.\n\n    vCenter Server High Availability uses SSH to coordinate the replication and failover between the nodes. Use of this feature requires SSH to remain enabled.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Access\\\" on the left navigation pane.\n\n    If \\\"SSH Login\\\" is not \\\"Deactivated\\\", this is a finding.\n  \"\n  desc 'fix', \"\n    Open the Virtual Appliance Management Interface (VAMI) by navigating to https://<vCenter server>:5480.\n\n    Log in with local operating system administrative credentials or with a Single Sign-On (SSO) account that is a member of the \\\"SystemConfiguration.BashShellAdministrator\\\" group.\n\n    Select \\\"Access\\\" on the left navigation pane.\n\n    Click \\\"Edit\\\" then disable \\\"Activate SSH Login\\\" and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000303'\n  tag rid: 'SV-VCSA-80-000303'\n  tag stig_id: 'VCSA-80-000303'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  describe powercli_command('Invoke-GetAccessSsh').stdout.strip do\n    it { should_not cmp 'true' }\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000303.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"True is expected not to cmp == \"true\"","run_time":0.0003541,"start_time":"2023-06-07T08:29:42-06:00","message":"\nexpected: true\n     got: True\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"True"}]},{"id":"VCSA-80-000304","title":"The vCenter Server must enable data in transit encryption for vSAN.","desc":"Transit encryption must be enabled to prevent unauthorized disclosure information and to protect the confidentiality of organizational information.\n\nvSAN data-in-transit encryption has the following characteristics:\n-vSAN uses AES-256 bit encryption on data in transit.\n-Forward secrecy is enforced for vSAN data-in-transit encryption.\n-Traffic between data hosts and witness hosts is encrypted.\n-File service data traffic between the VDFS proxy and VDFS server is encrypted.\n-vSAN file services inter-host connections are encrypted.\n-vSAN uses symmetric keys that are generated dynamically and shared between hosts. Hosts dynamically generate an encryption key when they establish a connection, and they use the key to encrypt all traffic between the hosts. You do not need a key management server to perform data-in-transit encryption.\n\nEach host is authenticated when it joins the cluster, ensuring connections only to trusted hosts are allowed. When a host is removed from the cluster, it is authentication certificate is removed.\n\nvSAN data-in-transit encryption is a cluster-wide setting. When enabled, all data and metadata traffic is encrypted as it transits across hosts.","descriptions":[{"label":"default","data":"Transit encryption must be enabled to prevent unauthorized disclosure information and to protect the confidentiality of organizational information.\n\nvSAN data-in-transit encryption has the following characteristics:\n-vSAN uses AES-256 bit encryption on data in transit.\n-Forward secrecy is enforced for vSAN data-in-transit encryption.\n-Traffic between data hosts and witness hosts is encrypted.\n-File service data traffic between the VDFS proxy and VDFS server is encrypted.\n-vSAN file services inter-host connections are encrypted.\n-vSAN uses symmetric keys that are generated dynamically and shared between hosts. Hosts dynamically generate an encryption key when they establish a connection, and they use the key to encrypt all traffic between the hosts. You do not need a key management server to perform data-in-transit encryption.\n\nEach host is authenticated when it joins the cluster, ensuring connections only to trusted hosts are allowed. When a host is removed from the cluster, it is authentication certificate is removed.\n\nvSAN data-in-transit encryption is a cluster-wide setting. When enabled, all data and metadata traffic is encrypted as it transits across hosts."},{"label":"rationale","data":""},{"label":"check","data":"If no clusters are enabled for vSAN, this is not applicable.\n\nFrom the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\nReview the \"Data-in-transit encryption\" status.\n\nor\n\nFrom a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n$vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system\n$vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name <cluster name>).ExtensionData.MoRef).DataInTransitEncryptionConfig\n\nRepeat these steps for each vSAN enabled cluster in the environment.\n\nIf \"Data-In-Transit encryption\" is not enabled, this is a finding."},{"label":"fix","data":"From the vSphere Client, go to Host and Clusters.\n\nSelect the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\nClick \"Edit\".\n\nEnable \"Data-In-Transit encryption\" and choose a rekey interval suitable for the environment then click \"Apply\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-APP-000516","gid":"V-VCSA-80-000304","rid":"SV-VCSA-80-000304","stig_id":"VCSA-80-000304","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VCSA-80-000304' do\n  title 'The vCenter Server must enable data in transit encryption for vSAN.'\n  desc  \"\n    Transit encryption must be enabled to prevent unauthorized disclosure information and to protect the confidentiality of organizational information.\n\n    vSAN data-in-transit encryption has the following characteristics:\n    -vSAN uses AES-256 bit encryption on data in transit.\n    -Forward secrecy is enforced for vSAN data-in-transit encryption.\n    -Traffic between data hosts and witness hosts is encrypted.\n    -File service data traffic between the VDFS proxy and VDFS server is encrypted.\n    -vSAN file services inter-host connections are encrypted.\n    -vSAN uses symmetric keys that are generated dynamically and shared between hosts. Hosts dynamically generate an encryption key when they establish a connection, and they use the key to encrypt all traffic between the hosts. You do not need a key management server to perform data-in-transit encryption.\n\n    Each host is authenticated when it joins the cluster, ensuring connections only to trusted hosts are allowed. When a host is removed from the cluster, it is authentication certificate is removed.\n\n    vSAN data-in-transit encryption is a cluster-wide setting. When enabled, all data and metadata traffic is encrypted as it transits across hosts.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If no clusters are enabled for vSAN, this is not applicable.\n\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Review the \\\"Data-in-transit encryption\\\" status.\n\n    or\n\n    From a PowerCLI command prompt while connected to the vCenter server, run the following commands:\n\n    $vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system\n    $vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name <cluster name>).ExtensionData.MoRef).DataInTransitEncryptionConfig\n\n    Repeat these steps for each vSAN enabled cluster in the environment.\n\n    If \\\"Data-In-Transit encryption\\\" is not enabled, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, go to Host and Clusters.\n\n    Select the vCenter Server >> Select the target cluster >> Configure >> vSAN >> Services >> Data Services.\n\n    Click \\\"Edit\\\".\n\n    Enable \\\"Data-In-Transit encryption\\\" and choose a rekey interval suitable for the environment then click \\\"Apply\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-APP-000516'\n  tag gid: 'V-VCSA-80-000304'\n  tag rid: 'SV-VCSA-80-000304'\n  tag stig_id: 'VCSA-80-000304'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  # Get all clusters with vSAN enabled\n  clusters = powercli_command('Get-Cluster | Where-Object {$_.VsanEnabled -eq $true} | Sort-Object | Select-Object -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n\n  if !clusters.empty?\n    clusters.each do |cluster|\n      command = \"$vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system; $vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name #{cluster}).ExtensionData.MoRef).DataInTransitEncryptionConfig.Enabled\"\n      describe powercli_command(command) do\n        its('stdout.strip') { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No clusters with vSAN enabled found...skipping tests' do\n      skip 'No clusters with vSAN enabled found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/ff2e5dc0ca67f397ef122a5d5d29d04238af45eed46b31d05bac0d54f7ee27e3/controls/VCSA-80-000304.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"PowerCLI Command: $vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system; $vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name cluster0).ExtensionData.MoRef).DataInTransitEncryptionConfig.Enabled stdout.strip is expected to cmp == \"true\"","run_time":0.4659353,"start_time":"2023-06-07T08:29:42-06:00","message":"\nexpected: true\n     got: \n\n(compared using `cmp` matcher)\n","resource_class":"powercli_command","resource_params":"[\"$vsanclusterconf = Get-VsanView -Id VsanVcClusterConfigSystem-vsan-cluster-config-system; $vsanclusterconf.VsanClusterGetConfig((Get-Cluster -Name cluster0).ExtensionData.MoRef).DataInTransitEncryptionConfig.Enabled\"]","resource_id":""}]}],"status":"loaded","status_message":""},{"name":"VMware vSphere 8.0 Virtual Machine STIG Readiness Guide","version":"1.0.1","sha256":"cc17f45c259a96d6a8cb741456ffd8ca998c955288ae61117592e7365b236bc5","title":"VMware vSphere 8.0 Virtual Machine STIG Readiness Guide","maintainer":"The Authors","summary":"An InSpec Compliance Profile","license":"Apache-2.0","copyright":"The Authors","supports":[],"attributes":[],"parent_profile":"vmware-vsphere-8.0-stig-baseline","groups":[{"id":"controls/VMCH-80-000189.rb","controls":["VMCH-80-000189"]},{"id":"controls/VMCH-80-000191.rb","controls":["VMCH-80-000191"]},{"id":"controls/VMCH-80-000192.rb","controls":["VMCH-80-000192"]},{"id":"controls/VMCH-80-000193.rb","controls":["VMCH-80-000193"]},{"id":"controls/VMCH-80-000194.rb","controls":["VMCH-80-000194"]},{"id":"controls/VMCH-80-000195.rb","controls":["VMCH-80-000195"]},{"id":"controls/VMCH-80-000196.rb","controls":["VMCH-80-000196"]},{"id":"controls/VMCH-80-000197.rb","controls":["VMCH-80-000197"]},{"id":"controls/VMCH-80-000198.rb","controls":["VMCH-80-000198"]},{"id":"controls/VMCH-80-000199.rb","controls":["VMCH-80-000199"]},{"id":"controls/VMCH-80-000200.rb","controls":["VMCH-80-000200"]},{"id":"controls/VMCH-80-000201.rb","controls":["VMCH-80-000201"]},{"id":"controls/VMCH-80-000202.rb","controls":["VMCH-80-000202"]},{"id":"controls/VMCH-80-000203.rb","controls":["VMCH-80-000203"]},{"id":"controls/VMCH-80-000204.rb","controls":["VMCH-80-000204"]},{"id":"controls/VMCH-80-000205.rb","controls":["VMCH-80-000205"]},{"id":"controls/VMCH-80-000206.rb","controls":["VMCH-80-000206"]},{"id":"controls/VMCH-80-000207.rb","controls":["VMCH-80-000207"]},{"id":"controls/VMCH-80-000208.rb","controls":["VMCH-80-000208"]},{"id":"controls/VMCH-80-000209.rb","controls":["VMCH-80-000209"]},{"id":"controls/VMCH-80-000210.rb","controls":["VMCH-80-000210"]},{"id":"controls/VMCH-80-000211.rb","controls":["VMCH-80-000211"]},{"id":"controls/VMCH-80-000212.rb","controls":["VMCH-80-000212"]},{"id":"controls/VMCH-80-000213.rb","controls":["VMCH-80-000213"]},{"id":"controls/VMCH-80-000214.rb","controls":["VMCH-80-000214"]}],"controls":[{"id":"VMCH-80-000189","title":"Virtual machines (VMs) must have copy operations disabled.","desc":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.","descriptions":[{"label":"default","data":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.copy.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.copy.disable\n\nIf the virtual machine advanced setting \"isolation.tools.copy.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.copy.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.copy.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.copy.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000189","rid":"SV-VMCH-80-000189","stig_id":"VMCH-80-000189","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000189' do\n  title 'Virtual machines (VMs) must have copy operations disabled.'\n  desc  'Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.copy.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.copy.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.copy.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.copy.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.copy.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.copy.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000189'\n  tag rid: 'SV-VMCH-80-000189'\n  tag stig_id: 'VMCH-80-000189'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.copy.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000189.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":0.0002568,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":0.0001892,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":0.0001531,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":0.0001559,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":0.0001475,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000191","title":"Virtual machines (VMs) must have drag and drop operations disabled.","desc":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.","descriptions":[{"label":"default","data":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.dnd.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable\n\nIf the virtual machine advanced setting \"isolation.tools.dnd.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.dnd.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.dnd.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000191","rid":"SV-VMCH-80-000191","stig_id":"VMCH-80-000191","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000191' do\n  title 'Virtual machines (VMs) must have drag and drop operations disabled.'\n  desc  'Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.dnd.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.dnd.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.dnd.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.dnd.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.dnd.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000191'\n  tag rid: 'SV-VMCH-80-000191'\n  tag stig_id: 'VMCH-80-000191'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.dnd.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000191.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":0.0001427,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":0.0001041,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":9.49e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":9.19e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":0.0003325,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000192","title":"Virtual machines (VMs) must have paste operations disabled.","desc":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.","descriptions":[{"label":"default","data":"Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.paste.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.paste.disable\n\nIf the virtual machine advanced setting \"isolation.tools.paste.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.paste.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.paste.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.paste.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000192","rid":"SV-VMCH-80-000192","stig_id":"VMCH-80-000192","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000192' do\n  title 'Virtual machines (VMs) must have paste operations disabled.'\n  desc  'Copy and paste operations are disabled by default; however, explicitly disabling this feature will enable audit controls to verify this setting is correct. Copy, paste, drag and drop, or GUI copy/paste operations between the guest operating system and the remote console could provide the means for an attacker to compromise the VM.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.paste.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.paste.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.paste.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.paste.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.paste.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.paste.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000192'\n  tag rid: 'SV-VMCH-80-000192'\n  tag stig_id: 'VMCH-80-000192'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.paste.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000192.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":8.7e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":7.92e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":7.87e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":7.08e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":8.53e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000193","title":"Virtual machines (VMs) must have virtual disk shrinking disabled.","desc":"Shrinking a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to shrink is available to nonadministrative users operating within the VM's guest operating system.","descriptions":[{"label":"default","data":"Shrinking a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to shrink is available to nonadministrative users operating within the VM's guest operating system."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.diskShrink.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable\n\nIf the virtual machine advanced setting \"isolation.tools.diskShrink.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.diskShrink.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.diskShrink.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000193","rid":"SV-VMCH-80-000193","stig_id":"VMCH-80-000193","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000193' do\n  title 'Virtual machines (VMs) must have virtual disk shrinking disabled.'\n  desc  \"\n    Shrinking a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\n    However, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to shrink is available to nonadministrative users operating within the VM's guest operating system.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.diskShrink.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskShrink.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskShrink.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.diskShrink.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000193'\n  tag rid: 'SV-VMCH-80-000193'\n  tag stig_id: 'VMCH-80-000193'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000193.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":7.79e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":7.41e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":7.04e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":6.95e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":7.14e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000194","title":"Virtual machines (VMs) must have virtual disk wiping disabled.","desc":"Shrinking and wiping (erasing) a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to wipe (erase) is available to nonadministrative users operating within the VM's guest operating system.","descriptions":[{"label":"default","data":"Shrinking and wiping (erasing) a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\nHowever, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to wipe (erase) is available to nonadministrative users operating within the VM's guest operating system."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.tools.diskWiper.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable\n\nIf the virtual machine advanced setting \"isolation.tools.diskWiper.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.tools.diskWiper.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.tools.diskWiper.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000194","rid":"SV-VMCH-80-000194","stig_id":"VMCH-80-000194","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000194' do\n  title 'Virtual machines (VMs) must have virtual disk wiping disabled.'\n  desc  \"\n    Shrinking and wiping (erasing) a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes (those without root or administrator privileges) within virtual machines have the capability to invoke this procedure.\n\n    However, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so this feature must be disabled. Repeated disk shrinking can make a virtual disk unavailable. The capability to wipe (erase) is available to nonadministrative users operating within the VM's guest operating system.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.tools.diskWiper.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskWiper.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.tools.diskWiper.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.tools.diskWiper.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000194'\n  tag rid: 'SV-VMCH-80-000194'\n  tag stig_id: 'VMCH-80-000194'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000194.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":0.0002323,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":6.55e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":6.17e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":6.14e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":6.05e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000195","title":"Virtual machines (VMs) must limit console sharing.","desc":"By default, more than one user at a time can connect to remote console sessions. When multiple sessions are activated, each terminal window receives a notification about the new session. If an administrator in the VM logs in using a VMware remote console during their session, a nonadministrator in the VM might connect to the console and observe the administrator's actions.\n\nAlso, this could result in an administrator losing console access to a VM. For example, if a jump box is being used for an open console session and the administrator loses connection to that box, the console session remains open. Allowing two console sessions permits debugging via a shared session. For the highest security, allow only one remote console session at a time.","descriptions":[{"label":"default","data":"By default, more than one user at a time can connect to remote console sessions. When multiple sessions are activated, each terminal window receives a notification about the new session. If an administrator in the VM logs in using a VMware remote console during their session, a nonadministrator in the VM might connect to the console and observe the administrator's actions.\n\nAlso, this could result in an administrator losing console access to a VM. For example, if a jump box is being used for an open console session and the administrator loses connection to that box, the console session remains open. Allowing two console sessions permits debugging via a shared session. For the highest security, allow only one remote console session at a time."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"RemoteDisplay.maxConnections\" value is set to \"1\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections\n\nIf the virtual machine advanced setting \"RemoteDisplay.maxConnections\" does not exist or is not set to \"1\", this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"RemoteDisplay.maxConnections\" value and set it to \"1\".\n\nIf the setting does not exist, add the Name and Value setting at the bottom of screen.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections | Set-AdvancedSetting -Value 1\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000195","rid":"SV-VMCH-80-000195","stig_id":"VMCH-80-000195","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000195' do\n  title 'Virtual machines (VMs) must limit console sharing.'\n  desc  \"\n    By default, more than one user at a time can connect to remote console sessions. When multiple sessions are activated, each terminal window receives a notification about the new session. If an administrator in the VM logs in using a VMware remote console during their session, a nonadministrator in the VM might connect to the console and observe the administrator's actions.\n\n    Also, this could result in an administrator losing console access to a VM. For example, if a jump box is being used for an open console session and the administrator loses connection to that box, the console session remains open. Allowing two console sessions permits debugging via a shared session. For the highest security, allow only one remote console session at a time.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"RemoteDisplay.maxConnections\\\" value is set to \\\"1\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections\n\n    If the virtual machine advanced setting \\\"RemoteDisplay.maxConnections\\\" does not exist or is not set to \\\"1\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"RemoteDisplay.maxConnections\\\" value and set it to \\\"1\\\".\n\n    If the setting does not exist, add the Name and Value setting at the bottom of screen.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name RemoteDisplay.maxConnections | Set-AdvancedSetting -Value 1\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000195'\n  tag rid: 'SV-VMCH-80-000195'\n  tag stig_id: 'VMCH-80-000195'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name RemoteDisplay.maxConnections | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should cmp '1' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000195.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"VM: stig vm2 is expected to cmp == \"1\"","run_time":0.0001447,"start_time":"2023-06-07T08:29:42-06:00","message":"\nexpected: 1\n     got: -1\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"failed","code_desc":"VM: stigvm1 is expected to cmp == \"1\"","run_time":0.0001217,"start_time":"2023-06-07T08:29:42-06:00","message":"\nexpected: 1\n     got: -1\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to cmp == \"1\"","run_time":8.88e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to cmp == \"1\"","run_time":0.0001429,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to cmp == \"1\"","run_time":7.69e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000196","title":"Virtual machines (VMs) must limit informational messages from the virtual machine to the VMX file.","desc":"The configuration file containing these name-value pairs is limited to a size of 1MB. If not limited, VMware tools in the guest operating system are capable of sending a large and continuous data stream to the host. This 1MB capacity should be sufficient for most cases, but this value can change if necessary.\n\nThe value can be increased if large amounts of custom information are being stored in the configuration file. The default limit is 1MB.","descriptions":[{"label":"default","data":"The configuration file containing these name-value pairs is limited to a size of 1MB. If not limited, VMware tools in the guest operating system are capable of sending a large and continuous data stream to the host. This 1MB capacity should be sufficient for most cases, but this value can change if necessary.\n\nThe value can be increased if large amounts of custom information are being stored in the configuration file. The default limit is 1MB."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"tools.setinfo.sizeLimit\" value is set to \"1048576\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit\n\nIf the virtual machine advanced setting \"tools.setinfo.sizeLimit\" is not set to \"1048576\", this is a finding.\n\nIf the virtual machine advanced setting \"tools.setinfo.sizeLimit\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"tools.setinfo.sizeLimit\" value and set it to \"1048576\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit | Set-AdvancedSetting -Value 1048576\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000196","rid":"SV-VMCH-80-000196","stig_id":"VMCH-80-000196","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000196' do\n  title 'Virtual machines (VMs) must limit informational messages from the virtual machine to the VMX file.'\n  desc  \"\n    The configuration file containing these name-value pairs is limited to a size of 1MB. If not limited, VMware tools in the guest operating system are capable of sending a large and continuous data stream to the host. This 1MB capacity should be sufficient for most cases, but this value can change if necessary.\n\n    The value can be increased if large amounts of custom information are being stored in the configuration file. The default limit is 1MB.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"tools.setinfo.sizeLimit\\\" value is set to \\\"1048576\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit\n\n    If the virtual machine advanced setting \\\"tools.setinfo.sizeLimit\\\" is not set to \\\"1048576\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"tools.setinfo.sizeLimit\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"tools.setinfo.sizeLimit\\\" value and set it to \\\"1048576\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.setinfo.sizeLimit | Set-AdvancedSetting -Value 1048576\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000196'\n  tag rid: 'SV-VMCH-80-000196'\n  tag stig_id: 'VMCH-80-000196'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name tools.setinfo.sizeLimit | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp '1048576' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000196.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":6.73e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":5.81e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":5.56e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":5.46e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":5.48e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000197","title":"Virtual machines (VMs) must prevent unauthorized removal, connection and modification of devices.","desc":"In a virtual machine, users and processes without root or administrator privileges can connect or disconnect devices, such as network adaptors and CD-ROM drives, and can modify device settings. Use the virtual machine settings editor or configuration editor to remove unneeded or unused hardware devices. To use the device again, prevent a user or running process in the virtual machine from connecting, disconnecting, or modifying a device from within the guest operating system.\n\nBy default, a rogue user with nonadministrator privileges in a virtual machine can:\n\n1. Connect a disconnected CD-ROM drive and access sensitive information on the media left in the drive.\n2. Disconnect a network adaptor to isolate the virtual machine from its network, which is a denial of service.\n3. Modify settings on a device.","descriptions":[{"label":"default","data":"In a virtual machine, users and processes without root or administrator privileges can connect or disconnect devices, such as network adaptors and CD-ROM drives, and can modify device settings. Use the virtual machine settings editor or configuration editor to remove unneeded or unused hardware devices. To use the device again, prevent a user or running process in the virtual machine from connecting, disconnecting, or modifying a device from within the guest operating system.\n\nBy default, a rogue user with nonadministrator privileges in a virtual machine can:\n\n1. Connect a disconnected CD-ROM drive and access sensitive information on the media left in the drive.\n2. Disconnect a network adaptor to isolate the virtual machine from its network, which is a denial of service.\n3. Modify settings on a device."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"isolation.device.connectable.disable\" value is set to \"true\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.device.connectable.disable\n\nIf the virtual machine advanced setting \"isolation.device.connectable.disable\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"isolation.device.connectable.disable\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"isolation.device.connectable.disable\" value and set it to \"true\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name isolation.device.connectable.disable | Set-AdvancedSetting -Value true\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000197","rid":"SV-VMCH-80-000197","stig_id":"VMCH-80-000197","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000197' do\n  title 'Virtual machines (VMs) must prevent unauthorized removal, connection and modification of devices.'\n  desc  \"\n    In a virtual machine, users and processes without root or administrator privileges can connect or disconnect devices, such as network adaptors and CD-ROM drives, and can modify device settings. Use the virtual machine settings editor or configuration editor to remove unneeded or unused hardware devices. To use the device again, prevent a user or running process in the virtual machine from connecting, disconnecting, or modifying a device from within the guest operating system.\n\n    By default, a rogue user with nonadministrator privileges in a virtual machine can:\n\n    1. Connect a disconnected CD-ROM drive and access sensitive information on the media left in the drive.\n    2. Disconnect a network adaptor to isolate the virtual machine from its network, which is a denial of service.\n    3. Modify settings on a device.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"isolation.device.connectable.disable\\\" value is set to \\\"true\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.device.connectable.disable\n\n    If the virtual machine advanced setting \\\"isolation.device.connectable.disable\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"isolation.device.connectable.disable\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"isolation.device.connectable.disable\\\" value and set it to \\\"true\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name isolation.device.connectable.disable | Set-AdvancedSetting -Value true\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000197'\n  tag rid: 'SV-VMCH-80-000197'\n  tag stig_id: 'VMCH-80-000197'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name isolation.device.connectable.disable | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000197.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":5.39e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":0.0001561,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":5.78e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":5.32e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":5.21e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000198","title":"Virtual machines (VMs) must not be able to obtain host information from the hypervisor.","desc":"If enabled, a VM can obtain detailed information about the physical host. The default value for the parameter is FALSE. This setting should not be TRUE unless a particular VM requires this information for performance monitoring. An adversary could use this information to inform further attacks on the host.","descriptions":[{"label":"default","data":"If enabled, a VM can obtain detailed information about the physical host. The default value for the parameter is FALSE. This setting should not be TRUE unless a particular VM requires this information for performance monitoring. An adversary could use this information to inform further attacks on the host."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"tools.guestlib.enableHostInfo\" value is set to \"false\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo\n\nIf the virtual machine advanced setting \"tools.guestlib.enableHostInfo\" is not set to \"false\", this is a finding.\n\nIf the virtual machine advanced setting \"tools.guestlib.enableHostInfo\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"tools.guestlib.enableHostInfo\" value and set it to \"false\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo | Set-AdvancedSetting -Value false\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000198","rid":"SV-VMCH-80-000198","stig_id":"VMCH-80-000198","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000198' do\n  title 'Virtual machines (VMs) must not be able to obtain host information from the hypervisor.'\n  desc  'If enabled, a VM can obtain detailed information about the physical host. The default value for the parameter is FALSE. This setting should not be TRUE unless a particular VM requires this information for performance monitoring. An adversary could use this information to inform further attacks on the host.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"tools.guestlib.enableHostInfo\\\" value is set to \\\"false\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo\n\n    If the virtual machine advanced setting \\\"tools.guestlib.enableHostInfo\\\" is not set to \\\"false\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"tools.guestlib.enableHostInfo\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"tools.guestlib.enableHostInfo\\\" value and set it to \\\"false\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo | Set-AdvancedSetting -Value false\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000198'\n  tag rid: 'SV-VMCH-80-000198'\n  tag stig_id: 'VMCH-80-000198'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name tools.guestlib.enableHostInfo | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'false' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000198.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":5.44e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":5.06e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":5.22e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":5.32e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":5.16e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000199","title":"Virtual machines (VMs) must have shared salt values disabled.","desc":"When salting is enabled (Mem.ShareForceSalting=1 or 2) to share a page between two virtual machines, both salt and the content of the page must be same. A salt value is a configurable advanced option for each virtual machine. The salt values can be specified manually in the virtual machine's advanced settings with the new option \"sched.mem.pshare.salt\".\n\nIf this option is not present in the virtual machine's advanced settings, the value of the \"vc.uuid\" option is taken as the default value. Because the \"vc.uuid\" is unique to each virtual machine, by default Transparent Page Sharing (TPS) happens only among the pages belonging to a particular virtual machine (Intra-VM).","descriptions":[{"label":"default","data":"When salting is enabled (Mem.ShareForceSalting=1 or 2) to share a page between two virtual machines, both salt and the content of the page must be same. A salt value is a configurable advanced option for each virtual machine. The salt values can be specified manually in the virtual machine's advanced settings with the new option \"sched.mem.pshare.salt\".\n\nIf this option is not present in the virtual machine's advanced settings, the value of the \"vc.uuid\" option is taken as the default value. Because the \"vc.uuid\" is unique to each virtual machine, by default Transparent Page Sharing (TPS) happens only among the pages belonging to a particular virtual machine (Intra-VM)."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"sched.mem.pshare.salt\" setting does not exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name sched.mem.pshare.salt\n\nIf the virtual machine advanced setting \"sched.mem.pshare.salt\" exists, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nDelete the \"sched.mem.pshare.salt\" setting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name sched.mem.pshare.salt | Remove-AdvancedSetting\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000199","rid":"SV-VMCH-80-000199","stig_id":"VMCH-80-000199","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000199' do\n  title 'Virtual machines (VMs) must have shared salt values disabled.'\n  desc  \"\n    When salting is enabled (Mem.ShareForceSalting=1 or 2) to share a page between two virtual machines, both salt and the content of the page must be same. A salt value is a configurable advanced option for each virtual machine. The salt values can be specified manually in the virtual machine's advanced settings with the new option \\\"sched.mem.pshare.salt\\\".\n\n    If this option is not present in the virtual machine's advanced settings, the value of the \\\"vc.uuid\\\" option is taken as the default value. Because the \\\"vc.uuid\\\" is unique to each virtual machine, by default Transparent Page Sharing (TPS) happens only among the pages belonging to a particular virtual machine (Intra-VM).\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"sched.mem.pshare.salt\\\" setting does not exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name sched.mem.pshare.salt\n\n    If the virtual machine advanced setting \\\"sched.mem.pshare.salt\\\" exists, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Delete the \\\"sched.mem.pshare.salt\\\" setting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name sched.mem.pshare.salt | Remove-AdvancedSetting\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000199'\n  tag rid: 'SV-VMCH-80-000199'\n  tag stig_id: 'VMCH-80-000199'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name sched.mem.pshare.salt | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000199.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":0.009577,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":0.0084832,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":0.0083997,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":0.0083547,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":0.0084383,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000200","title":"Virtual machines (VMs) must disable access through the \"dvfilter\" network Application Programming Interface (API).","desc":"An attacker might compromise a VM by using the \"dvFilter\" API. Configure only VMs that need this access to use the API.","descriptions":[{"label":"default","data":"An attacker might compromise a VM by using the \"dvFilter\" API. Configure only VMs that need this access to use the API."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the settings with the format \"ethernet*.filter*.name\" do not exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name \"ethernet*.filter*.name*\"\n\nIf the virtual machine advanced setting \"ethernet*.filter*.name\" exists and dvfilters are not in use, this is a finding.\n\nIf the virtual machine advanced setting \"ethernet*.filter*.name\" exists and the value is not valid, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nLook for settings with the format \"ethernet*.filter*.name\".\n\nEnsure only required VMs use this setting.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name ethernetX.filterY.name | Remove-AdvancedSetting\n\nNote: Change the X and Y values to match the specific setting in the organization's environment.\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000200","rid":"SV-VMCH-80-000200","stig_id":"VMCH-80-000200","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000200' do\n  title 'Virtual machines (VMs) must disable access through the \"dvfilter\" network Application Programming Interface (API).'\n  desc  'An attacker might compromise a VM by using the \"dvFilter\" API. Configure only VMs that need this access to use the API.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the settings with the format \\\"ethernet*.filter*.name\\\" do not exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name \\\"ethernet*.filter*.name*\\\"\n\n    If the virtual machine advanced setting \\\"ethernet*.filter*.name\\\" exists and dvfilters are not in use, this is a finding.\n\n    If the virtual machine advanced setting \\\"ethernet*.filter*.name\\\" exists and the value is not valid, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Look for settings with the format \\\"ethernet*.filter*.name\\\".\n\n    Ensure only required VMs use this setting.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name ethernetX.filterY.name | Remove-AdvancedSetting\n\n    Note: Change the X and Y values to match the specific setting in the organization's environment.\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000200'\n  tag rid: 'SV-VMCH-80-000200'\n  tag stig_id: 'VMCH-80-000200'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name ethernet*.filter* | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000200.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":0.0082814,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":0.0083835,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be empty","run_time":0.0083217,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be empty","run_time":0.0082663,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be empty","run_time":0.008406,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000201","title":"Virtual machines (VMs) must be configured to lock when the last console connection is closed.","desc":"When accessing the VM console, the guest operating system must be locked when the last console user disconnects, limiting the possibility of session hijacking. This setting only applies to Windows-based VMs with VMware tools installed.","descriptions":[{"label":"default","data":"When accessing the VM console, the guest operating system must be locked when the last console user disconnects, limiting the possibility of session hijacking. This setting only applies to Windows-based VMs with VMware tools installed."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\nVerify the option \"Lock the guest operating system when the last remote user disconnects\" is checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock\n\nIf the virtual machine advanced setting \"tools.guest.desktop.autolock\" is not set to \"true\", this is a finding.\n\nIf the virtual machine advanced setting \"tools.guest.desktop.autolock\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\nCheck the box next to \"Lock the guest operating system when the last remote user disconnects\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock | Set-AdvancedSetting -Value true"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000201","rid":"SV-VMCH-80-000201","stig_id":"VMCH-80-000201","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000201' do\n  title 'Virtual machines (VMs) must be configured to lock when the last console connection is closed.'\n  desc  'When accessing the VM console, the guest operating system must be locked when the last console user disconnects, limiting the possibility of session hijacking. This setting only applies to Windows-based VMs with VMware tools installed.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\n    Verify the option \\\"Lock the guest operating system when the last remote user disconnects\\\" is checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock\n\n    If the virtual machine advanced setting \\\"tools.guest.desktop.autolock\\\" is not set to \\\"true\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"tools.guest.desktop.autolock\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> VMware Remote Console Options.\n\n    Check the box next to \\\"Lock the guest operating system when the last remote user disconnects\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name tools.guest.desktop.autolock | Set-AdvancedSetting -Value true\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000201'\n  tag rid: 'SV-VMCH-80-000201'\n  tag stig_id: 'VMCH-80-000201'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name tools.guest.desktop.autolock | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'true' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000201.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":8.45e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":7.87e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to cmp == \"true\"","run_time":0.0001126,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to cmp == \"true\"","run_time":9.61e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to cmp == \"true\"","run_time":8.08e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000202","title":"Virtual machines (VMs) must disable 3D features when not required.","desc":"For performance reasons, it is recommended that 3D acceleration be disabled on virtual machines that do not require 3D functionality (e.g., most server workloads or desktops not using 3D applications).","descriptions":[{"label":"default","data":"For performance reasons, it is recommended that 3D acceleration be disabled on virtual machines that do not require 3D functionality (e.g., most server workloads or desktops not using 3D applications)."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\nExpand the \"Video card\" and verify the \"Enable 3D Support\" checkbox is unchecked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name mks.enable3d\n\nIf the virtual machine advanced setting \"mks.enable3d\" exists and is not set to \"false\", this is a finding.\n\nIf the virtual machine advanced setting \"mks.enable3d\" does not exist, this is not a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\nExpand the \"Video card\" and uncheck the \"Enable 3D Support\" checkbox.\n\nClick \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name mks.enable3d | Set-AdvancedSetting -Value \"false\"\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000202","rid":"SV-VMCH-80-000202","stig_id":"VMCH-80-000202","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000202' do\n  title 'Virtual machines (VMs) must disable 3D features when not required.'\n  desc  'For performance reasons, it is recommended that 3D acceleration be disabled on virtual machines that do not require 3D functionality (e.g., most server workloads or desktops not using 3D applications).'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\n    Expand the \\\"Video card\\\" and verify the \\\"Enable 3D Support\\\" checkbox is unchecked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name mks.enable3d\n\n    If the virtual machine advanced setting \\\"mks.enable3d\\\" exists and is not set to \\\"false\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"mks.enable3d\\\" does not exist, this is not a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings.\n\n    Expand the \\\"Video card\\\" and uncheck the \\\"Enable 3D Support\\\" checkbox.\n\n    Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name mks.enable3d | Set-AdvancedSetting -Value \\\"false\\\"\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000202'\n  tag rid: 'SV-VMCH-80-000202'\n  tag stig_id: 'VMCH-80-000202'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name mks.enable3d | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp 'false' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000202.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":0.000199,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":6.04e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to cmp == \"false\"","run_time":7.42e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to cmp == \"false\"","run_time":7.03e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to cmp == \"false\"","run_time":7.27e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000203","title":"Virtual machines (VMs) must enable encryption for vMotion.","desc":"vMotion migrations in vSphere 6.0 and earlier transferred working memory and CPU state information in clear text over the vMotion network. As of vSphere 6.5, this transfer can be transparently encrypted using 256-bit AES-GCM with negligible performance impact.\n\nvSphere enables encrypted vMotion by default as \"Opportunistic\", meaning that encrypted channels are used where supported, but the operation will continue in plain text where encryption is not supported.\n\nFor example, when vMotioning between two hosts, encryption will always be used. However, because 6.0 and earlier releases do not support this feature, vMotion from a 7.0 host to a 6.0 host would be allowed but would not be encrypted. If the encryption is set to \"Required\", vMotions to unsupported hosts will fail. This must be set to \"Opportunistic\" or \"Required\".","descriptions":[{"label":"default","data":"vMotion migrations in vSphere 6.0 and earlier transferred working memory and CPU state information in clear text over the vMotion network. As of vSphere 6.5, this transfer can be transparently encrypted using 256-bit AES-GCM with negligible performance impact.\n\nvSphere enables encrypted vMotion by default as \"Opportunistic\", meaning that encrypted channels are used where supported, but the operation will continue in plain text where encryption is not supported.\n\nFor example, when vMotioning between two hosts, encryption will always be used. However, because 6.0 and earlier releases do not support this feature, vMotion from a 7.0 host to a 6.0 host would be allowed but would not be encrypted. If the encryption is set to \"Required\", vMotions to unsupported hosts will fail. This must be set to \"Opportunistic\" or \"Required\"."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {($_.ExtensionData.Config.MigrateEncryption -eq \"disabled\")}\n\nIf the \"Encrypted vMotion\" setting does not have a value of \"Opportunistic\" or \"Required\", this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nFor \"Encrypted vMotion\" set the value to \"Opportunistic\" or \"Required\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.MigrateEncryption = New-Object VMware.Vim.VirtualMachineConfigSpecEncryptedVMotionModes\n$spec.MigrateEncryption = $true\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000203","rid":"SV-VMCH-80-000203","stig_id":"VMCH-80-000203","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000203' do\n  title 'Virtual machines (VMs) must enable encryption for vMotion.'\n  desc  \"\n    vMotion migrations in vSphere 6.0 and earlier transferred working memory and CPU state information in clear text over the vMotion network. As of vSphere 6.5, this transfer can be transparently encrypted using 256-bit AES-GCM with negligible performance impact.\n\n    vSphere enables encrypted vMotion by default as \\\"Opportunistic\\\", meaning that encrypted channels are used where supported, but the operation will continue in plain text where encryption is not supported.\n\n    For example, when vMotioning between two hosts, encryption will always be used. However, because 6.0 and earlier releases do not support this feature, vMotion from a 7.0 host to a 6.0 host would be allowed but would not be encrypted. If the encryption is set to \\\"Required\\\", vMotions to unsupported hosts will fail. This must be set to \\\"Opportunistic\\\" or \\\"Required\\\".\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {($_.ExtensionData.Config.MigrateEncryption -eq \\\"disabled\\\")}\n\n    If the \\\"Encrypted vMotion\\\" setting does not have a value of \\\"Opportunistic\\\" or \\\"Required\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    For \\\"Encrypted vMotion\\\" set the value to \\\"Opportunistic\\\" or \\\"Required\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.MigrateEncryption = New-Object VMware.Vim.VirtualMachineConfigSpecEncryptedVMotionModes\n    $spec.MigrateEncryption = $true\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000203'\n  tag rid: 'SV-VMCH-80-000203'\n  tag stig_id: 'VMCH-80-000203'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    list = ['opportunistic', 'required']\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.MigrateEncryption\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_in list }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000203.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be in \"opportunistic\" and \"required\"","run_time":0.0001248,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be in \"opportunistic\" and \"required\"","run_time":8.41e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be in \"opportunistic\" and \"required\"","run_time":7.61e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be in \"opportunistic\" and \"required\"","run_time":8.77e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be in \"opportunistic\" and \"required\"","run_time":7.88e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000204","title":"Virtual machines (VMs) must enable encryption for Fault Tolerance.","desc":"Fault Tolerance log traffic can be encrypted. This could contain sensitive data from the protected machine's memory or CPU instructions.\n\nvSphere Fault Tolerance performs frequent checks between a primary VM and secondary VM so the secondary VM can quickly resume from the last successful checkpoint. The checkpoint contains the VM state that has been modified since the previous checkpoint.\n\nWhen Fault Tolerance is turned on, FT encryption is set to \"Opportunistic\" by default, which means it enables encryption only if both the primary and secondary host are capable of encryption.","descriptions":[{"label":"default","data":"Fault Tolerance log traffic can be encrypted. This could contain sensitive data from the protected machine's memory or CPU instructions.\n\nvSphere Fault Tolerance performs frequent checks between a primary VM and secondary VM so the secondary VM can quickly resume from the last successful checkpoint. The checkpoint contains the VM state that has been modified since the previous checkpoint.\n\nWhen Fault Tolerance is turned on, FT encryption is set to \"Opportunistic\" by default, which means it enables encryption only if both the primary and secondary host are capable of encryption."},{"label":"rationale","data":""},{"label":"check","data":"If the Virtual Machine does not have Fault Tolerance enabled, this is not applicable.\n\nFor each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {($_.ExtensionData.Config.FtEncryptionMode -ne \"ftEncryptionOpportunistic\") -and ($_.ExtensionData.Config.FtEncryptionMode -ne \"ftEncryptionRequired\")}\n\nIf the \"Encrypted FT\" setting does not have a value of \"Opportunistic\" or \"Required\", this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\nFor \"Encrypted FT\" set the value to \"Opportunistic\" or \"Required\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.FTEncryption = New-Object VMware.Vim.VMware.Vim.VirtualMachineConfigSpecEncryptedFtModes\n$spec.FT = ftEncryptionOpportunistic or ftEncryptionRequired\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000204","rid":"SV-VMCH-80-000204","stig_id":"VMCH-80-000204","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000204' do\n  title 'Virtual machines (VMs) must enable encryption for Fault Tolerance.'\n  desc  \"\n    Fault Tolerance log traffic can be encrypted. This could contain sensitive data from the protected machine's memory or CPU instructions.\n\n    vSphere Fault Tolerance performs frequent checks between a primary VM and secondary VM so the secondary VM can quickly resume from the last successful checkpoint. The checkpoint contains the VM state that has been modified since the previous checkpoint.\n\n    When Fault Tolerance is turned on, FT encryption is set to \\\"Opportunistic\\\" by default, which means it enables encryption only if both the primary and secondary host are capable of encryption.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    If the Virtual Machine does not have Fault Tolerance enabled, this is not applicable.\n\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {($_.ExtensionData.Config.FtEncryptionMode -ne \\\"ftEncryptionOpportunistic\\\") -and ($_.ExtensionData.Config.FtEncryptionMode -ne \\\"ftEncryptionRequired\\\")}\n\n    If the \\\"Encrypted FT\\\" setting does not have a value of \\\"Opportunistic\\\" or \\\"Required\\\", this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Encryption.\n\n    For \\\"Encrypted FT\\\" set the value to \\\"Opportunistic\\\" or \\\"Required\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.FTEncryption = New-Object VMware.Vim.VMware.Vim.VirtualMachineConfigSpecEncryptedFtModes\n    $spec.FT = ftEncryptionOpportunistic or ftEncryptionRequired\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000204'\n  tag rid: 'SV-VMCH-80-000204'\n  tag stig_id: 'VMCH-80-000204'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    list = ['ftEncryptionOpportunistic', 'ftEncryptionRequired']\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.FtEncryptionMode\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should be_in list }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000204.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be in \"ftEncryptionOpportunistic\" and \"ftEncryptionRequired\"","run_time":7.57e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be in \"ftEncryptionOpportunistic\" and \"ftEncryptionRequired\"","run_time":7.46e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to be in \"ftEncryptionOpportunistic\" and \"ftEncryptionRequired\"","run_time":7.58e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to be in \"ftEncryptionOpportunistic\" and \"ftEncryptionRequired\"","run_time":7.2e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to be in \"ftEncryptionOpportunistic\" and \"ftEncryptionRequired\"","run_time":7.12e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000205","title":"Virtual machines (VMs) must configure log size.","desc":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, the size of these logs is unlimited, and they are only rotated on vMotion or power events. This can cause storage issues at scale for VMs that do not vMotion or power cycle often.","descriptions":[{"label":"default","data":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, the size of these logs is unlimited, and they are only rotated on vMotion or power events. This can cause storage issues at scale for VMs that do not vMotion or power cycle often."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"log.rotateSize\" value is set to \"2048000\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.rotateSize\n\nIf the virtual machine advanced setting \"log.rotateSize\" is not set to \"2048000\", this is a finding.\n\nIf the virtual machine advanced setting \"log.rotateSize\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"log.rotateSize\" value and set it to \"2048000\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.rotateSize | Set-AdvancedSetting -Value 2048000\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000205","rid":"SV-VMCH-80-000205","stig_id":"VMCH-80-000205","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000205' do\n  title 'Virtual machines (VMs) must configure log size.'\n  desc  \"\n    The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\n    By default, the size of these logs is unlimited, and they are only rotated on vMotion or power events. This can cause storage issues at scale for VMs that do not vMotion or power cycle often.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"log.rotateSize\\\" value is set to \\\"2048000\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.rotateSize\n\n    If the virtual machine advanced setting \\\"log.rotateSize\\\" is not set to \\\"2048000\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"log.rotateSize\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"log.rotateSize\\\" value and set it to \\\"2048000\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.rotateSize | Set-AdvancedSetting -Value 2048000\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000205'\n  tag rid: 'SV-VMCH-80-000205'\n  tag stig_id: 'VMCH-80-000205'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name log.rotateSize | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp '2048000' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000205.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":0.0001893,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":6.16e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to cmp == \"2048000\"","run_time":7.25e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to cmp == \"2048000\"","run_time":6.81e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to cmp == \"2048000\"","run_time":6.56e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000206","title":"Virtual machines (VMs) must configure log retention.","desc":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, 10 of these logs are retained. This is normally sufficient for most environments, but this configuration must be verified and maintained.","descriptions":[{"label":"default","data":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\nBy default, 10 of these logs are retained. This is normally sufficient for most environments, but this configuration must be verified and maintained."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nVerify the \"log.keepOld\" value is set to \"10\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.keepOld\n\nIf the virtual machine advanced setting \"log.keepOld\" is not set to \"10\", this is a finding.\n\nIf the virtual machine advanced setting \"log.keepOld\" does NOT exist, this is NOT a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\nFind the \"log.keepOld\" value and set it to \"10\".\n\nIf the setting does not exist no action is needed.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-AdvancedSetting -Name log.keepOld | Set-AdvancedSetting -Value 10\n\nNote: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000206","rid":"SV-VMCH-80-000206","stig_id":"VMCH-80-000206","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000206' do\n  title 'Virtual machines (VMs) must configure log retention.'\n  desc  \"\n    The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including but not limited to power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations, and machine clones.\n\n    By default, 10 of these logs are retained. This is normally sufficient for most environments, but this configuration must be verified and maintained.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Verify the \\\"log.keepOld\\\" value is set to \\\"10\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.keepOld\n\n    If the virtual machine advanced setting \\\"log.keepOld\\\" is not set to \\\"10\\\", this is a finding.\n\n    If the virtual machine advanced setting \\\"log.keepOld\\\" does NOT exist, this is NOT a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> Advanced Parameters.\n\n    Find the \\\"log.keepOld\\\" value and set it to \\\"10\\\".\n\n    If the setting does not exist no action is needed.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-AdvancedSetting -Name log.keepOld | Set-AdvancedSetting -Value 10\n\n    Note: The VM must be powered off to configure the advanced settings through the vSphere Client. Therefore, it is recommended to configure these settings with PowerCLI as this can be done while the VM is powered on. Settings do not take effect via either method until the virtual machine is cold started, not rebooted.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000206'\n  tag rid: 'SV-VMCH-80-000206'\n  tag stig_id: 'VMCH-80-000206'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-AdvancedSetting -Name log.keepOld | Select-Object -ExpandProperty Value\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should cmp '10' }\n        end\n        describe \"VM: #{vm}\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000206.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to be empty","run_time":5.93e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to be empty","run_time":8.83e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to cmp == \"10\"","run_time":7.28e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to cmp == \"10\"","run_time":0.0003565,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to cmp == \"10\"","run_time":7.28e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000207","title":"Virtual machines (VMs) must enable logging.","desc":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including, but not limited to, power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations and machine clones. Due to the value these logs provide for the continued availability of each VM and potential security incidents, these logs must be enabled.","descriptions":[{"label":"default","data":"The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including, but not limited to, power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations and machine clones. Due to the value these logs provide for the continued availability of each VM and potential security incidents, these logs must be enabled."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\nEnsure that the checkbox next to \"Enable logging\" is checked.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {$_.ExtensionData.Config.Flags.EnableLogging -ne \"True\"}\n\nIf logging is not enabled, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\nClick the checkbox next to \"Enable logging\". Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.Flags = New-Object VMware.Vim.VirtualMachineFlagInfo\n$spec.Flags.enableLogging = $true\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000207","rid":"SV-VMCH-80-000207","stig_id":"VMCH-80-000207","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000207' do\n  title 'Virtual machines (VMs) must enable logging.'\n  desc  'The ESXi hypervisor maintains logs for each individual VM by default. These logs contain information including, but not limited to, power events, system failure information, tools status and activity, time sync, virtual hardware changes, vMotion migrations and machine clones. Due to the value these logs provide for the continued availability of each VM and potential security incidents, these logs must be enabled.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\n    Ensure that the checkbox next to \\\"Enable logging\\\" is checked.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {$_.ExtensionData.Config.Flags.EnableLogging -ne \\\"True\\\"}\n\n    If logging is not enabled, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to Edit Settings >> VM Options >> Advanced.\n\n    Click the checkbox next to \\\"Enable logging\\\". Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.Flags = New-Object VMware.Vim.VirtualMachineFlagInfo\n    $spec.Flags.enableLogging = $true\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000207'\n  tag rid: 'SV-VMCH-80-000207'\n  tag stig_id: 'VMCH-80-000207'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Flags.EnableLogging\"\n      result = powercli_command(command).stdout.strip\n      describe \"VM: #{vm}\" do\n        subject { result }\n        it { should cmp 'true' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000207.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"VM: stig vm2 is expected to cmp == \"true\"","run_time":0.0001426,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stig vm2"},{"status":"passed","code_desc":"VM: stigvm1 is expected to cmp == \"true\"","run_time":7.39e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: stigvm1"},{"status":"passed","code_desc":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c is expected to cmp == \"true\"","run_time":7.09e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c"},{"status":"passed","code_desc":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d is expected to cmp == \"true\"","run_time":6.91e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d"},{"status":"passed","code_desc":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 is expected to cmp == \"true\"","run_time":7.38e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481"}]},{"id":"VMCH-80-000208","title":"Virtual machines (VMs) must not use independent, non-persistent disks.","desc":"The security issue with nonpersistent disk mode is that successful attackers, with a simple shutdown or reboot, might undo or remove any traces they were ever on the machine. To safeguard against this risk, production virtual machines should be set to use persistent disk mode; additionally, ensure activity within the VM is logged remotely on a separate server, such as a syslog server or equivalent Windows-based event collector. Without a persistent record of activity on a VM, administrators might never know whether they have been attacked or hacked.\n\nThere can be valid use cases for these types of disks, such as with an application presentation solution where read-only disks are desired, and such cases should be identified and documented.","descriptions":[{"label":"default","data":"The security issue with nonpersistent disk mode is that successful attackers, with a simple shutdown or reboot, might undo or remove any traces they were ever on the machine. To safeguard against this risk, production virtual machines should be set to use persistent disk mode; additionally, ensure activity within the VM is logged remotely on a separate server, such as a syslog server or equivalent Windows-based event collector. Without a persistent record of activity on a VM, administrators might never know whether they have been attacked or hacked.\n\nThere can be valid use cases for these types of disks, such as with an application presentation solution where read-only disks are desired, and such cases should be identified and documented."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the attached hard disks and verify they are not configured as independent nonpersistent disks.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-HardDisk | Select Parent, Name, Filename, DiskType, Persistence | FT -AutoSize\n\nIf the virtual machine has attached disks that are in independent nonpersistent mode and are not documented, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the target hard disk and change the mode to persistent or uncheck Independent.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run one of the following commands:\n\nGet-VM \"VM Name\" | Get-HardDisk | Set-HardDisk -Persistence IndependentPersistent\n\nor\n\nGet-VM \"VM Name\" | Get-HardDisk | Set-HardDisk -Persistence Persistent"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000208","rid":"SV-VMCH-80-000208","stig_id":"VMCH-80-000208","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000208' do\n  title 'Virtual machines (VMs) must not use independent, non-persistent disks.'\n  desc  \"\n    The security issue with nonpersistent disk mode is that successful attackers, with a simple shutdown or reboot, might undo or remove any traces they were ever on the machine. To safeguard against this risk, production virtual machines should be set to use persistent disk mode; additionally, ensure activity within the VM is logged remotely on a separate server, such as a syslog server or equivalent Windows-based event collector. Without a persistent record of activity on a VM, administrators might never know whether they have been attacked or hacked.\n\n    There can be valid use cases for these types of disks, such as with an application presentation solution where read-only disks are desired, and such cases should be identified and documented.\n  \"\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the attached hard disks and verify they are not configured as independent nonpersistent disks.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-HardDisk | Select Parent, Name, Filename, DiskType, Persistence | FT -AutoSize\n\n    If the virtual machine has attached disks that are in independent nonpersistent mode and are not documented, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the target hard disk and change the mode to persistent or uncheck Independent.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run one of the following commands:\n\n    Get-VM \\\"VM Name\\\" | Get-HardDisk | Set-HardDisk -Persistence IndependentPersistent\n\n    or\n\n    Get-VM \\\"VM Name\\\" | Get-HardDisk | Set-HardDisk -Persistence Persistent\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000208'\n  tag rid: 'SV-VMCH-80-000208'\n  tag stig_id: 'VMCH-80-000208'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-HardDisk | Select-Object -ExpandProperty Persistence\"\n      results = powercli_command(command)\n      results.stdout.split.each do |disk|\n        describe \"Checking the VM: #{vm} for Non-Persistent Hard Disks\" do\n          subject { disk }\n          it { should_not cmp 'IndependentNonPersistent' }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000208.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Checking the VM: stig vm2 for Non-Persistent Hard Disks is expected not to cmp == \"IndependentNonPersistent\"","run_time":8.15e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stig vm2 for Non-Persistent Hard Disks"},{"status":"passed","code_desc":"Checking the VM: stigvm1 for Non-Persistent Hard Disks is expected not to cmp == \"IndependentNonPersistent\"","run_time":7.5e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stigvm1 for Non-Persistent Hard Disks"},{"status":"passed","code_desc":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for Non-Persistent Hard Disks is expected not to cmp == \"IndependentNonPersistent\"","run_time":7.28e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for Non-Persistent Hard Disks"},{"status":"passed","code_desc":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for Non-Persistent Hard Disks is expected not to cmp == \"IndependentNonPersistent\"","run_time":7.28e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for Non-Persistent Hard Disks"},{"status":"passed","code_desc":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for Non-Persistent Hard Disks is expected not to cmp == \"IndependentNonPersistent\"","run_time":7.35e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for Non-Persistent Hard Disks"}]},{"id":"VMCH-80-000209","title":"Virtual machines (VMs) must remove unneeded floppy devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Get-FloppyDrive | Select Parent, Name, ConnectionState\n\nIf a virtual machine has a floppy drive connected, this is a finding."},{"label":"fix","data":"Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nThe VM must be powered off to remove a floppy drive.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-FloppyDrive | Remove-FloppyDrive"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000209","rid":"SV-VMCH-80-000209","stig_id":"VMCH-80-000209","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000209' do\n  title 'Virtual machines (VMs) must remove unneeded floppy devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Get-FloppyDrive | Select Parent, Name, ConnectionState\n\n    If a virtual machine has a floppy drive connected, this is a finding.\n  \"\n  desc 'fix', \"\n    Floppy drives are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    The VM must be powered off to remove a floppy drive.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-FloppyDrive | Remove-FloppyDrive\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000209'\n  tag rid: 'SV-VMCH-80-000209'\n  tag stig_id: 'VMCH-80-000209'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-FloppyDrive\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for Floppy drives\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000209.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Checking the VM: stig vm2 for Floppy drives is expected to be empty","run_time":0.0086651,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stig vm2 for Floppy drives"},{"status":"passed","code_desc":"Checking the VM: stigvm1 for Floppy drives is expected to be empty","run_time":0.0081981,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stigvm1 for Floppy drives"},{"status":"passed","code_desc":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for Floppy drives is expected to be empty","run_time":0.0083412,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for Floppy drives"},{"status":"passed","code_desc":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for Floppy drives is expected to be empty","run_time":0.0084882,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for Floppy drives"},{"status":"passed","code_desc":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for Floppy drives is expected to be empty","run_time":0.0082438,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for Floppy drives"}]},{"id":"VMCH-80-000210","title":"Virtual machines (VMs) must remove unneeded CD/DVD devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the VMs hardware and verify no CD/DVD drives are connected.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Get-CDDrive | Where {$_.extensiondata.connectable.connected -eq $true} | Select Parent,Name\n\nIf a virtual machine has a CD/DVD drive connected other than temporarily, this is a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the CD/DVD drive and uncheck \"Connected\" and \"Connect at power on\" and remove any attached ISOs.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-CDDrive | Set-CDDrive -NoMedia"}],"impact":0.3,"refs":[],"tags":{"severity":"low","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000210","rid":"SV-VMCH-80-000210","stig_id":"VMCH-80-000210","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000210' do\n  title 'Virtual machines (VMs) must remove unneeded CD/DVD devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the VMs hardware and verify no CD/DVD drives are connected.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Get-CDDrive | Where {$_.extensiondata.connectable.connected -eq $true} | Select Parent,Name\n\n    If a virtual machine has a CD/DVD drive connected other than temporarily, this is a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the CD/DVD drive and uncheck \\\"Connected\\\" and \\\"Connect at power on\\\" and remove any attached ISOs.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-CDDrive | Set-CDDrive -NoMedia\n  \"\n  impact 0.3\n  tag severity: 'low'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000210'\n  tag rid: 'SV-VMCH-80-000210'\n  tag stig_id: 'VMCH-80-000210'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}' | Get-CDDrive).ExtensionData.connectable.connected\"\n      result = powercli_command(command).stdout.strip\n      describe.one do\n        describe \"Checking the VM: #{vm} for CD/DVD drives\" do\n          subject { result }\n          it { should cmp 'false' }\n        end\n        describe \"Checking the VM: #{vm} for CD/DVD drives\" do\n          subject { result }\n          it { should be_empty }\n        end\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000210.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Checking the VM: stig vm2 for CD/DVD drives is expected to cmp == \"false\"","run_time":0.0001095,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stig vm2 for CD/DVD drives"},{"status":"passed","code_desc":"Checking the VM: stigvm1 for CD/DVD drives is expected to cmp == \"false\"","run_time":0.0002336,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stigvm1 for CD/DVD drives"},{"status":"passed","code_desc":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for CD/DVD drives is expected to be empty","run_time":7.62e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for CD/DVD drives"},{"status":"passed","code_desc":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for CD/DVD drives is expected to be empty","run_time":6.13e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for CD/DVD drives"},{"status":"passed","code_desc":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for CD/DVD drives is expected to be empty","run_time":5.48e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for CD/DVD drives"}]},{"id":"VMCH-80-000211","title":"Virtual machines (VMs) must remove unneeded parallel devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \"parallel\"}\n\nIf a virtual machine has a parallel device present, this is a finding."},{"label":"fix","data":"Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\nThe VM must be powered off to remove a parallel device.\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n$pport = (Get-VM -Name <vmname>).ExtensionData.Config.Hardware.Device | Where {$_.DeviceInfo.Label -match \"Parallel\"}\n$spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n$spec.DeviceChange += New-Object VMware.Vim.VirtualDeviceConfigSpec\n$spec.DeviceChange[-1].device = $pport\n$spec.DeviceChange[-1].operation = \"remove\"\n(Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000211","rid":"SV-VMCH-80-000211","stig_id":"VMCH-80-000211","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000211' do\n  title 'Virtual machines (VMs) must remove unneeded parallel devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \\\"parallel\\\"}\n\n    If a virtual machine has a parallel device present, this is a finding.\n  \"\n  desc 'fix', \"\n    Parallel devices are no longer visible through the vSphere Client and must be done via the Application Programming Interface (API) or PowerCLI.\n\n    The VM must be powered off to remove a parallel device.\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    $pport = (Get-VM -Name <vmname>).ExtensionData.Config.Hardware.Device | Where {$_.DeviceInfo.Label -match \\\"Parallel\\\"}\n    $spec = New-Object VMware.Vim.VirtualMachineConfigSpec\n    $spec.DeviceChange += New-Object VMware.Vim.VirtualDeviceConfigSpec\n    $spec.DeviceChange[-1].device = $pport\n    $spec.DeviceChange[-1].operation = \\\"remove\\\"\n    (Get-VM -Name <vmname>).ExtensionData.ReconfigVM($spec)\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000211'\n  tag rid: 'SV-VMCH-80-000211'\n  tag stig_id: 'VMCH-80-000211'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Hardware.Device.DeviceInfo.label\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for parallel devices\" do\n        subject { result }\n        it { should_not match 'Parallel' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000211.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Checking the VM: stig vm2 for parallel devices is expected not to match \"Parallel\"","run_time":8.28e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stig vm2 for parallel devices"},{"status":"passed","code_desc":"Checking the VM: stigvm1 for parallel devices is expected not to match \"Parallel\"","run_time":5.38e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stigvm1 for parallel devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for parallel devices is expected not to match \"Parallel\"","run_time":4.72e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for parallel devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for parallel devices is expected not to match \"Parallel\"","run_time":5.26e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for parallel devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for parallel devices is expected not to match \"Parallel\"","run_time":5.15e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for parallel devices"}]},{"id":"VMCH-80-000212","title":"Virtual machines (VMs) must remove unneeded serial devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the VMs hardware and verify no serial devices exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \"serial\"}\n\nIf a virtual machine has a serial device present, this is a finding."},{"label":"fix","data":"The VM must be powered off to remove a serial device.\n\nFor each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the serial device, click the circled \"X\" to remove it, and click \"OK\"."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000212","rid":"SV-VMCH-80-000212","stig_id":"VMCH-80-000212","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000212' do\n  title 'Virtual machines (VMs) must remove unneeded serial devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the VMs hardware and verify no serial devices exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \\\"serial\\\"}\n\n    If a virtual machine has a serial device present, this is a finding.\n  \"\n  desc  'fix', \"\n    The VM must be powered off to remove a serial device.\n\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the serial device, click the circled \\\"X\\\" to remove it, and click \\\"OK\\\".\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000212'\n  tag rid: 'SV-VMCH-80-000212'\n  tag stig_id: 'VMCH-80-000212'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Hardware.Device.DeviceInfo.label\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for serial devices\" do\n        subject { result }\n        it { should_not match 'Serial' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000212.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Checking the VM: stig vm2 for serial devices is expected not to match \"Serial\"","run_time":5.25e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stig vm2 for serial devices"},{"status":"passed","code_desc":"Checking the VM: stigvm1 for serial devices is expected not to match \"Serial\"","run_time":0.0003045,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stigvm1 for serial devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for serial devices is expected not to match \"Serial\"","run_time":7.72e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for serial devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for serial devices is expected not to match \"Serial\"","run_time":5.39e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for serial devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for serial devices is expected not to match \"Serial\"","run_time":0.0001312,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for serial devices"}]},{"id":"VMCH-80-000213","title":"Virtual machines (VMs) must remove unneeded USB devices.","desc":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.","descriptions":[{"label":"default","data":"Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nReview the VMs hardware and verify no USB devices exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\nGet-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \"usb\"}\nGet-VM | Get-UsbDevice\n\nIf a virtual machine has any USB devices or USB controllers present, this is a finding.\n\nIf USB smart card readers are used to pass smart cards through the VM console to a VM, the use of a USB controller and USB devices for that purpose is not a finding."},{"label":"fix","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, right-click the Virtual Machine and go to \"Edit Settings\".\n\nSelect the USB controller, click the circled \"X\" to remove it, and click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-USBDevice | Remove-USBDevice\n\nNote:  This will not remove the USB controller, just any connected devices."}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000213","rid":"SV-VMCH-80-000213","stig_id":"VMCH-80-000213","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000213' do\n  title 'Virtual machines (VMs) must remove unneeded USB devices.'\n  desc  'Ensure no device is connected to a virtual machine if it is not required. For example, floppy, serial, and parallel ports are rarely used for virtual machines in a data center environment, and CD/DVD drives are usually connected only temporarily during software installation.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Review the VMs hardware and verify no USB devices exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following commands:\n\n    Get-VM | Where {$_.ExtensionData.Config.Hardware.Device.DeviceInfo.Label -match \\\"usb\\\"}\n    Get-VM | Get-UsbDevice\n\n    If a virtual machine has any USB devices or USB controllers present, this is a finding.\n\n    If USB smart card readers are used to pass smart cards through the VM console to a VM, the use of a USB controller and USB devices for that purpose is not a finding.\n  \"\n  desc  'fix', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, right-click the Virtual Machine and go to \\\"Edit Settings\\\".\n\n    Select the USB controller, click the circled \\\"X\\\" to remove it, and click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-USBDevice | Remove-USBDevice\n\n    Note:  This will not remove the USB controller, just any connected devices.\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000213'\n  tag rid: 'SV-VMCH-80-000213'\n  tag stig_id: 'VMCH-80-000213'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"(Get-VM -Name '#{vm}').ExtensionData.Config.Hardware.Device.DeviceInfo.label\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for USB devices\" do\n        subject { result }\n        it { should_not match 'USB' }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000213.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Checking the VM: stig vm2 for USB devices is expected not to match \"USB\"","run_time":0.0005257,"start_time":"2023-06-07T08:29:42-06:00","message":"expected \"IDE 0\\r\\nIDE 1\\r\\nPS2 controller 0\\r\\nPCI controller 0\\r\\nSIO controller 0\\r\\nKeyboard \\r\\nPointing ...er \\r\\nSCSI controller 0\\r\\nSATA controller 0\\r\\nCD/DVD drive 1\\r\\nHard disk 1\\r\\nNetwork adapter 1\" not to match \"USB\"\nDiff:\n@@ -1,15 +1,29 @@\n-USB\n+IDE 0\n+IDE 1\n+PS2 controller 0\n+PCI controller 0\n+SIO controller 0\n+Keyboard \n+Pointing device\n+Video card \n+VMCI device\n+USB xHCI controller \n+SCSI controller 0\n+SATA controller 0\n+CD/DVD drive 1\n+Hard disk 1\n+Network adapter 1\n","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stig vm2 for USB devices"},{"status":"failed","code_desc":"Checking the VM: stigvm1 for USB devices is expected not to match \"USB\"","run_time":0.0002042,"start_time":"2023-06-07T08:29:42-06:00","message":"expected \"IDE 0\\r\\nIDE 1\\r\\nPS2 controller 0\\r\\nPCI controller 0\\r\\nSIO controller 0\\r\\nKeyboard \\r\\nPointing ...er \\r\\nSCSI controller 0\\r\\nSATA controller 0\\r\\nCD/DVD drive 1\\r\\nHard disk 1\\r\\nNetwork adapter 1\" not to match \"USB\"\nDiff:\n@@ -1,15 +1,29 @@\n-USB\n+IDE 0\n+IDE 1\n+PS2 controller 0\n+PCI controller 0\n+SIO controller 0\n+Keyboard \n+Pointing device\n+Video card \n+VMCI device\n+USB xHCI controller \n+SCSI controller 0\n+SATA controller 0\n+CD/DVD drive 1\n+Hard disk 1\n+Network adapter 1\n","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stigvm1 for USB devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for USB devices is expected not to match \"USB\"","run_time":0.0002226,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for USB devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for USB devices is expected not to match \"USB\"","run_time":5.77e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for USB devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for USB devices is expected not to match \"USB\"","run_time":4.56e-05,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for USB devices"}]},{"id":"VMCH-80-000214","title":"Virtual machines (VMs) must disable DirectPath I/O devices when not required.","desc":"VMDirectPath I/O (PCI passthrough) enables direct assignment of hardware PCI functions to VMs. This gives the VM access to the PCI functions with minimal intervention from the ESXi host. This is a powerful feature for legitimate applications such as virtualized storage appliances, backup appliances, dedicated graphics, etc., but it also allows a potential attacker highly privileged access to underlying hardware and the PCI bus.","descriptions":[{"label":"default","data":"VMDirectPath I/O (PCI passthrough) enables direct assignment of hardware PCI functions to VMs. This gives the VM access to the PCI functions with minimal intervention from the ESXi host. This is a powerful feature for legitimate applications such as virtualized storage appliances, backup appliances, dedicated graphics, etc., but it also allows a potential attacker highly privileged access to underlying hardware and the PCI bus."},{"label":"rationale","data":""},{"label":"check","data":"For each virtual machine do the following:\n\nFrom the vSphere Client, view the Summary tab.\n\nReview the PCI devices section and verify none exist.\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-PassthroughDevice\n\nIf the virtual machine has passthrough devices present, and the specific device returned is not approved, this is a finding."},{"label":"fix","data":"From the vSphere Client, select the Virtual Machine, right click and go to Edit Settings >> Virtual Hardware tab.\n\nFind the unexpected PCI device returned from the check.\n\nHover the mouse over the device and click the circled \"X\" to remove the device. Click \"OK\".\n\nor\n\nFrom a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\nGet-VM \"VM Name\" | Get-PassthroughDevice | Remove-PassthroughDevice"}],"impact":0.5,"refs":[],"tags":{"severity":"medium","gtitle":"SRG-OS-000480-VMM-002000","gid":"V-VMCH-80-000214","rid":"SV-VMCH-80-000214","stig_id":"VMCH-80-000214","cci":["CCI-000366"],"nist":["CM-6 b"]},"code":"control 'VMCH-80-000214' do\n  title 'Virtual machines (VMs) must disable DirectPath I/O devices when not required.'\n  desc  'VMDirectPath I/O (PCI passthrough) enables direct assignment of hardware PCI functions to VMs. This gives the VM access to the PCI functions with minimal intervention from the ESXi host. This is a powerful feature for legitimate applications such as virtualized storage appliances, backup appliances, dedicated graphics, etc., but it also allows a potential attacker highly privileged access to underlying hardware and the PCI bus.'\n  desc  'rationale', ''\n  desc  'check', \"\n    For each virtual machine do the following:\n\n    From the vSphere Client, view the Summary tab.\n\n    Review the PCI devices section and verify none exist.\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-PassthroughDevice\n\n    If the virtual machine has passthrough devices present, and the specific device returned is not approved, this is a finding.\n  \"\n  desc 'fix', \"\n    From the vSphere Client, select the Virtual Machine, right click and go to Edit Settings >> Virtual Hardware tab.\n\n    Find the unexpected PCI device returned from the check.\n\n    Hover the mouse over the device and click the circled \\\"X\\\" to remove the device. Click \\\"OK\\\".\n\n    or\n\n    From a PowerCLI command prompt while connected to the ESXi host or vCenter server, run the following command:\n\n    Get-VM \\\"VM Name\\\" | Get-PassthroughDevice | Remove-PassthroughDevice\n  \"\n  impact 0.5\n  tag severity: 'medium'\n  tag gtitle: 'SRG-OS-000480-VMM-002000'\n  tag gid: 'V-VMCH-80-000214'\n  tag rid: 'SV-VMCH-80-000214'\n  tag stig_id: 'VMCH-80-000214'\n  tag cci: ['CCI-000366']\n  tag nist: ['CM-6 b']\n\n  vmName = input('vmName')\n  allvms = input('allvms')\n  vms = []\n\n  unless vmName.empty?\n    vms = powercli_command(\"Get-VM -Name #{vmName} | Sort-Object Name | Select -ExpandProperty Name\").stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n  unless allvms == false\n    vms = powercli_command('Get-VM | Sort-Object Name | Select -ExpandProperty Name').stdout.gsub(\"\\r\\n\", \"\\n\").split(\"\\n\")\n  end\n\n  if !vms.empty?\n    vms.each do |vm|\n      command = \"Get-VM -Name '#{vm}' | Get-PassthroughDevice\"\n      result = powercli_command(command).stdout.strip\n      describe \"Checking the VM: #{vm} for PCI passthrough devices\" do\n        subject { result }\n        it { should be_empty }\n      end\n    end\n  else\n    describe 'No VMs found!' do\n      skip 'No VMs found...skipping tests'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"C:/Users/rlakey/.inspec/cache/e8186ecb29a879f6c234680093c8d3b1f007fb81b3af588b7ff12cdf587bfd7e/controls/VMCH-80-000214.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Checking the VM: stig vm2 for PCI passthrough devices is expected to be empty","run_time":0.0084144,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stig vm2 for PCI passthrough devices"},{"status":"passed","code_desc":"Checking the VM: stigvm1 for PCI passthrough devices is expected to be empty","run_time":0.00833,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: stigvm1 for PCI passthrough devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for PCI passthrough devices is expected to be empty","run_time":0.0082416,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-1446f2cc-b6b7-4778-84b7-f73f758dd46c for PCI passthrough devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for PCI passthrough devices is expected to be empty","run_time":0.0082677,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-28a51340-7070-4437-b4b1-a87b7480ac7d for PCI passthrough devices"},{"status":"passed","code_desc":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for PCI passthrough devices is expected to be empty","run_time":0.0081769,"start_time":"2023-06-07T08:29:42-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Checking the VM: vCLS-b680b5a0-5434-48a0-8420-82c95e5ab481 for PCI passthrough devices"}]}],"status":"loaded","status_message":""}],"statistics":{"duration":73.759917},"version":"5.22.3"}